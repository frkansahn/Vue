{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-ui\\src\\panel\\balloon\\contextualballoon.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-ui\\src\\panel\\balloon\\contextualballoon.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1581760786382},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2dldCBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2dldCI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwoKLyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDIwLCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHVpL3BhbmVsL2JhbGxvb24vY29udGV4dHVhbGJhbGxvb24KICovCmltcG9ydCBQbHVnaW4gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1jb3JlL3NyYy9wbHVnaW4nOwppbXBvcnQgQmFsbG9vblBhbmVsVmlldyBmcm9tICcuL2JhbGxvb25wYW5lbHZpZXcnOwppbXBvcnQgVmlldyBmcm9tICcuLi8uLi92aWV3JzsKaW1wb3J0IEJ1dHRvblZpZXcgZnJvbSAnLi4vLi4vYnV0dG9uL2J1dHRvbnZpZXcnOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9ja2VkaXRvcmVycm9yJzsKaW1wb3J0IEZvY3VzVHJhY2tlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9mb2N1c3RyYWNrZXInOwppbXBvcnQgdG9Vbml0IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2RvbS90b3VuaXQnOwppbXBvcnQgUmVjdCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9kb20vcmVjdCc7CmltcG9ydCBwcmV2SWNvbiBmcm9tICcuLi8uLi8uLi90aGVtZS9pY29ucy9wcmV2aW91cy1hcnJvdy5zdmcnOwppbXBvcnQgbmV4dEljb24gZnJvbSAnLi4vLi4vLi4vdGhlbWUvaWNvbnMvbmV4dC1hcnJvdy5zdmcnOwppbXBvcnQgJy4uLy4uLy4uL3RoZW1lL2NvbXBvbmVudHMvcGFuZWwvYmFsbG9vbnJvdGF0b3IuY3NzJzsKaW1wb3J0ICcuLi8uLi8uLi90aGVtZS9jb21wb25lbnRzL3BhbmVsL2Zha2VwYW5lbC5jc3MnOwp2YXIgdG9QeCA9IHRvVW5pdCgncHgnKTsKLyoqCiAqIFByb3ZpZGVzIHRoZSBjb21tb24gY29udGV4dHVhbCBiYWxsb29uIGZvciB0aGUgZWRpdG9yLgogKgogKiBUaGUgcm9sZSBvZiB0aGlzIHBsdWdpbiBpcyB0byB1bmlmeSB0aGUgY29udGV4dHVhbCBiYWxsb29ucyBsb2dpYywgc2ltcGxpZnkgdmlld3MgbWFuYWdlbWVudCBhbmQgaGVscAogKiBhdm9pZCB0aGUgdW5uZWNlc3NhcnkgY29tcGxleGl0eSBvZiBoYW5kbGluZyBtdWx0aXBsZSB7QGxpbmsgbW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vYmFsbG9vbnBhbmVsdmlld35CYWxsb29uUGFuZWxWaWV3fQogKiBpbnN0YW5jZXMgaW4gdGhlIGVkaXRvci4KICoKICogVGhpcyBwbHVnaW4gYWxsb3dzIGZvciBjcmVhdGluZyBzaW5nbGUgb3IgbXVsdGlwbGUgcGFuZWwgc3RhY2tzLgogKgogKiBFYWNoIHN0YWNrIG1heSBoYXZlIG11bHRpcGxlIHZpZXdzLCB3aXRoIHRoZSBvbmUgb24gdGhlIHRvcCBiZWluZyB2aXNpYmxlLiBXaGVuIHRoZSB2aXNpYmxlIHZpZXcgaXMgcmVtb3ZlZCBmcm9tIHRoZSBzdGFjaywKICogdGhlIHByZXZpb3VzIHZpZXcgYmVjb21lcyB2aXNpYmxlLgogKgogKiBJdCBtaWdodCBiZSB1c2VmdWwgdG8gaW1wbGVtZW50IG5lc3RlZCBuYXZpZ2F0aW9uIGluIGEgYmFsbG9vbi4gRm9yIGluc3RhbmNlLCBhIHRvb2xiYXIgdmlldyBtYXkgY29udGFpbiBhIGxpbmsgYnV0dG9uLgogKiBXaGVuIHlvdSBjbGljayBpdCwgYSBsaW5rIHZpZXcgKHdoaWNoIGxldHMgeW91IHNldCB0aGUgVVJMKSBpcyBjcmVhdGVkIGFuZCBwdXQgb24gdG9wIG9mIHRoZSB0b29sYmFyIHZpZXcsIHNvIHRoZSBsaW5rIHBhbmVsCiAqIGlzIGRpc3BsYXllZC4gV2hlbiB5b3UgZmluaXNoIGVkaXRpbmcgdGhlIGxpbmsgYW5kIGNsb3NlIChyZW1vdmUpIHRoZSBsaW5rIHZpZXcsIHRoZSB0b29sYmFyIHZpZXcgaXMgdmlzaWJsZSBhZ2Fpbi4KICoKICogSG93ZXZlciwgdGhlcmUgYXJlIGNhc2VzIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIGluZGVwZW5kZW50IGJhbGxvb25zIHRvIGJlIGRpc3BsYXllZCwgZm9yIGluc3RhbmNlLCBpZiB0aGUgc2VsZWN0aW9uCiAqIGlzIGluc2lkZSB0d28gaW5saW5lIGNvbW1lbnRzIGF0IHRoZSBzYW1lIHRpbWUuIEZvciBzdWNoIGNhc2VzLCB5b3UgY2FuIGNyZWF0ZSB0d28gaW5kZXBlbmRlbnQgcGFuZWwgc3RhY2tzLgogKiBUaGUgY29udGV4dHVhbCBiYWxsb29uIHBsdWdpbiB3aWxsIGNyZWF0ZSBhIG5hdmlnYXRpb24gYmFyIHRvIGxldCB0aGUgdXNlcnMgc3dpdGNoIGJldHdlZW4gdGhlc2UgcGFuZWwgc3RhY2tzIHVzaW5nIHRoZSAiTmV4dCIKICogYW5kICJQcmV2aW91cyIgYnV0dG9ucy4KICoKICogSWYgdGhlcmUgYXJlIG5vIHZpZXdzIGluIHRoZSBjdXJyZW50IHN0YWNrLCB0aGUgYmFsbG9vbiBwYW5lbCB3aWxsIHRyeSB0byBzd2l0Y2ggdG8gdGhlIG5leHQgc3RhY2suIElmIHRoZXJlIGFyZSBubwogKiBwYW5lbHMgaW4gYW55IHN0YWNrLCB0aGUgYmFsbG9vbiBwYW5lbCB3aWxsIGJlIGhpZGRlbi4KICoKICogKipOb3RlKio6IFRvIGZvcmNlIHRoZSBiYWxsb29uIHBhbmVsIHRvIHNob3cgb25seSBvbmUgdmlldywgZXZlbiBpZiB0aGVyZSBhcmUgb3RoZXIgc3RhY2tzLCB1c2UgdGhlIGBzaW5nbGVWaWV3TW9kZT10cnVlYCBvcHRpb24KICogd2hlbiB7QGxpbmsgbW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vY29udGV4dHVhbGJhbGxvb25+Q29udGV4dHVhbEJhbGxvb24jYWRkIGFkZGluZ30gYSB2aWV3IHRvIGEgcGFuZWwuCiAqCiAqIEZyb20gdGhlIGltcGxlbWVudGF0aW9uIHBvaW50IG9mIHZpZXcsIHRoZSBjb250ZXh0dWFsIGJhbGxvbiBwbHVnaW4gaXMgcmV1c2luZyBhIHNpbmdsZQogKiB7QGxpbmsgbW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vYmFsbG9vbnBhbmVsdmlld35CYWxsb29uUGFuZWxWaWV3fSBpbnN0YW5jZSB0byBkaXNwbGF5IG11bHRpcGxlIGNvbnRleHR1YWwgYmFsbG9vbgogKiBwYW5lbHMgaW4gdGhlIGVkaXRvci4gSXQgYWxzbyBjcmVhdGVzIGEgc3BlY2lhbCB7QGxpbmsgbW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vY29udGV4dHVhbGJhbGxvb25+Um90YXRvclZpZXcgcm90YXRvciB2aWV3fSwKICogdXNlZCB0byBtYW5hZ2UgbXVsdGlwbGUgcGFuZWwgc3RhY2tzLiBSb3RhdG9yIHZpZXcgaXMgYSBjaGlsZCBvZiB0aGUgYmFsbG9vbiBwYW5lbCB2aWV3IGFuZCB0aGUgcGFyZW50IG9mIHRoZSBzcGVjaWZpYwogKiB2aWV3IHlvdSB3YW50IHRvIGRpc3BsYXkuIElmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgcGFuZWwgc3RhY2sgdG8gYmUgZGlzcGxheWVkLCB0aGUgcm90YXRvciB2aWV3IHdpbGwgYWRkIGEKICogbmF2aWdhdGlvbiBiYXIuIElmIHRoZXJlIGlzIG9ubHkgb25lIHN0YWNrLCB0aGUgcm90YXRvciB2aWV3IGlzIHRyYW5zcGFyZW50IChpdCBkb2VzIG5vdCBhZGQgYW55IFVJIGVsZW1lbnRzKS4KICoKICogQGV4dGVuZHMgbW9kdWxlOmNvcmUvcGx1Z2luflBsdWdpbgogKi8KCnZhciBDb250ZXh0dWFsQmFsbG9vbiA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9QbHVnaW4pIHsKICBfaW5oZXJpdHMoQ29udGV4dHVhbEJhbGxvb24sIF9QbHVnaW4pOwoKICBfY3JlYXRlQ2xhc3MoQ29udGV4dHVhbEJhbGxvb24sIG51bGwsIFt7CiAgICBrZXk6ICJwbHVnaW5OYW1lIiwKCiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gJ0NvbnRleHR1YWxCYWxsb29uJzsKICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9XSk7CgogIGZ1bmN0aW9uIENvbnRleHR1YWxCYWxsb29uKGVkaXRvcikgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb250ZXh0dWFsQmFsbG9vbik7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ29udGV4dHVhbEJhbGxvb24pLmNhbGwodGhpcywgZWRpdG9yKSk7CiAgICAvKioKICAgICAqIFRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2RvbS9wb3NpdGlvbn5PcHRpb25zI2xpbWl0ZXIgcG9zaXRpb24gbGltaXRlcn0KICAgICAqIGZvciB0aGUge0BsaW5rICN2aWV3IGJhbGxvb259LCB1c2VkIHdoZW4gbm8gYGxpbWl0ZXJgIGhhcyBiZWVuIHBhc3NlZCBpbnRvIHtAbGluayAjYWRkfQogICAgICogb3Ige0BsaW5rICN1cGRhdGVQb3NpdGlvbn0uCiAgICAgKgogICAgICogQnkgZGVmYXVsdCwgYSBmdW5jdGlvbiB0aGF0IG9idGFpbnMgdGhlIGZhcnRoZXN0IERPTQogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yb290ZWRpdGFibGVlbGVtZW50flJvb3RFZGl0YWJsZUVsZW1lbnR9CiAgICAgKiBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNzZWxlY3Rpb259LgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+T3B0aW9ucyNsaW1pdGVyfSAjcG9zaXRpb25MaW1pdGVyCiAgICAgKi8KCiAgICBfdGhpcy5wb3NpdGlvbkxpbWl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2aWV3ID0gX3RoaXMuZWRpdG9yLmVkaXRpbmcudmlldzsKICAgICAgdmFyIHZpZXdEb2N1bWVudCA9IHZpZXcuZG9jdW1lbnQ7CiAgICAgIHZhciBlZGl0YWJsZUVsZW1lbnQgPSB2aWV3RG9jdW1lbnQuc2VsZWN0aW9uLmVkaXRhYmxlRWxlbWVudDsKCiAgICAgIGlmIChlZGl0YWJsZUVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gdmlldy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKGVkaXRhYmxlRWxlbWVudC5yb290KTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogICAgLyoqCiAgICAgKiBUaGUgY3VycmVudGx5IHZpc2libGUgdmlldyBvciBgbnVsbGAgd2hlbiB0aGVyZSBhcmUgbm8gdmlld3MgaW4gYW55IHN0YWNrLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS92aWV3flZpZXd8bnVsbH0gI3Zpc2libGVWaWV3CiAgICAgKi8KCgogICAgX3RoaXMuc2V0KCd2aXNpYmxlVmlldycsIG51bGwpOwogICAgLyoqCiAgICAgKiBUaGUgY29tbW9uIGJhbGxvb24gcGFuZWwgdmlldy4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2JhbGxvb25wYW5lbHZpZXd+QmFsbG9vblBhbmVsVmlld30gI3ZpZXcKICAgICAqLwoKCiAgICBfdGhpcy52aWV3ID0gbmV3IEJhbGxvb25QYW5lbFZpZXcoZWRpdG9yLmxvY2FsZSk7CiAgICBlZGl0b3IudWkudmlldy5ib2R5LmFkZChfdGhpcy52aWV3KTsKICAgIGVkaXRvci51aS5mb2N1c1RyYWNrZXIuYWRkKF90aGlzLnZpZXcuZWxlbWVudCk7CiAgICAvKioKICAgICAqIFRoZSBtYXAgb2Ygdmlld3MgYW5kIHRoZWlyIHN0YWNrcy4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge01hcC48bW9kdWxlOnVpL3ZpZXd+VmlldyxTZXQ+fQogICAgICovCgogICAgX3RoaXMuX3ZpZXdUb1N0YWNrID0gbmV3IE1hcCgpOwogICAgLyoqCiAgICAgKiBUaGUgbWFwIG9mIElEcyBhbmQgc3RhY2tzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAdHlwZSB7TWFwLjxTdHJpbmcsU2V0Pn0KICAgICAqLwoKICAgIF90aGlzLl9pZFRvU3RhY2sgPSBuZXcgTWFwKCk7CiAgICAvKioKICAgICAqIEEgdG90YWwgbnVtYmVyIG9mIGFsbCBzdGFja3MgaW4gdGhlIGJhbGxvb24uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge051bWJlcn0gI19udW1iZXJPZlN0YWNrcwogICAgICovCgogICAgX3RoaXMuc2V0KCdfbnVtYmVyT2ZTdGFja3MnLCAwKTsKICAgIC8qKgogICAgICogQSBmbGFnIHRoYXQgY29udHJvbHMgdGhlIHNpbmdsZSB2aWV3IG1vZGUuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge0Jvb2xlYW59ICNfc2luZ2xlVmlld01vZGUKICAgICAqLwoKCiAgICBfdGhpcy5zZXQoJ19zaW5nbGVWaWV3TW9kZScsIGZhbHNlKTsKICAgIC8qKgogICAgICogUm90YXRvciB2aWV3IGVtYmVkZGVkIGluIHRoZSBjb250ZXh0dWFsIGJhbGxvb24uCiAgICAgKiBEaXNwbGF5cyB0aGUgY3VycmVudGx5IHZpc2libGUgdmlldyBpbiB0aGUgYmFsbG9vbiBhbmQgcHJvdmlkZXMgbmF2aWdhdGlvbiBmb3Igc3dpdGNoaW5nIHN0YWNrcy4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge21vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29uflJvdGF0b3JWaWV3fQogICAgICovCgoKICAgIF90aGlzLl9yb3RhdG9yVmlldyA9IF90aGlzLl9jcmVhdGVSb3RhdG9yVmlldygpOwogICAgLyoqCiAgICAgKiBEaXNwbGF5cyBmYWtlIHBhbmVscyB1bmRlciB0aGUgYmFsbG9vbiBwYW5lbCB2aWV3IHdoZW4gbXVsdGlwbGUgc3RhY2tzIGFyZSBhZGRlZCB0byB0aGUgYmFsbG9vbi4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge21vZHVsZTp1aS92aWV3flZpZXd9CiAgICAgKi8KCiAgICBfdGhpcy5fZmFrZVBhbmVsc1ZpZXcgPSBfdGhpcy5fY3JlYXRlRmFrZVBhbmVsc1ZpZXcoKTsKICAgIHJldHVybiBfdGhpczsKICB9CiAgLyoqCiAgICogUmV0dXJucyBgdHJ1ZWAgd2hlbiB0aGUgZ2l2ZW4gdmlldyBpcyBpbiBvbmUgb2YgdGhlIHN0YWNrcy4gT3RoZXJ3aXNlIHJldHVybnMgYGZhbHNlYC4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOnVpL3ZpZXd+Vmlld30gdmlldwogICAqIEByZXR1cm5zIHtCb29sZWFufQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKENvbnRleHR1YWxCYWxsb29uLCBbewogICAga2V5OiAiaGFzVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzVmlldyh2aWV3KSB7CiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuX3ZpZXdUb1N0YWNrLmtleXMoKSkuaW5jbHVkZXModmlldyk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBuZXcgdmlldyB0byB0aGUgc3RhY2sgYW5kIG1ha2VzIGl0IHZpc2libGUgaWYgdGhlIGN1cnJlbnQgc3RhY2sgaXMgdmlzaWJsZQogICAgICogb3IgaXQgaXMgdGhlIGZpcnN0IHZpZXcgaW4gdGhlIGJhbGxvb24uCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHZpZXcuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RhdGEuc3RhY2tJZD0nbWFpbiddIFRoZSBJRCBvZiB0aGUgc3RhY2sgdGhhdCB0aGUgdmlldyBpcyBhZGRlZCB0by4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3ZpZXd+Vmlld30gW2RhdGEudmlld10gVGhlIGNvbnRlbnQgb2YgdGhlIGJhbGxvb24uCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+T3B0aW9uc30gW2RhdGEucG9zaXRpb25dIFBvc2l0aW9uaW5nIG9wdGlvbnMuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RhdGEuYmFsbG9vbkNsYXNzTmFtZV0gQW4gYWRkaXRpb25hbCBDU1MgY2xhc3MgYWRkZWQgdG8gdGhlIHtAbGluayAjdmlldyBiYWxsb29ufSB3aGVuIHZpc2libGUuCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtkYXRhLndpdGhBcnJvdz10cnVlXSBXaGV0aGVyIHRoZSB7QGxpbmsgI3ZpZXcgYmFsbG9vbn0gc2hvdWxkIGJlIHJlbmRlcmVkIHdpdGggYW4gYXJyb3cuCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtkYXRhLnNpbmdsZVZpZXdNb2RlPWZhbHNlXSBXaGV0aGVyIHRoZSB2aWV3IHNob3VsZCBiZSB0aGUgb25seSB2aXNpYmxlIHZpZXcgZXZlbiBpZiBvdGhlciBzdGFja3Mgd2VyZSBhZGRlZC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZChkYXRhKSB7CiAgICAgIGlmICh0aGlzLmhhc1ZpZXcoZGF0YS52aWV3KSkgewogICAgICAgIC8qKgogICAgICAgICAqIFRyeWluZyB0byBhZGQgY29uZmlndXJhdGlvbiBvZiB0aGUgc2FtZSB2aWV3IG1vcmUgdGhhbiBvbmNlLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGNvbnRleHR1YWxiYWxsb29uLWFkZC12aWV3LWV4aXN0CiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnRleHR1YWxiYWxsb29uLWFkZC12aWV3LWV4aXN0OiBDYW5ub3QgYWRkIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHNhbWUgdmlldyB0d2ljZS4nLCBbdGhpcywgZGF0YV0pOwogICAgICB9CgogICAgICB2YXIgc3RhY2tJZCA9IGRhdGEuc3RhY2tJZCB8fCAnbWFpbic7IC8vIElmIG5ldyBzdGFjayBpcyBhZGRlZCwgY3JlYXRlcyBpdCBhbmQgc2hvdyB2aWV3IGZyb20gdGhpcyBzdGFjay4KCiAgICAgIGlmICghdGhpcy5faWRUb1N0YWNrLmhhcyhzdGFja0lkKSkgewogICAgICAgIHRoaXMuX2lkVG9TdGFjay5zZXQoc3RhY2tJZCwgbmV3IE1hcChbW2RhdGEudmlldywgZGF0YV1dKSk7CgogICAgICAgIHRoaXMuX3ZpZXdUb1N0YWNrLnNldChkYXRhLnZpZXcsIHRoaXMuX2lkVG9TdGFjay5nZXQoc3RhY2tJZCkpOwoKICAgICAgICB0aGlzLl9udW1iZXJPZlN0YWNrcyA9IHRoaXMuX2lkVG9TdGFjay5zaXplOwoKICAgICAgICBpZiAoIXRoaXMuX3Zpc2libGVTdGFjayB8fCBkYXRhLnNpbmdsZVZpZXdNb2RlKSB7CiAgICAgICAgICB0aGlzLnNob3dTdGFjayhzdGFja0lkKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHN0YWNrID0gdGhpcy5faWRUb1N0YWNrLmdldChzdGFja0lkKTsKCiAgICAgIGlmIChkYXRhLnNpbmdsZVZpZXdNb2RlKSB7CiAgICAgICAgdGhpcy5zaG93U3RhY2soc3RhY2tJZCk7CiAgICAgIH0gLy8gQWRkIG5ldyB2aWV3IHRvIHRoZSBzdGFjay4KCgogICAgICBzdGFjay5zZXQoZGF0YS52aWV3LCBkYXRhKTsKCiAgICAgIHRoaXMuX3ZpZXdUb1N0YWNrLnNldChkYXRhLnZpZXcsIHN0YWNrKTsgLy8gQW5kIGRpc3BsYXkgaXQgaWYgaXMgYWRkZWQgdG8gdGhlIGN1cnJlbnRseSB2aXNpYmxlIHN0YWNrLgoKCiAgICAgIGlmIChzdGFjayA9PT0gdGhpcy5fdmlzaWJsZVN0YWNrKSB7CiAgICAgICAgdGhpcy5fc2hvd1ZpZXcoZGF0YSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyB0aGUgZ2l2ZW4gdmlldyBmcm9tIHRoZSBzdGFjay4gSWYgdGhlIHJlbW92ZWQgdmlldyB3YXMgdmlzaWJsZSwKICAgICAqIHRoZSB2aWV3IHByZWNlZGluZyBpdCBpbiB0aGUgc3RhY2sgd2lsbCBiZWNvbWUgdmlzaWJsZSBpbnN0ZWFkLgogICAgICogV2hlbiB0aGVyZSBpcyBubyB2aWV3IGluIHRoZSBzdGFjaywgdGhlIG5leHQgc3RhY2sgd2lsbCBiZSBkaXNwbGF5ZWQuCiAgICAgKiBXaGVuIHRoZXJlIGFyZSBubyBtb3JlIHN0YWNrcywgdGhlIGJhbGxvb24gd2lsbCBoaWRlLgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3ZpZXd+Vmlld30gdmlldyBBIHZpZXcgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBiYWxsb29uLgogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKHZpZXcpIHsKICAgICAgaWYgKCF0aGlzLmhhc1ZpZXcodmlldykpIHsKICAgICAgICAvKioKICAgICAgICAgKiBUcnlpbmcgdG8gcmVtb3ZlIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSB2aWV3IG5vdCBkZWZpbmVkIGluIHRoZSBzdGFjay4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciBjb250ZXh0dWFsYmFsbG9vbi1yZW1vdmUtdmlldy1ub3QtZXhpc3QKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29udGV4dHVhbGJhbGxvb24tcmVtb3ZlLXZpZXctbm90LWV4aXN0OiBDYW5ub3QgcmVtb3ZlIHRoZSBjb25maWd1cmF0aW9uIG9mIGEgbm9uLWV4aXN0ZW50IHZpZXcuJywgW3RoaXMsIHZpZXddKTsKICAgICAgfQoKICAgICAgdmFyIHN0YWNrID0gdGhpcy5fdmlld1RvU3RhY2suZ2V0KHZpZXcpOwoKICAgICAgaWYgKHRoaXMuX3NpbmdsZVZpZXdNb2RlICYmIHRoaXMudmlzaWJsZVZpZXcgPT09IHZpZXcpIHsKICAgICAgICB0aGlzLl9zaW5nbGVWaWV3TW9kZSA9IGZhbHNlOwogICAgICB9IC8vIFdoZW4gdmlzaWJsZSB2aWV3IHdpbGwgYmUgcmVtb3ZlZCB3ZSBuZWVkIHRvIHNob3cgYSBwcmVjZWRpbmcgdmlldyBvciBuZXh0IHN0YWNrCiAgICAgIC8vIGlmIGEgdmlldyBpcyB0aGUgb25seSB2aWV3IGluIHRoZSBzdGFjay4KCgogICAgICBpZiAodGhpcy52aXNpYmxlVmlldyA9PT0gdmlldykgewogICAgICAgIGlmIChzdGFjay5zaXplID09PSAxKSB7CiAgICAgICAgICBpZiAodGhpcy5faWRUb1N0YWNrLnNpemUgPiAxKSB7CiAgICAgICAgICAgIHRoaXMuX3Nob3dOZXh0U3RhY2soKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudmlldy5oaWRlKCk7CiAgICAgICAgICAgIHRoaXMudmlzaWJsZVZpZXcgPSBudWxsOwoKICAgICAgICAgICAgdGhpcy5fcm90YXRvclZpZXcuaGlkZVZpZXcoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5fc2hvd1ZpZXcoQXJyYXkuZnJvbShzdGFjay52YWx1ZXMoKSlbc3RhY2suc2l6ZSAtIDJdKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzdGFjay5zaXplID09PSAxKSB7CiAgICAgICAgdGhpcy5faWRUb1N0YWNrLmRlbGV0ZSh0aGlzLl9nZXRTdGFja0lkKHN0YWNrKSk7CgogICAgICAgIHRoaXMuX251bWJlck9mU3RhY2tzID0gdGhpcy5faWRUb1N0YWNrLnNpemU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhY2suZGVsZXRlKHZpZXcpOwogICAgICB9CgogICAgICB0aGlzLl92aWV3VG9TdGFjay5kZWxldGUodmlldyk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBiYWxsb29uIHVzaW5nIHRoZSBwb3NpdGlvbiBkYXRhIG9mIHRoZSBmaXJzdCB2aXNpYmxlIHZpZXcgaW4gdGhlIHN0YWNrLgogICAgICogV2hlbiBuZXcgcG9zaXRpb24gZGF0YSBpcyBnaXZlbiwgdGhlIHBvc2l0aW9uIGRhdGEgb2YgdGhlIGN1cnJlbnRseSB2aXNpYmxlIHZpZXcgd2lsbCBiZSB1cGRhdGVkLgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOnV0aWxzL2RvbS9wb3NpdGlvbn5PcHRpb25zfSBbcG9zaXRpb25dIHBvc2l0aW9uIG9wdGlvbnMuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAidXBkYXRlUG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVBvc2l0aW9uKHBvc2l0aW9uKSB7CiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHRoaXMuX3Zpc2libGVTdGFjay5nZXQodGhpcy52aXNpYmxlVmlldykucG9zaXRpb24gPSBwb3NpdGlvbjsKICAgICAgfQoKICAgICAgdGhpcy52aWV3LnBpbih0aGlzLl9nZXRCYWxsb29uUG9zaXRpb24oKSk7CgogICAgICB0aGlzLl9mYWtlUGFuZWxzVmlldy51cGRhdGVQb3NpdGlvbigpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG93cyB0aGUgbGFzdCB2aWV3IGZyb20gdGhlIHN0YWNrIG9mIGEgZ2l2ZW4gSUQuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGlkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2hvd1N0YWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93U3RhY2soaWQpIHsKICAgICAgdGhpcy52aXNpYmxlU3RhY2sgPSBpZDsKCiAgICAgIHZhciBzdGFjayA9IHRoaXMuX2lkVG9TdGFjay5nZXQoaWQpOwoKICAgICAgaWYgKCFzdGFjaykgewogICAgICAgIC8qKgogICAgICAgICAqIFRyeWluZyB0byBzaG93IGEgc3RhY2sgdGhhdCBkb2VzIG5vdCBleGlzdC4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciBjb250ZXh0dWFsYmFsbG9vbi1zaG93c3RhY2stc3RhY2stbm90LWV4aXN0CiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnRleHR1YWxiYWxsb29uLXNob3dzdGFjay1zdGFjay1ub3QtZXhpc3Q6IENhbm5vdCBzaG93IGEgc3RhY2sgdGhhdCBkb2VzIG5vdCBleGlzdC4nLCB0aGlzKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX3Zpc2libGVTdGFjayA9PT0gc3RhY2spIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX3Nob3dWaWV3KEFycmF5LmZyb20oc3RhY2sudmFsdWVzKCkpLnBvcCgpKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgc3RhY2sgb2YgdGhlIGN1cnJlbnRseSB2aXNpYmxlIHZpZXcuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEB0eXBlIHtTZXR9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2dldFN0YWNrSWQiLAoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgSUQgb2YgdGhlIGdpdmVuIHN0YWNrLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge1NldH0gc3RhY2sKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U3RhY2tJZChzdGFjaykgewogICAgICB2YXIgZW50cnkgPSBBcnJheS5mcm9tKHRoaXMuX2lkVG9TdGFjay5lbnRyaWVzKCkpLmZpbmQoZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgICAgcmV0dXJuIGVudHJ5WzFdID09PSBzdGFjazsKICAgICAgfSk7CiAgICAgIHJldHVybiBlbnRyeVswXTsKICAgIH0KICAgIC8qKgogICAgICogU2hvd3MgdGhlIGxhc3QgdmlldyBmcm9tIHRoZSBuZXh0IHN0YWNrLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3Nob3dOZXh0U3RhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zaG93TmV4dFN0YWNrKCkgewogICAgICB2YXIgc3RhY2tzID0gQXJyYXkuZnJvbSh0aGlzLl9pZFRvU3RhY2sudmFsdWVzKCkpOwogICAgICB2YXIgbmV4dEluZGV4ID0gc3RhY2tzLmluZGV4T2YodGhpcy5fdmlzaWJsZVN0YWNrKSArIDE7CgogICAgICBpZiAoIXN0YWNrc1tuZXh0SW5kZXhdKSB7CiAgICAgICAgbmV4dEluZGV4ID0gMDsKICAgICAgfQoKICAgICAgdGhpcy5zaG93U3RhY2sodGhpcy5fZ2V0U3RhY2tJZChzdGFja3NbbmV4dEluZGV4XSkpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG93cyB0aGUgbGFzdCB2aWV3IGZyb20gdGhlIHByZXZpb3VzIHN0YWNrLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3Nob3dQcmV2U3RhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zaG93UHJldlN0YWNrKCkgewogICAgICB2YXIgc3RhY2tzID0gQXJyYXkuZnJvbSh0aGlzLl9pZFRvU3RhY2sudmFsdWVzKCkpOwogICAgICB2YXIgbmV4dEluZGV4ID0gc3RhY2tzLmluZGV4T2YodGhpcy5fdmlzaWJsZVN0YWNrKSAtIDE7CgogICAgICBpZiAoIXN0YWNrc1tuZXh0SW5kZXhdKSB7CiAgICAgICAgbmV4dEluZGV4ID0gc3RhY2tzLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hvd1N0YWNrKHRoaXMuX2dldFN0YWNrSWQoc3RhY2tzW25leHRJbmRleF0pKTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyBhIHJvdGF0b3Igdmlldy4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHJldHVybnMge21vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29uflJvdGF0b3JWaWV3fQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9jcmVhdGVSb3RhdG9yVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZVJvdGF0b3JWaWV3KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciB2aWV3ID0gbmV3IFJvdGF0b3JWaWV3KHRoaXMuZWRpdG9yLmxvY2FsZSk7CiAgICAgIHZhciB0ID0gdGhpcy5lZGl0b3IubG9jYWxlLnQ7CiAgICAgIHRoaXMudmlldy5jb250ZW50LmFkZCh2aWV3KTsgLy8gSGlkZSBuYXZpZ2F0aW9uIHdoZW4gdGhlcmUgaXMgb25seSBhIG9uZSBzdGFjayAmIG5vdCBpbiBzaW5nbGUgdmlldyBtb2RlLgoKICAgICAgdmlldy5iaW5kKCdpc05hdmlnYXRpb25WaXNpYmxlJykudG8odGhpcywgJ19udW1iZXJPZlN0YWNrcycsIHRoaXMsICdfc2luZ2xlVmlld01vZGUnLCBmdW5jdGlvbiAodmFsdWUsIGlzU2luZ2xlVmlld01vZGUpIHsKICAgICAgICByZXR1cm4gIWlzU2luZ2xlVmlld01vZGUgJiYgdmFsdWUgPiAxOwogICAgICB9KTsgLy8gVXBkYXRlIGJhbGxvb24gcG9zaXRpb24gYWZ0ZXIgdG9nZ2xpbmcgbmF2aWdhdGlvbi4KCiAgICAgIHZpZXcub24oJ2NoYW5nZTppc05hdmlnYXRpb25WaXNpYmxlJywgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlUG9zaXRpb24oKTsKICAgICAgfSwgewogICAgICAgIHByaW9yaXR5OiAnbG93JwogICAgICB9KTsgLy8gVXBkYXRlIHN0YWNrcyBjb3VudGVyIHZhbHVlLgoKICAgICAgdmlldy5iaW5kKCdjb3VudGVyJykudG8odGhpcywgJ3Zpc2libGVWaWV3JywgdGhpcywgJ19udW1iZXJPZlN0YWNrcycsIGZ1bmN0aW9uICh2aXNpYmxlVmlldywgbnVtYmVyT2ZTdGFja3MpIHsKICAgICAgICBpZiAobnVtYmVyT2ZTdGFja3MgPCAyKSB7CiAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQoKICAgICAgICB2YXIgY3VycmVudCA9IEFycmF5LmZyb20oX3RoaXMyLl9pZFRvU3RhY2sudmFsdWVzKCkpLmluZGV4T2YoX3RoaXMyLl92aXNpYmxlU3RhY2spICsgMTsKICAgICAgICByZXR1cm4gdCgnJTAgb2YgJTEnLCBbY3VycmVudCwgbnVtYmVyT2ZTdGFja3NdKTsKICAgICAgfSk7CiAgICAgIHZpZXcuYnV0dG9uTmV4dFZpZXcub24oJ2V4ZWN1dGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gV2hlbiBjdXJyZW50IHZpZXcgaGFzIGEgZm9jdXMgdGhlbiBtb3ZlIGZvY3VzIHRvIHRoZSBlZGl0YWJsZSBiZWZvcmUgcmVtb3ZpbmcgaXQsCiAgICAgICAgLy8gb3RoZXJ3aXNlIGVkaXRvciB3aWxsIGxvc3QgZm9jdXMuCiAgICAgICAgaWYgKHZpZXcuZm9jdXNUcmFja2VyLmlzRm9jdXNlZCkgewogICAgICAgICAgX3RoaXMyLmVkaXRvci5lZGl0aW5nLnZpZXcuZm9jdXMoKTsKICAgICAgICB9CgogICAgICAgIF90aGlzMi5fc2hvd05leHRTdGFjaygpOwogICAgICB9KTsKICAgICAgdmlldy5idXR0b25QcmV2Vmlldy5vbignZXhlY3V0ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBXaGVuIGN1cnJlbnQgdmlldyBoYXMgYSBmb2N1cyB0aGVuIG1vdmUgZm9jdXMgdG8gdGhlIGVkaXRhYmxlIGJlZm9yZSByZW1vdmluZyBpdCwKICAgICAgICAvLyBvdGhlcndpc2UgZWRpdG9yIHdpbGwgbG9zdCBmb2N1cy4KICAgICAgICBpZiAodmlldy5mb2N1c1RyYWNrZXIuaXNGb2N1c2VkKSB7CiAgICAgICAgICBfdGhpczIuZWRpdG9yLmVkaXRpbmcudmlldy5mb2N1cygpOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMyLl9zaG93UHJldlN0YWNrKCk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdmlldzsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybnMge21vZHVsZTp1aS92aWV3flZpZXd9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2NyZWF0ZUZha2VQYW5lbHNWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRmFrZVBhbmVsc1ZpZXcoKSB7CiAgICAgIHZhciB2aWV3ID0gbmV3IEZha2VQYW5lbHNWaWV3KHRoaXMuZWRpdG9yLmxvY2FsZSwgdGhpcy52aWV3KTsKICAgICAgdmlldy5iaW5kKCdudW1iZXJPZlBhbmVscycpLnRvKHRoaXMsICdfbnVtYmVyT2ZTdGFja3MnLCB0aGlzLCAnX3NpbmdsZVZpZXdNb2RlJywgZnVuY3Rpb24gKG51bWJlciwgaXNTaW5nbGVWaWV3TW9kZSkgewogICAgICAgIHZhciBzaG93UGFuZWxzID0gIWlzU2luZ2xlVmlld01vZGUgJiYgbnVtYmVyID49IDI7CiAgICAgICAgcmV0dXJuIHNob3dQYW5lbHMgPyBNYXRoLm1pbihudW1iZXIgLSAxLCAyKSA6IDA7CiAgICAgIH0pOwogICAgICB2aWV3Lmxpc3RlblRvKHRoaXMudmlldywgJ2NoYW5nZTp0b3AnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZpZXcudXBkYXRlUG9zaXRpb24oKTsKICAgICAgfSk7CiAgICAgIHZpZXcubGlzdGVuVG8odGhpcy52aWV3LCAnY2hhbmdlOmxlZnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZpZXcudXBkYXRlUG9zaXRpb24oKTsKICAgICAgfSk7CiAgICAgIHRoaXMuZWRpdG9yLnVpLnZpZXcuYm9keS5hZGQodmlldyk7CiAgICAgIHJldHVybiB2aWV3OwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSB2aWV3IGFzIHRoZSBjb250ZW50IG9mIHRoZSBiYWxsb29uIGFuZCBhdHRhY2hlcyB0aGUgYmFsbG9vbiB1c2luZyBwb3NpdGlvbgogICAgICogb3B0aW9ucyBvZiB0aGUgZmlyc3Qgdmlldy4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgQ29uZmlndXJhdGlvbi4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3ZpZXd+Vmlld30gW2RhdGEudmlld10gVGhlIHZpZXcgdG8gc2hvdyBpbiB0aGUgYmFsbG9vbi4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGF0YS5iYWxsb29uQ2xhc3NOYW1lPScnXSBBZGRpdGlvbmFsIGNsYXNzIG5hbWUgd2hpY2ggd2lsbCBiZSBhZGRlZCB0byB0aGUge0BsaW5rICN2aWV3IGJhbGxvb259LgogICAgICogQHBhcmFtIHtCb29sZWFufSBbZGF0YS53aXRoQXJyb3c9dHJ1ZV0gV2hldGhlciB0aGUge0BsaW5rICN2aWV3IGJhbGxvb259IHNob3VsZCBiZSByZW5kZXJlZCB3aXRoIGFuIGFycm93LgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zaG93VmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Nob3dWaWV3KF9yZWYpIHsKICAgICAgdmFyIHZpZXcgPSBfcmVmLnZpZXcsCiAgICAgICAgICBfcmVmJGJhbGxvb25DbGFzc05hbWUgPSBfcmVmLmJhbGxvb25DbGFzc05hbWUsCiAgICAgICAgICBiYWxsb29uQ2xhc3NOYW1lID0gX3JlZiRiYWxsb29uQ2xhc3NOYW1lID09PSB2b2lkIDAgPyAnJyA6IF9yZWYkYmFsbG9vbkNsYXNzTmFtZSwKICAgICAgICAgIF9yZWYkd2l0aEFycm93ID0gX3JlZi53aXRoQXJyb3csCiAgICAgICAgICB3aXRoQXJyb3cgPSBfcmVmJHdpdGhBcnJvdyA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWYkd2l0aEFycm93LAogICAgICAgICAgX3JlZiRzaW5nbGVWaWV3TW9kZSA9IF9yZWYuc2luZ2xlVmlld01vZGUsCiAgICAgICAgICBzaW5nbGVWaWV3TW9kZSA9IF9yZWYkc2luZ2xlVmlld01vZGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRzaW5nbGVWaWV3TW9kZTsKICAgICAgdGhpcy52aWV3LmNsYXNzID0gYmFsbG9vbkNsYXNzTmFtZTsKICAgICAgdGhpcy52aWV3LndpdGhBcnJvdyA9IHdpdGhBcnJvdzsKCiAgICAgIHRoaXMuX3JvdGF0b3JWaWV3LnNob3dWaWV3KHZpZXcpOwoKICAgICAgdGhpcy52aXNpYmxlVmlldyA9IHZpZXc7CiAgICAgIHRoaXMudmlldy5waW4odGhpcy5fZ2V0QmFsbG9vblBvc2l0aW9uKCkpOwoKICAgICAgdGhpcy5fZmFrZVBhbmVsc1ZpZXcudXBkYXRlUG9zaXRpb24oKTsKCiAgICAgIGlmIChzaW5nbGVWaWV3TW9kZSkgewogICAgICAgIHRoaXMuX3NpbmdsZVZpZXdNb2RlID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHBvc2l0aW9uIG9wdGlvbnMgb2YgdGhlIGxhc3QgdmlldyBpbiB0aGUgc3RhY2suCiAgICAgKiBUaGlzIGtlZXBzIHRoZSBiYWxsb29uIGluIHRoZSBzYW1lIHBvc2l0aW9uIHdoZW4gdGhlIHZpZXcgaXMgY2hhbmdlZC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHJldHVybnMge21vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+T3B0aW9uc30KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfZ2V0QmFsbG9vblBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QmFsbG9vblBvc2l0aW9uKCkgewogICAgICB2YXIgcG9zaXRpb24gPSBBcnJheS5mcm9tKHRoaXMuX3Zpc2libGVTdGFjay52YWx1ZXMoKSkucG9wKCkucG9zaXRpb247IC8vIFVzZSB0aGUgZGVmYXVsdCBsaW1pdGVyIGlmIG5vbmUgaGFzIGJlZW4gc3BlY2lmaWVkLgoKICAgICAgaWYgKHBvc2l0aW9uICYmICFwb3NpdGlvbi5saW1pdGVyKSB7CiAgICAgICAgLy8gRG9uJ3QgbW9kaWZ5IHRoZSBvcmlnaW5hbCBvcHRpb25zIG9iamVjdC4KICAgICAgICBwb3NpdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIHBvc2l0aW9uLCB7CiAgICAgICAgICBsaW1pdGVyOiB0aGlzLnBvc2l0aW9uTGltaXRlcgogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gcG9zaXRpb247CiAgICB9CiAgfSwgewogICAga2V5OiAiX3Zpc2libGVTdGFjayIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdUb1N0YWNrLmdldCh0aGlzLnZpc2libGVWaWV3KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBDb250ZXh0dWFsQmFsbG9vbjsKfShQbHVnaW4pOwovKioKICogUm90YXRvciB2aWV3IGlzIGEgaGVscGVyIGNsYXNzIGZvciB0aGUge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29uIENvbnRleHR1YWxCYWxsb29ufS4KICogSXQgaXMgdXNlZCBmb3IgZGlzcGxheWluZyB0aGUgbGFzdCB2aWV3IGZyb20gdGhlIGN1cnJlbnQgc3RhY2sgYW5kIHByb3ZpZGluZyBuYXZpZ2F0aW9uIGJ1dHRvbnMgZm9yIHN3aXRjaGluZyBzdGFja3MuCiAqIFNlZSB0aGUge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29uIENvbnRleHR1YWxCYWxsb29ufSBkb2N1bWVudGF0aW9uIHRvIGxlYXJuIG1vcmUuCiAqCiAqIEBleHRlbmRzIG1vZHVsZTp1aS92aWV3flZpZXcKICovCgoKZXhwb3J0IHsgQ29udGV4dHVhbEJhbGxvb24gYXMgZGVmYXVsdCB9OwoKdmFyIFJvdGF0b3JWaWV3ID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1ZpZXcpIHsKICBfaW5oZXJpdHMoUm90YXRvclZpZXcsIF9WaWV3KTsKCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICBmdW5jdGlvbiBSb3RhdG9yVmlldyhsb2NhbGUpIHsKICAgIHZhciBfdGhpczM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJvdGF0b3JWaWV3KTsKCiAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUm90YXRvclZpZXcpLmNhbGwodGhpcywgbG9jYWxlKSk7CiAgICB2YXIgdCA9IGxvY2FsZS50OwogICAgdmFyIGJpbmQgPSBfdGhpczMuYmluZFRlbXBsYXRlOwogICAgLyoqCiAgICAgKiBEZWZpbmVzIHdoZXRoZXIgbmF2aWdhdGlvbiBpcyB2aXNpYmxlIG9yIG5vdC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSAjaXNOYXZpZ2F0aW9uVmlzaWJsZQogICAgICovCgogICAgX3RoaXMzLnNldCgnaXNOYXZpZ2F0aW9uVmlzaWJsZScsIHRydWUpOwogICAgLyoqCiAgICAgKiBVc2VkIGZvciBjaGVja2luZyBpZiBhIHZpZXcgaXMgZm9jdXNlZCBvciBub3QuCiAgICAgKgogICAgICogQHR5cGUge21vZHVsZTp1dGlscy9mb2N1c3RyYWNrZXJ+Rm9jdXNUcmFja2VyfQogICAgICovCgoKICAgIF90aGlzMy5mb2N1c1RyYWNrZXIgPSBuZXcgRm9jdXNUcmFja2VyKCk7CiAgICAvKioKICAgICAqIE5hdmlnYXRpb24gYnV0dG9uIGZvciBzd2l0Y2hpbmcgdGhlIHN0YWNrIHRvIHRoZSBwcmV2aW91cyBvbmUuCiAgICAgKgogICAgICogQHR5cGUge21vZHVsZTp1aS9idXR0b24vYnV0dG9udmlld35CdXR0b25WaWV3fQogICAgICovCgogICAgX3RoaXMzLmJ1dHRvblByZXZWaWV3ID0gX3RoaXMzLl9jcmVhdGVCdXR0b25WaWV3KHQoJ1ByZXZpb3VzJyksIHByZXZJY29uKTsKICAgIC8qKgogICAgICogTmF2aWdhdGlvbiBidXR0b24gZm9yIHN3aXRjaGluZyB0aGUgc3RhY2sgdG8gdGhlIG5leHQgb25lLgogICAgICoKICAgICAqIEB0eXBlIHttb2R1bGU6dWkvYnV0dG9uL2J1dHRvbnZpZXd+QnV0dG9uVmlld30KICAgICAqLwoKICAgIF90aGlzMy5idXR0b25OZXh0VmlldyA9IF90aGlzMy5fY3JlYXRlQnV0dG9uVmlldyh0KCdOZXh0JyksIG5leHRJY29uKTsKICAgIC8qKgogICAgICogQSBjb2xsZWN0aW9uIG9mIHRoZSBjaGlsZCB2aWV3cyB0aGF0IGNyZWF0ZXMgdGhlIHJvdGF0b3IgY29udGVudC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHttb2R1bGU6dWkvdmlld2NvbGxlY3Rpb25+Vmlld0NvbGxlY3Rpb259CiAgICAgKi8KCiAgICBfdGhpczMuY29udGVudCA9IF90aGlzMy5jcmVhdGVDb2xsZWN0aW9uKCk7CgogICAgX3RoaXMzLnNldFRlbXBsYXRlKHsKICAgICAgdGFnOiAnZGl2JywKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbJ2NrJywgJ2NrLWJhbGxvb24tcm90YXRvciddLAogICAgICAgICd6LWluZGV4JzogJy0xJwogICAgICB9LAogICAgICBjaGlsZHJlbjogW3sKICAgICAgICB0YWc6ICdkaXYnLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzOiBbJ2NrLWJhbGxvb24tcm90YXRvcl9fbmF2aWdhdGlvbicsIGJpbmQudG8oJ2lzTmF2aWdhdGlvblZpc2libGUnLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gJycgOiAnY2staGlkZGVuJzsKICAgICAgICAgIH0pXQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IFtfdGhpczMuYnV0dG9uUHJldlZpZXcsIHsKICAgICAgICAgIHRhZzogJ3NwYW4nLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICBjbGFzczogWydjay1iYWxsb29uLXJvdGF0b3JfX2NvdW50ZXInXQogICAgICAgICAgfSwKICAgICAgICAgIGNoaWxkcmVuOiBbewogICAgICAgICAgICB0ZXh0OiBiaW5kLnRvKCdjb3VudGVyJykKICAgICAgICAgIH1dCiAgICAgICAgfSwgX3RoaXMzLmJ1dHRvbk5leHRWaWV3XQogICAgICB9LCB7CiAgICAgICAgdGFnOiAnZGl2JywKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGFzczogJ2NrLWJhbGxvb24tcm90YXRvcl9fY29udGVudCcKICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBfdGhpczMuY29udGVudAogICAgICB9XQogICAgfSk7CgogICAgcmV0dXJuIF90aGlzMzsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhSb3RhdG9yVmlldywgW3sKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihSb3RhdG9yVmlldy5wcm90b3R5cGUpLCAicmVuZGVyIiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHRoaXMuZm9jdXNUcmFja2VyLmFkZCh0aGlzLmVsZW1lbnQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG93cyBhIGdpdmVuIHZpZXcuCiAgICAgKgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdmlld35WaWV3fSB2aWV3IFRoZSB2aWV3IHRvIHNob3cuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2hvd1ZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dWaWV3KHZpZXcpIHsKICAgICAgdGhpcy5oaWRlVmlldygpOwogICAgICB0aGlzLmNvbnRlbnQuYWRkKHZpZXcpOwogICAgfQogICAgLyoqCiAgICAgKiBIaWRlcyB0aGUgY3VycmVudGx5IGRpc3BsYXllZCB2aWV3LgogICAgICovCgogIH0sIHsKICAgIGtleTogImhpZGVWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlVmlldygpIHsKICAgICAgdGhpcy5jb250ZW50LmNsZWFyKCk7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZXMgYSBuYXZpZ2F0aW9uIGJ1dHRvbiB2aWV3LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbGFiZWwgVGhlIGJ1dHRvbiBsYWJlbC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpY29uIFRoZSBidXR0b24gaWNvbi4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dWkvYnV0dG9uL2J1dHRvbnZpZXd+QnV0dG9uVmlld30KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY3JlYXRlQnV0dG9uVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUJ1dHRvblZpZXcobGFiZWwsIGljb24pIHsKICAgICAgdmFyIHZpZXcgPSBuZXcgQnV0dG9uVmlldyh0aGlzLmxvY2FsZSk7CiAgICAgIHZpZXcuc2V0KHsKICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgaWNvbjogaWNvbiwKICAgICAgICB0b29sdGlwOiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gdmlldzsKICAgIH0KICB9XSk7CgogIHJldHVybiBSb3RhdG9yVmlldzsKfShWaWV3KTsgLy8gRGlzcGxheXMgYWRkaXRpb25hbCBsYXllcnMgdW5kZXIgdGhlIGJhbGxvb24gd2hlbiBtdWx0aXBsZSBzdGFja3MgYXJlIGFkZGVkIHRvIHRoZSBiYWxsb29uLgovLwovLyBAcHJpdmF0ZQovLyBAZXh0ZW5kcyBtb2R1bGU6dWkvdmlld35WaWV3CgoKdmFyIEZha2VQYW5lbHNWaWV3ID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1ZpZXcyKSB7CiAgX2luaGVyaXRzKEZha2VQYW5lbHNWaWV3LCBfVmlldzIpOwoKICAvLyBAaW5oZXJpdERvYwogIGZ1bmN0aW9uIEZha2VQYW5lbHNWaWV3KGxvY2FsZSwgYmFsbG9vblBhbmVsVmlldykgewogICAgdmFyIF90aGlzNDsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmFrZVBhbmVsc1ZpZXcpOwoKICAgIF90aGlzNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihGYWtlUGFuZWxzVmlldykuY2FsbCh0aGlzLCBsb2NhbGUpKTsKICAgIHZhciBiaW5kID0gX3RoaXM0LmJpbmRUZW1wbGF0ZTsgLy8gRmFrZSBwYW5lbHMgdG9wIG9mZnNldC4KICAgIC8vCiAgICAvLyBAb2JzZXJ2YWJsZQogICAgLy8gQG1lbWJlciB7TnVtYmVyfSAjdG9wCgogICAgX3RoaXM0LnNldCgndG9wJywgMCk7IC8vIEZha2UgcGFuZWxzIGxlZnQgb2Zmc2V0LgogICAgLy8KICAgIC8vIEBvYnNlcnZhYmxlCiAgICAvLyBAbWVtYmVyIHtOdW1iZXJ9ICNsZWZ0CgoKICAgIF90aGlzNC5zZXQoJ2xlZnQnLCAwKTsgLy8gRmFrZSBwYW5lbHMgaGVpZ2h0LgogICAgLy8KICAgIC8vIEBvYnNlcnZhYmxlCiAgICAvLyBAbWVtYmVyIHtOdW1iZXJ9ICNoZWlnaHQKCgogICAgX3RoaXM0LnNldCgnaGVpZ2h0JywgMCk7IC8vIEZha2UgcGFuZWxzIHdpZHRoLgogICAgLy8KICAgIC8vIEBvYnNlcnZhYmxlCiAgICAvLyBAbWVtYmVyIHtOdW1iZXJ9ICN3aWR0aAoKCiAgICBfdGhpczQuc2V0KCd3aWR0aCcsIDApOyAvLyBOdW1iZXIgb2YgcmVuZGVyZWQgZmFrZSBwYW5lbHMuCiAgICAvLwogICAgLy8gQG9ic2VydmFibGUKICAgIC8vIEBtZW1iZXIge051bWJlcn0gI251bWJlck9mUGFuZWxzCgoKICAgIF90aGlzNC5zZXQoJ251bWJlck9mUGFuZWxzJywgMCk7IC8vIENvbGxlY3Rpb24gb2YgdGhlIGNoaWxkIHZpZXdzIHdoaWNoIGNyZWF0ZXMgZmFrZSBwYW5lbCBjb250ZW50LgogICAgLy8KICAgIC8vIEByZWFkb25seQogICAgLy8gQHR5cGUge21vZHVsZTp1aS92aWV3Y29sbGVjdGlvbn5WaWV3Q29sbGVjdGlvbn0KCgogICAgX3RoaXM0LmNvbnRlbnQgPSBfdGhpczQuY3JlYXRlQ29sbGVjdGlvbigpOyAvLyBDb250ZXh0LgogICAgLy8KICAgIC8vIEBwcml2YXRlCiAgICAvLyBAdHlwZSB7bW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vYmFsbG9vbnBhbmVsdmlld35CYWxsb29uUGFuZWxWaWV3fQoKICAgIF90aGlzNC5fYmFsbG9vblBhbmVsVmlldyA9IGJhbGxvb25QYW5lbFZpZXc7CgogICAgX3RoaXM0LnNldFRlbXBsYXRlKHsKICAgICAgdGFnOiAnZGl2JywKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbJ2NrLWZha2UtcGFuZWwnLCBiaW5kLnRvKCdudW1iZXJPZlBhbmVscycsIGZ1bmN0aW9uIChudW1iZXIpIHsKICAgICAgICAgIHJldHVybiBudW1iZXIgPyAnJyA6ICdjay1oaWRkZW4nOwogICAgICAgIH0pXSwKICAgICAgICBzdHlsZTogewogICAgICAgICAgdG9wOiBiaW5kLnRvKCd0b3AnLCB0b1B4KSwKICAgICAgICAgIGxlZnQ6IGJpbmQudG8oJ2xlZnQnLCB0b1B4KSwKICAgICAgICAgIHdpZHRoOiBiaW5kLnRvKCd3aWR0aCcsIHRvUHgpLAogICAgICAgICAgaGVpZ2h0OiBiaW5kLnRvKCdoZWlnaHQnLCB0b1B4KQogICAgICAgIH0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IF90aGlzNC5jb250ZW50CiAgICB9KTsKCiAgICBfdGhpczQub24oJ2NoYW5nZTpudW1iZXJPZlBhbmVscycsIGZ1bmN0aW9uIChldnQsIG5hbWUsIG5leHQsIHByZXYpIHsKICAgICAgaWYgKG5leHQgPiBwcmV2KSB7CiAgICAgICAgX3RoaXM0Ll9hZGRQYW5lbHMobmV4dCAtIHByZXYpOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzNC5fcmVtb3ZlUGFuZWxzKHByZXYgLSBuZXh0KTsKICAgICAgfQoKICAgICAgX3RoaXM0LnVwZGF0ZVBvc2l0aW9uKCk7CiAgICB9KTsKCiAgICByZXR1cm4gX3RoaXM0OwogIH0gLy8gQHByaXZhdGUKICAvLyBAcGFyYW0ge051bWJlcn0gbnVtYmVyCgoKICBfY3JlYXRlQ2xhc3MoRmFrZVBhbmVsc1ZpZXcsIFt7CiAgICBrZXk6ICJfYWRkUGFuZWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkUGFuZWxzKG51bWJlcikgewogICAgICB3aGlsZSAobnVtYmVyLS0pIHsKICAgICAgICB2YXIgdmlldyA9IG5ldyBWaWV3KCk7CiAgICAgICAgdmlldy5zZXRUZW1wbGF0ZSh7CiAgICAgICAgICB0YWc6ICdkaXYnCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5jb250ZW50LmFkZCh2aWV3KTsKICAgICAgICB0aGlzLnJlZ2lzdGVyQ2hpbGQodmlldyk7CiAgICAgIH0KICAgIH0gLy8gQHByaXZhdGUKICAgIC8vIEBwYXJhbSB7TnVtYmVyfSBudW1iZXIKCiAgfSwgewogICAga2V5OiAiX3JlbW92ZVBhbmVscyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZVBhbmVscyhudW1iZXIpIHsKICAgICAgd2hpbGUgKG51bWJlci0tKSB7CiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLmNvbnRlbnQubGFzdDsKICAgICAgICB0aGlzLmNvbnRlbnQucmVtb3ZlKHZpZXcpOwogICAgICAgIHRoaXMuZGVyZWdpc3RlckNoaWxkKHZpZXcpOwogICAgICAgIHZpZXcuZGVzdHJveSgpOwogICAgICB9CiAgICB9IC8vIFVwZGF0ZXMgY29vcmRpbmF0ZXMgb2YgZmFrZSBwYW5lbHMuCgogIH0sIHsKICAgIGtleTogInVwZGF0ZVBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVQb3NpdGlvbigpIHsKICAgICAgaWYgKHRoaXMubnVtYmVyT2ZQYW5lbHMpIHsKICAgICAgICB2YXIgX3RoaXMkX2JhbGxvb25QYW5lbFZpID0gdGhpcy5fYmFsbG9vblBhbmVsVmlldywKICAgICAgICAgICAgdG9wID0gX3RoaXMkX2JhbGxvb25QYW5lbFZpLnRvcCwKICAgICAgICAgICAgbGVmdCA9IF90aGlzJF9iYWxsb29uUGFuZWxWaS5sZWZ0OwoKICAgICAgICB2YXIgX3JlZjIgPSBuZXcgUmVjdCh0aGlzLl9iYWxsb29uUGFuZWxWaWV3LmVsZW1lbnQpLAogICAgICAgICAgICB3aWR0aCA9IF9yZWYyLndpZHRoLAogICAgICAgICAgICBoZWlnaHQgPSBfcmVmMi5oZWlnaHQ7CgogICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgewogICAgICAgICAgdG9wOiB0b3AsCiAgICAgICAgICBsZWZ0OiBsZWZ0LAogICAgICAgICAgd2lkdGg6IHdpZHRoLAogICAgICAgICAgaGVpZ2h0OiBoZWlnaHQKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIEZha2VQYW5lbHNWaWV3Owp9KFZpZXcpOw=="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon.js"],"names":["Plugin","BalloonPanelView","View","ButtonView","CKEditorError","FocusTracker","toUnit","Rect","prevIcon","nextIcon","toPx","ContextualBalloon","editor","positionLimiter","view","editing","viewDocument","document","editableElement","selection","domConverter","mapViewToDom","root","set","locale","ui","body","add","focusTracker","element","_viewToStack","Map","_idToStack","_rotatorView","_createRotatorView","_fakePanelsView","_createFakePanelsView","Array","from","keys","includes","data","hasView","stackId","has","get","_numberOfStacks","size","_visibleStack","singleViewMode","showStack","stack","_showView","_singleViewMode","visibleView","_showNextStack","hide","hideView","values","delete","_getStackId","position","pin","_getBalloonPosition","updatePosition","id","visibleStack","pop","entry","entries","find","stacks","nextIndex","indexOf","length","RotatorView","t","content","bind","to","value","isSingleViewMode","on","priority","numberOfStacks","current","buttonNextView","isFocused","focus","buttonPrevView","_showPrevStack","FakePanelsView","number","showPanels","Math","min","listenTo","balloonClassName","withArrow","class","showView","limiter","Object","assign","bindTemplate","_createButtonView","createCollection","setTemplate","tag","attributes","children","text","clear","label","icon","tooltip","balloonPanelView","_balloonPanelView","style","top","left","width","height","evt","name","next","prev","_addPanels","_removePanels","registerChild","last","remove","deregisterChild","destroy","numberOfPanels"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/panel/balloon/contextualballoon\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport BalloonPanelView from './balloonpanelview';\nimport View from '../../view';\nimport ButtonView from '../../button/buttonview';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport toUnit from '@ckeditor/ckeditor5-utils/src/dom/tounit';\nimport Rect from '@ckeditor/ckeditor5-utils/src/dom/rect';\n\nimport prevIcon from '../../../theme/icons/previous-arrow.svg';\nimport nextIcon from '../../../theme/icons/next-arrow.svg';\n\nimport '../../../theme/components/panel/balloonrotator.css';\nimport '../../../theme/components/panel/fakepanel.css';\n\nconst toPx = toUnit( 'px' );\n\n/**\n * Provides the common contextual balloon for the editor.\n *\n * The role of this plugin is to unify the contextual balloons logic, simplify views management and help\n * avoid the unnecessary complexity of handling multiple {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView}\n * instances in the editor.\n *\n * This plugin allows for creating single or multiple panel stacks.\n *\n * Each stack may have multiple views, with the one on the top being visible. When the visible view is removed from the stack,\n * the previous view becomes visible.\n *\n * It might be useful to implement nested navigation in a balloon. For instance, a toolbar view may contain a link button.\n * When you click it, a link view (which lets you set the URL) is created and put on top of the toolbar view, so the link panel\n * is displayed. When you finish editing the link and close (remove) the link view, the toolbar view is visible again.\n *\n * However, there are cases when there are multiple independent balloons to be displayed, for instance, if the selection\n * is inside two inline comments at the same time. For such cases, you can create two independent panel stacks.\n * The contextual balloon plugin will create a navigation bar to let the users switch between these panel stacks using the \"Next\"\n * and \"Previous\" buttons.\n *\n * If there are no views in the current stack, the balloon panel will try to switch to the next stack. If there are no\n * panels in any stack, the balloon panel will be hidden.\n *\n * **Note**: To force the balloon panel to show only one view, even if there are other stacks, use the `singleViewMode=true` option\n * when {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon#add adding} a view to a panel.\n *\n * From the implementation point of view, the contextual ballon plugin is reusing a single\n * {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView} instance to display multiple contextual balloon\n * panels in the editor. It also creates a special {@link module:ui/panel/balloon/contextualballoon~RotatorView rotator view},\n * used to manage multiple panel stacks. Rotator view is a child of the balloon panel view and the parent of the specific\n * view you want to display. If there is more than one panel stack to be displayed, the rotator view will add a\n * navigation bar. If there is only one stack, the rotator view is transparent (it does not add any UI elements).\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class ContextualBalloon extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'ContextualBalloon';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor ) {\n\t\tsuper( editor );\n\n\t\t/**\n\t\t * The {@link module:utils/dom/position~Options#limiter position limiter}\n\t\t * for the {@link #view balloon}, used when no `limiter` has been passed into {@link #add}\n\t\t * or {@link #updatePosition}.\n\t\t *\n\t\t * By default, a function that obtains the farthest DOM\n\t\t * {@link module:engine/view/rooteditableelement~RootEditableElement}\n\t\t * of the {@link module:engine/view/document~Document#selection}.\n\t\t *\n\t\t * @member {module:utils/dom/position~Options#limiter} #positionLimiter\n\t\t */\n\t\tthis.positionLimiter = () => {\n\t\t\tconst view = this.editor.editing.view;\n\t\t\tconst viewDocument = view.document;\n\t\t\tconst editableElement = viewDocument.selection.editableElement;\n\n\t\t\tif ( editableElement ) {\n\t\t\t\treturn view.domConverter.mapViewToDom( editableElement.root );\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\t/**\n\t\t * The currently visible view or `null` when there are no views in any stack.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {module:ui/view~View|null} #visibleView\n\t\t */\n\t\tthis.set( 'visibleView', null );\n\n\t\t/**\n\t\t * The common balloon panel view.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/panel/balloon/balloonpanelview~BalloonPanelView} #view\n\t\t */\n\t\tthis.view = new BalloonPanelView( editor.locale );\n\t\teditor.ui.view.body.add( this.view );\n\t\teditor.ui.focusTracker.add( this.view.element );\n\n\t\t/**\n\t\t * The map of views and their stacks.\n\t\t *\n\t\t * @private\n\t\t * @type {Map.<module:ui/view~View,Set>}\n\t\t */\n\t\tthis._viewToStack = new Map();\n\n\t\t/**\n\t\t * The map of IDs and stacks.\n\t\t *\n\t\t * @private\n\t\t * @type {Map.<String,Set>}\n\t\t */\n\t\tthis._idToStack = new Map();\n\n\t\t/**\n\t\t * A total number of all stacks in the balloon.\n\t\t *\n\t\t * @private\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #_numberOfStacks\n\t\t */\n\t\tthis.set( '_numberOfStacks', 0 );\n\n\t\t/**\n\t\t * A flag that controls the single view mode.\n\t\t *\n\t\t * @private\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Boolean} #_singleViewMode\n\t\t */\n\t\tthis.set( '_singleViewMode', false );\n\n\t\t/**\n\t\t * Rotator view embedded in the contextual balloon.\n\t\t * Displays the currently visible view in the balloon and provides navigation for switching stacks.\n\t\t *\n\t\t * @private\n\t\t * @type {module:ui/panel/balloon/contextualballoon~RotatorView}\n\t\t */\n\t\tthis._rotatorView = this._createRotatorView();\n\n\t\t/**\n\t\t * Displays fake panels under the balloon panel view when multiple stacks are added to the balloon.\n\t\t *\n\t\t * @private\n\t\t * @type {module:ui/view~View}\n\t\t */\n\t\tthis._fakePanelsView = this._createFakePanelsView();\n\t}\n\n\t/**\n\t * Returns `true` when the given view is in one of the stacks. Otherwise returns `false`.\n\t *\n\t * @param {module:ui/view~View} view\n\t * @returns {Boolean}\n\t */\n\thasView( view ) {\n\t\treturn Array.from( this._viewToStack.keys() ).includes( view );\n\t}\n\n\t/**\n\t * Adds a new view to the stack and makes it visible if the current stack is visible\n\t * or it is the first view in the balloon.\n\t *\n\t * @param {Object} data The configuration of the view.\n\t * @param {String} [data.stackId='main'] The ID of the stack that the view is added to.\n\t * @param {module:ui/view~View} [data.view] The content of the balloon.\n\t * @param {module:utils/dom/position~Options} [data.position] Positioning options.\n\t * @param {String} [data.balloonClassName] An additional CSS class added to the {@link #view balloon} when visible.\n\t * @param {Boolean} [data.withArrow=true] Whether the {@link #view balloon} should be rendered with an arrow.\n\t * @param {Boolean} [data.singleViewMode=false] Whether the view should be the only visible view even if other stacks were added.\n\t */\n\tadd( data ) {\n\t\tif ( this.hasView( data.view ) ) {\n\t\t\t/**\n\t\t\t * Trying to add configuration of the same view more than once.\n\t\t\t *\n\t\t\t * @error contextualballoon-add-view-exist\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'contextualballoon-add-view-exist: Cannot add configuration of the same view twice.',\n\t\t\t\t[ this, data ]\n\t\t\t);\n\t\t}\n\n\t\tconst stackId = data.stackId || 'main';\n\n\t\t// If new stack is added, creates it and show view from this stack.\n\t\tif ( !this._idToStack.has( stackId ) ) {\n\t\t\tthis._idToStack.set( stackId, new Map( [ [ data.view, data ] ] ) );\n\t\t\tthis._viewToStack.set( data.view, this._idToStack.get( stackId ) );\n\t\t\tthis._numberOfStacks = this._idToStack.size;\n\n\t\t\tif ( !this._visibleStack || data.singleViewMode ) {\n\t\t\t\tthis.showStack( stackId );\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst stack = this._idToStack.get( stackId );\n\n\t\tif ( data.singleViewMode ) {\n\t\t\tthis.showStack( stackId );\n\t\t}\n\n\t\t// Add new view to the stack.\n\t\tstack.set( data.view, data );\n\t\tthis._viewToStack.set( data.view, stack );\n\n\t\t// And display it if is added to the currently visible stack.\n\t\tif ( stack === this._visibleStack ) {\n\t\t\tthis._showView( data );\n\t\t}\n\t}\n\n\t/**\n\t * Removes the given view from the stack. If the removed view was visible,\n\t * the view preceding it in the stack will become visible instead.\n\t * When there is no view in the stack, the next stack will be displayed.\n\t * When there are no more stacks, the balloon will hide.\n\t *\n\t * @param {module:ui/view~View} view A view to be removed from the balloon.\n\t */\n\tremove( view ) {\n\t\tif ( !this.hasView( view ) ) {\n\t\t\t/**\n\t\t\t * Trying to remove the configuration of the view not defined in the stack.\n\t\t\t *\n\t\t\t * @error contextualballoon-remove-view-not-exist\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'contextualballoon-remove-view-not-exist: Cannot remove the configuration of a non-existent view.',\n\t\t\t\t[ this, view ]\n\t\t\t);\n\t\t}\n\n\t\tconst stack = this._viewToStack.get( view );\n\n\t\tif ( this._singleViewMode && this.visibleView === view ) {\n\t\t\tthis._singleViewMode = false;\n\t\t}\n\n\t\t// When visible view will be removed we need to show a preceding view or next stack\n\t\t// if a view is the only view in the stack.\n\t\tif ( this.visibleView === view ) {\n\t\t\tif ( stack.size === 1 ) {\n\t\t\t\tif ( this._idToStack.size > 1 ) {\n\t\t\t\t\tthis._showNextStack();\n\t\t\t\t} else {\n\t\t\t\t\tthis.view.hide();\n\t\t\t\t\tthis.visibleView = null;\n\t\t\t\t\tthis._rotatorView.hideView();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._showView( Array.from( stack.values() )[ stack.size - 2 ] );\n\t\t\t}\n\t\t}\n\n\t\tif ( stack.size === 1 ) {\n\t\t\tthis._idToStack.delete( this._getStackId( stack ) );\n\t\t\tthis._numberOfStacks = this._idToStack.size;\n\t\t} else {\n\t\t\tstack.delete( view );\n\t\t}\n\n\t\tthis._viewToStack.delete( view );\n\t}\n\n\t/**\n\t * Updates the position of the balloon using the position data of the first visible view in the stack.\n\t * When new position data is given, the position data of the currently visible view will be updated.\n\t *\n\t * @param {module:utils/dom/position~Options} [position] position options.\n\t */\n\tupdatePosition( position ) {\n\t\tif ( position ) {\n\t\t\tthis._visibleStack.get( this.visibleView ).position = position;\n\t\t}\n\n\t\tthis.view.pin( this._getBalloonPosition() );\n\t\tthis._fakePanelsView.updatePosition();\n\t}\n\n\t/**\n\t * Shows the last view from the stack of a given ID.\n\t *\n\t * @param {String} id\n\t */\n\tshowStack( id ) {\n\t\tthis.visibleStack = id;\n\t\tconst stack = this._idToStack.get( id );\n\n\t\tif ( !stack ) {\n\t\t\t/**\n\t\t\t * Trying to show a stack that does not exist.\n\t\t\t *\n\t\t\t * @error contextualballoon-showstack-stack-not-exist\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'contextualballoon-showstack-stack-not-exist: Cannot show a stack that does not exist.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tif ( this._visibleStack === stack ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._showView( Array.from( stack.values() ).pop() );\n\t}\n\n\t/**\n\t * Returns the stack of the currently visible view.\n\t *\n\t * @private\n\t * @type {Set}\n\t */\n\tget _visibleStack() {\n\t\treturn this._viewToStack.get( this.visibleView );\n\t}\n\n\t/**\n\t * Returns the ID of the given stack.\n\t *\n\t * @private\n\t * @param {Set} stack\n\t * @returns {String}\n\t */\n\t_getStackId( stack ) {\n\t\tconst entry = Array.from( this._idToStack.entries() ).find( entry => entry[ 1 ] === stack );\n\n\t\treturn entry[ 0 ];\n\t}\n\n\t/**\n\t * Shows the last view from the next stack.\n\t *\n\t * @private\n\t */\n\t_showNextStack() {\n\t\tconst stacks = Array.from( this._idToStack.values() );\n\n\t\tlet nextIndex = stacks.indexOf( this._visibleStack ) + 1;\n\n\t\tif ( !stacks[ nextIndex ] ) {\n\t\t\tnextIndex = 0;\n\t\t}\n\n\t\tthis.showStack( this._getStackId( stacks[ nextIndex ] ) );\n\t}\n\n\t/**\n\t * Shows the last view from the previous stack.\n\t *\n\t * @private\n\t */\n\t_showPrevStack() {\n\t\tconst stacks = Array.from( this._idToStack.values() );\n\n\t\tlet nextIndex = stacks.indexOf( this._visibleStack ) - 1;\n\n\t\tif ( !stacks[ nextIndex ] ) {\n\t\t\tnextIndex = stacks.length - 1;\n\t\t}\n\n\t\tthis.showStack( this._getStackId( stacks[ nextIndex ] ) );\n\t}\n\n\t/**\n\t * Creates a rotator view.\n\t *\n\t * @private\n\t * @returns {module:ui/panel/balloon/contextualballoon~RotatorView}\n\t */\n\t_createRotatorView() {\n\t\tconst view = new RotatorView( this.editor.locale );\n\t\tconst t = this.editor.locale.t;\n\n\t\tthis.view.content.add( view );\n\n\t\t// Hide navigation when there is only a one stack & not in single view mode.\n\t\tview.bind( 'isNavigationVisible' ).to( this, '_numberOfStacks', this, '_singleViewMode', ( value, isSingleViewMode ) => {\n\t\t\treturn !isSingleViewMode && value > 1;\n\t\t} );\n\n\t\t// Update balloon position after toggling navigation.\n\t\tview.on( 'change:isNavigationVisible', () => ( this.updatePosition() ), { priority: 'low' } );\n\n\t\t// Update stacks counter value.\n\t\tview.bind( 'counter' ).to( this, 'visibleView', this, '_numberOfStacks', ( visibleView, numberOfStacks ) => {\n\t\t\tif ( numberOfStacks < 2 ) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst current = Array.from( this._idToStack.values() ).indexOf( this._visibleStack ) + 1;\n\n\t\t\treturn t( '%0 of %1', [ current, numberOfStacks ] );\n\t\t} );\n\n\t\tview.buttonNextView.on( 'execute', () => {\n\t\t\t// When current view has a focus then move focus to the editable before removing it,\n\t\t\t// otherwise editor will lost focus.\n\t\t\tif ( view.focusTracker.isFocused ) {\n\t\t\t\tthis.editor.editing.view.focus();\n\t\t\t}\n\n\t\t\tthis._showNextStack();\n\t\t} );\n\n\t\tview.buttonPrevView.on( 'execute', () => {\n\t\t\t// When current view has a focus then move focus to the editable before removing it,\n\t\t\t// otherwise editor will lost focus.\n\t\t\tif ( view.focusTracker.isFocused ) {\n\t\t\t\tthis.editor.editing.view.focus();\n\t\t\t}\n\n\t\t\tthis._showPrevStack();\n\t\t} );\n\n\t\treturn view;\n\t}\n\n\t/**\n\t * @returns {module:ui/view~View}\n\t */\n\t_createFakePanelsView() {\n\t\tconst view = new FakePanelsView( this.editor.locale, this.view );\n\n\t\tview.bind( 'numberOfPanels' ).to( this, '_numberOfStacks', this, '_singleViewMode', ( number, isSingleViewMode ) => {\n\t\t\tconst showPanels = !isSingleViewMode && number >= 2;\n\n\t\t\treturn showPanels ? Math.min( number - 1, 2 ) : 0;\n\t\t} );\n\n\t\tview.listenTo( this.view, 'change:top', () => view.updatePosition() );\n\t\tview.listenTo( this.view, 'change:left', () => view.updatePosition() );\n\n\t\tthis.editor.ui.view.body.add( view );\n\n\t\treturn view;\n\t}\n\n\t/**\n\t * Sets the view as the content of the balloon and attaches the balloon using position\n\t * options of the first view.\n\t *\n\t * @private\n\t * @param {Object} data Configuration.\n\t * @param {module:ui/view~View} [data.view] The view to show in the balloon.\n\t * @param {String} [data.balloonClassName=''] Additional class name which will be added to the {@link #view balloon}.\n\t * @param {Boolean} [data.withArrow=true] Whether the {@link #view balloon} should be rendered with an arrow.\n\t */\n\t_showView( { view, balloonClassName = '', withArrow = true, singleViewMode = false } ) {\n\t\tthis.view.class = balloonClassName;\n\t\tthis.view.withArrow = withArrow;\n\n\t\tthis._rotatorView.showView( view );\n\t\tthis.visibleView = view;\n\t\tthis.view.pin( this._getBalloonPosition() );\n\t\tthis._fakePanelsView.updatePosition();\n\n\t\tif ( singleViewMode ) {\n\t\t\tthis._singleViewMode = true;\n\t\t}\n\t}\n\n\t/**\n\t * Returns position options of the last view in the stack.\n\t * This keeps the balloon in the same position when the view is changed.\n\t *\n\t * @private\n\t * @returns {module:utils/dom/position~Options}\n\t */\n\t_getBalloonPosition() {\n\t\tlet position = Array.from( this._visibleStack.values() ).pop().position;\n\n\t\t// Use the default limiter if none has been specified.\n\t\tif ( position && !position.limiter ) {\n\t\t\t// Don't modify the original options object.\n\t\t\tposition = Object.assign( {}, position, {\n\t\t\t\tlimiter: this.positionLimiter\n\t\t\t} );\n\t\t}\n\n\t\treturn position;\n\t}\n}\n\n/**\n * Rotator view is a helper class for the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon ContextualBalloon}.\n * It is used for displaying the last view from the current stack and providing navigation buttons for switching stacks.\n * See the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon ContextualBalloon} documentation to learn more.\n *\n * @extends module:ui/view~View\n */\nclass RotatorView extends View {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( locale ) {\n\t\tsuper( locale );\n\n\t\tconst t = locale.t;\n\t\tconst bind = this.bindTemplate;\n\n\t\t/**\n\t\t * Defines whether navigation is visible or not.\n\t\t *\n\t\t * @member {Boolean} #isNavigationVisible\n\t\t */\n\t\tthis.set( 'isNavigationVisible', true );\n\n\t\t/**\n\t\t * Used for checking if a view is focused or not.\n\t\t *\n\t\t * @type {module:utils/focustracker~FocusTracker}\n\t\t */\n\t\tthis.focusTracker = new FocusTracker();\n\n\t\t/**\n\t\t * Navigation button for switching the stack to the previous one.\n\t\t *\n\t\t * @type {module:ui/button/buttonview~ButtonView}\n\t\t */\n\t\tthis.buttonPrevView = this._createButtonView( t( 'Previous' ), prevIcon );\n\n\t\t/**\n\t\t * Navigation button for switching the stack to the next one.\n\t\t *\n\t\t * @type {module:ui/button/buttonview~ButtonView}\n\t\t */\n\t\tthis.buttonNextView = this._createButtonView( t( 'Next' ), nextIcon );\n\n\t\t/**\n\t\t * A collection of the child views that creates the rotator content.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.content = this.createCollection();\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-balloon-rotator'\n\t\t\t\t],\n\t\t\t\t'z-index': '-1'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttag: 'div',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tclass: [\n\t\t\t\t\t\t\t'ck-balloon-rotator__navigation',\n\t\t\t\t\t\t\tbind.to( 'isNavigationVisible', value => value ? '' : 'ck-hidden' )\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.buttonPrevView,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: 'span',\n\n\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\tclass: [\n\t\t\t\t\t\t\t\t\t'ck-balloon-rotator__counter'\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: bind.to( 'counter' )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.buttonNextView\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttag: 'div',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tclass: 'ck-balloon-rotator__content'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: this.content\n\t\t\t\t}\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trender() {\n\t\tsuper.render();\n\n\t\tthis.focusTracker.add( this.element );\n\t}\n\n\t/**\n\t * Shows a given view.\n\t *\n\t * @param {module:ui/view~View} view The view to show.\n\t */\n\tshowView( view ) {\n\t\tthis.hideView();\n\t\tthis.content.add( view );\n\t}\n\n\t/**\n\t * Hides the currently displayed view.\n\t */\n\thideView() {\n\t\tthis.content.clear();\n\t}\n\n\t/**\n\t * Creates a navigation button view.\n\t *\n\t * @private\n\t * @param {String} label The button label.\n\t * @param {String} icon The button icon.\n\t * @returns {module:ui/button/buttonview~ButtonView}\n\t */\n\t_createButtonView( label, icon ) {\n\t\tconst view = new ButtonView( this.locale );\n\n\t\tview.set( {\n\t\t\tlabel,\n\t\t\ticon,\n\t\t\ttooltip: true\n\t\t} );\n\n\t\treturn view;\n\t}\n}\n\n// Displays additional layers under the balloon when multiple stacks are added to the balloon.\n//\n// @private\n// @extends module:ui/view~View\nclass FakePanelsView extends View {\n\t// @inheritDoc\n\tconstructor( locale, balloonPanelView ) {\n\t\tsuper( locale );\n\n\t\tconst bind = this.bindTemplate;\n\n\t\t// Fake panels top offset.\n\t\t//\n\t\t// @observable\n\t\t// @member {Number} #top\n\t\tthis.set( 'top', 0 );\n\n\t\t// Fake panels left offset.\n\t\t//\n\t\t// @observable\n\t\t// @member {Number} #left\n\t\tthis.set( 'left', 0 );\n\n\t\t// Fake panels height.\n\t\t//\n\t\t// @observable\n\t\t// @member {Number} #height\n\t\tthis.set( 'height', 0 );\n\n\t\t// Fake panels width.\n\t\t//\n\t\t// @observable\n\t\t// @member {Number} #width\n\t\tthis.set( 'width', 0 );\n\n\t\t// Number of rendered fake panels.\n\t\t//\n\t\t// @observable\n\t\t// @member {Number} #numberOfPanels\n\t\tthis.set( 'numberOfPanels', 0 );\n\n\t\t// Collection of the child views which creates fake panel content.\n\t\t//\n\t\t// @readonly\n\t\t// @type {module:ui/viewcollection~ViewCollection}\n\t\tthis.content = this.createCollection();\n\n\t\t// Context.\n\t\t//\n\t\t// @private\n\t\t// @type {module:ui/panel/balloon/balloonpanelview~BalloonPanelView}\n\t\tthis._balloonPanelView = balloonPanelView;\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck-fake-panel',\n\t\t\t\t\tbind.to( 'numberOfPanels', number => number ? '' : 'ck-hidden' )\n\t\t\t\t],\n\t\t\t\tstyle: {\n\t\t\t\t\ttop: bind.to( 'top', toPx ),\n\t\t\t\t\tleft: bind.to( 'left', toPx ),\n\t\t\t\t\twidth: bind.to( 'width', toPx ),\n\t\t\t\t\theight: bind.to( 'height', toPx )\n\t\t\t\t}\n\t\t\t},\n\t\t\tchildren: this.content\n\t\t} );\n\n\t\tthis.on( 'change:numberOfPanels', ( evt, name, next, prev ) => {\n\t\t\tif ( next > prev ) {\n\t\t\t\tthis._addPanels( next - prev );\n\t\t\t} else {\n\t\t\t\tthis._removePanels( prev - next );\n\t\t\t}\n\n\t\t\tthis.updatePosition();\n\t\t} );\n\t}\n\n\t// @private\n\t// @param {Number} number\n\t_addPanels( number ) {\n\t\twhile ( number-- ) {\n\t\t\tconst view = new View();\n\n\t\t\tview.setTemplate( { tag: 'div' } );\n\n\t\t\tthis.content.add( view );\n\t\t\tthis.registerChild( view );\n\t\t}\n\t}\n\n\t// @private\n\t// @param {Number} number\n\t_removePanels( number ) {\n\t\twhile ( number-- ) {\n\t\t\tconst view = this.content.last;\n\n\t\t\tthis.content.remove( view );\n\t\t\tthis.deregisterChild( view );\n\t\t\tview.destroy();\n\t\t}\n\t}\n\n\t// Updates coordinates of fake panels.\n\tupdatePosition() {\n\t\tif ( this.numberOfPanels ) {\n\t\t\tconst { top, left } = this._balloonPanelView;\n\t\t\tconst { width, height } = new Rect( this._balloonPanelView.element );\n\n\t\t\tObject.assign( this, { top, left, width, height } );\n\t\t}\n\t}\n}\n"]}]}