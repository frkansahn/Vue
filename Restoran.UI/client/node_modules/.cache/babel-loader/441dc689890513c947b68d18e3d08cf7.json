{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-typing\\src\\utils\\injecttypingmutationshandling.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-typing\\src\\utils\\injecttypingmutationshandling.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwoKLyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDIwLCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHR5cGluZy91dGlscy9pbmplY3R0eXBpbmdtdXRhdGlvbnNoYW5kbGluZwogKi8KaW1wb3J0IGRpZmYgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZGlmZic7CmltcG9ydCBEb21Db252ZXJ0ZXIgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvc3JjL3ZpZXcvZG9tY29udmVydGVyJzsKaW1wb3J0IHsgZ2V0U2luZ2xlVGV4dE5vZGVDaGFuZ2UsIGNvbnRhaW5lckNoaWxkcmVuTXV0YXRlZCB9IGZyb20gJy4vdXRpbHMnOwovKioKICogSGFuZGxlcyBtdXRhdGlvbnMgY2F1c2VkIGJ5IG5vcm1hbCB0eXBpbmcuCiAqCiAqIEBwYXJhbSB7bW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3J9IGVkaXRvciBUaGUgZWRpdG9yIGluc3RhbmNlLgogKi8KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGluamVjdFR5cGluZ011dGF0aW9uc0hhbmRsaW5nKGVkaXRvcikgewogIGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQub24oJ211dGF0aW9ucycsIGZ1bmN0aW9uIChldnQsIG11dGF0aW9ucywgdmlld1NlbGVjdGlvbikgewogICAgbmV3IE11dGF0aW9uSGFuZGxlcihlZGl0b3IpLmhhbmRsZShtdXRhdGlvbnMsIHZpZXdTZWxlY3Rpb24pOwogIH0pOwp9Ci8qKgogKiBIZWxwZXIgY2xhc3MgZm9yIHRyYW5zbGF0aW5nIERPTSBtdXRhdGlvbnMgaW50byBtb2RlbCBjaGFuZ2VzLgogKgogKiBAcHJpdmF0ZQogKi8KCnZhciBNdXRhdGlvbkhhbmRsZXIgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBtdXRhdGlvbiBoYW5kbGVyLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9yfkVkaXRvcn0gZWRpdG9yCiAgICovCiAgZnVuY3Rpb24gTXV0YXRpb25IYW5kbGVyKGVkaXRvcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE11dGF0aW9uSGFuZGxlcik7CgogICAgLyoqCiAgICAgKiBFZGl0b3IgaW5zdGFuY2UgZm9yIHdoaWNoIG11dGF0aW9ucyBhcmUgaGFuZGxlZC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yfSAjZWRpdG9yCiAgICAgKi8KICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yOwogICAgLyoqCiAgICAgKiBUaGUgZWRpdGluZyBjb250cm9sbGVyLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2VkaXRpbmdjb250cm9sbGVyfkVkaXRpbmdDb250cm9sbGVyfSAjZWRpdGluZwogICAgICovCgogICAgdGhpcy5lZGl0aW5nID0gdGhpcy5lZGl0b3IuZWRpdGluZzsKICB9CiAgLyoqCiAgICogSGFuZGxlcyBnaXZlbiBtdXRhdGlvbnMuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkVGV4dHwKICAgKiBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkQ2hpbGRyZW4+fSBtdXRhdGlvbnMKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9ufG51bGx9IHZpZXdTZWxlY3Rpb24KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhNdXRhdGlvbkhhbmRsZXIsIFt7CiAgICBrZXk6ICJoYW5kbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZShtdXRhdGlvbnMsIHZpZXdTZWxlY3Rpb24pIHsKICAgICAgaWYgKGNvbnRhaW5lckNoaWxkcmVuTXV0YXRlZChtdXRhdGlvbnMpKSB7CiAgICAgICAgdGhpcy5faGFuZGxlQ29udGFpbmVyQ2hpbGRyZW5NdXRhdGlvbnMobXV0YXRpb25zLCB2aWV3U2VsZWN0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gbXV0YXRpb25zW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgbXV0YXRpb24gPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICAgIC8vIEZvcnR1bmF0ZWx5IGl0IHdpbGwgbmV2ZXIgYmUgYm90aC4KICAgICAgICAgICAgdGhpcy5faGFuZGxlVGV4dE11dGF0aW9uKG11dGF0aW9uLCB2aWV3U2VsZWN0aW9uKTsKCiAgICAgICAgICAgIHRoaXMuX2hhbmRsZVRleHROb2RlSW5zZXJ0aW9uKG11dGF0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBIYW5kbGVzIHNpdHVhdGlvbnMgd2hlbiBjb250YWluZXIncyBjaGlsZHJlbiBtdXRhdGVkIGR1cmluZyBpbnB1dC4gVGhpcyBjYW4gaGFwcGVuIHdoZW4KICAgICAqIHRoZSBicm93c2VyIGlzIHRyeWluZyB0byAiZml4IiBET00gaW4gY2VydGFpbiBzaXR1YXRpb25zLiBGb3IgZXhhbXBsZSwgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gdHlwZQogICAgICogaW4gYDxwPjxhIGhyZWY9IiI+PGk+TGlua3t9PC9pPjwvYT48L3A+YCwgdGhlIGJyb3dzZXIgbWlnaHQgY2hhbmdlIHRoZSBvcmRlciBvZiBlbGVtZW50cwogICAgICogdG8gYDxwPjxpPjxhIGhyZWY9IiI+TGluazwvYT54e308L2k+PC9wPmAuIEEgc2ltaWxhciBzaXR1YXRpb24gaGFwcGVucyB3aGVuIHRoZSBzcGVsbCBjaGVja2VyCiAgICAgKiByZXBsYWNlcyBhIHdvcmQgd3JhcHBlZCB3aXRoIGA8c3Ryb25nPmAgd2l0aCBhIHdvcmQgd3JhcHBlZCB3aXRoIGEgYDxiPmAgZWxlbWVudC4KICAgICAqCiAgICAgKiBUbyBoYW5kbGUgc3VjaCBzaXR1YXRpb25zLCB0aGUgY29tbW9uIERPTSBhbmNlc3RvciBvZiBhbGwgbXV0YXRpb25zIGlzIGNvbnZlcnRlZCB0byB0aGUgbW9kZWwgcmVwcmVzZW50YXRpb24KICAgICAqIGFuZCB0aGVuIGNvbXBhcmVkIHdpdGggdGhlIGN1cnJlbnQgbW9kZWwgdG8gY2FsY3VsYXRlIHRoZSBwcm9wZXIgdGV4dCBjaGFuZ2UuCiAgICAgKgogICAgICogTm90ZTogU2luZ2xlIHRleHQgbm9kZSBpbnNlcnRpb24gaXMgaGFuZGxlZCBpbiB7QGxpbmsgI19oYW5kbGVUZXh0Tm9kZUluc2VydGlvbn0gYW5kIHRleHQgbm9kZSBtdXRhdGlvbiBpcyBoYW5kbGVkCiAgICAgKiBpbiB7QGxpbmsgI19oYW5kbGVUZXh0TXV0YXRpb259KS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHR8CiAgICAgKiBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkQ2hpbGRyZW4+fSBtdXRhdGlvbnMKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258bnVsbH0gdmlld1NlbGVjdGlvbgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVDb250YWluZXJDaGlsZHJlbk11dGF0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUNvbnRhaW5lckNoaWxkcmVuTXV0YXRpb25zKG11dGF0aW9ucywgdmlld1NlbGVjdGlvbikgewogICAgICAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIG9mIGFsbCBtdXRhdGlvbnMuCiAgICAgIHZhciBtdXRhdGlvbnNDb21tb25BbmNlc3RvciA9IGdldE11dGF0aW9uc0NvbnRhaW5lcihtdXRhdGlvbnMpOyAvLyBRdWl0IGlmIHRoZXJlIGlzIG5vIGNvbW1vbiBhbmNlc3Rvci4KCiAgICAgIGlmICghbXV0YXRpb25zQ29tbW9uQW5jZXN0b3IpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkb21Db252ZXJ0ZXIgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZG9tQ29udmVydGVyOyAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIGluIERPTS4KCiAgICAgIHZhciBkb21NdXRhdGlvbkNvbW1vbkFuY2VzdG9yID0gZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbShtdXRhdGlvbnNDb21tb25BbmNlc3Rvcik7IC8vIENyZWF0ZSBmcmVzaCBEb21Db252ZXJ0ZXIgc28gaXQgd2lsbCBub3QgdXNlIGV4aXN0aW5nIG1hcHBpbmcgYW5kIGNvbnZlcnQgY3VycmVudCBET00gdG8gbW9kZWwuCiAgICAgIC8vIFRoaXMgd291bGRuJ3QgYmUgbmVlZGVkIGlmIERvbUNvbnZlcnRlciB3b3VsZCBhbGxvdyB0byBjcmVhdGUgZnJlc2ggdmlldyB3aXRob3V0IGNoZWNraW5nIGFueSBtYXBwaW5ncy4KCiAgICAgIHZhciBmcmVzaERvbUNvbnZlcnRlciA9IG5ldyBEb21Db252ZXJ0ZXIodGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50KTsKICAgICAgdmFyIG1vZGVsRnJvbUN1cnJlbnREb20gPSB0aGlzLmVkaXRvci5kYXRhLnRvTW9kZWwoZnJlc2hEb21Db252ZXJ0ZXIuZG9tVG9WaWV3KGRvbU11dGF0aW9uQ29tbW9uQW5jZXN0b3IpKS5nZXRDaGlsZCgwKTsgLy8gQ3VycmVudCBtb2RlbC4KCiAgICAgIHZhciBjdXJyZW50TW9kZWwgPSB0aGlzLmVkaXRvci5lZGl0aW5nLm1hcHBlci50b01vZGVsRWxlbWVudChtdXRhdGlvbnNDb21tb25BbmNlc3Rvcik7IC8vIElmIGNvbW1vbiBhbmNlc3RvciBpcyBub3QgbWFwcGVkLCBkbyBub3QgZG8gYW55dGhpbmcuIEl0IHByb2JhYmx5IGlzIGEgcGFyZW50IG9mIGFub3RoZXIgdmlldyBlbGVtZW50LgogICAgICAvLyBUaGF0IG1lYW5zIHRoYXQgd2Ugd291bGQgbmVlZCB0byBkaWZmIG1vZGVsIGVsZW1lbnRzIChzZWUgYGlmYCBiZWxvdykuIEJldHRlciByZXR1cm4gZWFybHkgaW5zdGVhZCBvZgogICAgICAvLyB0cnlpbmcgdG8gZ2V0IGEgcmVhc29uYWJsZSBtb2RlbCBhbmNlc3Rvci4gSXQgd2lsbCBmZWxsIGludG8gdGhlIGBpZmAgYmVsb3cgYW55d2F5LgogICAgICAvLyBUaGlzIHNpdHVhdGlvbiBoYXBwZW5zIGZvciBleGFtcGxlIGZvciBsaXN0cy4gSWYgYDx1bD5gIGlzIGEgY29tbW9uIGFuY2VzdG9yLCBgY3VycmVudE1vZGVsYCBpcyBgdW5kZWZpbmVkYAogICAgICAvLyBiZWNhdXNlIGA8dWw+YCBpcyBub3QgbWFwcGVkIChgPGxpPmBzIGFyZSkuCiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy83MTguCgogICAgICBpZiAoIWN1cnJlbnRNb2RlbCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgY2hpbGRyZW4gZnJvbSBib3RoIGFuY2VzdG9ycy4KCgogICAgICB2YXIgbW9kZWxGcm9tRG9tQ2hpbGRyZW4gPSBBcnJheS5mcm9tKG1vZGVsRnJvbUN1cnJlbnREb20uZ2V0Q2hpbGRyZW4oKSk7CiAgICAgIHZhciBjdXJyZW50TW9kZWxDaGlsZHJlbiA9IEFycmF5LmZyb20oY3VycmVudE1vZGVsLmdldENoaWxkcmVuKCkpOyAvLyBSZW1vdmUgdGhlIGxhc3QgYDxzb2Z0QnJlYWs+YCBmcm9tIHRoZSBlbmQgb2YgYG1vZGVsRnJvbURvbUNoaWxkcmVuYCBpZiB0aGVyZSBpcyBubyBgPHNvZnRCcmVhaz5gIGluIGN1cnJlbnQgbW9kZWwuCiAgICAgIC8vIElmIHRoZSBkZXNjcmliZWQgc2NlbmFyaW8gaGFwcGVuZWQsIGl0IG1lYW5zIHRoYXQgdGhpcyBpcyBhIGJvZ3VzIGA8YnIgLz5gIGFkZGVkIGJ5IGEgYnJvd3Nlci4KCiAgICAgIHZhciBsYXN0RG9tQ2hpbGQgPSBtb2RlbEZyb21Eb21DaGlsZHJlblttb2RlbEZyb21Eb21DaGlsZHJlbi5sZW5ndGggLSAxXTsKICAgICAgdmFyIGxhc3RDdXJyZW50Q2hpbGQgPSBjdXJyZW50TW9kZWxDaGlsZHJlbltjdXJyZW50TW9kZWxDaGlsZHJlbi5sZW5ndGggLSAxXTsKCiAgICAgIGlmIChsYXN0RG9tQ2hpbGQgJiYgbGFzdERvbUNoaWxkLmlzKCdzb2Z0QnJlYWsnKSAmJiBsYXN0Q3VycmVudENoaWxkICYmICFsYXN0Q3VycmVudENoaWxkLmlzKCdzb2Z0QnJlYWsnKSkgewogICAgICAgIG1vZGVsRnJvbURvbUNoaWxkcmVuLnBvcCgpOwogICAgICB9CgogICAgICB2YXIgc2NoZW1hID0gdGhpcy5lZGl0b3IubW9kZWwuc2NoZW1hOyAvLyBTa2lwIHNpdHVhdGlvbnMgd2hlbiBjb21tb24gYW5jZXN0b3IgaGFzIGFueSBjb250YWluZXIgZWxlbWVudHMuCgogICAgICBpZiAoIWlzU2FmZUZvclRleHRNdXRhdGlvbihtb2RlbEZyb21Eb21DaGlsZHJlbiwgc2NoZW1hKSB8fCAhaXNTYWZlRm9yVGV4dE11dGF0aW9uKGN1cnJlbnRNb2RlbENoaWxkcmVuLCBzY2hlbWEpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFJlcGxhY2UgJm5ic3A7IGluc2VydGVkIGJ5IHRoZSBicm93c2VyIHdpdGggbm9ybWFsIHNwYWNlLiBTZWUgY29tbWVudCBpbiBgX2hhbmRsZVRleHRNdXRhdGlvbmAuCiAgICAgIC8vIFJlcGxhY2Ugbm9uLXRleHRzIHdpdGggYW55IGNoYXJhY3Rlci4gVGhpcyBpcyBwb3RlbnRpYWxseSBkYW5nZXJvdXMgYnV0IHBhc3NlcyBpbiBtYW51YWwgdGVzdHMuIFRoZSB0aGluZyBpcwogICAgICAvLyB0aGF0IHdlIG5lZWQgdG8gdGFrZSBjYXJlIG9mIHByb3BlciBpbmRleGVzIHNvIHdlIGNhbm5vdCBzaW1wbHkgcmVtb3ZlIG5vbi10ZXh0IGVsZW1lbnRzIGZyb20gdGhlIGNvbnRlbnQuCiAgICAgIC8vIEJ5IGluc2VydGluZyBhIGNoYXJhY3RlciB3ZSBrZWVwIGFsbCB0aGUgcmVhbCB0ZXh0cyBvbiB0aGVpciBpbmRleGVzLgoKCiAgICAgIHZhciBuZXdUZXh0ID0gbW9kZWxGcm9tRG9tQ2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uaXMoJ3RleHQnKSA/IGl0ZW0uZGF0YSA6ICdAJzsKICAgICAgfSkuam9pbignJykucmVwbGFjZSgvXHUwMEEwL2csICcgJyk7CiAgICAgIHZhciBvbGRUZXh0ID0gY3VycmVudE1vZGVsQ2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uaXMoJ3RleHQnKSA/IGl0ZW0uZGF0YSA6ICdAJzsKICAgICAgfSkuam9pbignJykucmVwbGFjZSgvXHUwMEEwL2csICcgJyk7IC8vIERvIG5vdGhpbmcgaWYgbXV0YXRpb25zIGNyZWF0ZWQgc2FtZSB0ZXh0LgoKICAgICAgaWYgKG9sZFRleHQgPT09IG5ld1RleHQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkaWZmUmVzdWx0ID0gZGlmZihvbGRUZXh0LCBuZXdUZXh0KTsKCiAgICAgIHZhciBfY2FsY3VsYXRlQ2hhbmdlcyA9IGNhbGN1bGF0ZUNoYW5nZXMoZGlmZlJlc3VsdCksCiAgICAgICAgICBmaXJzdENoYW5nZUF0ID0gX2NhbGN1bGF0ZUNoYW5nZXMuZmlyc3RDaGFuZ2VBdCwKICAgICAgICAgIGluc2VydGlvbnMgPSBfY2FsY3VsYXRlQ2hhbmdlcy5pbnNlcnRpb25zLAogICAgICAgICAgZGVsZXRpb25zID0gX2NhbGN1bGF0ZUNoYW5nZXMuZGVsZXRpb25zOyAvLyBUcnkgc2V0dGluZyBuZXcgbW9kZWwgc2VsZWN0aW9uIGFjY29yZGluZyB0byBwYXNzZWQgdmlldyBzZWxlY3Rpb24uCgoKICAgICAgdmFyIG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSBudWxsOwoKICAgICAgaWYgKHZpZXdTZWxlY3Rpb24pIHsKICAgICAgICBtb2RlbFNlbGVjdGlvblJhbmdlID0gdGhpcy5lZGl0aW5nLm1hcHBlci50b01vZGVsUmFuZ2Uodmlld1NlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCkpOwogICAgICB9CgogICAgICB2YXIgaW5zZXJ0VGV4dCA9IG5ld1RleHQuc3Vic3RyKGZpcnN0Q2hhbmdlQXQsIGluc2VydGlvbnMpOwogICAgICB2YXIgcmVtb3ZlUmFuZ2UgPSB0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVSYW5nZSh0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVQb3NpdGlvbkF0KGN1cnJlbnRNb2RlbCwgZmlyc3RDaGFuZ2VBdCksIHRoaXMuZWRpdG9yLm1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQoY3VycmVudE1vZGVsLCBmaXJzdENoYW5nZUF0ICsgZGVsZXRpb25zKSk7CiAgICAgIHRoaXMuZWRpdG9yLmV4ZWN1dGUoJ2lucHV0JywgewogICAgICAgIHRleHQ6IGluc2VydFRleHQsCiAgICAgICAgcmFuZ2U6IHJlbW92ZVJhbmdlLAogICAgICAgIHJlc3VsdFJhbmdlOiBtb2RlbFNlbGVjdGlvblJhbmdlCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVUZXh0TXV0YXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVUZXh0TXV0YXRpb24obXV0YXRpb24sIHZpZXdTZWxlY3Rpb24pIHsKICAgICAgaWYgKG11dGF0aW9uLnR5cGUgIT0gJ3RleHQnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFJlcGxhY2UgJm5ic3A7IGluc2VydGVkIGJ5IHRoZSBicm93c2VyIHdpdGggbm9ybWFsIHNwYWNlLgogICAgICAvLyBXZSB3YW50IG9ubHkgbm9ybWFsIHNwYWNlcyBpbiB0aGUgbW9kZWwgYW5kIGluIHRoZSB2aWV3LiBSZW5kZXJlciBhbmQgRE9NIENvbnZlcnRlciB3aWxsIGJlIHRoZW4gcmVzcG9uc2libGUKICAgICAgLy8gZm9yIHJlbmRlcmluZyBjb25zZWN1dGl2ZSBzcGFjZXMgdXNpbmcgJm5ic3A7LCBidXQgdGhlIG1vZGVsIGFuZCB0aGUgdmlldyBoYXMgdG8gYmUgY2xlYXIuCiAgICAgIC8vIE90aGVyIGZlYXR1cmUgbWF5IGludHJvZHVjZSBpbnNlcnRpbmcgbm9uLWJyZWFrYWJsZSBzcGFjZSBvbiBzcGVjaWZpYyBrZXkgc3Ryb2tlIChmb3IgZXhhbXBsZSBzaGlmdCArIHNwYWNlKS4KICAgICAgLy8gSG93ZXZlciB0aGVuIGl0IHdpbGwgYmUgaGFuZGxlZCBvdXRzaWRlIG9mIG11dGF0aW9ucywgbGlrZSBlbnRlciBrZXkgaXMuCiAgICAgIC8vIFRoZSByZXBsYWNpbmcgaXMgaGVyZSBiZWNhdXNlIGl0IGhhcyB0byBiZSBkb25lIGJlZm9yZSBgZGlmZmAgYW5kIGBkaWZmVG9DaGFuZ2VzYCBmdW5jdGlvbnMsIGFzIHRoZXkKICAgICAgLy8gdGFrZSBgbmV3VGV4dGAgYW5kIGNvbXBhcmUgaXQgdG8gKGNsZWFuZWQgdXApIHZpZXcuCiAgICAgIC8vIEl0IGNvdWxkIGFsc28gYmUgZG9uZSBpbiBtdXRhdGlvbiBvYnNlcnZlciB0b28sIGhvd2V2ZXIgaWYgYW55IG91dHNpZGUgcGx1Z2luIHdvdWxkIGxpa2UgdG8KICAgICAgLy8gaW50cm9kdWNlIGFkZGl0aW9uYWwgZXZlbnRzIGZvciBtdXRhdGlvbnMsIHRoZXkgd291bGQgZ2V0IGFscmVhZHkgY2xlYW5lZCB1cCB2ZXJzaW9uICh0aGlzIG1heSBiZSBnb29kIG9yIG5vdCkuCgoKICAgICAgdmFyIG5ld1RleHQgPSBtdXRhdGlvbi5uZXdUZXh0LnJlcGxhY2UoL1x1MDBBMC9nLCAnICcpOyAvLyBUbyBoYXZlIGNvcnJlY3QgYGRpZmZSZXN1bHRgLCB3ZSBhbHNvIGNvbXBhcmUgdmlldyBub2RlIHRleHQgZGF0YSB3aXRoICZuYnNwOyByZXBsYWNlZCBieSBzcGFjZS4KCiAgICAgIHZhciBvbGRUZXh0ID0gbXV0YXRpb24ub2xkVGV4dC5yZXBsYWNlKC9cdTAwQTAvZywgJyAnKTsgLy8gRG8gbm90aGluZyBpZiBtdXRhdGlvbnMgY3JlYXRlZCBzYW1lIHRleHQuCgogICAgICBpZiAob2xkVGV4dCA9PT0gbmV3VGV4dCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRpZmZSZXN1bHQgPSBkaWZmKG9sZFRleHQsIG5ld1RleHQpOwoKICAgICAgdmFyIF9jYWxjdWxhdGVDaGFuZ2VzMiA9IGNhbGN1bGF0ZUNoYW5nZXMoZGlmZlJlc3VsdCksCiAgICAgICAgICBmaXJzdENoYW5nZUF0ID0gX2NhbGN1bGF0ZUNoYW5nZXMyLmZpcnN0Q2hhbmdlQXQsCiAgICAgICAgICBpbnNlcnRpb25zID0gX2NhbGN1bGF0ZUNoYW5nZXMyLmluc2VydGlvbnMsCiAgICAgICAgICBkZWxldGlvbnMgPSBfY2FsY3VsYXRlQ2hhbmdlczIuZGVsZXRpb25zOyAvLyBUcnkgc2V0dGluZyBuZXcgbW9kZWwgc2VsZWN0aW9uIGFjY29yZGluZyB0byBwYXNzZWQgdmlldyBzZWxlY3Rpb24uCgoKICAgICAgdmFyIG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSBudWxsOwoKICAgICAgaWYgKHZpZXdTZWxlY3Rpb24pIHsKICAgICAgICBtb2RlbFNlbGVjdGlvblJhbmdlID0gdGhpcy5lZGl0aW5nLm1hcHBlci50b01vZGVsUmFuZ2Uodmlld1NlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCkpOwogICAgICB9IC8vIEdldCB0aGUgcG9zaXRpb24gaW4gdmlldyBhbmQgbW9kZWwgd2hlcmUgdGhlIGNoYW5nZXMgd2lsbCBoYXBwZW4uCgoKICAgICAgdmFyIHZpZXdQb3MgPSB0aGlzLmVkaXRpbmcudmlldy5jcmVhdGVQb3NpdGlvbkF0KG11dGF0aW9uLm5vZGUsIGZpcnN0Q2hhbmdlQXQpOwogICAgICB2YXIgbW9kZWxQb3MgPSB0aGlzLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxQb3NpdGlvbih2aWV3UG9zKTsKICAgICAgdmFyIHJlbW92ZVJhbmdlID0gdGhpcy5lZGl0b3IubW9kZWwuY3JlYXRlUmFuZ2UobW9kZWxQb3MsIG1vZGVsUG9zLmdldFNoaWZ0ZWRCeShkZWxldGlvbnMpKTsKICAgICAgdmFyIGluc2VydFRleHQgPSBuZXdUZXh0LnN1YnN0cihmaXJzdENoYW5nZUF0LCBpbnNlcnRpb25zKTsKICAgICAgdGhpcy5lZGl0b3IuZXhlY3V0ZSgnaW5wdXQnLCB7CiAgICAgICAgdGV4dDogaW5zZXJ0VGV4dCwKICAgICAgICByYW5nZTogcmVtb3ZlUmFuZ2UsCiAgICAgICAgcmVzdWx0UmFuZ2U6IG1vZGVsU2VsZWN0aW9uUmFuZ2UKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2hhbmRsZVRleHROb2RlSW5zZXJ0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlVGV4dE5vZGVJbnNlcnRpb24obXV0YXRpb24pIHsKICAgICAgaWYgKG11dGF0aW9uLnR5cGUgIT0gJ2NoaWxkcmVuJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGNoYW5nZSA9IGdldFNpbmdsZVRleHROb2RlQ2hhbmdlKG11dGF0aW9uKTsKICAgICAgdmFyIHZpZXdQb3MgPSB0aGlzLmVkaXRpbmcudmlldy5jcmVhdGVQb3NpdGlvbkF0KG11dGF0aW9uLm5vZGUsIGNoYW5nZS5pbmRleCk7CiAgICAgIHZhciBtb2RlbFBvcyA9IHRoaXMuZWRpdGluZy5tYXBwZXIudG9Nb2RlbFBvc2l0aW9uKHZpZXdQb3MpOwogICAgICB2YXIgaW5zZXJ0ZWRUZXh0ID0gY2hhbmdlLnZhbHVlc1swXS5kYXRhOwogICAgICB0aGlzLmVkaXRvci5leGVjdXRlKCdpbnB1dCcsIHsKICAgICAgICAvLyBSZXBsYWNlICZuYnNwOyBpbnNlcnRlZCBieSB0aGUgYnJvd3NlciB3aXRoIG5vcm1hbCBzcGFjZS4KICAgICAgICAvLyBTZWUgY29tbWVudCBpbiBgX2hhbmRsZVRleHRNdXRhdGlvbmAuCiAgICAgICAgLy8gSW4gdGhpcyBjYXNlIHdlIGRvbid0IG5lZWQgdG8gZG8gdGhpcyBiZWZvcmUgYGRpZmZgIGJlY2F1c2Ugd2UgZGlmZiB3aG9sZSBub2Rlcy4KICAgICAgICAvLyBKdXN0IGNoYW5nZSAmbmJzcDsgaW4gY2FzZSB0aGVyZSBhcmUgc29tZS4KICAgICAgICB0ZXh0OiBpbnNlcnRlZFRleHQucmVwbGFjZSgvXHUwMEEwL2csICcgJyksCiAgICAgICAgcmFuZ2U6IHRoaXMuZWRpdG9yLm1vZGVsLmNyZWF0ZVJhbmdlKG1vZGVsUG9zKQogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBNdXRhdGlvbkhhbmRsZXI7Cn0oKTsgLy8gUmV0dXJucyBmaXJzdCBjb21tb24gYW5jZXN0b3Igb2YgYWxsIG11dGF0aW9ucyB0aGF0IGlzIGVpdGhlciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudH0KLy8gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yb290ZWxlbWVudH5Sb290RWxlbWVudH0uCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7QXJyYXkuPG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRUZXh0fAovLyBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkQ2hpbGRyZW4+fSBtdXRhdGlvbnMKLy8gQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR8ZW5naW5lL3ZpZXcvcm9vdGVsZW1lbnR+Um9vdEVsZW1lbnR8dW5kZWZpbmVkfQoKCmZ1bmN0aW9uIGdldE11dGF0aW9uc0NvbnRhaW5lcihtdXRhdGlvbnMpIHsKICB2YXIgbGNhID0gbXV0YXRpb25zLm1hcChmdW5jdGlvbiAobXV0YXRpb24pIHsKICAgIHJldHVybiBtdXRhdGlvbi5ub2RlOwogIH0pLnJlZHVjZShmdW5jdGlvbiAoY29tbW9uQW5jZXN0b3IsIG5vZGUpIHsKICAgIHJldHVybiBjb21tb25BbmNlc3Rvci5nZXRDb21tb25BbmNlc3Rvcihub2RlLCB7CiAgICAgIGluY2x1ZGVTZWxmOiB0cnVlCiAgICB9KTsKICB9KTsKCiAgaWYgKCFsY2EpIHsKICAgIHJldHVybjsKICB9IC8vIFdlIG5lZWQgdG8gbG9vayBmb3IgY29udGFpbmVyIGFuZCByb290IGVsZW1lbnRzIG9ubHksIHNvIGNoZWNrIGFsbCBMQ0EncwogIC8vIGFuY2VzdG9ycyAoc3RhcnRpbmcgZnJvbSBpdHNlbGYpLgoKCiAgcmV0dXJuIGxjYS5nZXRBbmNlc3RvcnMoewogICAgaW5jbHVkZVNlbGY6IHRydWUsCiAgICBwYXJlbnRGaXJzdDogdHJ1ZQogIH0pLmZpbmQoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50LmlzKCdjb250YWluZXJFbGVtZW50JykgfHwgZWxlbWVudC5pcygncm9vdEVsZW1lbnQnKTsKICB9KTsKfSAvLyBSZXR1cm5zIHRydWUgaWYgcHJvdmlkZWQgYXJyYXkgY29udGFpbnMgY29udGVudCB0aGF0IHdvbid0IGJlIHByb2JsZW1hdGljIGR1cmluZyBkaWZmaW5nIGFuZCB0ZXh0IG11dGF0aW9uIGhhbmRsaW5nLgovLwovLyBAcGFyYW0ge0FycmF5Ljxtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZT59IGNoaWxkcmVuCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hfSBzY2hlbWEKLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZnVuY3Rpb24gaXNTYWZlRm9yVGV4dE11dGF0aW9uKGNoaWxkcmVuLCBzY2hlbWEpIHsKICByZXR1cm4gY2hpbGRyZW4uZXZlcnkoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICByZXR1cm4gc2NoZW1hLmlzSW5saW5lKGNoaWxkKTsKICB9KTsKfSAvLyBDYWxjdWxhdGVzIGZpcnN0IGNoYW5nZSBpbmRleCBhbmQgbnVtYmVyIG9mIGNoYXJhY3RlcnMgdGhhdCBzaG91bGQgYmUgaW5zZXJ0ZWQgYW5kIGRlbGV0ZWQgc3RhcnRpbmcgZnJvbSB0aGF0IGluZGV4LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0gZGlmZlJlc3VsdAovLyBAcmV0dXJucyB7e2luc2VydGlvbnM6IG51bWJlciwgZGVsZXRpb25zOiBudW1iZXIsIGZpcnN0Q2hhbmdlQXQ6ICp9fQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZUNoYW5nZXMoZGlmZlJlc3VsdCkgewogIC8vIEluZGV4IHdoZXJlIHRoZSBmaXJzdCBjaGFuZ2UgaGFwcGVucy4gVXNlZCB0byBzZXQgdGhlIHBvc2l0aW9uIGZyb20gd2hpY2ggbm9kZXMgd2lsbCBiZSByZW1vdmVkIGFuZCB3aGVyZSB3aWxsIGJlIGluc2VydGVkLgogIHZhciBmaXJzdENoYW5nZUF0ID0gbnVsbDsgLy8gSW5kZXggd2hlcmUgdGhlIGxhc3QgY2hhbmdlIGhhcHBlbnMuIFVzZWQgdG8gcHJvcGVybHkgY291bnQgaG93IG1hbnkgY2hhcmFjdGVycyBoYXZlIHRvIGJlIHJlbW92ZWQgYW5kIGluc2VydGVkLgoKICB2YXIgbGFzdENoYW5nZUF0ID0gbnVsbDsgLy8gR2V0IGBmaXJzdENoYW5nZUF0YCBhbmQgYGxhc3RDaGFuZ2VBdGAuCgogIGZvciAodmFyIGkgPSAwOyBpIDwgZGlmZlJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgdmFyIGNoYW5nZSA9IGRpZmZSZXN1bHRbaV07CgogICAgaWYgKGNoYW5nZSAhPSAnZXF1YWwnKSB7CiAgICAgIGZpcnN0Q2hhbmdlQXQgPSBmaXJzdENoYW5nZUF0ID09PSBudWxsID8gaSA6IGZpcnN0Q2hhbmdlQXQ7CiAgICAgIGxhc3RDaGFuZ2VBdCA9IGk7CiAgICB9CiAgfSAvLyBIb3cgbWFueSBjaGFyYWN0ZXJzLCBzdGFydGluZyBmcm9tIGBmaXJzdENoYW5nZUF0YCwgc2hvdWxkIGJlIHJlbW92ZWQuCgoKICB2YXIgZGVsZXRpb25zID0gMDsgLy8gSG93IG1hbnkgY2hhcmFjdGVycywgc3RhcnRpbmcgZnJvbSBgZmlyc3RDaGFuZ2VBdGAsIHNob3VsZCBiZSBpbnNlcnRlZC4KCiAgdmFyIGluc2VydGlvbnMgPSAwOwoKICBmb3IgKHZhciBfaSA9IGZpcnN0Q2hhbmdlQXQ7IF9pIDw9IGxhc3RDaGFuZ2VBdDsgX2krKykgewogICAgLy8gSWYgdGhlcmUgaXMgbm8gY2hhbmdlIChlcXVhbCkgb3IgZGVsZXRlLCB0aGUgY2hhcmFjdGVyIGlzIGV4aXN0aW5nIGluIGBvbGRUZXh0YC4gV2UgY291bnQgaXQgZm9yIHJlbW92aW5nLgogICAgaWYgKGRpZmZSZXN1bHRbX2ldICE9ICdpbnNlcnQnKSB7CiAgICAgIGRlbGV0aW9ucysrOwogICAgfSAvLyBJZiB0aGVyZSBpcyBubyBjaGFuZ2UgKGVxdWFsKSBvciBpbnNlcnQsIHRoZSBjaGFyYWN0ZXIgaXMgZXhpc3RpbmcgaW4gYG5ld1RleHRgLiBXZSBjb3VudCBpdCBmb3IgaW5zZXJ0aW5nLgoKCiAgICBpZiAoZGlmZlJlc3VsdFtfaV0gIT0gJ2RlbGV0ZScpIHsKICAgICAgaW5zZXJ0aW9ucysrOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIGluc2VydGlvbnM6IGluc2VydGlvbnMsCiAgICBkZWxldGlvbnM6IGRlbGV0aW9ucywKICAgIGZpcnN0Q2hhbmdlQXQ6IGZpcnN0Q2hhbmdlQXQKICB9Owp9"},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js"],"names":["diff","DomConverter","getSingleTextNodeChange","containerChildrenMutated","injectTypingMutationsHandling","editor","editing","view","document","on","evt","mutations","viewSelection","MutationHandler","handle","_handleContainerChildrenMutations","mutation","_handleTextMutation","_handleTextNodeInsertion","mutationsCommonAncestor","getMutationsContainer","domConverter","domMutationCommonAncestor","mapViewToDom","freshDomConverter","modelFromCurrentDom","data","toModel","domToView","getChild","currentModel","mapper","toModelElement","modelFromDomChildren","Array","from","getChildren","currentModelChildren","lastDomChild","length","lastCurrentChild","is","pop","schema","model","isSafeForTextMutation","newText","map","item","join","replace","oldText","diffResult","calculateChanges","firstChangeAt","insertions","deletions","modelSelectionRange","toModelRange","getFirstRange","insertText","substr","removeRange","createRange","createPositionAt","execute","text","range","resultRange","type","viewPos","node","modelPos","toModelPosition","getShiftedBy","change","index","insertedText","values","lca","reduce","commonAncestor","getCommonAncestor","includeSelf","getAncestors","parentFirst","find","element","children","every","child","isInline","lastChangeAt","i"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module typing/utils/injecttypingmutationshandling\n */\n\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\nimport DomConverter from '@ckeditor/ckeditor5-engine/src/view/domconverter';\n\nimport { getSingleTextNodeChange, containerChildrenMutated } from './utils';\n\n/**\n * Handles mutations caused by normal typing.\n *\n * @param {module:core/editor/editor~Editor} editor The editor instance.\n */\nexport default function injectTypingMutationsHandling( editor ) {\n\teditor.editing.view.document.on( 'mutations', ( evt, mutations, viewSelection ) => {\n\t\tnew MutationHandler( editor ).handle( mutations, viewSelection );\n\t} );\n}\n\n/**\n * Helper class for translating DOM mutations into model changes.\n *\n * @private\n */\nclass MutationHandler {\n\t/**\n\t * Creates an instance of the mutation handler.\n\t *\n\t * @param {module:core/editor/editor~Editor} editor\n\t */\n\tconstructor( editor ) {\n\t\t/**\n\t\t * Editor instance for which mutations are handled.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:core/editor/editor~Editor} #editor\n\t\t */\n\t\tthis.editor = editor;\n\n\t\t/**\n\t\t * The editing controller.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:engine/controller/editingcontroller~EditingController} #editing\n\t\t */\n\t\tthis.editing = this.editor.editing;\n\t}\n\n\t/**\n\t * Handles given mutations.\n\t *\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\thandle( mutations, viewSelection ) {\n\t\tif ( containerChildrenMutated( mutations ) ) {\n\t\t\tthis._handleContainerChildrenMutations( mutations, viewSelection );\n\t\t} else {\n\t\t\tfor ( const mutation of mutations ) {\n\t\t\t\t// Fortunately it will never be both.\n\t\t\t\tthis._handleTextMutation( mutation, viewSelection );\n\t\t\t\tthis._handleTextNodeInsertion( mutation );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles situations when container's children mutated during input. This can happen when\n\t * the browser is trying to \"fix\" DOM in certain situations. For example, when the user starts to type\n\t * in `<p><a href=\"\"><i>Link{}</i></a></p>`, the browser might change the order of elements\n\t * to `<p><i><a href=\"\">Link</a>x{}</i></p>`. A similar situation happens when the spell checker\n\t * replaces a word wrapped with `<strong>` with a word wrapped with a `<b>` element.\n\t *\n\t * To handle such situations, the common DOM ancestor of all mutations is converted to the model representation\n\t * and then compared with the current model to calculate the proper text change.\n\t *\n\t * Note: Single text node insertion is handled in {@link #_handleTextNodeInsertion} and text node mutation is handled\n\t * in {@link #_handleTextMutation}).\n\t *\n\t * @private\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\t_handleContainerChildrenMutations( mutations, viewSelection ) {\n\t\t// Get common ancestor of all mutations.\n\t\tconst mutationsCommonAncestor = getMutationsContainer( mutations );\n\n\t\t// Quit if there is no common ancestor.\n\t\tif ( !mutationsCommonAncestor ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domConverter = this.editor.editing.view.domConverter;\n\n\t\t// Get common ancestor in DOM.\n\t\tconst domMutationCommonAncestor = domConverter.mapViewToDom( mutationsCommonAncestor );\n\n\t\t// Create fresh DomConverter so it will not use existing mapping and convert current DOM to model.\n\t\t// This wouldn't be needed if DomConverter would allow to create fresh view without checking any mappings.\n\t\tconst freshDomConverter = new DomConverter( this.editor.editing.view.document );\n\t\tconst modelFromCurrentDom = this.editor.data.toModel(\n\t\t\tfreshDomConverter.domToView( domMutationCommonAncestor )\n\t\t).getChild( 0 );\n\n\t\t// Current model.\n\t\tconst currentModel = this.editor.editing.mapper.toModelElement( mutationsCommonAncestor );\n\n\t\t// If common ancestor is not mapped, do not do anything. It probably is a parent of another view element.\n\t\t// That means that we would need to diff model elements (see `if` below). Better return early instead of\n\t\t// trying to get a reasonable model ancestor. It will fell into the `if` below anyway.\n\t\t// This situation happens for example for lists. If `<ul>` is a common ancestor, `currentModel` is `undefined`\n\t\t// because `<ul>` is not mapped (`<li>`s are).\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/718.\n\t\tif ( !currentModel ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get children from both ancestors.\n\t\tconst modelFromDomChildren = Array.from( modelFromCurrentDom.getChildren() );\n\t\tconst currentModelChildren = Array.from( currentModel.getChildren() );\n\n\t\t// Remove the last `<softBreak>` from the end of `modelFromDomChildren` if there is no `<softBreak>` in current model.\n\t\t// If the described scenario happened, it means that this is a bogus `<br />` added by a browser.\n\t\tconst lastDomChild = modelFromDomChildren[ modelFromDomChildren.length - 1 ];\n\t\tconst lastCurrentChild = currentModelChildren[ currentModelChildren.length - 1 ];\n\n\t\tif ( lastDomChild && lastDomChild.is( 'softBreak' ) && lastCurrentChild && !lastCurrentChild.is( 'softBreak' ) ) {\n\t\t\tmodelFromDomChildren.pop();\n\t\t}\n\n\t\tconst schema = this.editor.model.schema;\n\n\t\t// Skip situations when common ancestor has any container elements.\n\t\tif ( !isSafeForTextMutation( modelFromDomChildren, schema ) || !isSafeForTextMutation( currentModelChildren, schema ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space. See comment in `_handleTextMutation`.\n\t\t// Replace non-texts with any character. This is potentially dangerous but passes in manual tests. The thing is\n\t\t// that we need to take care of proper indexes so we cannot simply remove non-text elements from the content.\n\t\t// By inserting a character we keep all the real texts on their indexes.\n\t\tconst newText = modelFromDomChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\t\tconst oldText = currentModelChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\t\tconst removeRange = this.editor.model.createRange(\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt ),\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt + deletions )\n\t\t);\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextMutation( mutation, viewSelection ) {\n\t\tif ( mutation.type != 'text' ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t// We want only normal spaces in the model and in the view. Renderer and DOM Converter will be then responsible\n\t\t// for rendering consecutive spaces using &nbsp;, but the model and the view has to be clear.\n\t\t// Other feature may introduce inserting non-breakable space on specific key stroke (for example shift + space).\n\t\t// However then it will be handled outside of mutations, like enter key is.\n\t\t// The replacing is here because it has to be done before `diff` and `diffToChanges` functions, as they\n\t\t// take `newText` and compare it to (cleaned up) view.\n\t\t// It could also be done in mutation observer too, however if any outside plugin would like to\n\t\t// introduce additional events for mutations, they would get already cleaned up version (this may be good or not).\n\t\tconst newText = mutation.newText.replace( /\\u00A0/g, ' ' );\n\t\t// To have correct `diffResult`, we also compare view node text data with &nbsp; replaced by space.\n\t\tconst oldText = mutation.oldText.replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\t// Get the position in view and model where the changes will happen.\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, firstChangeAt );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst removeRange = this.editor.model.createRange( modelPos, modelPos.getShiftedBy( deletions ) );\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextNodeInsertion( mutation ) {\n\t\tif ( mutation.type != 'children' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst change = getSingleTextNodeChange( mutation );\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, change.index );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst insertedText = change.values[ 0 ].data;\n\n\t\tthis.editor.execute( 'input', {\n\t\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t\t// See comment in `_handleTextMutation`.\n\t\t\t// In this case we don't need to do this before `diff` because we diff whole nodes.\n\t\t\t// Just change &nbsp; in case there are some.\n\t\t\ttext: insertedText.replace( /\\u00A0/g, ' ' ),\n\t\t\trange: this.editor.model.createRange( modelPos )\n\t\t} );\n\t}\n}\n\n// Returns first common ancestor of all mutations that is either {@link module:engine/view/containerelement~ContainerElement}\n// or {@link module:engine/view/rootelement~RootElement}.\n//\n// @private\n// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n// @returns {module:engine/view/containerelement~ContainerElement|engine/view/rootelement~RootElement|undefined}\nfunction getMutationsContainer( mutations ) {\n\tconst lca = mutations\n\t\t.map( mutation => mutation.node )\n\t\t.reduce( ( commonAncestor, node ) => {\n\t\t\treturn commonAncestor.getCommonAncestor( node, { includeSelf: true } );\n\t\t} );\n\n\tif ( !lca ) {\n\t\treturn;\n\t}\n\n\t// We need to look for container and root elements only, so check all LCA's\n\t// ancestors (starting from itself).\n\treturn lca.getAncestors( { includeSelf: true, parentFirst: true } )\n\t\t.find( element => element.is( 'containerElement' ) || element.is( 'rootElement' ) );\n}\n\n// Returns true if provided array contains content that won't be problematic during diffing and text mutation handling.\n//\n// @param {Array.<module:engine/model/node~Node>} children\n// @param {module:engine/model/schema~Schema} schema\n// @returns {Boolean}\nfunction isSafeForTextMutation( children, schema ) {\n\treturn children.every( child => schema.isInline( child ) );\n}\n\n// Calculates first change index and number of characters that should be inserted and deleted starting from that index.\n//\n// @private\n// @param diffResult\n// @returns {{insertions: number, deletions: number, firstChangeAt: *}}\nfunction calculateChanges( diffResult ) {\n\t// Index where the first change happens. Used to set the position from which nodes will be removed and where will be inserted.\n\tlet firstChangeAt = null;\n\t// Index where the last change happens. Used to properly count how many characters have to be removed and inserted.\n\tlet lastChangeAt = null;\n\n\t// Get `firstChangeAt` and `lastChangeAt`.\n\tfor ( let i = 0; i < diffResult.length; i++ ) {\n\t\tconst change = diffResult[ i ];\n\n\t\tif ( change != 'equal' ) {\n\t\t\tfirstChangeAt = firstChangeAt === null ? i : firstChangeAt;\n\t\t\tlastChangeAt = i;\n\t\t}\n\t}\n\n\t// How many characters, starting from `firstChangeAt`, should be removed.\n\tlet deletions = 0;\n\t// How many characters, starting from `firstChangeAt`, should be inserted.\n\tlet insertions = 0;\n\n\tfor ( let i = firstChangeAt; i <= lastChangeAt; i++ ) {\n\t\t// If there is no change (equal) or delete, the character is existing in `oldText`. We count it for removing.\n\t\tif ( diffResult[ i ] != 'insert' ) {\n\t\t\tdeletions++;\n\t\t}\n\n\t\t// If there is no change (equal) or insert, the character is existing in `newText`. We count it for inserting.\n\t\tif ( diffResult[ i ] != 'delete' ) {\n\t\t\tinsertions++;\n\t\t}\n\t}\n\n\treturn { insertions, deletions, firstChangeAt };\n}\n"]}]}