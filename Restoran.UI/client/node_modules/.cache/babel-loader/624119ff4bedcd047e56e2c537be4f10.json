{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\model\\utils\\insertcontent.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\model\\utils\\insertcontent.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1581760786382},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5hbmNob3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMCwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSBlbmdpbmUvbW9kZWwvdXRpbHMvaW5zZXJ0Y29udGVudAogKi8KaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4uL3Bvc2l0aW9uJzsKaW1wb3J0IExpdmVQb3NpdGlvbiBmcm9tICcuLi9saXZlcG9zaXRpb24nOwppbXBvcnQgRWxlbWVudCBmcm9tICcuLi9lbGVtZW50JzsKaW1wb3J0IFJhbmdlIGZyb20gJy4uL3JhbmdlJzsKaW1wb3J0IERvY3VtZW50U2VsZWN0aW9uIGZyb20gJy4uL2RvY3VtZW50c2VsZWN0aW9uJzsKaW1wb3J0IFNlbGVjdGlvbiBmcm9tICcuLi9zZWxlY3Rpb24nOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9ja2VkaXRvcmVycm9yJzsKLyoqCiAqIEluc2VydHMgY29udGVudCBpbnRvIHRoZSBlZGl0b3IgKHNwZWNpZmllZCBzZWxlY3Rpb24pIGFzIG9uZSB3b3VsZCBleHBlY3QgdGhlIHBhc3RlCiAqIGZ1bmN0aW9uYWxpdHkgdG8gd29yay4KICoKICogSWYgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbn0gaXMgcGFzc2VkIGFzIGBzZWxlY3RhYmxlYCBpdCB3aWxsIGJlIG1vZGlmaWVkCiAqIHRvIHRoZSBpbnNlcnRpb24gc2VsZWN0aW9uIChlcXVhbCB0byBhIHJhbmdlIHRvIGJlIHNlbGVjdGVkIGFmdGVyIGluc2VydGlvbikuCiAqCiAqIElmIGBzZWxlY3RhYmxlYCBpcyBub3QgcGFzc2VkLCB0aGUgY29udGVudCB3aWxsIGJlIGluc2VydGVkIHVzaW5nIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBvZiB0aGUgbW9kZWwgZG9jdW1lbnQuCiAqCiAqICoqTm90ZToqKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudH0gaW5zdGVhZCBvZiB0aGlzIGZ1bmN0aW9uLgogKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgZXhwb3NlZCB0byBiZSByZXVzYWJsZSBpbiBhbGdvcml0aG1zIHdoaWNoIGNoYW5nZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudH0KICogbWV0aG9kJ3MgYmVoYXZpb3IuCiAqCiAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0gbW9kZWwgVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbgogKiBzaG91bGQgYmUgcGVyZm9ybWVkLgogKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtfSBjb250ZW50IFRoZSBjb250ZW50IHRvIGluc2VydC4KICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3RhYmxlfSBbc2VsZWN0YWJsZT1tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb25dCiAqIFNlbGVjdGlvbiBpbnRvIHdoaWNoIHRoZSBjb250ZW50IHNob3VsZCBiZSBpbnNlcnRlZC4KICogQHBhcmFtIHtOdW1iZXJ8J2JlZm9yZSd8J2VuZCd8J2FmdGVyJ3wnb24nfCdpbid9IFtwbGFjZU9yT2Zmc2V0XSBTZXRzIHBsYWNlIG9yIG9mZnNldCBvZiB0aGUgc2VsZWN0aW9uLgogKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZX0gUmFuZ2Ugd2hpY2ggY29udGFpbnMgYWxsIHRoZSBwZXJmb3JtZWQgY2hhbmdlcy4gVGhpcyBpcyBhIHJhbmdlIHRoYXQsIGlmIHJlbW92ZWQsCiAqIHdvdWxkIHJldHVybiB0aGUgbW9kZWwgdG8gdGhlIHN0YXRlIGJlZm9yZSB0aGUgaW5zZXJ0aW9uLiBJZiBubyBjaGFuZ2VzIHdlcmUgcHJlZm9ybWVkIGJ5IGBpbnNlcnRDb250ZW50YCwgcmV0dXJucyBhIHJhbmdlIGNvbGxhcHNlZAogKiBhdCB0aGUgaW5zZXJ0aW9uIHBvc2l0aW9uLgogKi8KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGluc2VydENvbnRlbnQobW9kZWwsIGNvbnRlbnQsIHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQpIHsKICByZXR1cm4gbW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgIHZhciBzZWxlY3Rpb247CgogICAgaWYgKCFzZWxlY3RhYmxlKSB7CiAgICAgIHNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjsKICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIFNlbGVjdGlvbiB8fCBzZWxlY3RhYmxlIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgc2VsZWN0aW9uID0gc2VsZWN0YWJsZTsKICAgIH0gZWxzZSB7CiAgICAgIHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCk7CiAgICB9CgogICAgaWYgKCFzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHsKICAgICAgbW9kZWwuZGVsZXRlQ29udGVudChzZWxlY3Rpb24sIHsKICAgICAgICBkb05vdEF1dG9wYXJhZ3JhcGg6IHRydWUKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGluc2VydGlvbiA9IG5ldyBJbnNlcnRpb24obW9kZWwsIHdyaXRlciwgc2VsZWN0aW9uLmFuY2hvcik7CiAgICB2YXIgbm9kZXNUb0luc2VydDsKCiAgICBpZiAoY29udGVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7CiAgICAgIG5vZGVzVG9JbnNlcnQgPSBjb250ZW50LmdldENoaWxkcmVuKCk7CiAgICB9IGVsc2UgewogICAgICBub2Rlc1RvSW5zZXJ0ID0gW2NvbnRlbnRdOwogICAgfQoKICAgIGluc2VydGlvbi5oYW5kbGVOb2Rlcyhub2Rlc1RvSW5zZXJ0LCB7CiAgICAgIC8vIFRoZSBzZXQgb2YgY2hpbGRyZW4gYmVpbmcgaW5zZXJ0ZWQgaXMgdGhlIG9ubHkgc2V0IGluIHRoaXMgY29udGV4dAogICAgICAvLyBzbyBpdCdzIHRoZSBmaXJzdCBhbmQgbGFzdCAoaXQncyBhIGhhY2sgOykpLgogICAgICBpc0ZpcnN0OiB0cnVlLAogICAgICBpc0xhc3Q6IHRydWUKICAgIH0pOwogICAgdmFyIG5ld1JhbmdlID0gaW5zZXJ0aW9uLmdldFNlbGVjdGlvblJhbmdlKCk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwoKICAgIGlmIChuZXdSYW5nZSkgewogICAgICBpZiAoc2VsZWN0aW9uIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1JhbmdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3Rpb24uc2V0VG8obmV3UmFuZ2UpOwogICAgICB9CiAgICB9IGVsc2Ugey8vIFdlIGFyZSBub3QgdGVzdGluZyBlbHNlIGJlY2F1c2UgaXQncyBhIHNhZmUgY2hlY2sgZm9yIHVucHJlZGljdGFibGUgZWRnZSBjYXNlczoKICAgICAgLy8gYW4gaW5zZXJ0aW9uIHdpdGhvdXQgcHJvcGVyIHJhbmdlIHRvIHNlbGVjdC4KICAgICAgLy8KICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIGNvbnNvbGUud2FybiggJ0Nhbm5vdCBkZXRlcm1pbmUgYSBwcm9wZXIgc2VsZWN0aW9uIHJhbmdlIGFmdGVyIGluc2VydGlvbi4nICk7CiAgICB9CgogICAgdmFyIGFmZmVjdGVkUmFuZ2UgPSBpbnNlcnRpb24uZ2V0QWZmZWN0ZWRSYW5nZSgpIHx8IG1vZGVsLmNyZWF0ZVJhbmdlKHNlbGVjdGlvbi5hbmNob3IpOwogICAgaW5zZXJ0aW9uLmRlc3Ryb3koKTsKICAgIHJldHVybiBhZmZlY3RlZFJhbmdlOwogIH0pOwp9Ci8qKgogKiBVdGlsaXR5IGNsYXNzIGZvciBwZXJmb3JtaW5nIGNvbnRlbnQgaW5zZXJ0aW9uLgogKgogKiBAcHJpdmF0ZQogKi8KCnZhciBJbnNlcnRpb24gPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJbnNlcnRpb24obW9kZWwsIHdyaXRlciwgcG9zaXRpb24pIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbnNlcnRpb24pOwoKICAgIC8qKgogICAgICogVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbiBzaG91bGQgYmUgcGVyZm9ybWVkLgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvbW9kZWx+TW9kZWx9ICNtb2RlbAogICAgICovCiAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAvKioKICAgICAqIEJhdGNoIHRvIHdoaWNoIG9wZXJhdGlvbnMgd2lsbCBiZSBhZGRlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvd3JpdGVyfkJhdGNofSAjd3JpdGVyCiAgICAgKi8KCiAgICB0aGlzLndyaXRlciA9IHdyaXRlcjsKICAgIC8qKgogICAgICogVGhlIHBvc2l0aW9uIGF0IHdoaWNoIChvciBuZWFyIHdoaWNoKSB0aGUgbmV4dCBub2RlIHdpbGwgYmUgaW5zZXJ0ZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gI3Bvc2l0aW9uCiAgICAgKi8KCiAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247CiAgICAvKioKICAgICAqIEVsZW1lbnRzIHdpdGggd2hpY2ggdGhlIGluc2VydGVkIGVsZW1lbnRzIGNhbiBiZSBtZXJnZWQuCiAgICAgKgogICAgICoJCTxwPnhePC9wPjxwPnk8L3A+ICsgPHA+ejwvcD4gKGNhbiBtZXJnZSB0byA8cD54PC9wPikKICAgICAqCQk8cD54PC9wPjxwPl55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eTwvcD4pCiAgICAgKgkJPHA+eF55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eHk8L3A+IHdoaWNoIHdpbGwgYmUgc3BsaXQgZHVyaW5nIHRoZSBhY3Rpb24sCiAgICAgKgkJCQkJCQkJc28gYm90aCBpdHMgcGllY2VzIHdpbGwgYmUgYWRkZWQgdG8gdGhpcyBzZXQpCiAgICAgKgogICAgICoKICAgICAqIEBtZW1iZXIge1NldH0gI2Nhbk1lcmdlV2l0aAogICAgICovCgogICAgdGhpcy5jYW5NZXJnZVdpdGggPSBuZXcgU2V0KFt0aGlzLnBvc2l0aW9uLnBhcmVudF0pOwogICAgLyoqCiAgICAgKiBTY2hlbWEgb2YgdGhlIG1vZGVsLgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX0gI3NjaGVtYQogICAgICovCgogICAgdGhpcy5zY2hlbWEgPSBtb2RlbC5zY2hlbWE7CiAgICB0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YgPSBbXTsKICAgIC8qKgogICAgICogQmVnaW5uaW5nIG9mIHRoZSBhZmZlY3RlZCByYW5nZS4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnR+SW5zZXJ0aW9uI2dldEFmZmVjdGVkUmFuZ2V9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVwb3NpdGlvbn5MaXZlUG9zaXRpb258bnVsbH0gI19hZmZlY3RlZFN0YXJ0CiAgICAgKi8KCiAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gbnVsbDsKICAgIC8qKgogICAgICogRW5kIG9mIHRoZSBhZmZlY3RlZCByYW5nZS4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnR+SW5zZXJ0aW9uI2dldEFmZmVjdGVkUmFuZ2V9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVwb3NpdGlvbn5MaXZlUG9zaXRpb258bnVsbH0gI19hZmZlY3RlZEVuZAogICAgICovCgogICAgdGhpcy5fYWZmZWN0ZWRFbmQgPSBudWxsOwogIH0KICAvKioKICAgKiBIYW5kbGVzIGluc2VydGlvbiBvZiBhIHNldCBvZiBub2Rlcy4KICAgKgogICAqIEBwYXJhbSB7SXRlcmFibGUuPG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlPn0gbm9kZXMgTm9kZXMgdG8gaW5zZXJ0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJlbnRDb250ZXh0IENvbnRleHQgaW4gd2hpY2ggcGFyZW50IG9mIHRoZXNlIG5vZGVzIHdhcyBzdXBwb3NlZCB0byBiZSBpbnNlcnRlZC4KICAgKiBJZiB0aGUgcGFyZW50IGNvbnRleHQgaXMgcGFzc2VkIGl0IG1lYW5zIHRoYXQgdGhlIHBhcmVudCBlbGVtZW50IHdhcyBzdHJpcHBlZCAod2FzIG5vdCBhbGxvd2VkKS4KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhJbnNlcnRpb24sIFt7CiAgICBrZXk6ICJoYW5kbGVOb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlTm9kZXMobm9kZXMsIHBhcmVudENvbnRleHQpIHsKICAgICAgbm9kZXMgPSBBcnJheS5mcm9tKG5vZGVzKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgICB0aGlzLl9oYW5kbGVOb2RlKG5vZGUsIHsKICAgICAgICAgIGlzRmlyc3Q6IGkgPT09IDAgJiYgcGFyZW50Q29udGV4dC5pc0ZpcnN0LAogICAgICAgICAgaXNMYXN0OiBpID09PSBub2Rlcy5sZW5ndGggLSAxICYmIHBhcmVudENvbnRleHQuaXNMYXN0CiAgICAgICAgfSk7CiAgICAgIH0gLy8gVE1QIHRoaXMgd2lsbCBiZWNvbWUgYSBwb3N0LWZpeGVyLgoKCiAgICAgIHRoaXMuc2NoZW1hLnJlbW92ZURpc2FsbG93ZWRBdHRyaWJ1dGVzKHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZiwgdGhpcy53cml0ZXIpOwogICAgICB0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyByYW5nZSB0byBiZSBzZWxlY3RlZCBhZnRlciBpbnNlcnRpb24uCiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyB2YWxpZCByYW5nZSB0byBzZWxlY3QgYWZ0ZXIgaW5zZXJ0aW9uLgogICAgICoKICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0aW9uUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGlvblJhbmdlKCkgewogICAgICBpZiAodGhpcy5ub2RlVG9TZWxlY3QpIHsKICAgICAgICByZXR1cm4gUmFuZ2UuX2NyZWF0ZU9uKHRoaXMubm9kZVRvU2VsZWN0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubW9kZWwuc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZSh0aGlzLnBvc2l0aW9uKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIHJhbmdlIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgcGVyZm9ybWVkIGNoYW5nZXMuIFRoaXMgaXMgYSByYW5nZSB0aGF0LCBpZiByZW1vdmVkLCB3b3VsZCByZXR1cm4gdGhlIG1vZGVsIHRvIHRoZSBzdGF0ZQogICAgICogYmVmb3JlIHRoZSBpbnNlcnRpb24uIFJldHVybnMgYG51bGxgIGlmIG5vIGNoYW5nZXMgd2VyZSBkb25lLgogICAgICoKICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0QWZmZWN0ZWRSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QWZmZWN0ZWRSYW5nZSgpIHsKICAgICAgaWYgKCF0aGlzLl9hZmZlY3RlZFN0YXJ0KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5fYWZmZWN0ZWRTdGFydCwgdGhpcy5fYWZmZWN0ZWRFbmQpOwogICAgfQogICAgLyoqCiAgICAgKiBEZXN0cm95cyBgSW5zZXJ0aW9uYCBpbnN0YW5jZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBpZiAodGhpcy5fYWZmZWN0ZWRTdGFydCkgewogICAgICAgIHRoaXMuX2FmZmVjdGVkU3RhcnQuZGV0YWNoKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZCkgewogICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZXMgaW5zZXJ0aW9uIG9mIGEgc2luZ2xlIG5vZGUuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNvbnRleHQuaXNGaXJzdCBXaGV0aGVyIHRoZSBnaXZlbiBub2RlIGlzIHRoZSBmaXJzdCBvbmUgaW4gdGhlIGNvbnRlbnQgdG8gYmUgaW5zZXJ0ZWQuCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNvbnRleHQuaXNMYXN0IFdoZXRoZXIgdGhlIGdpdmVuIG5vZGUgaXMgdGhlIGxhc3Qgb25lIGluIHRoZSBjb250ZW50IHRvIGJlIGluc2VydGVkLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVOb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlTm9kZShub2RlLCBjb250ZXh0KSB7CiAgICAgIC8vIExldCdzIGhhbmRsZSBvYmplY3QgaW4gYSBzcGVjaWFsIHdheS4KICAgICAgLy8gKiBUaGV5IHNob3VsZCBuZXZlciBiZSBtZXJnZWQgd2l0aCBvdGhlciBlbGVtZW50cy4KICAgICAgLy8gKiBJZiB0aGV5IGFyZSBub3QgYWxsb3dlZCBpbiBhbnkgb2YgdGhlIHNlbGVjdGlvbiBhbmNlc3RvcnMsIHRoZXkgY291bGQgYmUgZWl0aGVyIGF1dG9wYXJhZ3JhcGhlZCBvciB0b3RhbGx5IHJlbW92ZWQuCiAgICAgIGlmICh0aGlzLnNjaGVtYS5pc09iamVjdChub2RlKSkgewogICAgICAgIHRoaXMuX2hhbmRsZU9iamVjdChub2RlLCBjb250ZXh0KTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFRyeSB0byBmaW5kIGEgcGxhY2UgZm9yIHRoZSBnaXZlbiBub2RlLgogICAgICAvLyBTcGxpdCB0aGUgcG9zaXRpb24ucGFyZW50J3MgYnJhbmNoIHVwIHRvIGEgcG9pbnQgd2hlcmUgdGhlIG5vZGUgY2FuIGJlIGluc2VydGVkLgogICAgICAvLyBJZiBpdCBpc24ndCBhbGxvd2VkIGluIHRoZSB3aG9sZSBicmFuY2gsIHRoZW4gb2YgY291cnNlIGRvbid0IHNwbGl0IGFueXRoaW5nLgoKCiAgICAgIHZhciBpc0FsbG93ZWQgPSB0aGlzLl9jaGVja0FuZFNwbGl0VG9BbGxvd2VkUG9zaXRpb24obm9kZSwgY29udGV4dCk7CgogICAgICBpZiAoIWlzQWxsb3dlZCkgewogICAgICAgIHRoaXMuX2hhbmRsZURpc2FsbG93ZWROb2RlKG5vZGUsIGNvbnRleHQpOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX2luc2VydChub2RlKTsgLy8gQWZ0ZXIgdGhlIG5vZGUgd2FzIGluc2VydGVkIHdlIG1heSB0cnkgdG8gbWVyZ2UgaXQgd2l0aCBpdHMgc2libGluZ3MuCiAgICAgIC8vIFRoaXMgc2hvdWxkIGhhcHBlbiBvbmx5IGlmIGl0IHdhcyB0aGUgZmlyc3QgYW5kL29yIGxhc3Qgb2YgdGhlIG5vZGVzIChzbyBvbmx5IHdpdGggYm91bmRhcnkgbm9kZXMpCiAgICAgIC8vIGFuZCBvbmx5IGlmIHRoZSBzZWxlY3Rpb24gd2FzIGluIHRob3NlIGVsZW1lbnRzIGluaXRpYWxseS4KICAgICAgLy8KICAgICAgLy8gRS5nLjoKICAgICAgLy8gPHA+eF48L3A+ICsgPHA+eTwvcD4gPT4gPHA+eDwvcD48cD55PC9wPiA9PiA8cD54eVtdPC9wPgogICAgICAvLyBhbmQ6CiAgICAgIC8vIDxwPnheeTwvcD4gKyA8cD56PC9wPiA9PiA8cD54PC9wPl48cD55PC9wPiArIDxwPno8L3A+ID0+IDxwPng8L3A+PHA+ejwvcD48cD55PC9wPiA9PiA8cD54eltdeTwvcD4KICAgICAgLy8gYnV0OgogICAgICAvLyA8cD54PC9wPjxwPl48L3A+PHA+ejwvcD4gKyA8cD55PC9wPiA9PiA8cD54PC9wPjxwPnk8L3A+PHA+ejwvcD4gKG5vIG1lcmdpbmcpCiAgICAgIC8vIDxwPng8L3A+WzxpbWc+XTxwPno8L3A+ICsgPHA+eTwvcD4gPT4gPHA+eDwvcD48cD55PC9wPjxwPno8L3A+IChubyBtZXJnaW5nLCBub3RlOiBhZnRlciBydW5uaW5nIGRlbGV0ZUNvbnRlbnRzCiAgICAgIC8vCQkJCQkJCQkJCQkJCQkJCQkgaXQncyBleGFjdGx5IHRoZSBzYW1lIGNhc2UgYXMgYWJvdmUpCgoKICAgICAgdGhpcy5fbWVyZ2VTaWJsaW5nc09mKG5vZGUsIGNvbnRleHQpOwogICAgfQogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gbm9kZSBUaGUgb2JqZWN0IGVsZW1lbnQuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVPYmplY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVPYmplY3Qobm9kZSwgY29udGV4dCkgewogICAgICAvLyBUcnkgZmluZGluZyBpdCBhIHBsYWNlIGluIHRoZSB0cmVlLgogICAgICBpZiAodGhpcy5fY2hlY2tBbmRTcGxpdFRvQWxsb3dlZFBvc2l0aW9uKG5vZGUpKSB7CiAgICAgICAgdGhpcy5faW5zZXJ0KG5vZGUpOwogICAgICB9IC8vIFRyeSBhdXRvcGFyYWdyYXBoaW5nLgogICAgICBlbHNlIHsKICAgICAgICAgIHRoaXMuX3RyeUF1dG9wYXJhZ3JhcGhpbmcobm9kZSwgY29udGV4dCk7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZSBUaGUgZGlzYWxsb3dlZCBub2RlIHdoaWNoIG5lZWRzIHRvIGJlIGhhbmRsZWQuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVEaXNhbGxvd2VkTm9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZURpc2FsbG93ZWROb2RlKG5vZGUsIGNvbnRleHQpIHsKICAgICAgLy8gSWYgdGhlIG5vZGUgaXMgYW4gZWxlbWVudCwgdHJ5IGluc2VydGluZyBpdHMgY2hpbGRyZW4gKHN0cmlwIHRoZSBwYXJlbnQpLgogICAgICBpZiAobm9kZS5pcygnZWxlbWVudCcpKSB7CiAgICAgICAgdGhpcy5oYW5kbGVOb2Rlcyhub2RlLmdldENoaWxkcmVuKCksIGNvbnRleHQpOwogICAgICB9IC8vIElmIHRleHQgaXMgbm90IGFsbG93ZWQsIHRyeSBhdXRvcGFyYWdyYXBoaW5nIGl0LgogICAgICBlbHNlIHsKICAgICAgICAgIHRoaXMuX3RyeUF1dG9wYXJhZ3JhcGhpbmcobm9kZSwgY29udGV4dCk7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZSBUaGUgbm9kZSB0byBpbnNlcnQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2luc2VydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2luc2VydChub2RlKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoIXRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQodGhpcy5wb3NpdGlvbiwgbm9kZSkpIHsKICAgICAgICAvLyBBbGdvcml0aG0ncyBjb3JyZWN0bmVzcyBjaGVjay4gV2Ugc2hvdWxkIG5ldmVyIGVuZCB1cCBoZXJlIGJ1dCBpdCdzIGdvb2QgdG8ga25vdyB0aGF0IHdlIGRpZC4KICAgICAgICAvLyBOb3RlIHRoYXQgaXQgd291bGQgb2Z0ZW4gYmUgYSBzaWxlbnQgaXNzdWUgaWYgd2UgaW5zZXJ0IG5vZGUgaW4gYSBwbGFjZSB3aGVyZSBpdCdzIG5vdCBhbGxvd2VkLgoKICAgICAgICAvKioKICAgICAgICAgKiBHaXZlbiBub2RlIGNhbm5vdCBiZSBpbnNlcnRlZCBvbiB0aGUgZ2l2ZW4gcG9zaXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgaW5zZXJ0Y29udGVudC13cm9uZy1wb3NpdGlvbgogICAgICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUgTm9kZSB0byBpbnNlcnQuCiAgICAgICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBwb3NpdGlvbiBQb3NpdGlvbiB0byBpbnNlcnQgdGhlIG5vZGUgYXQuCiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2luc2VydGNvbnRlbnQtd3JvbmctcG9zaXRpb246IEdpdmVuIG5vZGUgY2Fubm90IGJlIGluc2VydGVkIG9uIHRoZSBnaXZlbiBwb3NpdGlvbi4nLCB0aGlzLCB7CiAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgcG9zaXRpb246IHRoaXMucG9zaXRpb24KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGxpdmVQb3MgPSBMaXZlUG9zaXRpb24uZnJvbVBvc2l0aW9uKHRoaXMucG9zaXRpb24sICd0b05leHQnKTsKCiAgICAgIHRoaXMuX3NldEFmZmVjdGVkQm91bmRhcmllcyh0aGlzLnBvc2l0aW9uKTsKCiAgICAgIHRoaXMud3JpdGVyLmluc2VydChub2RlLCB0aGlzLnBvc2l0aW9uKTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IGxpdmVQb3MudG9Qb3NpdGlvbigpOwogICAgICBsaXZlUG9zLmRldGFjaCgpOyAvLyBUaGUgbGFzdCBpbnNlcnRlZCBvYmplY3Qgc2hvdWxkIGJlIHNlbGVjdGVkIGJlY2F1c2Ugd2UgY2FuJ3QgcHV0IGEgY29sbGFwc2VkIHNlbGVjdGlvbiBhZnRlciBpdC4KCiAgICAgIGlmICh0aGlzLnNjaGVtYS5pc09iamVjdChub2RlKSAmJiAhdGhpcy5zY2hlbWEuY2hlY2tDaGlsZCh0aGlzLnBvc2l0aW9uLCAnJHRleHQnKSkgewogICAgICAgIHRoaXMubm9kZVRvU2VsZWN0ID0gbm9kZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm5vZGVUb1NlbGVjdCA9IG51bGw7CiAgICAgIH0KCiAgICAgIHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZi5wdXNoKG5vZGUpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIHRvIHRoZSBnaXZlbiBgcG9zaXRpb25gLiBTaG91bGQgYmUgdXNlZCBiZWZvcmUgYSBjaGFuZ2UgaXMgZG9uZSBkdXJpbmcgaW5zZXJ0aW9uIHByb2Nlc3MgdG8KICAgICAqIG1hcmsgdGhlIGFmZmVjdGVkIHJhbmdlLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgYmVmb3JlIGluc2VydGluZyBhIG5vZGUgb3Igc3BsaXR0aW5nIGEgcGFyZW50IG5vZGUuIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIGFyZSBhbHNvIGNoYW5nZWQKICAgICAqIGR1cmluZyBtZXJnaW5nLCBidXQgdGhlIGxvZ2ljIHRoZXJlIGlzIG1vcmUgY29tcGxpY2F0ZWQgc28gaXQgaXMgbGVmdCBvdXQgb2YgdGhpcyBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBwb3NpdGlvbgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRBZmZlY3RlZEJvdW5kYXJpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRBZmZlY3RlZEJvdW5kYXJpZXMocG9zaXRpb24pIHsKICAgICAgLy8gU2V0IGFmZmVjdGVkIGJvdW5kYXJpZXMgc3RpY2tpbmVzcyBzbyB0aGF0IHRob3NlIHBvc2l0aW9uIHdpbGwgImV4cGFuZCIgd2hlbiBzb21ldGhpbmcgaXMgaW5zZXJ0ZWQgaW4gYmV0d2VlbiB0aGVtOgogICAgICAvLyA8cGFyYWdyYXBoPkZvb11bYmFyPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Rm9vXXh4W2JhcjwvcGFyYWdyYXBoPgogICAgICAvLyBUaGlzIGlzIHdoeSBpdCBjYW5ub3QgYmUgYSByYW5nZSBidXQgdHdvIHNlcGFyYXRlIHBvc2l0aW9ucy4KICAgICAgaWYgKCF0aGlzLl9hZmZlY3RlZFN0YXJ0KSB7CiAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydCA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24ocG9zaXRpb24sICd0b1ByZXZpb3VzJyk7CiAgICAgIH0gLy8gSWYgYF9hZmZlY3RlZEVuZGAgaXMgYmVmb3JlIHRoZSBuZXcgYm91bmRhcnkgcG9zaXRpb24sIGV4cGFuZCBgX2FmZmVjdGVkRW5kYC4gVGhpcyBjYW4gaGFwcGVuIGlmIGZpcnN0IGluc2VydGVkIG5vZGUgd2FzCiAgICAgIC8vIGluc2VydGVkIGludG8gdGhlIHBhcmVudCBidXQgdGhlIG5leHQgbm9kZSBpcyBtb3ZlZC1vdXQgb2YgdGhhdCBwYXJlbnQ6CiAgICAgIC8vICgxKSA8cGFyYWdyYXBoPkZvb11bPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Rm9vXXh4WzwvcGFyYWdyYXBoPgogICAgICAvLyAoMikgPHBhcmFncmFwaD5Gb29deHhbPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Rm9vXXh4PC9wYXJhZ3JhcGg+PHdpZGdldD48L3dpZGdldD5bCgoKICAgICAgaWYgKCF0aGlzLl9hZmZlY3RlZEVuZCB8fCB0aGlzLl9hZmZlY3RlZEVuZC5pc0JlZm9yZShwb3NpdGlvbikpIHsKICAgICAgICBpZiAodGhpcy5fYWZmZWN0ZWRFbmQpIHsKICAgICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYWZmZWN0ZWRFbmQgPSBMaXZlUG9zaXRpb24uZnJvbVBvc2l0aW9uKHBvc2l0aW9uLCAndG9OZXh0Jyk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUgVGhlIG5vZGUgd2hpY2ggY291bGQgcG90ZW50aWFsbHkgYmUgbWVyZ2VkLgogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfbWVyZ2VTaWJsaW5nc09mIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfbWVyZ2VTaWJsaW5nc09mKG5vZGUsIGNvbnRleHQpIHsKICAgICAgaWYgKCEobm9kZSBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgbWVyZ2VMZWZ0ID0gdGhpcy5fY2FuTWVyZ2VMZWZ0KG5vZGUsIGNvbnRleHQpOwoKICAgICAgdmFyIG1lcmdlUmlnaHQgPSB0aGlzLl9jYW5NZXJnZVJpZ2h0KG5vZGUsIGNvbnRleHQpOwoKICAgICAgdmFyIG1lcmdlUG9zTGVmdCA9IExpdmVQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKG5vZGUpOwoKICAgICAgbWVyZ2VQb3NMZWZ0LnN0aWNraW5lc3MgPSAndG9OZXh0JzsKCiAgICAgIHZhciBtZXJnZVBvc1JpZ2h0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBZnRlcihub2RlKTsKCiAgICAgIG1lcmdlUG9zUmlnaHQuc3RpY2tpbmVzcyA9ICd0b05leHQnOwoKICAgICAgaWYgKG1lcmdlTGVmdCkgewogICAgICAgIHZhciBsaXZlUG9zaXRpb24gPSBMaXZlUG9zaXRpb24uZnJvbVBvc2l0aW9uKHRoaXMucG9zaXRpb24pOwogICAgICAgIGxpdmVQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvTmV4dCc7IC8vIElmIGBfYWZmZWN0ZWRTdGFydGAgaXMgc2FtZXMgYXMgbWVyZ2UgcG9zaXRpb24sIGl0IG1lYW5zIHRoYXQgdGhlIGVsZW1lbnQgIm1hcmtlZCIgYnkgYF9hZmZlY3RlZFN0YXJ0YCBpcyBnb2luZyB0byBiZQogICAgICAgIC8vIHJlbW92ZWQgYW5kIGl0cyBjb250ZW50cyB3aWxsIGJlIG1vdmVkLiBUaGlzIHdvbid0IHRyYW5zZm9ybSBgTGl2ZVBvc2l0aW9uYCBzbyBgX2FmZmVjdGVkU3RhcnRgIG5lZWRzIHRvIGJlIG1vdmVkCiAgICAgICAgLy8gYnkgaGFuZCB0byBwcm9wZXJseSByZWZsZWN0IGFmZmVjdGVkIHJhbmdlLiAoRHVlIHRvIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIHN0aWNraW5lc3MsIHRoZSAicmFuZ2UiIGlzCiAgICAgICAgLy8gc2hvd24gYXMgYF1bYCkuCiAgICAgICAgLy8KICAgICAgICAvLyBFeGFtcGxlIC0gaW5zZXJ0IGA8cGFyYWdyYXBoPkFiYzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+YCBhdCB0aGUgZW5kIG9mIGA8cGFyYWdyYXBoPkZvb148L3BhcmFncmFwaD5gOgogICAgICAgIC8vCiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPgogICAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+XTxwYXJhZ3JhcGg+QWJjPC9wYXJhZ3JhcGg+PHBhcmFncmFwaD5YeXo8L3BhcmFncmFwaD5bPHBhcmFncmFwaD5CYXI8L3BhcmFncmFwaD4gICAtLT4KICAgICAgICAvLyA8cGFyYWdyYXBoPkZvb11BYmM8L3BhcmFncmFwaD48cGFyYWdyYXBoPlh5ejwvcGFyYWdyYXBoPls8cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPgogICAgICAgIC8vCiAgICAgICAgLy8gTm90ZSwgdGhhdCBpZiB3ZSBhcmUgaGVyZSB0aGVuIHNvbWV0aGluZyBtdXN0IGhhdmUgYmVlbiBpbnNlcnRlZCwgc28gYF9hZmZlY3RlZFN0YXJ0YCBhbmQgYF9hZmZlY3RlZEVuZGAgaGF2ZSB0byBiZSBzZXQuCgogICAgICAgIGlmICh0aGlzLl9hZmZlY3RlZFN0YXJ0LmlzRXF1YWwobWVyZ2VQb3NMZWZ0KSkgewogICAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydC5kZXRhY2goKTsKCiAgICAgICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc0xlZnQubm9kZUJlZm9yZSwgJ2VuZCcsICd0b1ByZXZpb3VzJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLndyaXRlci5tZXJnZShtZXJnZVBvc0xlZnQpOyAvLyBJZiBvbmx5IG9uZSBlbGVtZW50ICh0aGUgbWVyZ2VkIG9uZSkgaXMgaW4gdGhlICJhZmZlY3RlZCByYW5nZSIsIGFsc28gbW92ZSB0aGUgYWZmZWN0ZWQgcmFuZ2UgZW5kIGFwcHJvcHJpYXRlbHkuCiAgICAgICAgLy8KICAgICAgICAvLyBFeGFtcGxlIC0gaW5zZXJ0IGA8cGFyYWdyYXBoPkFiYzwvcGFyYWdyYXBoPmAgYXQgdGhlIG9mIGA8cGFyYWdyYXBoPkZvb148L3BhcmFncmFwaD5gOgogICAgICAgIC8vCiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPgogICAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+XTxwYXJhZ3JhcGg+QWJjPC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+ICAgLS0+CiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb29dQWJjPC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+ICAgLS0+CiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb29dQWJjWzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+CgogICAgICAgIGlmIChtZXJnZVBvc0xlZnQuaXNFcXVhbCh0aGlzLl9hZmZlY3RlZEVuZCkgJiYgY29udGV4dC5pc0xhc3QpIHsKICAgICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpOwoKICAgICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc0xlZnQubm9kZUJlZm9yZSwgJ2VuZCcsICd0b05leHQnKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucG9zaXRpb24gPSBsaXZlUG9zaXRpb24udG9Qb3NpdGlvbigpOwogICAgICAgIGxpdmVQb3NpdGlvbi5kZXRhY2goKTsKICAgICAgfQoKICAgICAgaWYgKG1lcmdlUmlnaHQpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoIXRoaXMucG9zaXRpb24uaXNFcXVhbChtZXJnZVBvc1JpZ2h0KSkgewogICAgICAgICAgLy8gQWxnb3JpdGhtJ3MgY29ycmVjdG5lc3MgY2hlY2suIFdlIHNob3VsZCBuZXZlciBlbmQgdXAgaGVyZSBidXQgaXQncyBnb29kIHRvIGtub3cgdGhhdCB3ZSBkaWQuCiAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHRoZSBpbnNlcnRpb24gcG9zaXRpb24gc2hvdWxkIGJlIGFmdGVyIHRoZSBub2RlIHdlJ2xsIG1lcmdlLiBJZiBpdCBpc24ndCwKICAgICAgICAgIC8vIGl0IHNob3VsZCBuZWVkIHRvIGJlIHNlY3VyZWQgYXMgaW4gdGhlIGxlZnQgbWVyZ2UgY2FzZS4KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEFuIGludGVybmFsIGVycm9yIG9jY3VyZWQgZHVyaW5nIG1lcmdpbmcgaW5zZXJ0aW9uIGNvbnRlbnQgd2l0aCBzaWJsaW5ncy4KICAgICAgICAgICAqIFRoZSBpbnNlcnRpb24gcG9zaXRpb24gc2hvdWxkIGVxdWFsIHRvIHRoZSBtZXJnZSBwb3NpdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZXJyb3IgaW5zZXJ0Y29udGVudC1pbnZhbGlkLWluc2VydGlvbi1wb3NpdGlvbgogICAgICAgICAgICovCiAgICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignaW5zZXJ0Y29udGVudC1pbnZhbGlkLWluc2VydGlvbi1wb3NpdGlvbicsIHRoaXMpOwogICAgICAgIH0gLy8gTW92ZSB0aGUgcG9zaXRpb24gdG8gdGhlIHByZXZpb3VzIG5vZGUsIHNvIGl0IGlzbid0IG1vdmVkIHRvIHRoZSBncmF2ZXlhcmQgb24gbWVyZ2UuCiAgICAgICAgLy8gPHA+eDwvcD5bXTxwPnk8L3A+ID0+IDxwPnhbXTwvcD48cD55PC9wPgoKCiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc1JpZ2h0Lm5vZGVCZWZvcmUsICdlbmQnKTsgLy8gT0s6ICA8cD54eFtdPC9wPiArIDxwPnl5PC9wPiA9PiA8cD54eFtdeXk8L3A+ICh3aGVuIHN0aWNrcyB0byBwcmV2aW91cykKICAgICAgICAvLyBOT0s6IDxwPnh4W108L3A+ICsgPHA+eXk8L3A+ID0+IDxwPnh4eXlbXTwvcD4gKHdoZW4gc3RpY2tzIHRvIG5leHQpCgogICAgICAgIHZhciBfbGl2ZVBvc2l0aW9uID0gTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbih0aGlzLnBvc2l0aW9uLCAndG9QcmV2aW91cycpOyAvLyBTZWUgY29tbWVudCBhYm92ZSBvbiBtb3ZpbmcgYF9hZmZlY3RlZFN0YXJ0YC4KCgogICAgICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZC5pc0VxdWFsKG1lcmdlUG9zUmlnaHQpKSB7CiAgICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZC5kZXRhY2goKTsKCiAgICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZCA9IExpdmVQb3NpdGlvbi5fY3JlYXRlQXQobWVyZ2VQb3NSaWdodC5ub2RlQmVmb3JlLCAnZW5kJywgJ3RvTmV4dCcpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy53cml0ZXIubWVyZ2UobWVyZ2VQb3NSaWdodCk7IC8vIFNlZSBjb21tZW50IGFib3ZlIG9uIG1vdmluZyBgX2FmZmVjdGVkU3RhcnRgLgoKICAgICAgICBpZiAobWVyZ2VQb3NSaWdodC5nZXRTaGlmdGVkQnkoLTEpLmlzRXF1YWwodGhpcy5fYWZmZWN0ZWRTdGFydCkgJiYgY29udGV4dC5pc0ZpcnN0KSB7CiAgICAgICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0LmRldGFjaCgpOwoKICAgICAgICAgIHRoaXMuX2FmZmVjdGVkU3RhcnQgPSBMaXZlUG9zaXRpb24uX2NyZWF0ZUF0KG1lcmdlUG9zUmlnaHQubm9kZUJlZm9yZSwgMCwgJ3RvUHJldmlvdXMnKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucG9zaXRpb24gPSBfbGl2ZVBvc2l0aW9uLnRvUG9zaXRpb24oKTsKCiAgICAgICAgX2xpdmVQb3NpdGlvbi5kZXRhY2goKTsKICAgICAgfQoKICAgICAgaWYgKG1lcmdlTGVmdCB8fCBtZXJnZVJpZ2h0KSB7CiAgICAgICAgLy8gQWZ0ZXIgbWVyZ2UgZWxlbWVudHMgdGhhdCB3ZXJlIG1hcmtlZCBieSBfaW5zZXJ0KCkgdG8gYmUgZmlsdGVyZWQgbWlnaHQgYmUgZ29uZSBzbwogICAgICAgIC8vIHdlIG5lZWQgdG8gbWFyayB0aGUgbmV3IGNvbnRhaW5lci4KICAgICAgICB0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YucHVzaCh0aGlzLnBvc2l0aW9uLnBhcmVudCk7CiAgICAgIH0KCiAgICAgIG1lcmdlUG9zTGVmdC5kZXRhY2goKTsKICAgICAgbWVyZ2VQb3NSaWdodC5kZXRhY2goKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgc3BlY2lmaWVkIG5vZGUgY2FuIGJlIG1lcmdlZCB3aXRoIHByZXZpb3VzIHNpYmxpbmcgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZSBUaGUgbm9kZSB3aGljaCBjb3VsZCBwb3RlbnRpYWxseSBiZSBtZXJnZWQuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2Nhbk1lcmdlTGVmdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2Nhbk1lcmdlTGVmdChub2RlLCBjb250ZXh0KSB7CiAgICAgIHZhciBwcmV2aW91c1NpYmxpbmcgPSBub2RlLnByZXZpb3VzU2libGluZzsKICAgICAgcmV0dXJuIGNvbnRleHQuaXNGaXJzdCAmJiBwcmV2aW91c1NpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHRoaXMuY2FuTWVyZ2VXaXRoLmhhcyhwcmV2aW91c1NpYmxpbmcpICYmIHRoaXMubW9kZWwuc2NoZW1hLmNoZWNrTWVyZ2UocHJldmlvdXNTaWJsaW5nLCBub2RlKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgc3BlY2lmaWVkIG5vZGUgY2FuIGJlIG1lcmdlZCB3aXRoIG5leHQgc2libGluZyBlbGVtZW50LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBub2RlIHdoaWNoIGNvdWxkIHBvdGVudGlhbGx5IGJlIG1lcmdlZC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY2FuTWVyZ2VSaWdodCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2Nhbk1lcmdlUmlnaHQobm9kZSwgY29udGV4dCkgewogICAgICB2YXIgbmV4dFNpYmxpbmcgPSBub2RlLm5leHRTaWJsaW5nOwogICAgICByZXR1cm4gY29udGV4dC5pc0xhc3QgJiYgbmV4dFNpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHRoaXMuY2FuTWVyZ2VXaXRoLmhhcyhuZXh0U2libGluZykgJiYgdGhpcy5tb2RlbC5zY2hlbWEuY2hlY2tNZXJnZShub2RlLCBuZXh0U2libGluZyk7CiAgICB9CiAgICAvKioKICAgICAqIFRyaWVzIHdyYXBwaW5nIHRoZSBub2RlIGluIGEgbmV3IHBhcmFncmFwaCBhbmQgaW5zZXJ0aW5nIGl0IHRoaXMgd2F5LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBub2RlIHdoaWNoIG5lZWRzIHRvIGJlIGF1dG9wYXJhZ3JhcGhlZC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3RyeUF1dG9wYXJhZ3JhcGhpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIF90cnlBdXRvcGFyYWdyYXBoaW5nKG5vZGUsIGNvbnRleHQpIHsKICAgICAgdmFyIHBhcmFncmFwaCA9IHRoaXMud3JpdGVyLmNyZWF0ZUVsZW1lbnQoJ3BhcmFncmFwaCcpOyAvLyBEbyBub3QgYXV0b3BhcmFncmFwaCBpZiB0aGUgcGFyYWdyYXBoIHdvbid0IGJlIGFsbG93ZWQgdGhlcmUsCiAgICAgIC8vIGNhdXNlIHRoYXQgd291bGQgbGVhZCB0byBhbiBpbmZpbml0ZSBsb29wLiBUaGUgcGFyYWdyYXBoIHdvdWxkIGJlIHJlamVjdGVkIGluCiAgICAgIC8vIHRoZSBuZXh0IF9oYW5kbGVOb2RlKCkgY2FsbCBhbmQgd2UnZCBiZSBoZXJlIGFnYWluLgoKICAgICAgaWYgKHRoaXMuX2dldEFsbG93ZWRJbihwYXJhZ3JhcGgsIHRoaXMucG9zaXRpb24ucGFyZW50KSAmJiB0aGlzLnNjaGVtYS5jaGVja0NoaWxkKHBhcmFncmFwaCwgbm9kZSkpIHsKICAgICAgICBwYXJhZ3JhcGguX2FwcGVuZENoaWxkKG5vZGUpOwoKICAgICAgICB0aGlzLl9oYW5kbGVOb2RlKHBhcmFncmFwaCwgY29udGV4dCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUKICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBXaGV0aGVyIGFuIGFsbG93ZWQgcG9zaXRpb24gd2FzIGZvdW5kLgogICAgICogYGZhbHNlYCBpcyByZXR1cm5lZCBpZiB0aGUgbm9kZSBpc24ndCBhbGxvd2VkIGF0IGFueSBwb3NpdGlvbiB1cCBpbiB0aGUgdHJlZSwgYHRydWVgIGlmIHdhcy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY2hlY2tBbmRTcGxpdFRvQWxsb3dlZFBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hlY2tBbmRTcGxpdFRvQWxsb3dlZFBvc2l0aW9uKG5vZGUpIHsKICAgICAgdmFyIGFsbG93ZWRJbiA9IHRoaXMuX2dldEFsbG93ZWRJbihub2RlLCB0aGlzLnBvc2l0aW9uLnBhcmVudCk7CgogICAgICBpZiAoIWFsbG93ZWRJbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgd2hpbGUgKGFsbG93ZWRJbiAhPSB0aGlzLnBvc2l0aW9uLnBhcmVudCkgewogICAgICAgIC8vIElmIGEgcGFyZW50IHdoaWNoIHdlJ2QgbmVlZCB0byBsZWF2ZSBpcyBhIGxpbWl0IGVsZW1lbnQsIGJyZWFrLgogICAgICAgIGlmICh0aGlzLnNjaGVtYS5pc0xpbWl0KHRoaXMucG9zaXRpb24ucGFyZW50KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucG9zaXRpb24uaXNBdFN0YXJ0KSB7CiAgICAgICAgICAvLyBJZiBpbnNlcnRpb24gcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcGFyZW50LCBtb3ZlIGl0IG91dCBpbnN0ZWFkIG9mIHNwbGl0dGluZy4KICAgICAgICAgIC8vIDxwPl5Gb288L3A+IC0+IF48cD5Gb288L3A+CiAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wb3NpdGlvbi5wYXJlbnQ7CiAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy53cml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUocGFyZW50KTsgLy8gU3BlY2lhbCBjYXNlIOKAkyBwYXJlbnQgaXMgZW1wdHkgKDxwPl48L3A+KS4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyAxLiBwYXJlbnQuaXNFbXB0eQogICAgICAgICAgLy8gV2UgY2FuIHJlbW92ZSB0aGUgZWxlbWVudCBhZnRlciBtb3ZpbmcgaW5zZXJ0aW9uIHBvc2l0aW9uIG91dCBvZiBpdC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyAyLiBwYXJlbnQucGFyZW50ID09PSBhbGxvd2VkSW4KICAgICAgICAgIC8vIEhvd2V2ZXIgcGFyZW50IHNob3VsZCByZW1haW4gaW4gcGxhY2Ugd2hlbiBhbGxvd2VkIGVsZW1lbnQgaXMgYWJvdmUgbGltaXQgZWxlbWVudCBpbiBkb2N1bWVudCB0cmVlLgogICAgICAgICAgLy8gRm9yIGV4YW1wbGUgdGhlcmUgc2hvdWxkbid0IGJlIGFsbG93ZWQgdG8gcmVtb3ZlIGVtcHR5IHBhcmFncmFwaCBmcm9tIHRhYmxlQ2VsbCwgd2hlbiBpcyBwYXN0ZWQKICAgICAgICAgIC8vIGNvbnRlbnQgYWxsb3dlZCBpbiAkcm9vdC4KCiAgICAgICAgICBpZiAocGFyZW50LmlzRW1wdHkgJiYgcGFyZW50LnBhcmVudCA9PT0gYWxsb3dlZEluKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVyLnJlbW92ZShwYXJlbnQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbi5pc0F0RW5kKSB7CiAgICAgICAgICAvLyBJZiBpbnNlcnRpb24gcG9zaXRpb24gaXMgYXQgdGhlIGVuZCBvZiB0aGUgcGFyZW50LCBtb3ZlIGl0IG91dCBpbnN0ZWFkIG9mIHNwbGl0dGluZy4KICAgICAgICAgIC8vIDxwPkZvb148L3A+IC0+IDxwPkZvbzwvcD5eCiAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy53cml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih0aGlzLnBvc2l0aW9uLnBhcmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciB0ZW1wUG9zID0gdGhpcy53cml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih0aGlzLnBvc2l0aW9uLnBhcmVudCk7CgogICAgICAgICAgdGhpcy5fc2V0QWZmZWN0ZWRCb3VuZGFyaWVzKHRoaXMucG9zaXRpb24pOwoKICAgICAgICAgIHRoaXMud3JpdGVyLnNwbGl0KHRoaXMucG9zaXRpb24pOwogICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRlbXBQb3M7CiAgICAgICAgICB0aGlzLmNhbk1lcmdlV2l0aC5hZGQodGhpcy5wb3NpdGlvbi5ub2RlQWZ0ZXIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIGVsZW1lbnQgaW4gd2hpY2ggdGhlIGdpdmVuIG5vZGUgaXMgYWxsb3dlZC4gSXQgY2hlY2tzIHRoZSBwYXNzZWQgZWxlbWVudCBhbmQgYWxsIGl0cyBhbmNlc3RvcnMuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUgVGhlIG5vZGUgdG8gY2hlY2suCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50IFRoZSBlbGVtZW50IGluIHdoaWNoIHRoZSBub2RlJ3MgY29ycmVjdG5lc3Mgc2hvdWxkIGJlIGNoZWNrZWQuCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnR8bnVsbH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfZ2V0QWxsb3dlZEluIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QWxsb3dlZEluKG5vZGUsIGVsZW1lbnQpIHsKICAgICAgaWYgKHRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQoZWxlbWVudCwgbm9kZSkpIHsKICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgfQoKICAgICAgaWYgKGVsZW1lbnQucGFyZW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEFsbG93ZWRJbihub2RlLCBlbGVtZW50LnBhcmVudCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEluc2VydGlvbjsKfSgpOw=="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/insertcontent.js"],"names":["Position","LivePosition","Element","Range","DocumentSelection","Selection","CKEditorError","insertContent","model","content","selectable","placeOrOffset","change","writer","selection","document","createSelection","isCollapsed","deleteContent","doNotAutoparagraph","insertion","Insertion","anchor","nodesToInsert","is","getChildren","handleNodes","isFirst","isLast","newRange","getSelectionRange","setSelection","setTo","affectedRange","getAffectedRange","createRange","destroy","position","canMergeWith","Set","parent","schema","_filterAttributesOf","_affectedStart","_affectedEnd","nodes","parentContext","Array","from","i","length","node","_handleNode","removeDisallowedAttributes","nodeToSelect","_createOn","getNearestSelectionRange","detach","context","isObject","_handleObject","isAllowed","_checkAndSplitToAllowedPosition","_handleDisallowedNode","_insert","_mergeSiblingsOf","_tryAutoparagraphing","checkChild","livePos","fromPosition","_setAffectedBoundaries","insert","toPosition","push","isBefore","mergeLeft","_canMergeLeft","mergeRight","_canMergeRight","mergePosLeft","_createBefore","stickiness","mergePosRight","_createAfter","livePosition","isEqual","_createAt","nodeBefore","merge","getShiftedBy","previousSibling","has","checkMerge","nextSibling","paragraph","createElement","_getAllowedIn","_appendChild","allowedIn","isLimit","isAtStart","createPositionBefore","isEmpty","remove","isAtEnd","createPositionAfter","tempPos","split","add","nodeAfter","element"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/model/utils/insertcontent\n */\n\nimport Position from '../position';\nimport LivePosition from '../liveposition';\nimport Element from '../element';\nimport Range from '../range';\nimport DocumentSelection from '../documentselection';\nimport Selection from '../selection';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\n\n/**\n * Inserts content into the editor (specified selection) as one would expect the paste\n * functionality to work.\n *\n * If an instance of {@link module:engine/model/selection~Selection} is passed as `selectable` it will be modified\n * to the insertion selection (equal to a range to be selected after insertion).\n *\n * If `selectable` is not passed, the content will be inserted using the current selection of the model document.\n *\n * **Note:** Use {@link module:engine/model/model~Model#insertContent} instead of this function.\n * This function is only exposed to be reusable in algorithms which change the {@link module:engine/model/model~Model#insertContent}\n * method's behavior.\n *\n * @param {module:engine/model/model~Model} model The model in context of which the insertion\n * should be performed.\n * @param {module:engine/model/documentfragment~DocumentFragment|module:engine/model/item~Item} content The content to insert.\n * @param {module:engine/model/selection~Selectable} [selectable=model.document.selection]\n * Selection into which the content should be inserted.\n * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\n * @returns {module:engine/model/range~Range} Range which contains all the performed changes. This is a range that, if removed,\n * would return the model to the state before the insertion. If no changes were preformed by `insertContent`, returns a range collapsed\n * at the insertion position.\n */\nexport default function insertContent( model, content, selectable, placeOrOffset ) {\n\treturn model.change( writer => {\n\t\tlet selection;\n\n\t\tif ( !selectable ) {\n\t\t\tselection = model.document.selection;\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\n\t\t\tselection = selectable;\n\t\t} else {\n\t\t\tselection = writer.createSelection( selectable, placeOrOffset );\n\t\t}\n\n\t\tif ( !selection.isCollapsed ) {\n\t\t\tmodel.deleteContent( selection, { doNotAutoparagraph: true } );\n\t\t}\n\n\t\tconst insertion = new Insertion( model, writer, selection.anchor );\n\n\t\tlet nodesToInsert;\n\n\t\tif ( content.is( 'documentFragment' ) ) {\n\t\t\tnodesToInsert = content.getChildren();\n\t\t} else {\n\t\t\tnodesToInsert = [ content ];\n\t\t}\n\n\t\tinsertion.handleNodes( nodesToInsert, {\n\t\t\t// The set of children being inserted is the only set in this context\n\t\t\t// so it's the first and last (it's a hack ;)).\n\t\t\tisFirst: true,\n\t\t\tisLast: true\n\t\t} );\n\n\t\tconst newRange = insertion.getSelectionRange();\n\n\t\t/* istanbul ignore else */\n\t\tif ( newRange ) {\n\t\t\tif ( selection instanceof DocumentSelection ) {\n\t\t\t\twriter.setSelection( newRange );\n\t\t\t} else {\n\t\t\t\tselection.setTo( newRange );\n\t\t\t}\n\t\t} else {\n\t\t\t// We are not testing else because it's a safe check for unpredictable edge cases:\n\t\t\t// an insertion without proper range to select.\n\t\t\t//\n\t\t\t// @if CK_DEBUG // console.warn( 'Cannot determine a proper selection range after insertion.' );\n\t\t}\n\n\t\tconst affectedRange = insertion.getAffectedRange() || model.createRange( selection.anchor );\n\n\t\tinsertion.destroy();\n\n\t\treturn affectedRange;\n\t} );\n}\n\n/**\n * Utility class for performing content insertion.\n *\n * @private\n */\nclass Insertion {\n\tconstructor( model, writer, position ) {\n\t\t/**\n\t\t * The model in context of which the insertion should be performed.\n\t\t *\n\t\t * @member {module:engine/model~Model} #model\n\t\t */\n\t\tthis.model = model;\n\n\t\t/**\n\t\t * Batch to which operations will be added.\n\t\t *\n\t\t * @member {module:engine/controller/writer~Batch} #writer\n\t\t */\n\t\tthis.writer = writer;\n\n\t\t/**\n\t\t * The position at which (or near which) the next node will be inserted.\n\t\t *\n\t\t * @member {module:engine/model/position~Position} #position\n\t\t */\n\t\tthis.position = position;\n\n\t\t/**\n\t\t * Elements with which the inserted elements can be merged.\n\t\t *\n\t\t *\t\t<p>x^</p><p>y</p> + <p>z</p> (can merge to <p>x</p>)\n\t\t *\t\t<p>x</p><p>^y</p> + <p>z</p> (can merge to <p>y</p>)\n\t\t *\t\t<p>x^y</p> + <p>z</p> (can merge to <p>xy</p> which will be split during the action,\n\t\t *\t\t\t\t\t\t\t\tso both its pieces will be added to this set)\n\t\t *\n\t\t *\n\t\t * @member {Set} #canMergeWith\n\t\t */\n\t\tthis.canMergeWith = new Set( [ this.position.parent ] );\n\n\t\t/**\n\t\t * Schema of the model.\n\t\t *\n\t\t * @member {module:engine/model/schema~Schema} #schema\n\t\t */\n\t\tthis.schema = model.schema;\n\n\t\tthis._filterAttributesOf = [];\n\n\t\t/**\n\t\t * Beginning of the affected range. See {@link module:engine/model/utils/insertcontent~Insertion#getAffectedRange}.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/model/liveposition~LivePosition|null} #_affectedStart\n\t\t */\n\t\tthis._affectedStart = null;\n\n\t\t/**\n\t\t * End of the affected range. See {@link module:engine/model/utils/insertcontent~Insertion#getAffectedRange}.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/model/liveposition~LivePosition|null} #_affectedEnd\n\t\t */\n\t\tthis._affectedEnd = null;\n\t}\n\n\t/**\n\t * Handles insertion of a set of nodes.\n\t *\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes to insert.\n\t * @param {Object} parentContext Context in which parent of these nodes was supposed to be inserted.\n\t * If the parent context is passed it means that the parent element was stripped (was not allowed).\n\t */\n\thandleNodes( nodes, parentContext ) {\n\t\tnodes = Array.from( nodes );\n\n\t\tfor ( let i = 0; i < nodes.length; i++ ) {\n\t\t\tconst node = nodes[ i ];\n\n\t\t\tthis._handleNode( node, {\n\t\t\t\tisFirst: i === 0 && parentContext.isFirst,\n\t\t\t\tisLast: ( i === ( nodes.length - 1 ) ) && parentContext.isLast\n\t\t\t} );\n\t\t}\n\n\t\t// TMP this will become a post-fixer.\n\t\tthis.schema.removeDisallowedAttributes( this._filterAttributesOf, this.writer );\n\t\tthis._filterAttributesOf = [];\n\t}\n\n\t/**\n\t * Returns range to be selected after insertion.\n\t * Returns `null` if there is no valid range to select after insertion.\n\t *\n\t * @returns {module:engine/model/range~Range|null}\n\t */\n\tgetSelectionRange() {\n\t\tif ( this.nodeToSelect ) {\n\t\t\treturn Range._createOn( this.nodeToSelect );\n\t\t}\n\n\t\treturn this.model.schema.getNearestSelectionRange( this.position );\n\t}\n\n\t/**\n\t * Returns a range which contains all the performed changes. This is a range that, if removed, would return the model to the state\n\t * before the insertion. Returns `null` if no changes were done.\n\t *\n\t * @returns {module:engine/model/range~Range|null}\n\t */\n\tgetAffectedRange() {\n\t\tif ( !this._affectedStart ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Range( this._affectedStart, this._affectedEnd );\n\t}\n\n\t/**\n\t * Destroys `Insertion` instance.\n\t */\n\tdestroy() {\n\t\tif ( this._affectedStart ) {\n\t\t\tthis._affectedStart.detach();\n\t\t}\n\n\t\tif ( this._affectedEnd ) {\n\t\t\tthis._affectedEnd.detach();\n\t\t}\n\t}\n\n\t/**\n\t * Handles insertion of a single node.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node\n\t * @param {Object} context\n\t * @param {Boolean} context.isFirst Whether the given node is the first one in the content to be inserted.\n\t * @param {Boolean} context.isLast Whether the given node is the last one in the content to be inserted.\n\t */\n\t_handleNode( node, context ) {\n\t\t// Let's handle object in a special way.\n\t\t// * They should never be merged with other elements.\n\t\t// * If they are not allowed in any of the selection ancestors, they could be either autoparagraphed or totally removed.\n\t\tif ( this.schema.isObject( node ) ) {\n\t\t\tthis._handleObject( node, context );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Try to find a place for the given node.\n\t\t// Split the position.parent's branch up to a point where the node can be inserted.\n\t\t// If it isn't allowed in the whole branch, then of course don't split anything.\n\t\tconst isAllowed = this._checkAndSplitToAllowedPosition( node, context );\n\n\t\tif ( !isAllowed ) {\n\t\t\tthis._handleDisallowedNode( node, context );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._insert( node );\n\n\t\t// After the node was inserted we may try to merge it with its siblings.\n\t\t// This should happen only if it was the first and/or last of the nodes (so only with boundary nodes)\n\t\t// and only if the selection was in those elements initially.\n\t\t//\n\t\t// E.g.:\n\t\t// <p>x^</p> + <p>y</p> => <p>x</p><p>y</p> => <p>xy[]</p>\n\t\t// and:\n\t\t// <p>x^y</p> + <p>z</p> => <p>x</p>^<p>y</p> + <p>z</p> => <p>x</p><p>z</p><p>y</p> => <p>xz[]y</p>\n\t\t// but:\n\t\t// <p>x</p><p>^</p><p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging)\n\t\t// <p>x</p>[<img>]<p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging, note: after running deleteContents\n\t\t//\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t it's exactly the same case as above)\n\t\tthis._mergeSiblingsOf( node, context );\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/element~Element} node The object element.\n\t * @param {Object} context\n\t */\n\t_handleObject( node, context ) {\n\t\t// Try finding it a place in the tree.\n\t\tif ( this._checkAndSplitToAllowedPosition( node ) ) {\n\t\t\tthis._insert( node );\n\t\t}\n\t\t// Try autoparagraphing.\n\t\telse {\n\t\t\tthis._tryAutoparagraphing( node, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The disallowed node which needs to be handled.\n\t * @param {Object} context\n\t */\n\t_handleDisallowedNode( node, context ) {\n\t\t// If the node is an element, try inserting its children (strip the parent).\n\t\tif ( node.is( 'element' ) ) {\n\t\t\tthis.handleNodes( node.getChildren(), context );\n\t\t}\n\t\t// If text is not allowed, try autoparagraphing it.\n\t\telse {\n\t\t\tthis._tryAutoparagraphing( node, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node to insert.\n\t */\n\t_insert( node ) {\n\t\t/* istanbul ignore if */\n\t\tif ( !this.schema.checkChild( this.position, node ) ) {\n\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\n\t\t\t// Note that it would often be a silent issue if we insert node in a place where it's not allowed.\n\n\t\t\t/**\n\t\t\t * Given node cannot be inserted on the given position.\n\t\t\t *\n\t\t\t * @error insertcontent-wrong-position\n\t\t\t * @param {module:engine/model/node~Node} node Node to insert.\n\t\t\t * @param {module:engine/model/position~Position} position Position to insert the node at.\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'insertcontent-wrong-position: Given node cannot be inserted on the given position.',\n\t\t\t\tthis,\n\t\t\t\t{ node, position: this.position }\n\t\t\t);\n\t\t}\n\n\t\tconst livePos = LivePosition.fromPosition( this.position, 'toNext' );\n\n\t\tthis._setAffectedBoundaries( this.position );\n\t\tthis.writer.insert( node, this.position );\n\n\t\tthis.position = livePos.toPosition();\n\t\tlivePos.detach();\n\n\t\t// The last inserted object should be selected because we can't put a collapsed selection after it.\n\t\tif ( this.schema.isObject( node ) && !this.schema.checkChild( this.position, '$text' ) ) {\n\t\t\tthis.nodeToSelect = node;\n\t\t} else {\n\t\t\tthis.nodeToSelect = null;\n\t\t}\n\n\t\tthis._filterAttributesOf.push( node );\n\t}\n\n\t/**\n\t * Sets `_affectedStart` and `_affectedEnd` to the given `position`. Should be used before a change is done during insertion process to\n\t * mark the affected range.\n\t *\n\t * This method is used before inserting a node or splitting a parent node. `_affectedStart` and `_affectedEnd` are also changed\n\t * during merging, but the logic there is more complicated so it is left out of this function.\n\t *\n\t * @private\n\t * @param {module:engine/model/position~Position} position\n\t */\n\t_setAffectedBoundaries( position ) {\n\t\t// Set affected boundaries stickiness so that those position will \"expand\" when something is inserted in between them:\n\t\t// <paragraph>Foo][bar</paragraph> -> <paragraph>Foo]xx[bar</paragraph>\n\t\t// This is why it cannot be a range but two separate positions.\n\t\tif ( !this._affectedStart ) {\n\t\t\tthis._affectedStart = LivePosition.fromPosition( position, 'toPrevious' );\n\t\t}\n\n\t\t// If `_affectedEnd` is before the new boundary position, expand `_affectedEnd`. This can happen if first inserted node was\n\t\t// inserted into the parent but the next node is moved-out of that parent:\n\t\t// (1) <paragraph>Foo][</paragraph> -> <paragraph>Foo]xx[</paragraph>\n\t\t// (2) <paragraph>Foo]xx[</paragraph> -> <paragraph>Foo]xx</paragraph><widget></widget>[\n\t\tif ( !this._affectedEnd || this._affectedEnd.isBefore( position ) ) {\n\t\t\tif ( this._affectedEnd ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t}\n\n\t\t\tthis._affectedEnd = LivePosition.fromPosition( position, 'toNext' );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t */\n\t_mergeSiblingsOf( node, context ) {\n\t\tif ( !( node instanceof Element ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mergeLeft = this._canMergeLeft( node, context );\n\t\tconst mergeRight = this._canMergeRight( node, context );\n\t\tconst mergePosLeft = LivePosition._createBefore( node );\n\t\tmergePosLeft.stickiness = 'toNext';\n\t\tconst mergePosRight = LivePosition._createAfter( node );\n\t\tmergePosRight.stickiness = 'toNext';\n\n\t\tif ( mergeLeft ) {\n\t\t\tconst livePosition = LivePosition.fromPosition( this.position );\n\t\t\tlivePosition.stickiness = 'toNext';\n\n\t\t\t// If `_affectedStart` is sames as merge position, it means that the element \"marked\" by `_affectedStart` is going to be\n\t\t\t// removed and its contents will be moved. This won't transform `LivePosition` so `_affectedStart` needs to be moved\n\t\t\t// by hand to properly reflect affected range. (Due to `_affectedStart` and `_affectedEnd` stickiness, the \"range\" is\n\t\t\t// shown as `][`).\n\t\t\t//\n\t\t\t// Example - insert `<paragraph>Abc</paragraph><paragraph>Xyz</paragraph>` at the end of `<paragraph>Foo^</paragraph>`:\n\t\t\t//\n\t\t\t// <paragraph>Foo</paragraph><paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo</paragraph>]<paragraph>Abc</paragraph><paragraph>Xyz</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc</paragraph><paragraph>Xyz</paragraph>[<paragraph>Bar</paragraph>\n\t\t\t//\n\t\t\t// Note, that if we are here then something must have been inserted, so `_affectedStart` and `_affectedEnd` have to be set.\n\t\t\tif ( this._affectedStart.isEqual( mergePosLeft ) ) {\n\t\t\t\tthis._affectedStart.detach();\n\t\t\t\tthis._affectedStart = LivePosition._createAt( mergePosLeft.nodeBefore, 'end', 'toPrevious' );\n\t\t\t}\n\n\t\t\tthis.writer.merge( mergePosLeft );\n\n\t\t\t// If only one element (the merged one) is in the \"affected range\", also move the affected range end appropriately.\n\t\t\t//\n\t\t\t// Example - insert `<paragraph>Abc</paragraph>` at the of `<paragraph>Foo^</paragraph>`:\n\t\t\t//\n\t\t\t// <paragraph>Foo</paragraph><paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo</paragraph>]<paragraph>Abc</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc[</paragraph><paragraph>Bar</paragraph>\n\t\t\tif ( mergePosLeft.isEqual( this._affectedEnd ) && context.isLast ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t\tthis._affectedEnd = LivePosition._createAt( mergePosLeft.nodeBefore, 'end', 'toNext' );\n\t\t\t}\n\n\t\t\tthis.position = livePosition.toPosition();\n\t\t\tlivePosition.detach();\n\t\t}\n\n\t\tif ( mergeRight ) {\n\t\t\t/* istanbul ignore if */\n\t\t\tif ( !this.position.isEqual( mergePosRight ) ) {\n\t\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\n\t\t\t\t// At this point the insertion position should be after the node we'll merge. If it isn't,\n\t\t\t\t// it should need to be secured as in the left merge case.\n\t\t\t\t/**\n\t\t\t\t * An internal error occured during merging insertion content with siblings.\n\t\t\t\t * The insertion position should equal to the merge position.\n\t\t\t\t *\n\t\t\t\t * @error insertcontent-invalid-insertion-position\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'insertcontent-invalid-insertion-position', this );\n\t\t\t}\n\n\t\t\t// Move the position to the previous node, so it isn't moved to the graveyard on merge.\n\t\t\t// <p>x</p>[]<p>y</p> => <p>x[]</p><p>y</p>\n\t\t\tthis.position = Position._createAt( mergePosRight.nodeBefore, 'end' );\n\n\t\t\t// OK:  <p>xx[]</p> + <p>yy</p> => <p>xx[]yy</p> (when sticks to previous)\n\t\t\t// NOK: <p>xx[]</p> + <p>yy</p> => <p>xxyy[]</p> (when sticks to next)\n\t\t\tconst livePosition = LivePosition.fromPosition( this.position, 'toPrevious' );\n\n\t\t\t// See comment above on moving `_affectedStart`.\n\t\t\tif ( this._affectedEnd.isEqual( mergePosRight ) ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t\tthis._affectedEnd = LivePosition._createAt( mergePosRight.nodeBefore, 'end', 'toNext' );\n\t\t\t}\n\n\t\t\tthis.writer.merge( mergePosRight );\n\n\t\t\t// See comment above on moving `_affectedStart`.\n\t\t\tif ( mergePosRight.getShiftedBy( -1 ).isEqual( this._affectedStart ) && context.isFirst ) {\n\t\t\t\tthis._affectedStart.detach();\n\t\t\t\tthis._affectedStart = LivePosition._createAt( mergePosRight.nodeBefore, 0, 'toPrevious' );\n\t\t\t}\n\n\t\t\tthis.position = livePosition.toPosition();\n\t\t\tlivePosition.detach();\n\t\t}\n\n\t\tif ( mergeLeft || mergeRight ) {\n\t\t\t// After merge elements that were marked by _insert() to be filtered might be gone so\n\t\t\t// we need to mark the new container.\n\t\t\tthis._filterAttributesOf.push( this.position.parent );\n\t\t}\n\n\t\tmergePosLeft.detach();\n\t\tmergePosRight.detach();\n\t}\n\n\t/**\n\t * Checks whether specified node can be merged with previous sibling element.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t * @returns {Boolean}\n\t */\n\t_canMergeLeft( node, context ) {\n\t\tconst previousSibling = node.previousSibling;\n\n\t\treturn context.isFirst &&\n\t\t\t( previousSibling instanceof Element ) &&\n\t\t\tthis.canMergeWith.has( previousSibling ) &&\n\t\t\tthis.model.schema.checkMerge( previousSibling, node );\n\t}\n\n\t/**\n\t * Checks whether specified node can be merged with next sibling element.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t * @returns {Boolean}\n\t */\n\t_canMergeRight( node, context ) {\n\t\tconst nextSibling = node.nextSibling;\n\n\t\treturn context.isLast &&\n\t\t\t( nextSibling instanceof Element ) &&\n\t\t\tthis.canMergeWith.has( nextSibling ) &&\n\t\t\tthis.model.schema.checkMerge( node, nextSibling );\n\t}\n\n\t/**\n\t * Tries wrapping the node in a new paragraph and inserting it this way.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which needs to be autoparagraphed.\n\t * @param {Object} context\n\t */\n\t_tryAutoparagraphing( node, context ) {\n\t\tconst paragraph = this.writer.createElement( 'paragraph' );\n\n\t\t// Do not autoparagraph if the paragraph won't be allowed there,\n\t\t// cause that would lead to an infinite loop. The paragraph would be rejected in\n\t\t// the next _handleNode() call and we'd be here again.\n\t\tif ( this._getAllowedIn( paragraph, this.position.parent ) && this.schema.checkChild( paragraph, node ) ) {\n\t\t\tparagraph._appendChild( node );\n\t\t\tthis._handleNode( paragraph, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node\n\t * @returns {Boolean} Whether an allowed position was found.\n\t * `false` is returned if the node isn't allowed at any position up in the tree, `true` if was.\n\t */\n\t_checkAndSplitToAllowedPosition( node ) {\n\t\tconst allowedIn = this._getAllowedIn( node, this.position.parent );\n\n\t\tif ( !allowedIn ) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile ( allowedIn != this.position.parent ) {\n\t\t\t// If a parent which we'd need to leave is a limit element, break.\n\t\t\tif ( this.schema.isLimit( this.position.parent ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( this.position.isAtStart ) {\n\t\t\t\t// If insertion position is at the beginning of the parent, move it out instead of splitting.\n\t\t\t\t// <p>^Foo</p> -> ^<p>Foo</p>\n\t\t\t\tconst parent = this.position.parent;\n\n\t\t\t\tthis.position = this.writer.createPositionBefore( parent );\n\n\t\t\t\t// Special case  parent is empty (<p>^</p>).\n\t\t\t\t//\n\t\t\t\t// 1. parent.isEmpty\n\t\t\t\t// We can remove the element after moving insertion position out of it.\n\t\t\t\t//\n\t\t\t\t// 2. parent.parent === allowedIn\n\t\t\t\t// However parent should remain in place when allowed element is above limit element in document tree.\n\t\t\t\t// For example there shouldn't be allowed to remove empty paragraph from tableCell, when is pasted\n\t\t\t\t// content allowed in $root.\n\t\t\t\tif ( parent.isEmpty && parent.parent === allowedIn ) {\n\t\t\t\t\tthis.writer.remove( parent );\n\t\t\t\t}\n\t\t\t} else if ( this.position.isAtEnd ) {\n\t\t\t\t// If insertion position is at the end of the parent, move it out instead of splitting.\n\t\t\t\t// <p>Foo^</p> -> <p>Foo</p>^\n\t\t\t\tthis.position = this.writer.createPositionAfter( this.position.parent );\n\t\t\t} else {\n\t\t\t\tconst tempPos = this.writer.createPositionAfter( this.position.parent );\n\n\t\t\t\tthis._setAffectedBoundaries( this.position );\n\t\t\t\tthis.writer.split( this.position );\n\n\t\t\t\tthis.position = tempPos;\n\n\t\t\t\tthis.canMergeWith.add( this.position.nodeAfter );\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Gets the element in which the given node is allowed. It checks the passed element and all its ancestors.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node to check.\n\t * @param {module:engine/model/element~Element} element The element in which the node's correctness should be checked.\n\t * @returns {module:engine/model/element~Element|null}\n\t */\n\t_getAllowedIn( node, element ) {\n\t\tif ( this.schema.checkChild( element, node ) ) {\n\t\t\treturn element;\n\t\t}\n\n\t\tif ( element.parent ) {\n\t\t\treturn this._getAllowedIn( node, element.parent );\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"]}]}