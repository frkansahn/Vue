{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-ui\\src\\template.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-ui\\src\\template.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9nZXQgZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMCwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSB1aS90ZW1wbGF0ZQogKi8KCi8qIGdsb2JhbCBkb2N1bWVudCAqLwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9ja2VkaXRvcmVycm9yJzsKaW1wb3J0IG1peCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9taXgnOwppbXBvcnQgRW1pdHRlck1peGluIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2VtaXR0ZXJtaXhpbic7CmltcG9ydCBWaWV3IGZyb20gJy4vdmlldyc7CmltcG9ydCBWaWV3Q29sbGVjdGlvbiBmcm9tICcuL3ZpZXdjb2xsZWN0aW9uJzsKaW1wb3J0IGlzTm9kZSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9kb20vaXNub2RlJzsKaW1wb3J0IHsgaXNPYmplY3QsIGNsb25lRGVlcFdpdGggfSBmcm9tICdsb2Rhc2gtZXMnOwp2YXIgeGh0bWxOcyA9ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJzsKLyoqCiAqIEEgYmFzaWMgVGVtcGxhdGUgY2xhc3MuIEl0IHJlbmRlcnMgYSBET00gSFRNTCBlbGVtZW50IG9yIHRleHQgZnJvbSBhCiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGRlZmluaXRpb259IGFuZCBzdXBwb3J0cyBlbGVtZW50IGF0dHJpYnV0ZXMsIGNoaWxkcmVuLAogKiBiaW5kaW5ncyB0byB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGVzfSBhbmQgRE9NIGV2ZW50IHByb3BhZ2F0aW9uLgogKgogKiBBIHNpbXBsZSB0ZW1wbGF0ZSBjYW4gbG9vayBsaWtlIHRoaXM6CiAqCiAqCQljb25zdCBiaW5kID0gVGVtcGxhdGUuYmluZCggb2JzZXJ2YWJsZSwgZW1pdHRlciApOwogKgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGFnOiAncCcsCiAqCQkJYXR0cmlidXRlczogewogKgkJCQljbGFzczogJ2ZvbycsCiAqCQkJCXN0eWxlOiB7CiAqCQkJCQliYWNrZ3JvdW5kQ29sb3I6ICd5ZWxsb3cnCiAqCQkJCX0KICoJCQl9LAogKgkJCW9uOiB7CiAqCQkJCWNsaWNrOiBiaW5kLnRvKCAnY2xpY2tlZCcgKQogKgkJCX0sCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJJ0EgcGFyYWdyYXBoLicKICoJCQldCiAqCQl9ICkucmVuZGVyKCk7CiAqCiAqIGFuZCBpdCB3aWxsIHJlbmRlciB0aGUgZm9sbG93aW5nIEhUTUwgZWxlbWVudDoKICoKICoJCTxwIGNsYXNzPSJmb28iIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7Ij5BIHBhcmFncmFwaC48L3A+CiAqCiAqIEFkZGl0aW9uYWxseSwgdGhlIGBvYnNlcnZhYmxlYCB3aWxsIGFsd2F5cyBmaXJlIGBjbGlja2VkYCB1cG9uIGNsaWNraW5nIGA8cD5gIGluIHRoZSBET00uCiAqCiAqIFNlZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gdG8ga25vdyBtb3JlIGFib3V0IHRlbXBsYXRlcyBhbmQgY29tcGxleAogKiB0ZW1wbGF0ZSBkZWZpbml0aW9ucy4KICoKKiBAbWl4ZXMgbW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyTWl4aW4KICovCgp2YXIgVGVtcGxhdGUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgflRlbXBsYXRlfSBjbGFzcy4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmIFRoZSBkZWZpbml0aW9uIG9mIHRoZSB0ZW1wbGF0ZS4KICAgKi8KICBmdW5jdGlvbiBUZW1wbGF0ZShkZWYpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZW1wbGF0ZSk7CgogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBub3JtYWxpemUoY2xvbmUoZGVmKSkpOwogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGlzIHBhcnRpY3VsYXIgVGVtcGxhdGUgaW5zdGFuY2UgaGFzIGJlZW4KICAgICAqIHtAbGluayAjcmVuZGVyIHJlbmRlcmVkfS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9pc1JlbmRlcmVkID0gZmFsc2U7CiAgICAvKioKICAgICAqIFRoZSB0YWcgKGB0YWdOYW1lYCkgb2YgdGhpcyB0ZW1wbGF0ZSwgZS5nLiBgZGl2YC4gSXQgYWxzbyBpbmRpY2F0ZXMgdGhhdCB0aGUgdGVtcGxhdGUKICAgICAqIHJlbmRlcnMgdG8gYW4gSFRNTCBlbGVtZW50LgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gI3RhZwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdGV4dCBvZiB0aGUgdGVtcGxhdGUuIEl0IGFsc28gaW5kaWNhdGVzIHRoYXQgdGhlIHRlbXBsYXRlIHJlbmRlcnMgdG8gYSBET00gdGV4dCBub2RlLgogICAgICoKICAgICAqIEBtZW1iZXIge0FycmF5LjxTdHJpbmd8bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWE+fSAjdGV4dAogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXR0cmlidXRlcyBvZiB0aGUgdGVtcGxhdGUsIGUuZy4gYHsgaWQ6IFsgJ2NrLWlkJyBdIH1gLCBjb3JyZXNwb25kaW5nIHdpdGgKICAgICAqIHRoZSBhdHRyaWJ1dGVzIG9mIGFuIEhUTUwgZWxlbWVudC4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogVGhpcyBwcm9wZXJ0eSBvbmx5IG1ha2VzIHNlbnNlIHdoZW4ge0BsaW5rICN0YWd9IGlzIGRlZmluZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7T2JqZWN0fSAjYXR0cmlidXRlcwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY2hpbGRyZW4gb2YgdGhlIHRlbXBsYXRlLiBUaGV5IGNhbiBiZSBlaXRoZXI6CiAgICAgKiAqIGluZGVwZW5kZW50IGluc3RhbmNlcyBvZiB7QGxpbmsgflRlbXBsYXRlfSAoc3Vi4oCTdGVtcGxhdGVzKSwKICAgICAqICogbmF0aXZlIERPTSBOb2Rlcy4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogVGhpcyBwcm9wZXJ0eSBvbmx5IG1ha2VzIHNlbnNlIHdoZW4ge0BsaW5rICN0YWd9IGlzIGRlZmluZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7QXJyYXkuPG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZXxOb2RlPn0gI2NoaWxkcmVuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBET00gZXZlbnQgbGlzdGVuZXJzIG9mIHRoZSB0ZW1wbGF0ZS4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtPYmplY3R9ICNldmVudExpc3RlbmVycwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGF0YSB1c2VkIGJ5IHRoZSB7QGxpbmsgI3JldmVydH0gbWV0aG9kIHRvIHJlc3RvcmUgYSBub2RlIHRvIGl0cyBvcmlnaW5hbCBzdGF0ZS4KICAgICAqCiAgICAgKiBTZWU6IHtAbGluayAjYXBwbHl9LgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9CiAgICAgKi8KCiAgICB0aGlzLl9yZXZlcnREYXRhID0gbnVsbDsKICB9CiAgLyoqCiAgICogUmVuZGVycyBhIERPTSBOb2RlIChhbiBIVE1MIGVsZW1lbnQgb3IgdGV4dCkgb3V0IG9mIHRoZSB0ZW1wbGF0ZS4KICAgKgogICAqCQljb25zdCBkb21Ob2RlID0gbmV3IFRlbXBsYXRlKCB7IC4uLiB9ICkucmVuZGVyKCk7CiAgICoKICAgKiBTZWU6IHtAbGluayAjYXBwbHl9LgogICAqCiAgICogQHJldHVybnMge0hUTUxFbGVtZW50fFRleHR9CiAgICovCgoKICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGUsIFt7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIG5vZGUgPSB0aGlzLl9yZW5kZXJOb2RlKHsKICAgICAgICBpbnRvRnJhZ21lbnQ6IHRydWUKICAgICAgfSk7CgogICAgICB0aGlzLl9pc1JlbmRlcmVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGxpZXMgdGhlIHRlbXBsYXRlIHRvIGFuIGV4aXN0aW5nIERPTSBOb2RlLCBlaXRoZXIgSFRNTCBlbGVtZW50IG9yIHRleHQuCiAgICAgKgogICAgICogKipOb3RlOioqIE5vIG5ldyBET00gbm9kZXMgd2lsbCBiZSBjcmVhdGVkLiBBcHBseWluZyBleHRlbmRzOgogICAgICoKICAgICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGF0dHJpYnV0ZXN9LAogICAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24gZXZlbnQgbGlzdGVuZXJzfSwgYW5kCiAgICAgKiBgdGV4dENvbnRlbnRgIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGNoaWxkcmVufSBvbmx5LgogICAgICoKICAgICAqICoqTm90ZToqKiBFeGlzdGluZyBgY2xhc3NgIGFuZCBgc3R5bGVgIGF0dHJpYnV0ZXMgYXJlIGV4dGVuZGVkIHdoZW4gYSB0ZW1wbGF0ZQogICAgICogaXMgYXBwbGllZCB0byBhbiBIVE1MIGVsZW1lbnQsIHdoaWxlIG90aGVyIGF0dHJpYnV0ZXMgYW5kIGB0ZXh0Q29udGVudGAgYXJlIG92ZXJyaWRkZW4uCiAgICAgKgogICAgICogKipOb3RlOioqIFRoZSBwcm9jZXNzIG9mIGFwcGx5aW5nIGEgdGVtcGxhdGUgY2FuIGJlIGVhc2lseSByZXZlcnRlZCB1c2luZyB0aGUKICAgICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmV2ZXJ0fSBtZXRob2QuCiAgICAgKgogICAgICoJCWNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwogICAgICoJCWNvbnN0IG9ic2VydmFibGUgPSBuZXcgTW9kZWwoIHsgZGl2Q2xhc3M6ICdteS1kaXYnIH0gKTsKICAgICAqCQljb25zdCBlbWl0dGVyID0gT2JqZWN0LmNyZWF0ZSggRW1pdHRlck1peGluICk7CiAgICAgKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICAgICAqCiAgICAgKgkJbmV3IFRlbXBsYXRlKCB7CiAgICAgKgkJCWF0dHJpYnV0ZXM6IHsKICAgICAqCQkJCWlkOiAnZmlyc3QtZGl2JywKICAgICAqCQkJCWNsYXNzOiBiaW5kLnRvKCAnZGl2Q2xhc3MnICkKICAgICAqCQkJfSwKICAgICAqCQkJb246IHsKICAgICAqCQkJCWNsaWNrOiBiaW5kKCAnZWxlbWVudENsaWNrZWQnICkgLy8gV2lsbCBiZSBmaXJlZCBieSB0aGUgb2JzZXJ2YWJsZS4KICAgICAqCQkJfSwKICAgICAqCQkJY2hpbGRyZW46IFsKICAgICAqCQkJCSdEaXYgdGV4dC4nCiAgICAgKgkJCV0KICAgICAqCQl9ICkuYXBwbHkoIGVsZW1lbnQgKTsKICAgICAqCiAgICAgKgkJY29uc29sZS5sb2coIGVsZW1lbnQub3V0ZXJIVE1MICk7IC8vIC0+ICc8ZGl2IGlkPSJmaXJzdC1kaXYiIGNsYXNzPSJteS1kaXYiPjwvZGl2PicKICAgICAqCiAgICAgKiBAc2VlIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZW5kZXIKICAgICAqIEBzZWUgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydAogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIFJvb3Qgbm9kZSBmb3IgdGhlIHRlbXBsYXRlIHRvIGFwcGx5LgogICAgICovCgogIH0sIHsKICAgIGtleTogImFwcGx5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseShub2RlKSB7CiAgICAgIHRoaXMuX3JldmVydERhdGEgPSBnZXRFbXB0eVJldmVydERhdGEoKTsKCiAgICAgIHRoaXMuX3JlbmRlck5vZGUoewogICAgICAgIG5vZGU6IG5vZGUsCiAgICAgICAgaXNBcHBseWluZzogdHJ1ZSwKICAgICAgICByZXZlcnREYXRhOiB0aGlzLl9yZXZlcnREYXRhCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9CiAgICAvKioKICAgICAqIFJldmVydHMgYSB0ZW1wbGF0ZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2FwcGx5IGFwcGxpZWR9IHRvIGEgRE9NIG5vZGUuCiAgICAgKgogICAgICogQHBhcmFtIHtOb2RlfSBub2RlIFRoZSByb290IG5vZGUgZm9yIHRoZSB0ZW1wbGF0ZSB0byByZXZlcnQuIEluIG1vc3Qgb2YgdGhlIGNhc2VzLCBpdCBpcyB0aGUKICAgICAqIHNhbWUgbm9kZSB1c2VkIGJ5IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXBwbHl9LgogICAgICovCgogIH0sIHsKICAgIGtleTogInJldmVydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmV2ZXJ0KG5vZGUpIHsKICAgICAgaWYgKCF0aGlzLl9yZXZlcnREYXRhKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogQXR0ZW1wdGluZyB0byByZXZlcnQgYSB0ZW1wbGF0ZSB3aGljaCBoYXMgbm90IGJlZW4gYXBwbGllZCB5ZXQuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgdWktdGVtcGxhdGUtcmV2ZXJ0LW5vdC1hcHBsaWVkCiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3VpLXRlbXBsYXRlLXJldmVydC1ub3QtYXBwbGllZDogQXR0ZW1wdGluZyB0byByZXZlcnQgYSB0ZW1wbGF0ZSB3aGljaCBoYXMgbm90IGJlZW4gYXBwbGllZCB5ZXQuJywgW3RoaXMsIG5vZGVdKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZShub2RlLCB0aGlzLl9yZXZlcnREYXRhKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbiBpdGVyYXRvciB3aGljaCB0cmF2ZXJzZXMgdGhlIHRlbXBsYXRlIGluIHNlYXJjaCBvZiB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+Vmlld30KICAgICAqIGluc3RhbmNlcyBhbmQgcmV0dXJucyB0aGVtIG9uZSBieSBvbmUuCiAgICAgKgogICAgICoJCWNvbnN0IHZpZXdGb28gPSBuZXcgVmlldygpOwogICAgICoJCWNvbnN0IHZpZXdCYXIgPSBuZXcgVmlldygpOwogICAgICoJCWNvbnN0IHZpZXdCYXogPSBuZXcgVmlldygpOwogICAgICoJCWNvbnN0IHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKCB7CiAgICAgKgkJCXRhZzogJ2RpdicsCiAgICAgKgkJCWNoaWxkcmVuOiBbCiAgICAgKgkJCQl2aWV3Rm9vLAogICAgICoJCQkJewogICAgICoJCQkJCXRhZzogJ2RpdicsCiAgICAgKgkJCQkJY2hpbGRyZW46IFsKICAgICAqCQkJCQkJdmlld0JhcgogICAgICoJCQkJCV0KICAgICAqCQkJCX0sCiAgICAgKgkJCQl2aWV3QmF6CiAgICAgKgkJCV0KICAgICAqCQl9ICk7CiAgICAgKgogICAgICoJCS8vIExvZ3M6IHZpZXdGb28sIHZpZXdCYXIsIHZpZXdCYXoKICAgICAqCQlmb3IgKCBjb25zdCB2aWV3IG9mIHRlbXBsYXRlLmdldFZpZXdzKCkgKSB7CiAgICAgKgkJCWNvbnNvbGUubG9nKCB2aWV3ICk7CiAgICAgKgkJfQogICAgICoKICAgICAqIEByZXR1cm5zIHtJdGVyYWJsZS48bW9kdWxlOnVpL3ZpZXd+Vmlldz59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Vmlld3MiLAogICAgdmFsdWU6CiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBnZXRWaWV3cygpIHsKICAgICAgdmFyIF9tYXJrZWQsIHNlYXJjaDsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBnZXRWaWV3cyQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc2VhcmNoID0gZnVuY3Rpb24gX3JlZihkZWYpIHsKICAgICAgICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uLCBfZGlkSXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvciwgX3N0ZXAsIGNoaWxkOwoKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBzZWFyY2gkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRlZi5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMjsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gZGVmLmNoaWxkcmVuW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVGVtcGxhdGUoY2hpbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZGVsZWdhdGVZaWVsZChzZWFyY2goY2hpbGQpLCAidDAiLCAxNSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyMDsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDEgPSBfY29udGV4dFsiY2F0Y2giXSg0KTsKICAgICAgICAgICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0LnQxOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNDsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI1OwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMjcpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMjQpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgX21hcmtlZCwgbnVsbCwgW1s0LCAyMCwgMjQsIDMyXSwgWzI1LCwgMjcsIDMxXV0pOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF9tYXJrZWQgPQogICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhzZWFyY2gpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuZGVsZWdhdGVZaWVsZChzZWFyY2godGhpcyksICJ0MCIsIDMpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgZ2V0Vmlld3MsIHRoaXMpOwogICAgfSkKICAgIC8qKgogICAgICogQW4gZW50cnkgcG9pbnQgdG8gdGhlIGludGVyZmFjZSB3aGljaCBiaW5kcyBET00gbm9kZXMgdG8KICAgICAqIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUgb2JzZXJ2YWJsZXN9LgogICAgICogVGhlcmUgYXJlIHR3byB0eXBlcyBvZiBiaW5kaW5nczoKICAgICAqCiAgICAgKiAqIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGVzIG9yIHRleHQgYHRleHRDb250ZW50YCBzeW5jaHJvbml6ZWQgd2l0aCBhdHRyaWJ1dGVzIG9mIGFuCiAgICAgKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfS4gTGVhcm4gbW9yZSBhYm91dCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0b30KICAgICAqIGFuZCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiNpZn0uCiAgICAgKgogICAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICAgKgogICAgICoJCW5ldyBUZW1wbGF0ZSggewogICAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQkvLyBCaW5kcyB0aGUgZWxlbWVudCAiY2xhc3MiIGF0dHJpYnV0ZSB0byBvYnNlcnZhYmxlI2NsYXNzQXR0cmlidXRlLgogICAgICoJCQkJY2xhc3M6IGJpbmQudG8oICdjbGFzc0F0dHJpYnV0ZScgKQogICAgICoJCQl9CiAgICAgKgkJfSApLnJlbmRlcigpOwogICAgICoKICAgICAqICogRE9NIGV2ZW50cyBmaXJlZCBvbiBIVE1MIGVsZW1lbnQgcHJvcGFnYXRlZCB0aHJvdWdoCiAgICAgKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfS4gTGVhcm4gbW9yZSBhYm91dCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0b30uCiAgICAgKgogICAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICAgKgogICAgICoJCW5ldyBUZW1wbGF0ZSggewogICAgICoJCQlvbjogewogICAgICoJCQkJLy8gV2lsbCBiZSBmaXJlZCBieSB0aGUgb2JzZXJ2YWJsZS4KICAgICAqCQkJCWNsaWNrOiBiaW5kKCAnZWxlbWVudENsaWNrZWQnICkKICAgICAqCQkJfQogICAgICoJCX0gKS5yZW5kZXIoKTsKICAgICAqCiAgICAgKiBBbHNvIHNlZSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyNiaW5kVGVtcGxhdGV9LgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBvYnNlcnZhYmxlIEFuIG9ic2VydmFibGUgd2hpY2ggcHJvdmlkZXMgYm91bmRhYmxlIGF0dHJpYnV0ZXMuCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlcn0gZW1pdHRlciBBbiBlbWl0dGVyIHRoYXQgbGlzdGVucyB0byBvYnNlcnZhYmxlIGF0dHJpYnV0ZQogICAgICogY2hhbmdlcyBvciBET00gRXZlbnRzIChkZXBlbmRpbmcgb24gdGhlIGtpbmQgb2YgdGhlIGJpbmRpbmcpLiBVc3VhbGx5LCBhIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fSBpbnN0YW5jZS4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+QmluZENoYWlufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW5kZXJOb2RlIiwKCiAgICAvKioKICAgICAqIFJlbmRlcnMgYSBET00gTm9kZSAoZWl0aGVyIGFuIEhUTUwgZWxlbWVudCBvciB0ZXh0KSBvdXQgb2YgdGhlIHRlbXBsYXRlLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyTm9kZShkYXRhKSB7CiAgICAgIHZhciBpc0ludmFsaWQ7CgogICAgICBpZiAoZGF0YS5ub2RlKSB7CiAgICAgICAgLy8gV2hlbiBhcHBseWluZywgYSBkZWZpbml0aW9uIGNhbm5vdCBoYXZlICJ0YWciIGFuZCAidGV4dCIgYXQgdGhlIHNhbWUgdGltZS4KICAgICAgICBpc0ludmFsaWQgPSB0aGlzLnRhZyAmJiB0aGlzLnRleHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gV2hlbiByZW5kZXJpbmcsIGEgZGVmaW5pdGlvbiBtdXN0IGhhdmUgZWl0aGVyICJ0YWciIG9yICJ0ZXh0IjogWE9SKCB0aGlzLnRhZywgdGhpcy50ZXh0ICkuCiAgICAgICAgaXNJbnZhbGlkID0gdGhpcy50YWcgPyB0aGlzLnRleHQgOiAhdGhpcy50ZXh0OwogICAgICB9CgogICAgICBpZiAoaXNJbnZhbGlkKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogTm9kZSBkZWZpbml0aW9uIGNhbm5vdCBoYXZlIHRoZSAidGFnIiBhbmQgInRleHQiIHByb3BlcnRpZXMgYXQgdGhlIHNhbWUgdGltZS4KICAgICAgICAgKiBOb2RlIGRlZmluaXRpb24gbXVzdCBoYXZlIGVpdGhlciAidGFnIiBvciAidGV4dCIgd2hlbiByZW5kZXJpbmcgYSBuZXcgTm9kZS4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciB1aS10ZW1wbGF0ZS13cm9uZy1zeW50YXgKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndWktdGVtcGxhdGUtd3Jvbmctc3ludGF4OiBOb2RlIGRlZmluaXRpb24gbXVzdCBoYXZlIGVpdGhlciAidGFnIiBvciAidGV4dCIgd2hlbiByZW5kZXJpbmcgYSBuZXcgTm9kZS4nLCB0aGlzKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudGV4dCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJUZXh0KGRhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJFbGVtZW50KGRhdGEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlbmRlcnMgYW4gSFRNTCBlbGVtZW50IG91dCBvZiB0aGUgdGVtcGxhdGUuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckVsZW1lbnQoZGF0YSkgewogICAgICB2YXIgbm9kZSA9IGRhdGEubm9kZTsKCiAgICAgIGlmICghbm9kZSkgewogICAgICAgIG5vZGUgPSBkYXRhLm5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5ucyB8fCB4aHRtbE5zLCB0aGlzLnRhZyk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3JlbmRlckF0dHJpYnV0ZXMoZGF0YSk7CgogICAgICB0aGlzLl9yZW5kZXJFbGVtZW50Q2hpbGRyZW4oZGF0YSk7CgogICAgICB0aGlzLl9zZXRVcExpc3RlbmVycyhkYXRhKTsKCiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgLyoqCiAgICAgKiBSZW5kZXJzIGEgdGV4dCBub2RlIG91dCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3RleHR9LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3JlbmRlclRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJUZXh0KGRhdGEpIHsKICAgICAgdmFyIG5vZGUgPSBkYXRhLm5vZGU7IC8vIFNhdmUgdGhlIG9yaWdpbmFsIHRleHRDb250ZW50IHRvIHJldmVydCBpdCBpbiAjcmV2ZXJ0KCkuCgogICAgICBpZiAobm9kZSkgewogICAgICAgIGRhdGEucmV2ZXJ0RGF0YS50ZXh0ID0gbm9kZS50ZXh0Q29udGVudDsKICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlID0gZGF0YS5ub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpOwogICAgICB9IC8vIENoZWNrIGlmIHRoaXMgVGV4dCBOb2RlIGlzIGJvdW5kIHRvIE9ic2VydmFibGUuIENhc2VzOgogICAgICAvLwogICAgICAvLwkJdGV4dDogWyBUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkgXQogICAgICAvLwogICAgICAvLwkJdGV4dDogWwogICAgICAvLwkJCSdmb28nLAogICAgICAvLwkJCVRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKSwKICAgICAgLy8JCQkuLi4KICAgICAgLy8JCV0KICAgICAgLy8KCgogICAgICBpZiAoaGFzVGVtcGxhdGVCaW5kaW5nKHRoaXMudGV4dCkpIHsKICAgICAgICB0aGlzLl9iaW5kVG9PYnNlcnZhYmxlKHsKICAgICAgICAgIHNjaGVtYTogdGhpcy50ZXh0LAogICAgICAgICAgdXBkYXRlcjogZ2V0VGV4dFVwZGF0ZXIobm9kZSksCiAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgfSk7CiAgICAgIH0gLy8gU2ltcGx5IHNldCB0ZXh0LiBDYXNlczoKICAgICAgLy8KICAgICAgLy8JCXRleHQ6IFsgJ2FsbCcsICdhcmUnLCAnc3RhdGljJyBdCiAgICAgIC8vCiAgICAgIC8vCQl0ZXh0OiBbICdmb28nIF0KICAgICAgLy8KICAgICAgZWxzZSB7CiAgICAgICAgICBub2RlLnRleHRDb250ZW50ID0gdGhpcy50ZXh0LmpvaW4oJycpOwogICAgICAgIH0KCiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgLyoqCiAgICAgKiBSZW5kZXJzIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGVzIG91dCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2F0dHJpYnV0ZXN9LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3JlbmRlckF0dHJpYnV0ZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJBdHRyaWJ1dGVzKGRhdGEpIHsKICAgICAgdmFyIGF0dHJOYW1lLCBhdHRyVmFsdWUsIGRvbUF0dHJWYWx1ZSwgYXR0ck5zOwoKICAgICAgaWYgKCF0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBub2RlID0gZGF0YS5ub2RlOwogICAgICB2YXIgcmV2ZXJ0RGF0YSA9IGRhdGEucmV2ZXJ0RGF0YTsKCiAgICAgIGZvciAoYXR0ck5hbWUgaW4gdGhpcy5hdHRyaWJ1dGVzKSB7CiAgICAgICAgLy8gQ3VycmVudCBhdHRyaWJ1dGUgdmFsdWUgaW4gRE9NLgogICAgICAgIGRvbUF0dHJWYWx1ZSA9IG5vZGUuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKTsgLy8gVGhlIHZhbHVlIHRvIGJlIHNldC4KCiAgICAgICAgYXR0clZhbHVlID0gdGhpcy5hdHRyaWJ1dGVzW2F0dHJOYW1lXTsgLy8gU2F2ZSByZXZlcnQgZGF0YS4KCiAgICAgICAgaWYgKHJldmVydERhdGEpIHsKICAgICAgICAgIHJldmVydERhdGEuYXR0cmlidXRlc1thdHRyTmFtZV0gPSBkb21BdHRyVmFsdWU7CiAgICAgICAgfSAvLyBEZXRlY3QgY3VzdG9tIG5hbWVzcGFjZToKICAgICAgICAvLwogICAgICAgIC8vCQljbGFzczogewogICAgICAgIC8vCQkJbnM6ICdhYmMnLAogICAgICAgIC8vCQkJdmFsdWU6IFRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKQogICAgICAgIC8vCQl9CiAgICAgICAgLy8KCgogICAgICAgIGF0dHJOcyA9IGlzT2JqZWN0KGF0dHJWYWx1ZVswXSkgJiYgYXR0clZhbHVlWzBdLm5zID8gYXR0clZhbHVlWzBdLm5zIDogbnVsbDsgLy8gQWN0aXZhdGUgYmluZGluZyBpZiBvbmUgaXMgZm91bmQuIENhc2VzOgogICAgICAgIC8vCiAgICAgICAgLy8JCWNsYXNzOiBbCiAgICAgICAgLy8JCQlUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkKICAgICAgICAvLwkJXQogICAgICAgIC8vCiAgICAgICAgLy8JCWNsYXNzOiBbCiAgICAgICAgLy8JCQknYmFyJywKICAgICAgICAvLwkJCVRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKSwKICAgICAgICAvLwkJCSdiYXonCiAgICAgICAgLy8JCV0KICAgICAgICAvLwogICAgICAgIC8vCQljbGFzczogewogICAgICAgIC8vCQkJbnM6ICdhYmMnLAogICAgICAgIC8vCQkJdmFsdWU6IFRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKQogICAgICAgIC8vCQl9CiAgICAgICAgLy8KCiAgICAgICAgaWYgKGhhc1RlbXBsYXRlQmluZGluZyhhdHRyVmFsdWUpKSB7CiAgICAgICAgICAvLyBOb3JtYWxpemUgYXR0cmlidXRlcyB3aXRoIGFkZGl0aW9uYWwgZGF0YSBsaWtlIG5hbWVzcGFjZToKICAgICAgICAgIC8vCiAgICAgICAgICAvLwkJY2xhc3M6IHsKICAgICAgICAgIC8vCQkJbnM6ICdhYmMnLAogICAgICAgICAgLy8JCQl2YWx1ZTogWyAuLi4gXQogICAgICAgICAgLy8JCX0KICAgICAgICAgIC8vCiAgICAgICAgICB2YXIgdmFsdWVUb0JpbmQgPSBhdHRyTnMgPyBhdHRyVmFsdWVbMF0udmFsdWUgOiBhdHRyVmFsdWU7IC8vIEV4dGVuZCB0aGUgb3JpZ2luYWwgdmFsdWUgb2YgYXR0cmlidXRlcyBsaWtlICJzdHlsZSIgYW5kICJjbGFzcyIsCiAgICAgICAgICAvLyBkb24ndCBvdmVycmlkZSB0aGVtLgoKICAgICAgICAgIGlmIChyZXZlcnREYXRhICYmIHNob3VsZEV4dGVuZChhdHRyTmFtZSkpIHsKICAgICAgICAgICAgdmFsdWVUb0JpbmQudW5zaGlmdChkb21BdHRyVmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2JpbmRUb09ic2VydmFibGUoewogICAgICAgICAgICBzY2hlbWE6IHZhbHVlVG9CaW5kLAogICAgICAgICAgICB1cGRhdGVyOiBnZXRBdHRyaWJ1dGVVcGRhdGVyKG5vZGUsIGF0dHJOYW1lLCBhdHRyTnMpLAogICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIFN0eWxlIGF0dHJpYnV0ZSBjb3VsZCBiZSBhbiBPYmplY3Qgc28gaXQgbmVlZHMgdG8gYmUgcGFyc2VkIGluIGEgc3BlY2lmaWMgd2F5LgogICAgICAgIC8vCiAgICAgICAgLy8JCXN0eWxlOiB7CiAgICAgICAgLy8JCQl3aWR0aDogJzEwMHB4JywKICAgICAgICAvLwkJCWhlaWdodDogVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApCiAgICAgICAgLy8JCX0KICAgICAgICAvLwogICAgICAgIGVsc2UgaWYgKGF0dHJOYW1lID09ICdzdHlsZScgJiYgdHlwZW9mIGF0dHJWYWx1ZVswXSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyU3R5bGVBdHRyaWJ1dGUoYXR0clZhbHVlWzBdLCBkYXRhKTsKICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIHNpbXBseSBzZXQgdGhlIHN0YXRpYyBhdHRyaWJ1dGU6CiAgICAgICAgICAvLwogICAgICAgICAgLy8JCWNsYXNzOiBbICdmb28nIF0KICAgICAgICAgIC8vCiAgICAgICAgICAvLwkJY2xhc3M6IFsgJ2FsbCcsICdhcmUnLCAnc3RhdGljJyBdCiAgICAgICAgICAvLwogICAgICAgICAgLy8JCWNsYXNzOiBbCiAgICAgICAgICAvLwkJCXsKICAgICAgICAgIC8vCQkJCW5zOiAnYWJjJywKICAgICAgICAgIC8vCQkJCXZhbHVlOiBbICdmb28nIF0KICAgICAgICAgIC8vCQkJfQogICAgICAgICAgLy8JCV0KICAgICAgICAgIC8vCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvLyBFeHRlbmQgdGhlIG9yaWdpbmFsIHZhbHVlIG9mIGF0dHJpYnV0ZXMgbGlrZSAic3R5bGUiIGFuZCAiY2xhc3MiLAogICAgICAgICAgICAgIC8vIGRvbid0IG92ZXJyaWRlIHRoZW0uCiAgICAgICAgICAgICAgaWYgKHJldmVydERhdGEgJiYgZG9tQXR0clZhbHVlICYmIHNob3VsZEV4dGVuZChhdHRyTmFtZSkpIHsKICAgICAgICAgICAgICAgIGF0dHJWYWx1ZS51bnNoaWZ0KGRvbUF0dHJWYWx1ZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBhdHRyVmFsdWUgPSBhdHRyVmFsdWUgLy8gUmV0cmlldmUgInZhbHVlcyIgZnJvbToKICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgIC8vCQljbGFzczogWwogICAgICAgICAgICAgIC8vCQkJewogICAgICAgICAgICAgIC8vCQkJCW5zOiAnYWJjJywKICAgICAgICAgICAgICAvLwkJCQl2YWx1ZTogWyAuLi4gXQogICAgICAgICAgICAgIC8vCQkJfQogICAgICAgICAgICAgIC8vCQldCiAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwgPyB2YWwudmFsdWUgfHwgdmFsIDogdmFsOwogICAgICAgICAgICAgIH0pIC8vIEZsYXR0ZW4gdGhlIGFycmF5LgogICAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIG5leHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcmV2LmNvbmNhdChuZXh0KTsKICAgICAgICAgICAgICB9LCBbXSkgLy8gQ29udmVydCBpbnRvIHN0cmluZy4KICAgICAgICAgICAgICAucmVkdWNlKGFycmF5VmFsdWVSZWR1Y2VyLCAnJyk7CgogICAgICAgICAgICAgIGlmICghaXNGYWxzeShhdHRyVmFsdWUpKSB7CiAgICAgICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZU5TKGF0dHJOcywgYXR0ck5hbWUsIGF0dHJWYWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVuZGVycyB0aGUgYHN0eWxlYCBhdHRyaWJ1dGUgb2YgYW4gSFRNTCBlbGVtZW50IGJhc2VkIG9uCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2F0dHJpYnV0ZXN9LgogICAgICoKICAgICAqIEEgc3R5bGUgYXR0cmlidXRlIGlzIGFuIHtPYmplY3R9IHdpdGggc3RhdGljIHZhbHVlczoKICAgICAqCiAgICAgKgkJYXR0cmlidXRlczogewogICAgICoJCQlzdHlsZTogewogICAgICoJCQkJY29sb3I6ICdyZWQnCiAgICAgKgkJCX0KICAgICAqCQl9CiAgICAgKgogICAgICogb3IgdmFsdWVzIGJvdW5kIHRvIHtAbGluayBtb2R1bGU6dWkvbW9kZWx+TW9kZWx9IHByb3BlcnRpZXM6CiAgICAgKgogICAgICoJCWF0dHJpYnV0ZXM6IHsKICAgICAqCQkJc3R5bGU6IHsKICAgICAqCQkJCWNvbG9yOiBiaW5kLnRvKCAuLi4gKQogICAgICoJCQl9CiAgICAgKgkJfQogICAgICoKICAgICAqIE5vdGU6IFRoZSBgc3R5bGVgIGF0dHJpYnV0ZSBpcyByZW5kZXJlZCB3aXRob3V0IHNldHRpbmcgdGhlIG5hbWVzcGFjZS4gSXQgZG9lcyBub3Qgc2VlbSB0byBiZQogICAgICogbmVlZGVkLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3R5bGVzIFN0eWxlcyBsb2NhdGVkIGluIGBhdHRyaWJ1dGVzLnN0eWxlYCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW5kZXJTdHlsZUF0dHJpYnV0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlclN0eWxlQXR0cmlidXRlKHN0eWxlcywgZGF0YSkgewogICAgICB2YXIgbm9kZSA9IGRhdGEubm9kZTsKCiAgICAgIGZvciAodmFyIHN0eWxlTmFtZSBpbiBzdHlsZXMpIHsKICAgICAgICB2YXIgc3R5bGVWYWx1ZSA9IHN0eWxlc1tzdHlsZU5hbWVdOyAvLyBDYXNlczoKICAgICAgICAvLwogICAgICAgIC8vCQlzdHlsZTogewogICAgICAgIC8vCQkJY29sb3I6IGJpbmQudG8oICdhdHRyaWJ1dGUnICkKICAgICAgICAvLwkJfQogICAgICAgIC8vCgogICAgICAgIGlmIChoYXNUZW1wbGF0ZUJpbmRpbmcoc3R5bGVWYWx1ZSkpIHsKICAgICAgICAgIHRoaXMuX2JpbmRUb09ic2VydmFibGUoewogICAgICAgICAgICBzY2hlbWE6IFtzdHlsZVZhbHVlXSwKICAgICAgICAgICAgdXBkYXRlcjogZ2V0U3R5bGVVcGRhdGVyKG5vZGUsIHN0eWxlTmFtZSksCiAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gQ2FzZXM6CiAgICAgICAgLy8KICAgICAgICAvLwkJc3R5bGU6IHsKICAgICAgICAvLwkJCWNvbG9yOiAncmVkJwogICAgICAgIC8vCQl9CiAgICAgICAgLy8KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbm9kZS5zdHlsZVtzdHlsZU5hbWVdID0gc3R5bGVWYWx1ZTsKICAgICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZWN1cnNpdmVseSByZW5kZXJzIEhUTUwgZWxlbWVudCdzIGNoaWxkcmVuIGZyb20ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNjaGlsZHJlbn0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyRWxlbWVudENoaWxkcmVuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyRWxlbWVudENoaWxkcmVuKGRhdGEpIHsKICAgICAgdmFyIG5vZGUgPSBkYXRhLm5vZGU7CiAgICAgIHZhciBjb250YWluZXIgPSBkYXRhLmludG9GcmFnbWVudCA/IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSA6IG5vZGU7CiAgICAgIHZhciBpc0FwcGx5aW5nID0gZGF0YS5pc0FwcGx5aW5nOwogICAgICB2YXIgY2hpbGRJbmRleCA9IDA7CiAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjIgPSBmYWxzZTsKICAgICAgdmFyIF9pdGVyYXRvckVycm9yMiA9IHVuZGVmaW5lZDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yMiA9IHRoaXMuY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDI7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWUpIHsKICAgICAgICAgIHZhciBjaGlsZCA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICBpZiAoaXNWaWV3Q29sbGVjdGlvbihjaGlsZCkpIHsKICAgICAgICAgICAgaWYgKCFpc0FwcGx5aW5nKSB7CiAgICAgICAgICAgICAgY2hpbGQuc2V0UGFyZW50KG5vZGUpOyAvLyBOb3RlOiBWaWV3Q29sbGVjdGlvbiByZW5kZXJzIGl0cyBjaGlsZHJlbi4KCiAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IzID0gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yMyA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjMgPSBjaGlsZFtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IChfc3RlcDMgPSBfaXRlcmF0b3IzLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICB2YXIgdmlldyA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHZpZXcuZWxlbWVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IzID0gZXJyOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zICYmIF9pdGVyYXRvcjMucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IzLnJldHVybigpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGlzVmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgaWYgKCFpc0FwcGx5aW5nKSB7CiAgICAgICAgICAgICAgaWYgKCFjaGlsZC5pc1JlbmRlcmVkKSB7CiAgICAgICAgICAgICAgICBjaGlsZC5yZW5kZXIoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZC5lbGVtZW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChpc05vZGUoY2hpbGQpKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNBcHBseWluZykgewogICAgICAgICAgICAgIHZhciByZXZlcnREYXRhID0gZGF0YS5yZXZlcnREYXRhOwogICAgICAgICAgICAgIHZhciBjaGlsZFJldmVydERhdGEgPSBnZXRFbXB0eVJldmVydERhdGEoKTsKICAgICAgICAgICAgICByZXZlcnREYXRhLmNoaWxkcmVuLnB1c2goY2hpbGRSZXZlcnREYXRhKTsKCiAgICAgICAgICAgICAgY2hpbGQuX3JlbmRlck5vZGUoewogICAgICAgICAgICAgICAgbm9kZTogY29udGFpbmVyLmNoaWxkTm9kZXNbY2hpbGRJbmRleCsrXSwKICAgICAgICAgICAgICAgIGlzQXBwbHlpbmc6IHRydWUsCiAgICAgICAgICAgICAgICByZXZlcnREYXRhOiBjaGlsZFJldmVydERhdGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2hpbGQucmVuZGVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yMiA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjIucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGRhdGEuaW50b0ZyYWdtZW50KSB7CiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjb250YWluZXIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFjdGl2YXRlcyBgb25gIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0KICAgICAqIG9uIGFuIEhUTUwgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRVcExpc3RlbmVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFVwTGlzdGVuZXJzKGRhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5ldmVudExpc3RlbmVycykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3Aoa2V5KSB7CiAgICAgICAgdmFyIHJldmVydEJpbmRpbmdzID0gX3RoaXMuZXZlbnRMaXN0ZW5lcnNba2V5XS5tYXAoZnVuY3Rpb24gKHNjaGVtYUl0ZW0pIHsKICAgICAgICAgIHZhciBfa2V5JHNwbGl0ID0ga2V5LnNwbGl0KCdAJyksCiAgICAgICAgICAgICAgX2tleSRzcGxpdDIgPSBfc2xpY2VkVG9BcnJheShfa2V5JHNwbGl0LCAyKSwKICAgICAgICAgICAgICBkb21FdnROYW1lID0gX2tleSRzcGxpdDJbMF0sCiAgICAgICAgICAgICAgZG9tU2VsZWN0b3IgPSBfa2V5JHNwbGl0MlsxXTsKCiAgICAgICAgICByZXR1cm4gc2NoZW1hSXRlbS5hY3RpdmF0ZURvbUV2ZW50TGlzdGVuZXIoZG9tRXZ0TmFtZSwgZG9tU2VsZWN0b3IsIGRhdGEpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoZGF0YS5yZXZlcnREYXRhKSB7CiAgICAgICAgICBkYXRhLnJldmVydERhdGEuYmluZGluZ3MucHVzaChyZXZlcnRCaW5kaW5ncyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgICBfbG9vcChrZXkpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvciBhIGdpdmVuIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gY29udGFpbmluZyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30KICAgICAqIGFjdGl2YXRlcyB0aGUgYmluZGluZyBhbmQgc2V0cyBpdHMgaW5pdGlhbCB2YWx1ZS4KICAgICAqCiAgICAgKiBOb3RlOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IGNhbiBiZSBmb3IgSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMgb3IKICAgICAqIHRleHQgbm9kZSBgdGV4dENvbnRlbnRgLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEJpbmRpbmcgb3B0aW9ucy4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IG9wdGlvbnMuc2NoZW1hCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcHRpb25zLnVwZGF0ZXIgQSBmdW5jdGlvbiB3aGljaCB1cGRhdGVzIHRoZSBET00gKGxpa2UgYXR0cmlidXRlIG9yIHRleHQpLgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gb3B0aW9ucy5kYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9iaW5kVG9PYnNlcnZhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYmluZFRvT2JzZXJ2YWJsZShfcmVmMikgewogICAgICB2YXIgc2NoZW1hID0gX3JlZjIuc2NoZW1hLAogICAgICAgICAgdXBkYXRlciA9IF9yZWYyLnVwZGF0ZXIsCiAgICAgICAgICBkYXRhID0gX3JlZjIuZGF0YTsKICAgICAgdmFyIHJldmVydERhdGEgPSBkYXRhLnJldmVydERhdGE7IC8vIFNldCBpbml0aWFsIHZhbHVlcy4KCiAgICAgIHN5bmNWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgdXBkYXRlciwgZGF0YSk7CiAgICAgIHZhciByZXZlcnRCaW5kaW5ncyA9IHNjaGVtYSAvLyBGaWx0ZXIgImZhbHN5IiAoZmFsc2UsIHVuZGVmaW5lZCwgbnVsbCwgJycpIHZhbHVlIHNjaGVtYSBjb21wb25lbnRzIG91dC4KICAgICAgLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiAhaXNGYWxzeShpdGVtKTsKICAgICAgfSkgLy8gRmlsdGVyIGluYWN0aXZlIGJpbmRpbmdzIGZyb20gc2NoZW1hLCBsaWtlIHN0YXRpYyBzdHJpbmdzICgnZm9vJyksIG51bWJlcnMgKDQyKSwgZXRjLgogICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0ub2JzZXJ2YWJsZTsKICAgICAgfSkgLy8gT25jZSBvbmx5IHRoZSBhY3R1YWwgYmluZGluZyBhcmUgbGVmdCwgbGV0IHRoZSBlbWl0dGVyIGxpc3RlbiB0byBvYnNlcnZhYmxlIGNoYW5nZTphdHRyaWJ1dGUgZXZlbnQuCiAgICAgIC8vIFRPRE86IFJlZHVjZSB0aGUgbnVtYmVyIG9mIGxpc3RlbmVycyBhdHRhY2hlZCBhcyBtYW55IGJpbmRpbmdzIG1heSBsaXN0ZW4KICAgICAgLy8gdG8gdGhlIHNhbWUgb2JzZXJ2YWJsZSBhdHRyaWJ1dGUuCiAgICAgIC5tYXAoZnVuY3Rpb24gKHRlbXBsYXRlQmluZGluZykgewogICAgICAgIHJldHVybiB0ZW1wbGF0ZUJpbmRpbmcuYWN0aXZhdGVBdHRyaWJ1dGVMaXN0ZW5lcihzY2hlbWEsIHVwZGF0ZXIsIGRhdGEpOwogICAgICB9KTsKCiAgICAgIGlmIChyZXZlcnREYXRhKSB7CiAgICAgICAgcmV2ZXJ0RGF0YS5iaW5kaW5ncy5wdXNoKHJldmVydEJpbmRpbmdzKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXZlcnRzIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YSNyZXZlcnREYXRhIHRlbXBsYXRlIGRhdGF9IGZyb20gYSBub2RlIHRvCiAgICAgKiByZXR1cm4gaXQgdG8gdGhlIG9yaWdpbmFsIHN0YXRlLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8VGV4dH0gbm9kZSBBIG5vZGUgdG8gYmUgcmV2ZXJ0ZWQuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmV2ZXJ0RGF0YSBBbiBvYmplY3QgdGhhdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBjaGFuZ2VzIGhhdmUgYmVlbiBtYWRlIGJ5CiAgICAgKiB7QGxpbmsgI2FwcGx5fSB0byB0aGUgbm9kZS4gU2VlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YSNyZXZlcnREYXRhfSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JldmVydFRlbXBsYXRlRnJvbU5vZGUobm9kZSwgcmV2ZXJ0RGF0YSkgewogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjQgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjQgPSByZXZlcnREYXRhLmJpbmRpbmdzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA0OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gKF9zdGVwNCA9IF9pdGVyYXRvcjQubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlKSB7CiAgICAgICAgICB2YXIgYmluZGluZyA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgIC8vIEVhY2ggYmluZGluZyBtYXkgY29uc2lzdCBvZiBzZXZlcmFsIG9ic2VydmFibGUrb2JzZXJ2YWJsZSNhdHRyaWJ1dGUuCiAgICAgICAgICAvLyBsaWtlIHRoZSBmb2xsb3dpbmcgaGFzIDI6CiAgICAgICAgICAvLwogICAgICAgICAgLy8JCWNsYXNzOiBbCiAgICAgICAgICAvLwkJCSd4JywKICAgICAgICAgIC8vCQkJYmluZC50byggJ2ZvbycgKSwKICAgICAgICAgIC8vCQkJJ3knLAogICAgICAgICAgLy8JCQliaW5kLnRvKCAnYmFyJyApCiAgICAgICAgICAvLwkJXQogICAgICAgICAgLy8KICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I1ID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I1ID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjUgPSBiaW5kaW5nW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA1OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ID0gKF9zdGVwNSA9IF9pdGVyYXRvcjUubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIHJldmVydEJpbmRpbmcgPSBfc3RlcDUudmFsdWU7CiAgICAgICAgICAgICAgcmV2ZXJ0QmluZGluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I1ID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I1ID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ICYmIF9pdGVyYXRvcjUucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjUucmV0dXJuKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjUpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yNCA9IHRydWU7CiAgICAgICAgX2l0ZXJhdG9yRXJyb3I0ID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ICYmIF9pdGVyYXRvcjQucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yNC5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNCkgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocmV2ZXJ0RGF0YS50ZXh0KSB7CiAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9IHJldmVydERhdGEudGV4dDsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGF0dHJOYW1lIGluIHJldmVydERhdGEuYXR0cmlidXRlcykgewogICAgICAgIHZhciBhdHRyVmFsdWUgPSByZXZlcnREYXRhLmF0dHJpYnV0ZXNbYXR0ck5hbWVdOyAvLyBXaGVuIHRoZSBhdHRyaWJ1dGUgaGFzICoqbm90KiogYmVlbiBzZXQgYmVmb3JlICNhcHBseSgpLgoKICAgICAgICBpZiAoYXR0clZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShhdHRyTmFtZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBhdHRyVmFsdWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXZlcnREYXRhLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7CiAgICAgICAgdGhpcy5fcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZShub2RlLmNoaWxkTm9kZXNbaV0sIHJldmVydERhdGEuY2hpbGRyZW5baV0pOwogICAgICB9CiAgICB9CiAgfV0sIFt7CiAgICBrZXk6ICJiaW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kKG9ic2VydmFibGUsIGVtaXR0ZXIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0bzogZnVuY3Rpb24gdG8oZXZlbnROYW1lT3JGdW5jdGlvbk9yQXR0cmlidXRlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZVRvQmluZGluZyh7CiAgICAgICAgICAgIGV2ZW50TmFtZU9yRnVuY3Rpb246IGV2ZW50TmFtZU9yRnVuY3Rpb25PckF0dHJpYnV0ZSwKICAgICAgICAgICAgYXR0cmlidXRlOiBldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUsCiAgICAgICAgICAgIG9ic2VydmFibGU6IG9ic2VydmFibGUsCiAgICAgICAgICAgIGVtaXR0ZXI6IGVtaXR0ZXIsCiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjawogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBpZjogZnVuY3Rpb24gX2lmKGF0dHJpYnV0ZSwgdmFsdWVJZlRydWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFRlbXBsYXRlSWZCaW5kaW5nKHsKICAgICAgICAgICAgb2JzZXJ2YWJsZTogb2JzZXJ2YWJsZSwKICAgICAgICAgICAgZW1pdHRlcjogZW1pdHRlciwKICAgICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGUsCiAgICAgICAgICAgIHZhbHVlSWZUcnVlOiB2YWx1ZUlmVHJ1ZSwKICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIEV4dGVuZHMgYW4gZXhpc3Rpbmcge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gaW5zdGFuY2Ugd2l0aCBzb21lIGFkZGl0aW9uYWwgY29udGVudAogICAgICogZnJvbSBhbm90aGVyIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KICAgICAqCiAgICAgKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICAgICAqCiAgICAgKgkJY29uc3QgdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoIHsKICAgICAqCQkJdGFnOiAncCcsCiAgICAgKgkJCWF0dHJpYnV0ZXM6IHsKICAgICAqCQkJCWNsYXNzOiAnYScsCiAgICAgKgkJCQlkYXRhLXg6IGJpbmQudG8oICdmb28nICkKICAgICAqCQkJfSwKICAgICAqCQkJY2hpbGRyZW46IFsKICAgICAqCQkJCXsKICAgICAqCQkJCQl0YWc6ICdzcGFuJywKICAgICAqCQkJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQkJCWNsYXNzOiAnYicKICAgICAqCQkJCQl9LAogICAgICoJCQkJCWNoaWxkcmVuOiBbCiAgICAgKgkJCQkJCSdTcGFuJwogICAgICoJCQkJCV0KICAgICAqCQkJCX0KICAgICAqCQkJXQogICAgICoJCSB9ICk7CiAgICAgKgogICAgICoJCS8vIEluc3RhbmNlLWxldmVsIGV4dGVuc2lvbi4KICAgICAqCQlUZW1wbGF0ZS5leHRlbmQoIHRlbXBsYXRlLCB7CiAgICAgKgkJCWF0dHJpYnV0ZXM6IHsKICAgICAqCQkJCWNsYXNzOiAnYicsCiAgICAgKgkJCQlkYXRhLXg6IGJpbmQudG8oICdiYXInICkKICAgICAqCQkJfSwKICAgICAqCQkJY2hpbGRyZW46IFsKICAgICAqCQkJCXsKICAgICAqCQkJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQkJCWNsYXNzOiAnYycKICAgICAqCQkJCQl9CiAgICAgKgkJCQl9CiAgICAgKgkJCV0KICAgICAqCQl9ICk7CiAgICAgKgogICAgICoJCS8vIENoaWxkIGV4dGVuc2lvbi4KICAgICAqCQlUZW1wbGF0ZS5leHRlbmQoIHRlbXBsYXRlLmNoaWxkcmVuWyAwIF0sIHsKICAgICAqCQkJYXR0cmlidXRlczogewogICAgICoJCQkJY2xhc3M6ICdkJwogICAgICoJCQl9CiAgICAgKgkJfSApOwogICAgICoKICAgICAqIHRoZSBgb3V0ZXJIVE1MYCBvZiBgdGVtcGxhdGUucmVuZGVyKClgIGlzOgogICAgICoKICAgICAqCQk8cCBjbGFzcz0iYSBiIiBkYXRhLXg9Insgb2JzZXJ2YWJsZS5mb28gfSB7IG9ic2VydmFibGUuYmFyIH0iPgogICAgICoJCQk8c3BhbiBjbGFzcz0iYiBjIGQiPlNwYW48L3NwYW4+CiAgICAgKgkJPC9wPgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfSB0ZW1wbGF0ZSBBbiBleGlzdGluZyB0ZW1wbGF0ZSBpbnN0YW5jZSB0byBiZSBleHRlbmRlZC4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmIEFkZGl0aW9uYWwgZGVmaW5pdGlvbiB0byBiZSBhcHBsaWVkIHRvIGEgdGVtcGxhdGUuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZXh0ZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHRlbmQodGVtcGxhdGUsIGRlZikgewogICAgICBpZiAodGVtcGxhdGUuX2lzUmVuZGVyZWQpIHsKICAgICAgICAvKioKICAgICAgICAgKiBFeHRlbmRpbmcgYSB0ZW1wbGF0ZSBhZnRlciByZW5kZXJpbmcgbWF5IG5vdCB3b3JrIGFzIGV4cGVjdGVkLiBUbyBtYWtlIHN1cmUKICAgICAgICAgKiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZS5leHRlbmQgZXh0ZW5kaW5nfSB3b3JrcyBmb3IgYW4gZWxlbWVudCwKICAgICAgICAgKiBtYWtlIHN1cmUgaXQgaGFwcGVucyBiZWZvcmUge0BsaW5rICNyZW5kZXJ9IGlzIGNhbGxlZC4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciB0ZW1wbGF0ZS1leHRlbmQtcmVuZGVyCiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3RlbXBsYXRlLWV4dGVuZC1yZW5kZXI6IEF0dGVtcHRpbmcgdG8gZXh0ZW5kIGEgdGVtcGxhdGUgd2hpY2ggaGFzIGFscmVhZHkgYmVlbiByZW5kZXJlZC4nLCBbdGhpcywgdGVtcGxhdGVdKTsKICAgICAgfQoKICAgICAgZXh0ZW5kVGVtcGxhdGUodGVtcGxhdGUsIG5vcm1hbGl6ZShjbG9uZShkZWYpKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVGVtcGxhdGU7Cn0oKTsKCmV4cG9ydCB7IFRlbXBsYXRlIGFzIGRlZmF1bHQgfTsKbWl4KFRlbXBsYXRlLCBFbWl0dGVyTWl4aW4pOwovKioKICogRGVzY3JpYmVzIGEgYmluZGluZyBjcmVhdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlLmJpbmR9IGludGVyZmFjZS4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCB2YXIgVGVtcGxhdGVCaW5kaW5nID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IGNsYXNzLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgVGhlIGRlZmluaXRpb24gb2YgdGhlIGJpbmRpbmcuCiAgICovCiAgZnVuY3Rpb24gVGVtcGxhdGVCaW5kaW5nKGRlZikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRlbXBsYXRlQmluZGluZyk7CgogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkZWYpOwogICAgLyoqCiAgICAgKiBBbiBvYnNlcnZhYmxlIGluc3RhbmNlIG9mIHRoZSBiaW5kaW5nLiBJdCBlaXRoZXI6CiAgICAgKgogICAgICogKiBwcm92aWRlcyB0aGUgYXR0cmlidXRlIHdpdGggdGhlIHZhbHVlLAogICAgICogKiBvciBwYXNzZXMgdGhlIGV2ZW50IHdoZW4gYSBjb3JyZXNwb25kaW5nIERPTSBldmVudCBpcyBmaXJlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJ9IHVzZWQgYnkgdGhlIGJpbmRpbmcgdG86CiAgICAgKgogICAgICogKiBsaXN0ZW4gdG8gdGhlIGF0dHJpYnV0ZSBjaGFuZ2UgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI29ic2VydmFibGV9LAogICAgICogKiBvciBsaXN0ZW4gdG8gdGhlIGV2ZW50IGluIHRoZSBET00uCiAgICAgKgogICAgICogQG1lbWJlciB7bW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyTWl4aW59IG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjZW1pdHRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZSBvYnNlcnZlZCBhdHRyaWJ1dGV9LgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGUKICAgICAqLwoKICAgIC8qKgogICAgICogQSBjdXN0b20gZnVuY3Rpb24gdG8gcHJvY2VzcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0uCiAgICAgKgogICAgICogQG1lbWJlciB7RnVuY3Rpb259IFttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2NhbGxiYWNrXQogICAgICovCiAgfQogIC8qKgogICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBiaW5kaW5nLiBJdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0gaW4KICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfS4gVGhlIHZhbHVlIG1heSBiZSBwcm9jZXNzZWQgYnkgdGhlCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjY2FsbGJhY2t9LCBpZiBzdWNoIGhhcyBiZWVuIHBhc3NlZCB0byB0aGUgYmluZGluZy4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gW25vZGVdIEEgbmF0aXZlIERPTSBub2RlLCBwYXNzZWQgdG8gdGhlIGN1c3RvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNjYWxsYmFja30uCiAgICogQHJldHVybnMgeyp9IFRoZSB2YWx1ZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZX0uCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGVCaW5kaW5nLCBbewogICAga2V5OiAiZ2V0VmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKG5vZGUpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5vYnNlcnZhYmxlW3RoaXMuYXR0cmlidXRlXTsKICAgICAgcmV0dXJuIHRoaXMuY2FsbGJhY2sgPyB0aGlzLmNhbGxiYWNrKHZhbHVlLCBub2RlKSA6IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBBY3RpdmF0ZXMgdGhlIGxpc3RlbmVyIHdoaWNoIHdhaXRzIGZvciBjaGFuZ2VzIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfSwgdGhlbiB1cGRhdGVzIHRoZSBET00gd2l0aCB0aGUgYWdncmVnYXRlZAogICAgICogdmFsdWUgb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfS4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEgQSBmdWxsIHNjaGVtYSB0byBnZW5lcmF0ZSBhbiBhdHRyaWJ1dGUgb3IgdGV4dCBpbiB0aGUgRE9NLgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gdXBkYXRlciBBIERPTSB1cGRhdGVyIGZ1bmN0aW9uIHVzZWQgdG8gdXBkYXRlIHRoZSBuYXRpdmUgRE9NIGF0dHJpYnV0ZSBvciB0ZXh0LgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byBzZXZlciB0aGUgbGlzdGVuZXIgYmluZGluZy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhY3RpdmF0ZUF0dHJpYnV0ZUxpc3RlbmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhY3RpdmF0ZUF0dHJpYnV0ZUxpc3RlbmVyKHNjaGVtYSwgdXBkYXRlciwgZGF0YSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKCkgewogICAgICAgIHJldHVybiBzeW5jVmFsdWVTY2hlbWFWYWx1ZShzY2hlbWEsIHVwZGF0ZXIsIGRhdGEpOwogICAgICB9OwoKICAgICAgdGhpcy5lbWl0dGVyLmxpc3RlblRvKHRoaXMub2JzZXJ2YWJsZSwgJ2NoYW5nZTonICsgdGhpcy5hdHRyaWJ1dGUsIGNhbGxiYWNrKTsgLy8gQWxsb3dzIHJldmVydCBvZiB0aGUgbGlzdGVuZXIuCgogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5lbWl0dGVyLnN0b3BMaXN0ZW5pbmcoX3RoaXMyLm9ic2VydmFibGUsICdjaGFuZ2U6JyArIF90aGlzMi5hdHRyaWJ1dGUsIGNhbGxiYWNrKTsKICAgICAgfTsKICAgIH0KICB9XSk7CgogIHJldHVybiBUZW1wbGF0ZUJpbmRpbmc7Cn0oKTsKLyoqCiAqIERlc2NyaWJlcyBlaXRoZXI6CiAqCiAqICogYSBiaW5kaW5nIHRvIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9LAogKiAqIG9yIGEgbmF0aXZlIERPTSBldmVudCBiaW5kaW5nLgogKgogKiBJdCBpcyBjcmVhdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0b30gbWV0aG9kLgogKgogKiBAcHJvdGVjdGVkCiAqLwoKZXhwb3J0IHZhciBUZW1wbGF0ZVRvQmluZGluZyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9UZW1wbGF0ZUJpbmRpbmcpIHsKICBfaW5oZXJpdHMoVGVtcGxhdGVUb0JpbmRpbmcsIF9UZW1wbGF0ZUJpbmRpbmcpOwoKICBmdW5jdGlvbiBUZW1wbGF0ZVRvQmluZGluZygpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZW1wbGF0ZVRvQmluZGluZyk7CgogICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUZW1wbGF0ZVRvQmluZGluZykuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGVUb0JpbmRpbmcsIFt7CiAgICBrZXk6ICJhY3RpdmF0ZURvbUV2ZW50TGlzdGVuZXIiLAoKICAgIC8qKgogICAgICogQWN0aXZhdGVzIHRoZSBsaXN0ZW5lciBmb3IgdGhlIG5hdGl2ZSBET00gZXZlbnQsIHdoaWNoIHdoZW4gZmlyZWQsIGlzIHByb3BhZ2F0ZWQgYnkKICAgICAqIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNlbWl0dGVyfS4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZG9tRXZ0TmFtZSBUaGUgbmFtZSBvZiB0aGUgbmF0aXZlIERPTSBldmVudC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkb21TZWxlY3RvciBUaGUgc2VsZWN0b3IgaW4gdGhlIERPTSB0byBmaWx0ZXIgZGVsZWdhdGVkIGV2ZW50cy4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24gdG8gc2V2ZXIgdGhlIGxpc3RlbmVyIGJpbmRpbmcuCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBhY3RpdmF0ZURvbUV2ZW50TGlzdGVuZXIoZG9tRXZ0TmFtZSwgZG9tU2VsZWN0b3IsIGRhdGEpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayhldnQsIGRvbUV2dCkgewogICAgICAgIGlmICghZG9tU2VsZWN0b3IgfHwgZG9tRXZ0LnRhcmdldC5tYXRjaGVzKGRvbVNlbGVjdG9yKSkgewogICAgICAgICAgaWYgKHR5cGVvZiBfdGhpczMuZXZlbnROYW1lT3JGdW5jdGlvbiA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIF90aGlzMy5ldmVudE5hbWVPckZ1bmN0aW9uKGRvbUV2dCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczMub2JzZXJ2YWJsZS5maXJlKF90aGlzMy5ldmVudE5hbWVPckZ1bmN0aW9uLCBkb21FdnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRoaXMuZW1pdHRlci5saXN0ZW5UbyhkYXRhLm5vZGUsIGRvbUV2dE5hbWUsIGNhbGxiYWNrKTsgLy8gQWxsb3dzIHJldmVydCBvZiB0aGUgbGlzdGVuZXIuCgogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5lbWl0dGVyLnN0b3BMaXN0ZW5pbmcoZGF0YS5ub2RlLCBkb21FdnROYW1lLCBjYWxsYmFjayk7CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVGVtcGxhdGVUb0JpbmRpbmc7Cn0oVGVtcGxhdGVCaW5kaW5nKTsKLyoqCiAqIERlc2NyaWJlcyBhIGJpbmRpbmcgdG8ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGlufSBjcmVhdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiNpZn0KICogbWV0aG9kLgogKgogKiBAcHJvdGVjdGVkCiAqLwoKZXhwb3J0IHZhciBUZW1wbGF0ZUlmQmluZGluZyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9UZW1wbGF0ZUJpbmRpbmcyKSB7CiAgX2luaGVyaXRzKFRlbXBsYXRlSWZCaW5kaW5nLCBfVGVtcGxhdGVCaW5kaW5nMik7CgogIGZ1bmN0aW9uIFRlbXBsYXRlSWZCaW5kaW5nKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRlbXBsYXRlSWZCaW5kaW5nKTsKCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFRlbXBsYXRlSWZCaW5kaW5nKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICB9CgogIF9jcmVhdGVDbGFzcyhUZW1wbGF0ZUlmQmluZGluZywgW3sKICAgIGtleTogImdldFZhbHVlIiwKCiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZShub2RlKSB7CiAgICAgIHZhciB2YWx1ZSA9IF9nZXQoX2dldFByb3RvdHlwZU9mKFRlbXBsYXRlSWZCaW5kaW5nLnByb3RvdHlwZSksICJnZXRWYWx1ZSIsIHRoaXMpLmNhbGwodGhpcywgbm9kZSk7CgogICAgICByZXR1cm4gaXNGYWxzeSh2YWx1ZSkgPyBmYWxzZSA6IHRoaXMudmFsdWVJZlRydWUgfHwgdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogVGhlIHZhbHVlIG9mIHRoZSBET00gYXR0cmlidXRlIG9yIHRleHQgdG8gYmUgc2V0IGlmIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfSBpcyBgdHJ1ZWAuCiAgICAgKgogICAgICogQG1lbWJlciB7U3RyaW5nfSBbbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlSWZCaW5kaW5nI3ZhbHVlSWZUcnVlXQogICAgICovCgogIH1dKTsKCiAgcmV0dXJuIFRlbXBsYXRlSWZCaW5kaW5nOwp9KFRlbXBsYXRlQmluZGluZyk7IC8vIENoZWNrcyB3aGV0aGVyIGdpdmVuIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gY29udGFpbnMgYQovLyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30uCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHNjaGVtYQovLyBAcmV0dXJucyB7Qm9vbGVhbn0KCmZ1bmN0aW9uIGhhc1RlbXBsYXRlQmluZGluZyhzY2hlbWEpIHsKICBpZiAoIXNjaGVtYSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0gLy8gTm9ybWFsaXplIGF0dHJpYnV0ZXMgd2l0aCBhZGRpdGlvbmFsIGRhdGEgbGlrZSBuYW1lc3BhY2U6CiAgLy8KICAvLwkJY2xhc3M6IHsKICAvLwkJCW5zOiAnYWJjJywKICAvLwkJCXZhbHVlOiBbIC4uLiBdCiAgLy8JCX0KICAvLwoKCiAgaWYgKHNjaGVtYS52YWx1ZSkgewogICAgc2NoZW1hID0gc2NoZW1hLnZhbHVlOwogIH0KCiAgaWYgKEFycmF5LmlzQXJyYXkoc2NoZW1hKSkgewogICAgcmV0dXJuIHNjaGVtYS5zb21lKGhhc1RlbXBsYXRlQmluZGluZyk7CiAgfSBlbHNlIGlmIChzY2hlbWEgaW5zdGFuY2VvZiBUZW1wbGF0ZUJpbmRpbmcpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgcmV0dXJuIGZhbHNlOwp9IC8vIEFzc2VtYmxlcyB0aGUgdmFsdWUgdXNpbmcge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBhbmQgc3RvcmVzIGl0IGluIGEgZm9ybSBvZgovLyBhbiBBcnJheS4gRWFjaCBlbnRyeSBvZiB0aGUgQXJyYXkgY29ycmVzcG9uZHMgdG8gb25lIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0KLy8gaXRlbXMuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHNjaGVtYQovLyBAcGFyYW0ge05vZGV9IG5vZGUgRE9NIE5vZGUgdXBkYXRlZCB3aGVuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gY2hhbmdlcy4KLy8gQHJldHVybnMge0FycmF5fQoKCmZ1bmN0aW9uIGdldFZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCBub2RlKSB7CiAgcmV0dXJuIHNjaGVtYS5tYXAoZnVuY3Rpb24gKHNjaGVtYUl0ZW0pIHsKICAgIC8vIFByb2Nlc3Mge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IGJpbmRpbmdzLgogICAgaWYgKHNjaGVtYUl0ZW0gaW5zdGFuY2VvZiBUZW1wbGF0ZUJpbmRpbmcpIHsKICAgICAgcmV0dXJuIHNjaGVtYUl0ZW0uZ2V0VmFsdWUobm9kZSk7CiAgICB9IC8vIEFsbCBzdGF0aWMgdmFsdWVzIGxpa2Ugc3RyaW5ncywgbnVtYmVycywgYW5kICJmYWxzeSIgdmFsdWVzIChmYWxzZSwgbnVsbCwgdW5kZWZpbmVkLCAnJywgZXRjLikganVzdCBwYXNzLgoKCiAgICByZXR1cm4gc2NoZW1hSXRlbTsKICB9KTsKfSAvLyBBIGZ1bmN0aW9uIGV4ZWN1dGVkIGVhY2ggdGltZSB0aGUgYm91bmQgT2JzZXJ2YWJsZSBhdHRyaWJ1dGUgY2hhbmdlcywgd2hpY2ggdXBkYXRlcyB0aGUgRE9NIHdpdGggYSB2YWx1ZQovLyBjb25zdHJ1Y3RlZCBmcm9tIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0uCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHNjaGVtYQovLyBAcGFyYW0ge0Z1bmN0aW9ufSB1cGRhdGVyIEEgZnVuY3Rpb24gd2hpY2ggdXBkYXRlcyB0aGUgRE9NIChsaWtlIGF0dHJpYnV0ZSBvciB0ZXh0KS4KLy8gQHBhcmFtIHtOb2RlfSBub2RlIERPTSBOb2RlIHVwZGF0ZWQgd2hlbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW59IGNoYW5nZXMuCgoKZnVuY3Rpb24gc3luY1ZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCB1cGRhdGVyLCBfcmVmMykgewogIHZhciBub2RlID0gX3JlZjMubm9kZTsKICB2YXIgdmFsdWUgPSBnZXRWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgbm9kZSk7IC8vIENoZWNrIGlmIHNjaGVtYSBpcyBhIHNpbmdsZSBUZW1wbGF0ZS5iaW5kLmlmLCBsaWtlOgogIC8vCiAgLy8JCWNsYXNzOiBUZW1wbGF0ZS5iaW5kLmlmKCAnZm9vJyApCiAgLy8KCiAgaWYgKHNjaGVtYS5sZW5ndGggPT0gMSAmJiBzY2hlbWFbMF0gaW5zdGFuY2VvZiBUZW1wbGF0ZUlmQmluZGluZykgewogICAgdmFsdWUgPSB2YWx1ZVswXTsKICB9IGVsc2UgewogICAgdmFsdWUgPSB2YWx1ZS5yZWR1Y2UoYXJyYXlWYWx1ZVJlZHVjZXIsICcnKTsKICB9CgogIGlmIChpc0ZhbHN5KHZhbHVlKSkgewogICAgdXBkYXRlci5yZW1vdmUoKTsKICB9IGVsc2UgewogICAgdXBkYXRlci5zZXQodmFsdWUpOwogIH0KfSAvLyBSZXR1cm5zIGFuIG9iamVjdCBjb25zaXN0aW5nIG9mIGBzZXRgIGFuZCBgcmVtb3ZlYCBmdW5jdGlvbnMsIHdoaWNoCi8vIGNhbiBiZSB1c2VkIGluIHRoZSBjb250ZXh0IG9mIERPTSBOb2RlIHRvIHNldCBvciByZXNldCBgdGV4dENvbnRlbnRgLgovLyBAc2VlIG1vZHVsZTp1aS92aWV3flZpZXcjX2JpbmRUb09ic2VydmFibGUKLy8KLy8gQHBhcmFtIHtOb2RlfSBub2RlIERPTSBOb2RlIHRvIGJlIG1vZGlmaWVkLgovLyBAcmV0dXJucyB7T2JqZWN0fQoKCmZ1bmN0aW9uIGdldFRleHRVcGRhdGVyKG5vZGUpIHsKICByZXR1cm4gewogICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgbm9kZS50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICBub2RlLnRleHRDb250ZW50ID0gJyc7CiAgICB9CiAgfTsKfSAvLyBSZXR1cm5zIGFuIG9iamVjdCBjb25zaXN0aW5nIG9mIGBzZXRgIGFuZCBgcmVtb3ZlYCBmdW5jdGlvbnMsIHdoaWNoCi8vIGNhbiBiZSB1c2VkIGluIHRoZSBjb250ZXh0IG9mIERPTSBOb2RlIHRvIHNldCBvciByZXNldCBhbiBhdHRyaWJ1dGUuCi8vIEBzZWUgbW9kdWxlOnVpL3ZpZXd+VmlldyNfYmluZFRvT2JzZXJ2YWJsZQovLwovLyBAcGFyYW0ge05vZGV9IG5vZGUgRE9NIE5vZGUgdG8gYmUgbW9kaWZpZWQuCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyTmFtZSBOYW1lIG9mIHRoZSBhdHRyaWJ1dGUgdG8gYmUgbW9kaWZpZWQuCi8vIEBwYXJhbSB7U3RyaW5nfSBbbnM9bnVsbF0gTmFtZXNwYWNlIHRvIHVzZS4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBnZXRBdHRyaWJ1dGVVcGRhdGVyKGVsLCBhdHRyTmFtZSwgbnMpIHsKICByZXR1cm4gewogICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgZWwuc2V0QXR0cmlidXRlTlMobnMsIGF0dHJOYW1lLCB2YWx1ZSk7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZU5TKG5zLCBhdHRyTmFtZSk7CiAgICB9CiAgfTsKfSAvLyBSZXR1cm5zIGFuIG9iamVjdCBjb25zaXN0aW5nIG9mIGBzZXRgIGFuZCBgcmVtb3ZlYCBmdW5jdGlvbnMsIHdoaWNoCi8vIGNhbiBiZSB1c2VkIGluIHRoZSBjb250ZXh0IG9mIENTU1N0eWxlRGVjbGFyYXRpb24gdG8gc2V0IG9yIHJlbW92ZSBhIHN0eWxlLgovLyBAc2VlIG1vZHVsZTp1aS92aWV3flZpZXcjX2JpbmRUb09ic2VydmFibGUKLy8KLy8gQHBhcmFtIHtOb2RlfSBub2RlIERPTSBOb2RlIHRvIGJlIG1vZGlmaWVkLgovLyBAcGFyYW0ge1N0cmluZ30gc3R5bGVOYW1lIE5hbWUgb2YgdGhlIHN0eWxlIHRvIGJlIG1vZGlmaWVkLgovLyBAcmV0dXJucyB7T2JqZWN0fQoKCmZ1bmN0aW9uIGdldFN0eWxlVXBkYXRlcihlbCwgc3R5bGVOYW1lKSB7CiAgcmV0dXJuIHsKICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgIGVsLnN0eWxlW3N0eWxlTmFtZV0gPSB2YWx1ZTsKICAgIH0sCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKICAgICAgZWwuc3R5bGVbc3R5bGVOYW1lXSA9IG51bGw7CiAgICB9CiAgfTsKfSAvLyBDbG9uZXMgZGVmaW5pdGlvbiBvZiB0aGUgdGVtcGxhdGUuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmCi8vIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufQoKCmZ1bmN0aW9uIGNsb25lKGRlZikgewogIHZhciBjbG9uZSA9IGNsb25lRGVlcFdpdGgoZGVmLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgIC8vIERvbid0IGNsb25lIHRoZSBgVGVtcGxhdGUuYmluZGAqIGJpbmRpbmdzIGJlY2F1c2Ugb2YgdGhlIHJlZmVyZW5jZXMgdG8gT2JzZXJ2YWJsZQogICAgLy8gYW5kIERvbUVtaXR0ZXJNaXhpbiBpbnN0YW5jZXMgaW5zaWRlLCB3aGljaCB3b3VsZCBhbHNvIGJlIHRyYXZlcnNlZCBhbmQgY2xvbmVkIGJ5IGdyZWVkeQogICAgLy8gY2xvbmVEZWVwV2l0aCBhbGdvcml0aG0uIFRoZXJlJ3Mgbm8gcG9pbnQgaW4gY2xvbmluZyBPYnNlcnZhYmxlL0RvbUVtaXR0ZXJNaXhpbnMKICAgIC8vIGFsb25nIHdpdGggdGhlIGRlZmluaXRpb24uCiAgICAvLwogICAgLy8gRG9uJ3QgY2xvbmUgVGVtcGxhdGUgaW5zdGFuY2VzIGlmIHByb3ZpZGVkIGFzIGEgY2hpbGQuIFRoZXkncmUgc2ltcGx5ICNyZW5kZXIoKWVkCiAgICAvLyBhbmQgbm90aGluZyBzaG91bGQgaW50ZXJmZXJlLgogICAgLy8KICAgIC8vIEFsc28gZG9uJ3QgY2xvbmUgVmlldyBpbnN0YW5jZXMgaWYgcHJvdmlkZWQgYXMgYSBjaGlsZCBvZiB0aGUgVGVtcGxhdGUuIFRoZSB0ZW1wbGF0ZQogICAgLy8gaW5zdGFuY2Ugd2lsbCBiZSBleHRyYWN0ZWQgZnJvbSB0aGUgVmlldyBkdXJpbmcgdGhlIG5vcm1hbGl6YXRpb24gYW5kIHRoZXJlJ3Mgbm8gbmVlZAogICAgLy8gdG8gY2xvbmUgaXQuCiAgICBpZiAodmFsdWUgJiYgKHZhbHVlIGluc3RhbmNlb2YgVGVtcGxhdGVCaW5kaW5nIHx8IGlzVGVtcGxhdGUodmFsdWUpIHx8IGlzVmlldyh2YWx1ZSkgfHwgaXNWaWV3Q29sbGVjdGlvbih2YWx1ZSkpKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICB9KTsKICByZXR1cm4gY2xvbmU7Cn0gLy8gTm9ybWFsaXplcyBnaXZlbiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vIFNlZToKLy8gICoge0BsaW5rIG5vcm1hbGl6ZUF0dHJpYnV0ZXN9Ci8vICAqIHtAbGluayBub3JtYWxpemVMaXN0ZW5lcnN9Ci8vICAqIHtAbGluayBub3JtYWxpemVQbGFpblRleHREZWZpbml0aW9ufQovLyAgKiB7QGxpbmsgbm9ybWFsaXplVGV4dERlZmluaXRpb259Ci8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmCi8vIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBOb3JtYWxpemVkIGRlZmluaXRpb24uCgoKZnVuY3Rpb24gbm9ybWFsaXplKGRlZikgewogIGlmICh0eXBlb2YgZGVmID09ICdzdHJpbmcnKSB7CiAgICBkZWYgPSBub3JtYWxpemVQbGFpblRleHREZWZpbml0aW9uKGRlZik7CiAgfSBlbHNlIGlmIChkZWYudGV4dCkgewogICAgbm9ybWFsaXplVGV4dERlZmluaXRpb24oZGVmKTsKICB9CgogIGlmIChkZWYub24pIHsKICAgIGRlZi5ldmVudExpc3RlbmVycyA9IG5vcm1hbGl6ZUxpc3RlbmVycyhkZWYub24pOyAvLyBUZW1wbGF0ZSBtaXhlcyBFbWl0dGVyTWl4aW4sIHNvIGRlbGV0ZSAjb24gdG8gYXZvaWQgY29sbGlzaW9uLgoKICAgIGRlbGV0ZSBkZWYub247CiAgfQoKICBpZiAoIWRlZi50ZXh0KSB7CiAgICBpZiAoZGVmLmF0dHJpYnV0ZXMpIHsKICAgICAgbm9ybWFsaXplQXR0cmlidXRlcyhkZWYuYXR0cmlidXRlcyk7CiAgICB9CgogICAgdmFyIGNoaWxkcmVuID0gW107CgogICAgaWYgKGRlZi5jaGlsZHJlbikgewogICAgICBpZiAoaXNWaWV3Q29sbGVjdGlvbihkZWYuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaChkZWYuY2hpbGRyZW4pOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNiA9IGZhbHNlOwogICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjYgPSB1bmRlZmluZWQ7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I2ID0gZGVmLmNoaWxkcmVuW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA2OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ID0gKF9zdGVwNiA9IF9pdGVyYXRvcjYubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjYgPSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBjaGlsZCA9IF9zdGVwNi52YWx1ZTsKCiAgICAgICAgICAgIGlmIChpc1RlbXBsYXRlKGNoaWxkKSB8fCBpc1ZpZXcoY2hpbGQpIHx8IGlzTm9kZShjaGlsZCkpIHsKICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBUZW1wbGF0ZShjaGlsZCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjYgPSB0cnVlOwogICAgICAgICAgX2l0ZXJhdG9yRXJyb3I2ID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ICYmIF9pdGVyYXRvcjYucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I2LnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I2KSB7CiAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I2OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZGVmLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgfQoKICByZXR1cm4gZGVmOwp9IC8vIE5vcm1hbGl6ZXMgImF0dHJpYnV0ZXMiIHNlY3Rpb24gb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LgovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6ICdiYXInLAovLwkJCWI6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwKLy8JCQljOiB7Ci8vCQkJCXZhbHVlOiAnYmFyJwovLwkJCX0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6IFsgJ2JhcicgXSwKLy8JCQliOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBdLAovLwkJCWM6IHsKLy8JCQkJdmFsdWU6IFsgJ2JhcicgXQovLwkJCX0KLy8JCX0KLy8KLy8gQHBhcmFtIHtPYmplY3R9IGF0dHJpYnV0ZXMKCgpmdW5jdGlvbiBub3JtYWxpemVBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMpIHsKICBmb3IgKHZhciBhIGluIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChhdHRyaWJ1dGVzW2FdLnZhbHVlKSB7CiAgICAgIGF0dHJpYnV0ZXNbYV0udmFsdWUgPSBbXS5jb25jYXQoYXR0cmlidXRlc1thXS52YWx1ZSk7CiAgICB9CgogICAgYXJyYXlpZnkoYXR0cmlidXRlcywgYSk7CiAgfQp9IC8vIE5vcm1hbGl6ZXMgIm9uIiBzZWN0aW9uIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KLy8KLy8JCW9uOiB7Ci8vCQkJYTogJ2JhcicsCi8vCQkJYjoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9LAovLwkJCWM6IFsge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9LCAoKSA9PiB7IC4uLiB9IF0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJb246IHsKLy8JCQlhOiBbICdiYXInIF0sCi8vCQkJYjogWyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30gXSwKLy8JCQljOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwgKCkgPT4geyAuLi4gfSBdCi8vCQl9Ci8vCi8vIEBwYXJhbSB7T2JqZWN0fSBsaXN0ZW5lcnMKLy8gQHJldHVybnMge09iamVjdH0gT2JqZWN0IGNvbnRhaW5pbmcgbm9ybWFsaXplZCBsaXN0ZW5lcnMuCgoKZnVuY3Rpb24gbm9ybWFsaXplTGlzdGVuZXJzKGxpc3RlbmVycykgewogIGZvciAodmFyIGwgaW4gbGlzdGVuZXJzKSB7CiAgICBhcnJheWlmeShsaXN0ZW5lcnMsIGwpOwogIH0KCiAgcmV0dXJuIGxpc3RlbmVyczsKfSAvLyBOb3JtYWxpemVzICJzdHJpbmciIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KLy8KLy8JCSJmb28iCi8vCi8vIGJlY29tZXMKLy8KLy8JCXsgdGV4dDogWyAnZm9vJyBdIH0sCi8vCi8vIEBwYXJhbSB7U3RyaW5nfSBkZWYKLy8gQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IE5vcm1hbGl6ZWQgdGVtcGxhdGUgZGVmaW5pdGlvbi4KCgpmdW5jdGlvbiBub3JtYWxpemVQbGFpblRleHREZWZpbml0aW9uKGRlZikgewogIHJldHVybiB7CiAgICB0ZXh0OiBbZGVmXQogIH07Cn0gLy8gTm9ybWFsaXplcyB0ZXh0IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KLy8KLy8JCWNoaWxkcmVuOiBbCi8vCQkJeyB0ZXh0OiAnZGVmJyB9LAovLwkJCXsgdGV4dDoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IH0KLy8JCV0KLy8KLy8gYmVjb21lcwovLwovLwkJY2hpbGRyZW46IFsKLy8JCQl7IHRleHQ6IFsgJ2RlZicgXSB9LAovLwkJCXsgdGV4dDogWyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30gXSB9Ci8vCQldCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmCgoKZnVuY3Rpb24gbm9ybWFsaXplVGV4dERlZmluaXRpb24oZGVmKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGRlZi50ZXh0KSkgewogICAgZGVmLnRleHQgPSBbZGVmLnRleHRdOwogIH0KfSAvLyBXcmFwcyBhbiBlbnRyeSBpbiBPYmplY3QgaW4gYW4gQXJyYXksIGlmIG5vdCBhbHJlYWR5IG9uZS4KLy8KLy8JCXsKLy8JCQl4OiAneScsCi8vCQkJYTogWyAnYicgXQovLwkJfQovLwovLyBiZWNvbWVzCi8vCi8vCQl7Ci8vCQkJeDogWyAneScgXSwKLy8JCQlhOiBbICdiJyBdCi8vCQl9Ci8vCi8vIEBwYXJhbSB7T2JqZWN0fSBvYmoKLy8gQHBhcmFtIHtTdHJpbmd9IGtleQoKCmZ1bmN0aW9uIGFycmF5aWZ5KG9iaiwga2V5KSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KG9ialtrZXldKSkgewogICAgb2JqW2tleV0gPSBbb2JqW2tleV1dOwogIH0KfSAvLyBBIGhlbHBlciB3aGljaCBjb25jYXRlbmF0ZXMgdGhlIHZhbHVlIGF2b2lkaW5nIHVud2FudGVkCi8vIGxlYWRpbmcgd2hpdGUgc3BhY2VzLgovLwovLyBAcGFyYW0ge1N0cmluZ30gcHJldgovLyBAcGFyYW0ge1N0cmluZ30gY3VyCi8vIEByZXR1cm5zIHtTdHJpbmd9CgoKZnVuY3Rpb24gYXJyYXlWYWx1ZVJlZHVjZXIocHJldiwgY3VyKSB7CiAgaWYgKGlzRmFsc3koY3VyKSkgewogICAgcmV0dXJuIHByZXY7CiAgfSBlbHNlIGlmIChpc0ZhbHN5KHByZXYpKSB7CiAgICByZXR1cm4gY3VyOwogIH0gZWxzZSB7CiAgICByZXR1cm4gIiIuY29uY2F0KHByZXYsICIgIikuY29uY2F0KGN1cik7CiAgfQp9IC8vIEV4dGVuZHMgb25lIG9iamVjdCBkZWZpbmVkIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgovLwovLwkJewovLwkJCWtleTE6IFtBcnJheTFdLAovLwkJCWtleTI6IFtBcnJheTJdLAovLwkJCS4uLgovLwkJCWtleU46IFtBcnJheU5dCi8vCQl9Ci8vCi8vIHdpdGggYW5vdGhlciBvYmplY3Qgb2YgdGhlIHNhbWUgZGF0YSBmb3JtYXQuCi8vCi8vIEBwYXJhbSB7T2JqZWN0fSBvYmogQmFzZSBvYmplY3QuCi8vIEBwYXJhbSB7T2JqZWN0fSBleHQgT2JqZWN0IGV4dGVuZGluZyBiYXNlLgovLyBAcmV0dXJucyB7U3RyaW5nfQoKCmZ1bmN0aW9uIGV4dGVuZE9iamVjdFZhbHVlQXJyYXkob2JqLCBleHQpIHsKICBmb3IgKHZhciBhIGluIGV4dCkgewogICAgaWYgKG9ialthXSkgewogICAgICB2YXIgX29iaiRhOwoKICAgICAgKF9vYmokYSA9IG9ialthXSkucHVzaC5hcHBseShfb2JqJGEsIF90b0NvbnN1bWFibGVBcnJheShleHRbYV0pKTsKICAgIH0gZWxzZSB7CiAgICAgIG9ialthXSA9IGV4dFthXTsKICAgIH0KICB9Cn0gLy8gQSBoZWxwZXIgZm9yIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjZXh0ZW5kfS4gUmVjdXJzaXZlbHkgZXh0ZW5kcyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfSBpbnN0YW5jZQovLyB3aXRoIGNvbnRlbnQgZnJvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uIFNlZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2V4dGVuZH0gdG8gbGVhcm4gbW9yZS4KLy8KLy8gQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV9IGRlZiBBIHRlbXBsYXRlIGluc3RhbmNlIHRvIGJlIGV4dGVuZGVkLgovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZiBBIGRlZmluaXRpb24gd2hpY2ggaXMgdG8gZXh0ZW5kIHRoZSB0ZW1wbGF0ZSBpbnN0YW5jZS4KLy8gQHBhcmFtIHtPYmplY3R9IEVycm9yIGNvbnRleHQuCgoKZnVuY3Rpb24gZXh0ZW5kVGVtcGxhdGUodGVtcGxhdGUsIGRlZikgewogIGlmIChkZWYuYXR0cmlidXRlcykgewogICAgaWYgKCF0ZW1wbGF0ZS5hdHRyaWJ1dGVzKSB7CiAgICAgIHRlbXBsYXRlLmF0dHJpYnV0ZXMgPSB7fTsKICAgIH0KCiAgICBleHRlbmRPYmplY3RWYWx1ZUFycmF5KHRlbXBsYXRlLmF0dHJpYnV0ZXMsIGRlZi5hdHRyaWJ1dGVzKTsKICB9CgogIGlmIChkZWYuZXZlbnRMaXN0ZW5lcnMpIHsKICAgIGlmICghdGVtcGxhdGUuZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgdGVtcGxhdGUuZXZlbnRMaXN0ZW5lcnMgPSB7fTsKICAgIH0KCiAgICBleHRlbmRPYmplY3RWYWx1ZUFycmF5KHRlbXBsYXRlLmV2ZW50TGlzdGVuZXJzLCBkZWYuZXZlbnRMaXN0ZW5lcnMpOwogIH0KCiAgaWYgKGRlZi50ZXh0KSB7CiAgICB2YXIgX3RlbXBsYXRlJHRleHQ7CgogICAgKF90ZW1wbGF0ZSR0ZXh0ID0gdGVtcGxhdGUudGV4dCkucHVzaC5hcHBseShfdGVtcGxhdGUkdGV4dCwgX3RvQ29uc3VtYWJsZUFycmF5KGRlZi50ZXh0KSk7CiAgfQoKICBpZiAoZGVmLmNoaWxkcmVuICYmIGRlZi5jaGlsZHJlbi5sZW5ndGgpIHsKICAgIGlmICh0ZW1wbGF0ZS5jaGlsZHJlbi5sZW5ndGggIT0gZGVmLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAvKioKICAgICAgICogVGhlIG51bWJlciBvZiBjaGlsZHJlbiBpbiBleHRlbmRlZCBkZWZpbml0aW9uIGRvZXMgbm90IG1hdGNoLgogICAgICAgKgogICAgICAgKiBAZXJyb3IgdWktdGVtcGxhdGUtZXh0ZW5kLWNoaWxkcmVuLW1pc21hdGNoCiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndWktdGVtcGxhdGUtZXh0ZW5kLWNoaWxkcmVuLW1pc21hdGNoOiBUaGUgbnVtYmVyIG9mIGNoaWxkcmVuIGluIGV4dGVuZGVkIGRlZmluaXRpb24gZG9lcyBub3QgbWF0Y2guJywgdGVtcGxhdGUpOwogICAgfQoKICAgIHZhciBjaGlsZEluZGV4ID0gMDsKICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNyA9IHRydWU7CiAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I3ID0gZmFsc2U7CiAgICB2YXIgX2l0ZXJhdG9yRXJyb3I3ID0gdW5kZWZpbmVkOwoKICAgIHRyeSB7CiAgICAgIGZvciAodmFyIF9pdGVyYXRvcjcgPSBkZWYuY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDc7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjcgPSAoX3N0ZXA3ID0gX2l0ZXJhdG9yNy5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNyA9IHRydWUpIHsKICAgICAgICB2YXIgY2hpbGREZWYgPSBfc3RlcDcudmFsdWU7CiAgICAgICAgZXh0ZW5kVGVtcGxhdGUodGVtcGxhdGUuY2hpbGRyZW5bY2hpbGRJbmRleCsrXSwgY2hpbGREZWYpOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I3ID0gdHJ1ZTsKICAgICAgX2l0ZXJhdG9yRXJyb3I3ID0gZXJyOwogICAgfSBmaW5hbGx5IHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb243ICYmIF9pdGVyYXRvcjcucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgIF9pdGVyYXRvcjcucmV0dXJuKCk7CiAgICAgICAgfQogICAgICB9IGZpbmFsbHkgewogICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjcpIHsKICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn0gLy8gQ2hlY2tzIGlmIHZhbHVlIGlzICJmYWxzeSIuCi8vIE5vdGU6IDAgKE51bWJlcikgaXMgbm90ICJmYWxzeSIgaW4gdGhpcyBjb250ZXh0LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNGYWxzeSh2YWx1ZSkgewogIHJldHVybiAhdmFsdWUgJiYgdmFsdWUgIT09IDA7Cn0gLy8gQ2hlY2tzIGlmIHRoZSBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fQovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNWaWV3KGl0ZW0pIHsKICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIFZpZXc7Cn0gLy8gQ2hlY2tzIGlmIHRoZSBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV9Ci8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7Kn0gdmFsdWUgVmFsdWUgdG8gYmUgY2hlY2tlZC4KCgpmdW5jdGlvbiBpc1RlbXBsYXRlKGl0ZW0pIHsKICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIFRlbXBsYXRlOwp9IC8vIENoZWNrcyBpZiB0aGUgaXRlbSBpcyBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNWaWV3Q29sbGVjdGlvbihpdGVtKSB7CiAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBWaWV3Q29sbGVjdGlvbjsKfSAvLyBDcmVhdGVzIGFuIGVtcHR5IHNrZWxldG9uIGZvciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydH0KLy8gZGF0YS4KLy8KLy8gQHByaXZhdGUKCgpmdW5jdGlvbiBnZXRFbXB0eVJldmVydERhdGEoKSB7CiAgcmV0dXJuIHsKICAgIGNoaWxkcmVuOiBbXSwKICAgIGJpbmRpbmdzOiBbXSwKICAgIGF0dHJpYnV0ZXM6IHt9CiAgfTsKfSAvLyBDaGVja3Mgd2hldGhlciBhbiBhdHRyaWJ1dGUgc2hvdWxkIGJlIGV4dGVuZGVkIHdoZW4KLy8ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseX0gaXMgY2FsbGVkLgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge1N0cmluZ30gYXR0ck5hbWUgQXR0cmlidXRlIG5hbWUgdG8gY2hlY2suCgoKZnVuY3Rpb24gc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSB7CiAgcmV0dXJuIGF0dHJOYW1lID09ICdjbGFzcycgfHwgYXR0ck5hbWUgPT0gJ3N0eWxlJzsKfQovKioKICogQSBkZWZpbml0aW9uIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfS4gSXQgZGVzY3JpYmVzIHdoYXQga2luZCBvZgogKiBub2RlIGEgdGVtcGxhdGUgd2lsbCByZW5kZXIgKEhUTUwgZWxlbWVudCBvciB0ZXh0KSwgYXR0cmlidXRlcyBvZiBhbiBlbGVtZW50LCBET00gZXZlbnQKICogbGlzdGVuZXJzIGFuZCBjaGlsZHJlbi4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSB0byBsZWFybiBhYm91dCBIVE1MIGVsZW1lbnQgYXR0cmlidXRlcywKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9IHRvIGxlYXJuIGFib3V0IERPTSBldmVudCBsaXN0ZW5lcnMuCiAqCiAqIEEgc2FtcGxlIGRlZmluaXRpb24gb24gYW4gSFRNTCBlbGVtZW50IGNhbiBsb29rIGxpa2UgdGhpczoKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCWNoaWxkcmVuOiBbCiAqCQkJCXsKICoJCQkJCXRhZzogJ3NwYW4nLAogKgkJCQkJYXR0cmlidXRlczogeyAuLi4gfSwKICoJCQkJCWNoaWxkcmVuOiBbIC4uLiBdLAogKgkJCQl9LAogKgkJCQl7CiAqCQkJCQl0ZXh0OiAnc3RhdGlj4oCTdGV4dCcKICoJCQkJfSwKICoJCQkJJ2Fsc28tc3RhdGlj4oCTdGV4dCcsCiAqCQkJXSwKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCWNsYXNzOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LAogKgkJCQlpZDoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSwKICoJCQkJc3R5bGU6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0KICoKICoJCQkJLy8gLi4uCiAqCQkJfSwKICoJCQlvbjogewogKgkJCQknY2xpY2snOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9CiAqCiAqCQkJCS8vIERvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgZm9ybWF0IGlzIGFsc28gYWNjZXB0ZWQuCiAqCQkJCSdrZXl1cEBhLnNvbWUtY2xhc3MnOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9CiAqCiAqCQkJCS8vIC4uLgogKgkJCX0KICoJCX0gKTsKICoKICogQSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+Vmlld30sIGFub3RoZXIge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gb3IgYSBuYXRpdmUgRE9NIG5vZGUKICogY2FuIGFsc28gYmVjb21lIGEgY2hpbGQgb2YgYSB0ZW1wbGF0ZS4gV2hlbiBhIHZpZXcgaXMgcGFzc2VkLCBpdHMge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXcjZWxlbWVudH0gaXMgdXNlZDoKICoKICoJCWNvbnN0IHZpZXcgPSBuZXcgU29tZVZpZXcoKTsKICoJCWNvbnN0IGNoaWxkVGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoIHsgLi4uIH0gKTsKICoJCWNvbnN0IGNoaWxkTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdiJyApOwogKgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGFnOiAncCcsCiAqCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJLy8gdmlldyNlbGVtZW50IHdpbGwgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiB0aGlzIDxwPi4KICoJCQkJdmlldywKICoKICogCQkJCS8vIFRoZSBvdXRwdXQgb2YgY2hpbGRUZW1wbGF0ZS5yZW5kZXIoKSB3aWxsIGJlIGFkZGVkIGhlcmUuCiAqCQkJCWNoaWxkVGVtcGxhdGUsCiAqCiAqCQkJCS8vIE5hdGl2ZSBET00gbm9kZXMgYXJlIGluY2x1ZGVkIGRpcmVjdGx5IGluIHRoZSByZW5kZXJlZCBvdXRwdXQuCiAqCQkJCWNoaWxkTm9kZQogKgkJCV0KICoJCX0gKTsKICoKICogQW4gZW50aXJlIHtAbGluayBtb2R1bGU6dWkvdmlld2NvbGxlY3Rpb25+Vmlld0NvbGxlY3Rpb259IGNhbiBiZSB1c2VkIGFzIGEgY2hpbGQgaW4gdGhlIGRlZmluaXRpb246CiAqCiAqCQljb25zdCBjb2xsZWN0aW9uID0gbmV3IFZpZXdDb2xsZWN0aW9uKCk7CiAqCQljb2xsZWN0aW9uLmFkZCggc29tZVZpZXcgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgogKgkJCWNoaWxkcmVuOiBjb2xsZWN0aW9uCiAqCQl9ICk7CiAqCiAqIEB0eXBlZGVmIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24KICogQHR5cGUgT2JqZWN0CiAqCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0YWcgU2VlIHRoZSB0ZW1wbGF0ZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3RhZ30gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7QXJyYXkuPG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24+fSBbY2hpbGRyZW5dCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNjaGlsZHJlbn0gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxTdHJpbmcsIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hPn0gW2F0dHJpYnV0ZXNdCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhdHRyaWJ1dGVzfSBwcm9wZXJ0eS4KICoKICogQHByb3BlcnR5IHtTdHJpbmd8bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF8QXJyYXkuPFN0cmluZ3xtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYT59IFt0ZXh0XQogKiBTZWUgdGhlIHRlbXBsYXRlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjdGV4dH0gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxTdHJpbmcsIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUxpc3RlbmVyU2NoZW1hPn0gW29uXQogKiBTZWUgdGhlIHRlbXBsYXRlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjZXZlbnRMaXN0ZW5lcnN9IHByb3BlcnR5LgogKi8KCi8qKgogKiBEZXNjcmliZXMgYSB2YWx1ZSBvZiBhbiBIVE1MIGVsZW1lbnQgYXR0cmlidXRlIG9yIGB0ZXh0Q29udGVudGAuIEl0IGFsbG93cyBjb21iaW5pbmcgbXVsdGlwbGUKICogZGF0YSBzb3VyY2VzIGxpa2Ugc3RhdGljIHZhbHVlcyBhbmQge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gYXR0cmlidXRlcy4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IHRvIGxlYXJuIHdoZXJlIHRvIHVzZSBpdCwKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlLmJpbmR9IHRvIGxlYXJuIGhvdyB0byBjb25maWd1cmUKICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gYXR0cmlidXRlIGJpbmRpbmdzLAogKiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmVuZGVyfSB0byBsZWFybiBob3cgdG8gcmVuZGVyIGEgdGVtcGxhdGUsCiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG8gYHRvKClgfSBhbmQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWYgYGlmKClgfQogKiBtZXRob2RzIHRvIGxlYXJuIG1vcmUgYWJvdXQgYmluZGluZ3MuCiAqCiAqIEF0dHJpYnV0ZSB2YWx1ZXMgY2FuIGJlIGRlc2NyaWJlZCBpbiBtYW55IGRpZmZlcmVudCB3YXlzOgogKgogKgkJLy8gQmluZCBoZWxwZXIgd2lsbCBjcmVhdGUgYmluZGluZ3MgdG8gYXR0cmlidXRlcyBvZiB0aGUgb2JzZXJ2YWJsZS4KICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCS8vIEEgcGxhaW4gc3RyaW5nIHNjaGVtYS4KICoJCQkJJ2NsYXNzJzogJ3N0YXRpYy10ZXh0JywKICoKICoJCQkJLy8gQW4gb2JqZWN0IHNjaGVtYSwgYmluZHMgdG8gdGhlICJmb28iIGF0dHJpYnV0ZSBvZiB0aGUKICoJCQkJLy8gb2JzZXJ2YWJsZSBhbmQgZm9sbG93cyBpdHMgdmFsdWUuCiAqCQkJCSdjbGFzcyc6IGJpbmQudG8oICdmb28nICksCiAqCiAqCQkJCS8vIEFuIGFycmF5IHNjaGVtYSwgY29tYmluZXMgdGhlIGFib3ZlLgogKgkJCQknY2xhc3MnOiBbCiAqCQkJCQknc3RhdGljLXRleHQnLAogKgkJCQkJYmluZC50byggJ2JhcicsICgpID0+IHsgLi4uIH0gKSwKICoKICogCQkJCQkvLyBCaW5kaW5ncyBjYW4gYWxzbyBiZSBjb25kaXRpb25hbC4KICoJCQkJCWJpbmQuaWYoICdiYXonLCAnY2xhc3Mtd2hlbi1iYXotaXMtdHJ1ZScgKQogKgkJCQldLAogKgogKgkJCQkvLyBBbiBhcnJheSBzY2hlbWEsIHdpdGggYSBjdXN0b20gbmFtZXNwYWNlLCBlLmcuIHVzZWZ1bCBmb3IgY3JlYXRpbmcgU1ZHcy4KICoJCQkJJ2NsYXNzJzogewogKgkJCQkJbnM6ICdodHRwOi8vbnMudXJsJywKICoJCQkJCXZhbHVlOiBbCiAqCQkJCQkJYmluZC5pZiggJ2JheicsICd2YWx1ZS13aGVuLXRydWUnICksCiAqCQkJCQkJJ3N0YXRpYy10ZXh0JwogKgkJCQkJXQogKgkJCQl9LAogKgogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLCBzcGVjaWZpYyBmb3Igc3R5bGVzLgogKgkJCQlzdHlsZTogewogKgkJCQkJY29sb3I6ICdyZWQnLAogKgkJCQkJYmFja2dyb3VuZENvbG9yOiBiaW5kLnRvKCAncXV4JywgKCkgPT4geyAuLi4gfSApCiAqCQkJCX0KICoJCQl9CiAqCQl9ICk7CiAqCiAqIFRleHQgbm9kZXMgY2FuIGFsc28gaGF2ZSBjb21wbGV4IHZhbHVlczoKICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQkvLyBXaWxsIHJlbmRlciBhICJmb28iIHRleHQgbm9kZS4KICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRleHQ6ICdmb28nCiAqCQl9ICk7CiAqCiAqCQkvLyBXaWxsIHJlbmRlciBhICJzdGF0aWMgdGV4dDoge29ic2VydmFibGUuZm9vfSIgdGV4dCBub2RlLgogKgkJLy8gVGhlIHRleHQgb2YgdGhlIG5vZGUgd2lsbCBiZSB1cGRhdGVkIGFzIHRoZSAiZm9vIiBhdHRyaWJ1dGUgY2hhbmdlcy4KICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRleHQ6IFsKICoJCQkJJ3N0YXRpYyB0ZXh0OiAnLAogKgkJCQliaW5kLnRvKCAnZm9vJywgKCkgPT4geyAuLi4gfSApCiAqCQkJXQogKgkJfSApOwogKgogKiBAdHlwZWRlZiBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYQogKiBAdHlwZSB7T2JqZWN0fFN0cmluZ3xBcnJheX0KICovCgovKioKICogRGVzY3JpYmVzIGFuIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkIHRvIGFuIEhUTUwgZWxlbWVudC4gU3VjaCBsaXN0ZW5lciBjYW4gcHJvcGFnYXRlIERPTSBldmVudHMKICogdGhyb3VnaCBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBpbnN0YW5jZSwgZXhlY3V0ZSBjdXN0b20gY2FsbGJhY2tzCiAqIG9yIGJvdGgsIGlmIG5lY2Vzc2FyeS4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IHRvIGxlYXJuIG1vcmUgYWJvdXQgdGVtcGxhdGUgZGVmaW5pdGlvbnMsCiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG8gYHRvKClgfSBtZXRob2QgdG8gbGVhcm4gbW9yZSBhYm91dCBiaW5kaW5ncy4KICoKICogQ2hlY2sgb3V0IGRpZmZlcmVudCB3YXlzIG9mIGF0dGFjaGluZyBldmVudCBsaXN0ZW5lcnMgYmVsb3c6CiAqCiAqCQkvLyBCaW5kIGhlbHBlciB3aWxsIHByb3BhZ2F0ZSBldmVudHMgdGhyb3VnaCB0aGUgb2JzZXJ2YWJsZS4KICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlvbjogewogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLiBUaGUgb2JzZXJ2YWJsZSB3aWxsIGZpcmUgdGhlICJjbGlja2VkIiBldmVudCB1cG9uIERPTSAiY2xpY2siLgogKgkJCQljbGljazogYmluZC50byggJ2NsaWNrZWQnICkKICoKICoJCQkJLy8gQW4gb2JqZWN0IHNjaGVtYS4gSXQgd2lsbCB3b3JrIGZvciAiY2xpY2siIGV2ZW50IG9uICJhLmZvbyIgY2hpbGRyZW4gb25seS4KICoJCQkJJ2NsaWNrQGEuZm9vJzogYmluZC50byggJ2NsaWNrZWQnICkKICoKICoJCQkJLy8gQW4gYXJyYXkgc2NoZW1hLCBtYWtlcyB0aGUgb2JzZXJ2YWJsZSBwcm9wYWdhdGUgbXVsdGlwbGUgZXZlbnRzLgogKgkJCQljbGljazogWwogKgkJCQkJYmluZC50byggJ2NsaWNrZWQnICksCiAqCQkJCQliaW5kLnRvKCAnZXhlY3V0ZWQnICkKICoJCQkJXSwKICoKICoJCQkJLy8gQW4gYXJyYXkgc2NoZW1hIHdpdGggYSBjdXN0b20gY2FsbGJhY2suCiAqCQkJCSdjbGlja0BhLmZvbyc6IHsKICoJCQkJCWJpbmQudG8oICdjbGlja2VkJyApLAogKgkJCQkJYmluZC50byggZXZ0ID0+IHsKICoJCQkJCQljb25zb2xlLmxvZyggYCR7IGV2dC50YXJnZXQgfSBoYXMgYmVlbiBjbGlja2VkIWAgKTsKICoJCQkJCX0gfQogKgkJCQl9CiAqCQkJfQogKgkJfSApOwogKgogKiBAdHlwZWRlZiBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYQogKiBAdHlwZSB7T2JqZWN0fFN0cmluZ3xBcnJheX0KICovCgovKioKICogVGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgflRlbXBsYXRlLmJpbmQgYFRlbXBsYXRlLmJpbmQoKWB9LiBJdCBwcm92aWRlcyBgdG8oKWAgYW5kIGBpZigpYAogKiBtZXRob2RzIHRvIGNyZWF0ZSB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlfSBhdHRyaWJ1dGUgYW5kIGV2ZW50IGJpbmRpbmdzLgogKgogKiBAaW50ZXJmYWNlIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4KICovCgovKioKICogQmluZHMgYW4ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlfSB0byBlaXRoZXI6CiAqCiAqICogYW4gSFRNTCBlbGVtZW50IGF0dHJpYnV0ZSBvciBhIHRleHQgbm9kZSBgdGV4dENvbnRlbnRgLCBzbyBpdCByZW1haW5zIGluIHN5bmMgd2l0aCB0aGUgb2JzZXJ2YWJsZQogKiBhdHRyaWJ1dGUgYXMgaXQgY2hhbmdlcywKICogKiBvciBhbiBIVE1MIGVsZW1lbnQgRE9NIGV2ZW50LCBzbyB0aGUgRE9NIGV2ZW50cyBhcmUgcHJvcGFnYXRlZCB0aHJvdWdoIGFuIG9ic2VydmFibGUuCiAqCiAqIFNvbWUgY29tbW9uIHVzZSBjYXNlcyBvZiBgdG8oKWAgYmluZGluZ3MgYXJlIHByZXNlbnRlZCBiZWxvdzoKICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCS8vIGNsYXNzPSIuLi4iIGF0dHJpYnV0ZSBnZXRzIGJvdW5kIHRvIGBvYnNlcnZhYmxlI2FgCiAqCQkJCWNsYXNzOiBiaW5kLnRvKCAnYScgKQogKgkJCX0sCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJLy8gPHA+Li4uPC9wPiBnZXRzIGJvdW5kIHRvIG9ic2VydmFibGUjYjsgYWx3YXlzIGB0b1VwcGVyQ2FzZSgpYC4KICoJCQkJewogKgkJCQkJdGV4dDogYmluZC50byggJ2InLCAoIHZhbHVlLCBub2RlICkgPT4gdmFsdWUudG9VcHBlckNhc2UoKSApCiAqCQkJCX0KICoJCQldLAogKgkJCW9uOiB7CiAqCQkJCWNsaWNrOiBbCiAqCQkJCQkvLyBBbiBvYnNlcnZhYmxlIHdpbGwgZmlyZSAiY2xpY2tlZCIgdXBvbiAiY2xpY2siIGluIHRoZSBET00uCiAqCQkJCQliaW5kLnRvKCAnY2xpY2tlZCcgKSwKICoKICoJCQkJCS8vIEEgY3VzdG9tIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgdXBvbiAiY2xpY2siIGluIHRoZSBET00uCiAqCQkJCQliaW5kLnRvKCAoKSA9PiB7CiAqCQkJCQkJLi4uCiAqCQkJCQl9ICkKICoJCQkJXQogKgkJCX0KICoJCX0gKS5yZW5kZXIoKTsKICoKICogTGVhcm4gbW9yZSBhYm91dCB1c2luZyBgdG8oKWAgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gYW5kCiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYX0uCiAqCiAqIEBtZXRob2QgI3RvCiAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUgQW4gYXR0cmlidXRlIG5hbWUgb2YKICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gb3IgYSBET00gZXZlbnQgbmFtZSBvciBhbiBldmVudCBjYWxsYmFjay4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSBBbGxvd3MgZm9yIHByb2Nlc3Npbmcgb2YgdGhlIHZhbHVlLiBBY2NlcHRzIGBOb2RlYCBhbmQgYHZhbHVlYCBhcyBhcmd1bWVudHMuCiAqIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfQogKi8KCi8qKgogKiBCaW5kcyBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGV9IHRvIGFuIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGUgb3IgYSB0ZXh0CiAqIG5vZGUgYHRleHRDb250ZW50YCBzbyBpdCByZW1haW5zIGluIHN5bmMgd2l0aCB0aGUgb2JzZXJ2YWJsZSBhdHRyaWJ1dGUgYXMgaXQgY2hhbmdlcy4KICoKICogVW5saWtlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+QmluZENoYWluI3RvfSwgaXQgY29udHJvbHMgdGhlIHByZXNlbmNlIG9mIHRoZSBhdHRyaWJ1dGUgb3IgYHRleHRDb250ZW50YAogKiBkZXBlbmRpbmcgb24gdGhlICJmYWxzZW5lc3MiIG9mIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IGF0dHJpYnV0ZS4KICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdpbnB1dCcsCiAqCQkJYXR0cmlidXRlczogewogKgkJCQkvLyA8aW5wdXQgY2hlY2tlZD4gd2hlbiBgb2JzZXJ2YWJsZSNhYCBpcyBub3QgdW5kZWZpbmVkL251bGwvZmFsc2UvJycKICoJCQkJLy8gPGlucHV0PiB3aGVuIGBvYnNlcnZhYmxlI2FgIGlzIHVuZGVmaW5lZC9udWxsL2ZhbHNlCiAqCQkJCWNoZWNrZWQ6IGJpbmQuaWYoICdhJyApCiAqCQkJfSwKICoJCQljaGlsZHJlbjogWwogKgkJCQl7CiAqCQkJCQkvLyA8aW5wdXQ+ImItaXMtbm90LXNldCI8L2lucHV0PiB3aGVuIGBvYnNlcnZhYmxlI2JgIGlzIHVuZGVmaW5lZC9udWxsL2ZhbHNlLycnCiAqCQkJCQkvLyA8aW5wdXQ+PC9pbnB1dD4gd2hlbiBgb2JzZXJ2YWJsZSNiYCBpcyBub3QgImZhbHN5IgogKgkJCQkJdGV4dDogYmluZC5pZiggJ2InLCAnYi1pcy1ub3Qtc2V0JywgKCB2YWx1ZSwgbm9kZSApID0+ICF2YWx1ZSApCiAqCQkJCX0KICoJCQldCiAqCQl9ICkucmVuZGVyKCk7CiAqCiAqIExlYXJuIG1vcmUgYWJvdXQgdXNpbmcgYGlmKClgIGluIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LgogKgogKiBAbWV0aG9kICNpZgogKiBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlIEFuIGF0dHJpYnV0ZSBuYW1lIG9mIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IHVzZWQgaW4gdGhlIGJpbmRpbmcuCiAqIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWVJZlRydWVdIFZhbHVlIHNldCB3aGVuIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBhdHRyaWJ1dGUgaXMgbm90CiAqIHVuZGVmaW5lZC9udWxsL2ZhbHNlLycnIChlbXB0eSBzdHJpbmcpLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIEFsbG93cyBmb3IgcHJvY2Vzc2luZyBvZiB0aGUgdmFsdWUuIEFjY2VwdHMgYE5vZGVgIGFuZCBgdmFsdWVgIGFzIGFyZ3VtZW50cy4KICogQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9CiAqLwoKLyoqCiAqIFRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI19yZW5kZXJOb2RlfSBjb25maWd1cmF0aW9uLgogKgogKiBAcHJpdmF0ZQogKiBAaW50ZXJmYWNlIG1vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhCiAqLwoKLyoqCiAqIFRlbGxzIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjX3JlbmRlck5vZGV9IHRvIHJlbmRlcgogKiBjaGlsZHJlbiBpbnRvIGBEb2N1bWVudEZyYWdtZW50YCBmaXJzdCBhbmQgdGhlbiBhcHBlbmQgdGhlIGZyYWdtZW50CiAqIHRvIHRoZSBwYXJlbnQgZWxlbWVudC4gSXQgaXMgYSBzcGVlZCBvcHRpbWl6YXRpb24uCiAqCiAqIEBtZW1iZXIge0Jvb2xlYW59ICNpbnRvRnJhZ21lbnQKICovCgovKioKICogQSBub2RlIHdoaWNoIGlzIGJlaW5nIHJlbmRlcmVkLgogKgogKiBAbWVtYmVyIHtIVE1MRWxlbWVudHxUZXh0fSAjbm9kZQogKi8KCi8qKgogKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUge0Btb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyTm9kZU9wdGlvbnMjbm9kZX0gaGFzCiAqIGJlZW4gcHJvdmlkZWQgYnkge0Btb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXBwbHl9LgogKgogKiBAbWVtYmVyIHtCb29sZWFufSAjaXNBcHBseWluZwogKi8KCi8qKgogKiBBbiBvYmplY3Qgc3RvcmluZyB0aGUgZGF0YSB0aGF0IGhlbHBzIHtAbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydH0KICogYnJpbmdpbmcgYmFjayBhbiBlbGVtZW50IHRvIGl0cyBpbml0aWFsIHN0YXRlLCBpLmUuIGJlZm9yZQogKiB7QG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseX0gd2FzIGNhbGxlZC4KICoKICogQG1lbWJlciB7T2JqZWN0fSAjcmV2ZXJ0RGF0YQogKi8="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-ui/src/template.js"],"names":["CKEditorError","mix","EmitterMixin","View","ViewCollection","isNode","isObject","cloneDeepWith","xhtmlNs","Template","def","Object","assign","normalize","clone","_isRendered","_revertData","node","_renderNode","intoFragment","getEmptyRevertData","isApplying","revertData","_revertTemplateFromNode","search","children","child","isView","isTemplate","data","isInvalid","tag","text","_renderText","_renderElement","document","createElementNS","ns","_renderAttributes","_renderElementChildren","_setUpListeners","textContent","createTextNode","hasTemplateBinding","_bindToObservable","schema","updater","getTextUpdater","join","attrName","attrValue","domAttrValue","attrNs","attributes","getAttribute","valueToBind","value","shouldExtend","unshift","getAttributeUpdater","_renderStyleAttribute","map","val","reduce","prev","next","concat","arrayValueReducer","isFalsy","setAttributeNS","styles","styleName","styleValue","getStyleUpdater","style","container","createDocumentFragment","childIndex","isViewCollection","setParent","view","appendChild","element","isRendered","render","childRevertData","push","childNodes","eventListeners","key","revertBindings","schemaItem","split","domEvtName","domSelector","activateDomEventListener","bindings","syncValueSchemaValue","filter","item","observable","templateBinding","activateAttributeListener","binding","revertBinding","removeAttribute","setAttribute","i","length","emitter","to","eventNameOrFunctionOrAttribute","callback","TemplateToBinding","eventNameOrFunction","attribute","if","valueIfTrue","TemplateIfBinding","template","extendTemplate","TemplateBinding","listenTo","stopListening","evt","domEvt","target","matches","fire","Array","isArray","some","getValueSchemaValue","getValue","remove","set","el","removeAttributeNS","normalizePlainTextDefinition","normalizeTextDefinition","on","normalizeListeners","normalizeAttributes","a","arrayify","listeners","l","obj","cur","extendObjectValueArray","ext","childDef"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/template\n */\n\n/* global document */\n\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport View from './view';\nimport ViewCollection from './viewcollection';\nimport isNode from '@ckeditor/ckeditor5-utils/src/dom/isnode';\nimport { isObject, cloneDeepWith } from 'lodash-es';\n\nconst xhtmlNs = 'http://www.w3.org/1999/xhtml';\n\n/**\n * A basic Template class. It renders a DOM HTML element or text from a\n * {@link module:ui/template~TemplateDefinition definition} and supports element attributes, children,\n * bindings to {@link module:utils/observablemixin~Observable observables} and DOM event propagation.\n *\n * A simple template can look like this:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\tclass: 'foo',\n *\t\t\t\tstyle: {\n *\t\t\t\t\tbackgroundColor: 'yellow'\n *\t\t\t\t}\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t'A paragraph.'\n *\t\t\t]\n *\t\t} ).render();\n *\n * and it will render the following HTML element:\n *\n *\t\t<p class=\"foo\" style=\"background-color: yellow;\">A paragraph.</p>\n *\n * Additionally, the `observable` will always fire `clicked` upon clicking `<p>` in the DOM.\n *\n * See {@link module:ui/template~TemplateDefinition} to know more about templates and complex\n * template definitions.\n *\n* @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Template {\n\t/**\n\t * Creates an instance of the {@link ~Template} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the template.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, normalize( clone( def ) ) );\n\n\t\t/**\n\t\t * Indicates whether this particular Template instance has been\n\t\t * {@link #render rendered}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._isRendered = false;\n\n\t\t/**\n\t\t * The tag (`tagName`) of this template, e.g. `div`. It also indicates that the template\n\t\t * renders to an HTML element.\n\t\t *\n\t\t * @member {String} #tag\n\t\t */\n\n\t\t/**\n\t\t * The text of the template. It also indicates that the template renders to a DOM text node.\n\t\t *\n\t\t * @member {Array.<String|module:ui/template~TemplateValueSchema>} #text\n\t\t */\n\n\t\t/**\n\t\t * The attributes of the template, e.g. `{ id: [ 'ck-id' ] }`, corresponding with\n\t\t * the attributes of an HTML element.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Object} #attributes\n\t\t */\n\n\t\t/**\n\t\t * The children of the template. They can be either:\n\t\t * * independent instances of {@link ~Template} (subtemplates),\n\t\t * * native DOM Nodes.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Array.<module:ui/template~Template|Node>} #children\n\t\t */\n\n\t\t/**\n\t\t * The DOM event listeners of the template.\n\t\t *\n\t\t * @member {Object} #eventListeners\n\t\t */\n\n\t\t/**\n\t\t * The data used by the {@link #revert} method to restore a node to its original state.\n\t\t *\n\t\t * See: {@link #apply}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {module:ui/template~RenderData}\n\t\t */\n\t\tthis._revertData = null;\n\t}\n\n\t/**\n\t * Renders a DOM Node (an HTML element or text) out of the template.\n\t *\n\t *\t\tconst domNode = new Template( { ... } ).render();\n\t *\n\t * See: {@link #apply}.\n\t *\n\t * @returns {HTMLElement|Text}\n\t */\n\trender() {\n\t\tconst node = this._renderNode( {\n\t\t\tintoFragment: true\n\t\t} );\n\n\t\tthis._isRendered = true;\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Applies the template to an existing DOM Node, either HTML element or text.\n\t *\n\t * **Note:** No new DOM nodes will be created. Applying extends:\n\t *\n\t * {@link module:ui/template~TemplateDefinition attributes},\n\t * {@link module:ui/template~TemplateDefinition event listeners}, and\n\t * `textContent` of {@link module:ui/template~TemplateDefinition children} only.\n\t *\n\t * **Note:** Existing `class` and `style` attributes are extended when a template\n\t * is applied to an HTML element, while other attributes and `textContent` are overridden.\n\t *\n\t * **Note:** The process of applying a template can be easily reverted using the\n\t * {@link module:ui/template~Template#revert} method.\n\t *\n\t *\t\tconst element = document.createElement( 'div' );\n\t *\t\tconst observable = new Model( { divClass: 'my-div' } );\n\t *\t\tconst emitter = Object.create( EmitterMixin );\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tid: 'first-div',\n\t *\t\t\t\tclass: bind.to( 'divClass' )\n\t *\t\t\t},\n\t *\t\t\ton: {\n\t *\t\t\t\tclick: bind( 'elementClicked' ) // Will be fired by the observable.\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t'Div text.'\n\t *\t\t\t]\n\t *\t\t} ).apply( element );\n\t *\n\t *\t\tconsole.log( element.outerHTML ); // -> '<div id=\"first-div\" class=\"my-div\"></div>'\n\t *\n\t * @see module:ui/template~Template#render\n\t * @see module:ui/template~Template#revert\n\t * @param {Node} node Root node for the template to apply.\n\t */\n\tapply( node ) {\n\t\tthis._revertData = getEmptyRevertData();\n\n\t\tthis._renderNode( {\n\t\t\tnode,\n\t\t\tisApplying: true,\n\t\t\trevertData: this._revertData\n\t\t} );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Reverts a template {@link module:ui/template~Template#apply applied} to a DOM node.\n\t *\n\t * @param {Node} node The root node for the template to revert. In most of the cases, it is the\n\t * same node used by {@link module:ui/template~Template#apply}.\n\t */\n\trevert( node ) {\n\t\tif ( !this._revertData ) {\n\t\t\t/**\n\t\t\t * Attempting to revert a template which has not been applied yet.\n\t\t\t *\n\t\t\t * @error ui-template-revert-not-applied\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-revert-not-applied: Attempting to revert a template which has not been applied yet.',\n\t\t\t\t[ this, node ]\n\t\t\t);\n\t\t}\n\n\t\tthis._revertTemplateFromNode( node, this._revertData );\n\t}\n\n\t/**\n\t * Returns an iterator which traverses the template in search of {@link module:ui/view~View}\n\t * instances and returns them one by one.\n\t *\n\t *\t\tconst viewFoo = new View();\n\t *\t\tconst viewBar = new View();\n\t *\t\tconst viewBaz = new View();\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'div',\n\t *\t\t\tchildren: [\n\t *\t\t\t\tviewFoo,\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'div',\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\tviewBar\n\t *\t\t\t\t\t]\n\t *\t\t\t\t},\n\t *\t\t\t\tviewBaz\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Logs: viewFoo, viewBar, viewBaz\n\t *\t\tfor ( const view of template.getViews() ) {\n\t *\t\t\tconsole.log( view );\n\t *\t\t}\n\t *\n\t * @returns {Iterable.<module:ui/view~View>}\n\t */\n\t* getViews() {\n\t\tfunction* search( def ) {\n\t\t\tif ( def.children ) {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isView( child ) ) {\n\t\t\t\t\t\tyield child;\n\t\t\t\t\t} else if ( isTemplate( child ) ) {\n\t\t\t\t\t\tyield* search( child );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tyield* search( this );\n\t}\n\n\t/**\n\t * An entry point to the interface which binds DOM nodes to\n\t * {@link module:utils/observablemixin~Observable observables}.\n\t * There are two types of bindings:\n\t *\n\t * * HTML element attributes or text `textContent` synchronized with attributes of an\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}\n\t * and {@link module:ui/template~BindChain#if}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\t// Binds the element \"class\" attribute to observable#classAttribute.\n\t *\t\t\t\tclass: bind.to( 'classAttribute' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * * DOM events fired on HTML element propagated through\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\ton: {\n\t *\t\t\t\t// Will be fired by the observable.\n\t *\t\t\t\tclick: bind( 'elementClicked' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * Also see {@link module:ui/view~View#bindTemplate}.\n\t *\n\t * @param {module:utils/observablemixin~Observable} observable An observable which provides boundable attributes.\n\t * @param {module:utils/emittermixin~Emitter} emitter An emitter that listens to observable attribute\n\t * changes or DOM Events (depending on the kind of the binding). Usually, a {@link module:ui/view~View} instance.\n\t * @returns {module:ui/template~BindChain}\n\t */\n\tstatic bind( observable, emitter ) {\n\t\treturn {\n\t\t\tto( eventNameOrFunctionOrAttribute, callback ) {\n\t\t\t\treturn new TemplateToBinding( {\n\t\t\t\t\teventNameOrFunction: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tattribute: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tobservable, emitter, callback\n\t\t\t\t} );\n\t\t\t},\n\n\t\t\tif( attribute, valueIfTrue, callback ) {\n\t\t\t\treturn new TemplateIfBinding( {\n\t\t\t\t\tobservable, emitter, attribute, valueIfTrue, callback\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Extends an existing {@link module:ui/template~Template} instance with some additional content\n\t * from another {@link module:ui/template~TemplateDefinition}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'p',\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'a',\n\t *\t\t\t\tdata-x: bind.to( 'foo' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'span',\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'b'\n\t *\t\t\t\t\t},\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\t'Span'\n\t *\t\t\t\t\t]\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t } );\n\t *\n\t *\t\t// Instance-level extension.\n\t *\t\tTemplate.extend( template, {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'b',\n\t *\t\t\t\tdata-x: bind.to( 'bar' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'c'\n\t *\t\t\t\t\t}\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Child extension.\n\t *\t\tTemplate.extend( template.children[ 0 ], {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'd'\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * the `outerHTML` of `template.render()` is:\n\t *\n\t *\t\t<p class=\"a b\" data-x=\"{ observable.foo } { observable.bar }\">\n\t *\t\t\t<span class=\"b c d\">Span</span>\n\t *\t\t</p>\n\t *\n\t * @param {module:ui/template~Template} template An existing template instance to be extended.\n\t * @param {module:ui/template~TemplateDefinition} def Additional definition to be applied to a template.\n\t */\n\tstatic extend( template, def ) {\n\t\tif ( template._isRendered ) {\n\t\t\t/**\n\t\t\t * Extending a template after rendering may not work as expected. To make sure\n\t\t\t * the {@link module:ui/template~Template.extend extending} works for an element,\n\t\t\t * make sure it happens before {@link #render} is called.\n\t\t\t *\n\t\t\t * @error template-extend-render\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'template-extend-render: Attempting to extend a template which has already been rendered.',\n\t\t\t\t[ this, template ]\n\t\t\t);\n\t\t}\n\n\t\textendTemplate( template, normalize( clone( def ) ) );\n\t}\n\n\t/**\n\t * Renders a DOM Node (either an HTML element or text) out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderNode( data ) {\n\t\tlet isInvalid;\n\n\t\tif ( data.node ) {\n\t\t\t// When applying, a definition cannot have \"tag\" and \"text\" at the same time.\n\t\t\tisInvalid = this.tag && this.text;\n\t\t} else {\n\t\t\t// When rendering, a definition must have either \"tag\" or \"text\": XOR( this.tag, this.text ).\n\t\t\tisInvalid = this.tag ? this.text : !this.text;\n\t\t}\n\n\t\tif ( isInvalid ) {\n\t\t\t/**\n\t\t\t * Node definition cannot have the \"tag\" and \"text\" properties at the same time.\n\t\t\t * Node definition must have either \"tag\" or \"text\" when rendering a new Node.\n\t\t\t *\n\t\t\t * @error ui-template-wrong-syntax\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-wrong-syntax: Node definition must have either \"tag\" or \"text\" when rendering a new Node.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tif ( this.text ) {\n\t\t\treturn this._renderText( data );\n\t\t} else {\n\t\t\treturn this._renderElement( data );\n\t\t}\n\t}\n\n\t/**\n\t * Renders an HTML element out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElement( data ) {\n\t\tlet node = data.node;\n\n\t\tif ( !node ) {\n\t\t\tnode = data.node = document.createElementNS( this.ns || xhtmlNs, this.tag );\n\t\t}\n\n\t\tthis._renderAttributes( data );\n\t\tthis._renderElementChildren( data );\n\t\tthis._setUpListeners( data );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders a text node out of {@link module:ui/template~Template#text}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderText( data ) {\n\t\tlet node = data.node;\n\n\t\t// Save the original textContent to revert it in #revert().\n\t\tif ( node ) {\n\t\t\tdata.revertData.text = node.textContent;\n\t\t} else {\n\t\t\tnode = data.node = document.createTextNode( '' );\n\t\t}\n\n\t\t// Check if this Text Node is bound to Observable. Cases:\n\t\t//\n\t\t//\t\ttext: [ Template.bind( ... ).to( ... ) ]\n\t\t//\n\t\t//\t\ttext: [\n\t\t//\t\t\t'foo',\n\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t//\t\t\t...\n\t\t//\t\t]\n\t\t//\n\t\tif ( hasTemplateBinding( this.text ) ) {\n\t\t\tthis._bindToObservable( {\n\t\t\t\tschema: this.text,\n\t\t\t\tupdater: getTextUpdater( node ),\n\t\t\t\tdata\n\t\t\t} );\n\t\t}\n\t\t// Simply set text. Cases:\n\t\t//\n\t\t//\t\ttext: [ 'all', 'are', 'static' ]\n\t\t//\n\t\t//\t\ttext: [ 'foo' ]\n\t\t//\n\t\telse {\n\t\t\tnode.textContent = this.text.join( '' );\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders HTML element attributes out of {@link module:ui/template~Template#attributes}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderAttributes( data ) {\n\t\tlet attrName, attrValue, domAttrValue, attrNs;\n\n\t\tif ( !this.attributes ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst node = data.node;\n\t\tconst revertData = data.revertData;\n\n\t\tfor ( attrName in this.attributes ) {\n\t\t\t// Current attribute value in DOM.\n\t\t\tdomAttrValue = node.getAttribute( attrName );\n\n\t\t\t// The value to be set.\n\t\t\tattrValue = this.attributes[ attrName ];\n\n\t\t\t// Save revert data.\n\t\t\tif ( revertData ) {\n\t\t\t\trevertData.attributes[ attrName ] = domAttrValue;\n\t\t\t}\n\n\t\t\t// Detect custom namespace:\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tattrNs = ( isObject( attrValue[ 0 ] ) && attrValue[ 0 ].ns ) ? attrValue[ 0 ].ns : null;\n\n\t\t\t// Activate binding if one is found. Cases:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'bar',\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t\t//\t\t\t'baz'\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( attrValue ) ) {\n\t\t\t\t// Normalize attributes with additional data like namespace:\n\t\t\t\t//\n\t\t\t\t//\t\tclass: {\n\t\t\t\t//\t\t\tns: 'abc',\n\t\t\t\t//\t\t\tvalue: [ ... ]\n\t\t\t\t//\t\t}\n\t\t\t\t//\n\t\t\t\tconst valueToBind = attrNs ? attrValue[ 0 ].value : attrValue;\n\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && shouldExtend( attrName ) ) {\n\t\t\t\t\tvalueToBind.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: valueToBind,\n\t\t\t\t\tupdater: getAttributeUpdater( node, attrName, attrNs ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Style attribute could be an Object so it needs to be parsed in a specific way.\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\twidth: '100px',\n\t\t\t//\t\t\theight: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse if ( attrName == 'style' && typeof attrValue[ 0 ] !== 'string' ) {\n\t\t\t\tthis._renderStyleAttribute( attrValue[ 0 ], data );\n\t\t\t}\n\n\t\t\t// Otherwise simply set the static attribute:\n\t\t\t//\n\t\t\t//\t\tclass: [ 'foo' ]\n\t\t\t//\n\t\t\t//\t\tclass: [ 'all', 'are', 'static' ]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t{\n\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t//\t\t\t\tvalue: [ 'foo' ]\n\t\t\t//\t\t\t}\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\telse {\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && domAttrValue && shouldExtend( attrName ) ) {\n\t\t\t\t\tattrValue.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tattrValue = attrValue\n\t\t\t\t\t// Retrieve \"values\" from:\n\t\t\t\t\t//\n\t\t\t\t\t//\t\tclass: [\n\t\t\t\t\t//\t\t\t{\n\t\t\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t\t\t//\t\t\t\tvalue: [ ... ]\n\t\t\t\t\t//\t\t\t}\n\t\t\t\t\t//\t\t]\n\t\t\t\t\t//\n\t\t\t\t\t.map( val => val ? ( val.value || val ) : val )\n\t\t\t\t\t// Flatten the array.\n\t\t\t\t\t.reduce( ( prev, next ) => prev.concat( next ), [] )\n\t\t\t\t\t// Convert into string.\n\t\t\t\t\t.reduce( arrayValueReducer, '' );\n\n\t\t\t\tif ( !isFalsy( attrValue ) ) {\n\t\t\t\t\tnode.setAttributeNS( attrNs, attrName, attrValue );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Renders the `style` attribute of an HTML element based on\n\t * {@link module:ui/template~Template#attributes}.\n\t *\n\t * A style attribute is an {Object} with static values:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: 'red'\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * or values bound to {@link module:ui/model~Model} properties:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: bind.to( ... )\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * Note: The `style` attribute is rendered without setting the namespace. It does not seem to be\n\t * needed.\n\t *\n\t * @private\n\t * @param {Object} styles Styles located in `attributes.style` of {@link module:ui/template~TemplateDefinition}.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderStyleAttribute( styles, data ) {\n\t\tconst node = data.node;\n\n\t\tfor ( const styleName in styles ) {\n\t\t\tconst styleValue = styles[ styleName ];\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: bind.to( 'attribute' )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( styleValue ) ) {\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: [ styleValue ],\n\t\t\t\t\tupdater: getStyleUpdater( node, styleName ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: 'red'\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse {\n\t\t\t\tnode.style[ styleName ] = styleValue;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Recursively renders HTML element's children from {@link module:ui/template~Template#children}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElementChildren( data ) {\n\t\tconst node = data.node;\n\t\tconst container = data.intoFragment ? document.createDocumentFragment() : node;\n\t\tconst isApplying = data.isApplying;\n\t\tlet childIndex = 0;\n\n\t\tfor ( const child of this.children ) {\n\t\t\tif ( isViewCollection( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tchild.setParent( node );\n\n\t\t\t\t\t// Note: ViewCollection renders its children.\n\t\t\t\t\tfor ( const view of child ) {\n\t\t\t\t\t\tcontainer.appendChild( view.element );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if ( isView( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tif ( !child.isRendered ) {\n\t\t\t\t\t\tchild.render();\n\t\t\t\t\t}\n\n\t\t\t\t\tcontainer.appendChild( child.element );\n\t\t\t\t}\n\t\t\t} else if ( isNode( child ) ) {\n\t\t\t\tcontainer.appendChild( child );\n\t\t\t} else {\n\t\t\t\tif ( isApplying ) {\n\t\t\t\t\tconst revertData = data.revertData;\n\t\t\t\t\tconst childRevertData = getEmptyRevertData();\n\n\t\t\t\t\trevertData.children.push( childRevertData );\n\n\t\t\t\t\tchild._renderNode( {\n\t\t\t\t\t\tnode: container.childNodes[ childIndex++ ],\n\t\t\t\t\t\tisApplying: true,\n\t\t\t\t\t\trevertData: childRevertData\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.appendChild( child.render() );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( data.intoFragment ) {\n\t\t\tnode.appendChild( container );\n\t\t}\n\t}\n\n\t/**\n\t * Activates `on` event listeners from the {@link module:ui/template~TemplateDefinition}\n\t * on an HTML element.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_setUpListeners( data ) {\n\t\tif ( !this.eventListeners ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const key in this.eventListeners ) {\n\t\t\tconst revertBindings = this.eventListeners[ key ].map( schemaItem => {\n\t\t\t\tconst [ domEvtName, domSelector ] = key.split( '@' );\n\n\t\t\t\treturn schemaItem.activateDomEventListener( domEvtName, domSelector, data );\n\t\t\t} );\n\n\t\t\tif ( data.revertData ) {\n\t\t\t\tdata.revertData.bindings.push( revertBindings );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * For a given {@link module:ui/template~TemplateValueSchema} containing {@link module:ui/template~TemplateBinding}\n\t * activates the binding and sets its initial value.\n\t *\n\t * Note: {@link module:ui/template~TemplateValueSchema} can be for HTML element attributes or\n\t * text node `textContent`.\n\t *\n\t * @protected\n\t * @param {Object} options Binding options.\n\t * @param {module:ui/template~TemplateValueSchema} options.schema\n\t * @param {Function} options.updater A function which updates the DOM (like attribute or text).\n\t * @param {module:ui/template~RenderData} options.data Rendering data.\n\t */\n\t_bindToObservable( { schema, updater, data } ) {\n\t\tconst revertData = data.revertData;\n\n\t\t// Set initial values.\n\t\tsyncValueSchemaValue( schema, updater, data );\n\n\t\tconst revertBindings = schema\n\t\t\t// Filter \"falsy\" (false, undefined, null, '') value schema components out.\n\t\t\t.filter( item => !isFalsy( item ) )\n\t\t\t// Filter inactive bindings from schema, like static strings ('foo'), numbers (42), etc.\n\t\t\t.filter( item => item.observable )\n\t\t\t// Once only the actual binding are left, let the emitter listen to observable change:attribute event.\n\t\t\t// TODO: Reduce the number of listeners attached as many bindings may listen\n\t\t\t// to the same observable attribute.\n\t\t\t.map( templateBinding => templateBinding.activateAttributeListener( schema, updater, data ) );\n\n\t\tif ( revertData ) {\n\t\t\trevertData.bindings.push( revertBindings );\n\t\t}\n\t}\n\n\t/**\n\t * Reverts {@link module:ui/template~RenderData#revertData template data} from a node to\n\t * return it to the original state.\n\t *\n\t * @protected\n\t * @param {HTMLElement|Text} node A node to be reverted.\n\t * @param {Object} revertData An object that stores information about what changes have been made by\n\t * {@link #apply} to the node. See {@link module:ui/template~RenderData#revertData} for more information.\n\t */\n\t_revertTemplateFromNode( node, revertData ) {\n\t\tfor ( const binding of revertData.bindings ) {\n\t\t\t// Each binding may consist of several observable+observable#attribute.\n\t\t\t// like the following has 2:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'x',\n\t\t\t//\t\t\tbind.to( 'foo' ),\n\t\t\t//\t\t\t'y',\n\t\t\t//\t\t\tbind.to( 'bar' )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\tfor ( const revertBinding of binding ) {\n\t\t\t\trevertBinding();\n\t\t\t}\n\t\t}\n\n\t\tif ( revertData.text ) {\n\t\t\tnode.textContent = revertData.text;\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const attrName in revertData.attributes ) {\n\t\t\tconst attrValue = revertData.attributes[ attrName ];\n\n\t\t\t// When the attribute has **not** been set before #apply().\n\t\t\tif ( attrValue === null ) {\n\t\t\t\tnode.removeAttribute( attrName );\n\t\t\t} else {\n\t\t\t\tnode.setAttribute( attrName, attrValue );\n\t\t\t}\n\t\t}\n\n\t\tfor ( let i = 0; i < revertData.children.length; ++i ) {\n\t\t\tthis._revertTemplateFromNode( node.childNodes[ i ], revertData.children[ i ] );\n\t\t}\n\t}\n}\n\nmix( Template, EmitterMixin );\n\n/**\n * Describes a binding created by the {@link module:ui/template~Template.bind} interface.\n *\n * @protected\n */\nexport class TemplateBinding {\n\t/**\n\t * Creates an instance of the {@link module:ui/template~TemplateBinding} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the binding.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, def );\n\n\t\t/**\n\t\t * An observable instance of the binding. It either:\n\t\t *\n\t\t * * provides the attribute with the value,\n\t\t * * or passes the event when a corresponding DOM event is fired.\n\t\t *\n\t\t * @member {module:utils/observablemixin~ObservableMixin} module:ui/template~TemplateBinding#observable\n\t\t */\n\n\t\t/**\n\t\t * An {@link module:utils/emittermixin~Emitter} used by the binding to:\n\t\t *\n\t\t * * listen to the attribute change in the {@link module:ui/template~TemplateBinding#observable},\n\t\t * * or listen to the event in the DOM.\n\t\t *\n\t\t * @member {module:utils/emittermixin~EmitterMixin} module:ui/template~TemplateBinding#emitter\n\t\t */\n\n\t\t/**\n\t\t * The name of the {@link module:ui/template~TemplateBinding#observable observed attribute}.\n\t\t *\n\t\t * @member {String} module:ui/template~TemplateBinding#attribute\n\t\t */\n\n\t\t/**\n\t\t * A custom function to process the value of the {@link module:ui/template~TemplateBinding#attribute}.\n\t\t *\n\t\t * @member {Function} [module:ui/template~TemplateBinding#callback]\n\t\t */\n\t}\n\n\t/**\n\t * Returns the value of the binding. It is the value of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}. The value may be processed by the\n\t * {@link module:ui/template~TemplateBinding#callback}, if such has been passed to the binding.\n\t *\n\t * @param {Node} [node] A native DOM node, passed to the custom {@link module:ui/template~TemplateBinding#callback}.\n\t * @returns {*} The value of {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}.\n\t */\n\tgetValue( node ) {\n\t\tconst value = this.observable[ this.attribute ];\n\n\t\treturn this.callback ? this.callback( value, node ) : value;\n\t}\n\n\t/**\n\t * Activates the listener which waits for changes of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}, then updates the DOM with the aggregated\n\t * value of {@link module:ui/template~TemplateValueSchema}.\n\t *\n\t * @param {module:ui/template~TemplateValueSchema} schema A full schema to generate an attribute or text in the DOM.\n\t * @param {Function} updater A DOM updater function used to update the native DOM attribute or text.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateAttributeListener( schema, updater, data ) {\n\t\tconst callback = () => syncValueSchemaValue( schema, updater, data );\n\n\t\tthis.emitter.listenTo( this.observable, 'change:' + this.attribute, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( this.observable, 'change:' + this.attribute, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes either:\n *\n * * a binding to an {@link module:utils/observablemixin~Observable},\n * * or a native DOM event binding.\n *\n * It is created by the {@link module:ui/template~BindChain#to} method.\n *\n * @protected\n */\nexport class TemplateToBinding extends TemplateBinding {\n\t/**\n\t * Activates the listener for the native DOM event, which when fired, is propagated by\n\t * the {@link module:ui/template~TemplateBinding#emitter}.\n\t *\n\t * @param {String} domEvtName The name of the native DOM event.\n\t * @param {String} domSelector The selector in the DOM to filter delegated events.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateDomEventListener( domEvtName, domSelector, data ) {\n\t\tconst callback = ( evt, domEvt ) => {\n\t\t\tif ( !domSelector || domEvt.target.matches( domSelector ) ) {\n\t\t\t\tif ( typeof this.eventNameOrFunction == 'function' ) {\n\t\t\t\t\tthis.eventNameOrFunction( domEvt );\n\t\t\t\t} else {\n\t\t\t\t\tthis.observable.fire( this.eventNameOrFunction, domEvt );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.emitter.listenTo( data.node, domEvtName, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( data.node, domEvtName, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes a binding to {@link module:utils/observablemixin~ObservableMixin} created by the {@link module:ui/template~BindChain#if}\n * method.\n *\n * @protected\n */\nexport class TemplateIfBinding extends TemplateBinding {\n\t/**\n\t * @inheritDoc\n\t */\n\tgetValue( node ) {\n\t\tconst value = super.getValue( node );\n\n\t\treturn isFalsy( value ) ? false : ( this.valueIfTrue || true );\n\t}\n\n\t/**\n\t * The value of the DOM attribute or text to be set if the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable} is `true`.\n\t *\n\t * @member {String} [module:ui/template~TemplateIfBinding#valueIfTrue]\n\t */\n}\n\n// Checks whether given {@link module:ui/template~TemplateValueSchema} contains a\n// {@link module:ui/template~TemplateBinding}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @returns {Boolean}\nfunction hasTemplateBinding( schema ) {\n\tif ( !schema ) {\n\t\treturn false;\n\t}\n\n\t// Normalize attributes with additional data like namespace:\n\t//\n\t//\t\tclass: {\n\t//\t\t\tns: 'abc',\n\t//\t\t\tvalue: [ ... ]\n\t//\t\t}\n\t//\n\tif ( schema.value ) {\n\t\tschema = schema.value;\n\t}\n\n\tif ( Array.isArray( schema ) ) {\n\t\treturn schema.some( hasTemplateBinding );\n\t} else if ( schema instanceof TemplateBinding ) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n// Assembles the value using {@link module:ui/template~TemplateValueSchema} and stores it in a form of\n// an Array. Each entry of the Array corresponds to one of {@link module:ui/template~TemplateValueSchema}\n// items.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\n// @returns {Array}\nfunction getValueSchemaValue( schema, node ) {\n\treturn schema.map( schemaItem => {\n\t\t// Process {@link module:ui/template~TemplateBinding} bindings.\n\t\tif ( schemaItem instanceof TemplateBinding ) {\n\t\t\treturn schemaItem.getValue( node );\n\t\t}\n\n\t\t// All static values like strings, numbers, and \"falsy\" values (false, null, undefined, '', etc.) just pass.\n\t\treturn schemaItem;\n\t} );\n}\n\n// A function executed each time the bound Observable attribute changes, which updates the DOM with a value\n// constructed from {@link module:ui/template~TemplateValueSchema}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Function} updater A function which updates the DOM (like attribute or text).\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\nfunction syncValueSchemaValue( schema, updater, { node } ) {\n\tlet value = getValueSchemaValue( schema, node );\n\n\t// Check if schema is a single Template.bind.if, like:\n\t//\n\t//\t\tclass: Template.bind.if( 'foo' )\n\t//\n\tif ( schema.length == 1 && schema[ 0 ] instanceof TemplateIfBinding ) {\n\t\tvalue = value[ 0 ];\n\t} else {\n\t\tvalue = value.reduce( arrayValueReducer, '' );\n\t}\n\n\tif ( isFalsy( value ) ) {\n\t\tupdater.remove();\n\t} else {\n\t\tupdater.set( value );\n\t}\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset `textContent`.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @returns {Object}\nfunction getTextUpdater( node ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tnode.textContent = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tnode.textContent = '';\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset an attribute.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} attrName Name of the attribute to be modified.\n// @param {String} [ns=null] Namespace to use.\n// @returns {Object}\nfunction getAttributeUpdater( el, attrName, ns ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.setAttributeNS( ns, attrName, value );\n\t\t},\n\n\t\tremove() {\n\t\t\tel.removeAttributeNS( ns, attrName );\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of CSSStyleDeclaration to set or remove a style.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} styleName Name of the style to be modified.\n// @returns {Object}\nfunction getStyleUpdater( el, styleName ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.style[ styleName ] = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tel.style[ styleName ] = null;\n\t\t}\n\t};\n}\n\n// Clones definition of the template.\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition}\nfunction clone( def ) {\n\tconst clone = cloneDeepWith( def, value => {\n\t\t// Don't clone the `Template.bind`* bindings because of the references to Observable\n\t\t// and DomEmitterMixin instances inside, which would also be traversed and cloned by greedy\n\t\t// cloneDeepWith algorithm. There's no point in cloning Observable/DomEmitterMixins\n\t\t// along with the definition.\n\t\t//\n\t\t// Don't clone Template instances if provided as a child. They're simply #render()ed\n\t\t// and nothing should interfere.\n\t\t//\n\t\t// Also don't clone View instances if provided as a child of the Template. The template\n\t\t// instance will be extracted from the View during the normalization and there's no need\n\t\t// to clone it.\n\t\tif ( value && ( value instanceof TemplateBinding || isTemplate( value ) || isView( value ) || isViewCollection( value ) ) ) {\n\t\t\treturn value;\n\t\t}\n\t} );\n\n\treturn clone;\n}\n\n// Normalizes given {@link module:ui/template~TemplateDefinition}.\n//\n// See:\n//  * {@link normalizeAttributes}\n//  * {@link normalizeListeners}\n//  * {@link normalizePlainTextDefinition}\n//  * {@link normalizeTextDefinition}\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition} Normalized definition.\nfunction normalize( def ) {\n\tif ( typeof def == 'string' ) {\n\t\tdef = normalizePlainTextDefinition( def );\n\t} else if ( def.text ) {\n\t\tnormalizeTextDefinition( def );\n\t}\n\n\tif ( def.on ) {\n\t\tdef.eventListeners = normalizeListeners( def.on );\n\n\t\t// Template mixes EmitterMixin, so delete #on to avoid collision.\n\t\tdelete def.on;\n\t}\n\n\tif ( !def.text ) {\n\t\tif ( def.attributes ) {\n\t\t\tnormalizeAttributes( def.attributes );\n\t\t}\n\n\t\tconst children = [];\n\n\t\tif ( def.children ) {\n\t\t\tif ( isViewCollection( def.children ) ) {\n\t\t\t\tchildren.push( def.children );\n\t\t\t} else {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isTemplate( child ) || isView( child ) || isNode( child ) ) {\n\t\t\t\t\t\tchildren.push( child );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren.push( new Template( child ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdef.children = children;\n\t}\n\n\treturn def;\n}\n\n// Normalizes \"attributes\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tattributes: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: {\n//\t\t\t\tvalue: 'bar'\n//\t\t\t}\n//\t\t}\n//\n// becomes\n//\n//\t\tattributes: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: {\n//\t\t\t\tvalue: [ 'bar' ]\n//\t\t\t}\n//\t\t}\n//\n// @param {Object} attributes\nfunction normalizeAttributes( attributes ) {\n\tfor ( const a in attributes ) {\n\t\tif ( attributes[ a ].value ) {\n\t\t\tattributes[ a ].value = [].concat( attributes[ a ].value );\n\t\t}\n\n\t\tarrayify( attributes, a );\n\t}\n}\n\n// Normalizes \"on\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\ton: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// becomes\n//\n//\t\ton: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// @param {Object} listeners\n// @returns {Object} Object containing normalized listeners.\nfunction normalizeListeners( listeners ) {\n\tfor ( const l in listeners ) {\n\t\tarrayify( listeners, l );\n\t}\n\n\treturn listeners;\n}\n\n// Normalizes \"string\" {@link module:ui/template~TemplateDefinition}.\n//\n//\t\t\"foo\"\n//\n// becomes\n//\n//\t\t{ text: [ 'foo' ] },\n//\n// @param {String} def\n// @returns {module:ui/template~TemplateDefinition} Normalized template definition.\nfunction normalizePlainTextDefinition( def ) {\n\treturn {\n\t\ttext: [ def ]\n\t};\n}\n\n// Normalizes text {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tchildren: [\n//\t\t\t{ text: 'def' },\n//\t\t\t{ text: {@link module:ui/template~TemplateBinding} }\n//\t\t]\n//\n// becomes\n//\n//\t\tchildren: [\n//\t\t\t{ text: [ 'def' ] },\n//\t\t\t{ text: [ {@link module:ui/template~TemplateBinding} ] }\n//\t\t]\n//\n// @param {module:ui/template~TemplateDefinition} def\nfunction normalizeTextDefinition( def ) {\n\tif ( !Array.isArray( def.text ) ) {\n\t\tdef.text = [ def.text ];\n\t}\n}\n\n// Wraps an entry in Object in an Array, if not already one.\n//\n//\t\t{\n//\t\t\tx: 'y',\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// becomes\n//\n//\t\t{\n//\t\t\tx: [ 'y' ],\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// @param {Object} obj\n// @param {String} key\nfunction arrayify( obj, key ) {\n\tif ( !Array.isArray( obj[ key ] ) ) {\n\t\tobj[ key ] = [ obj[ key ] ];\n\t}\n}\n\n// A helper which concatenates the value avoiding unwanted\n// leading white spaces.\n//\n// @param {String} prev\n// @param {String} cur\n// @returns {String}\nfunction arrayValueReducer( prev, cur ) {\n\tif ( isFalsy( cur ) ) {\n\t\treturn prev;\n\t} else if ( isFalsy( prev ) ) {\n\t\treturn cur;\n\t} else {\n\t\treturn `${ prev } ${ cur }`;\n\t}\n}\n\n// Extends one object defined in the following format:\n//\n//\t\t{\n//\t\t\tkey1: [Array1],\n//\t\t\tkey2: [Array2],\n//\t\t\t...\n//\t\t\tkeyN: [ArrayN]\n//\t\t}\n//\n// with another object of the same data format.\n//\n// @param {Object} obj Base object.\n// @param {Object} ext Object extending base.\n// @returns {String}\nfunction extendObjectValueArray( obj, ext ) {\n\tfor ( const a in ext ) {\n\t\tif ( obj[ a ] ) {\n\t\t\tobj[ a ].push( ...ext[ a ] );\n\t\t} else {\n\t\t\tobj[ a ] = ext[ a ];\n\t\t}\n\t}\n}\n\n// A helper for {@link module:ui/template~Template#extend}. Recursively extends {@link module:ui/template~Template} instance\n// with content from {@link module:ui/template~TemplateDefinition}. See {@link module:ui/template~Template#extend} to learn more.\n//\n// @param {module:ui/template~Template} def A template instance to be extended.\n// @param {module:ui/template~TemplateDefinition} def A definition which is to extend the template instance.\n// @param {Object} Error context.\nfunction extendTemplate( template, def ) {\n\tif ( def.attributes ) {\n\t\tif ( !template.attributes ) {\n\t\t\ttemplate.attributes = {};\n\t\t}\n\n\t\textendObjectValueArray( template.attributes, def.attributes );\n\t}\n\n\tif ( def.eventListeners ) {\n\t\tif ( !template.eventListeners ) {\n\t\t\ttemplate.eventListeners = {};\n\t\t}\n\n\t\textendObjectValueArray( template.eventListeners, def.eventListeners );\n\t}\n\n\tif ( def.text ) {\n\t\ttemplate.text.push( ...def.text );\n\t}\n\n\tif ( def.children && def.children.length ) {\n\t\tif ( template.children.length != def.children.length ) {\n\t\t\t/**\n\t\t\t * The number of children in extended definition does not match.\n\t\t\t *\n\t\t\t * @error ui-template-extend-children-mismatch\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-extend-children-mismatch: The number of children in extended definition does not match.',\n\t\t\t\ttemplate\n\t\t\t);\n\t\t}\n\n\t\tlet childIndex = 0;\n\n\t\tfor ( const childDef of def.children ) {\n\t\t\textendTemplate( template.children[ childIndex++ ], childDef );\n\t\t}\n\t}\n}\n\n// Checks if value is \"falsy\".\n// Note: 0 (Number) is not \"falsy\" in this context.\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isFalsy( value ) {\n\treturn !value && value !== 0;\n}\n\n// Checks if the item is an instance of {@link module:ui/view~View}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isView( item ) {\n\treturn item instanceof View;\n}\n\n// Checks if the item is an instance of {@link module:ui/template~Template}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isTemplate( item ) {\n\treturn item instanceof Template;\n}\n\n// Checks if the item is an instance of {@link module:ui/viewcollection~ViewCollection}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isViewCollection( item ) {\n\treturn item instanceof ViewCollection;\n}\n\n// Creates an empty skeleton for {@link module:ui/template~Template#revert}\n// data.\n//\n// @private\nfunction getEmptyRevertData() {\n\treturn {\n\t\tchildren: [],\n\t\tbindings: [],\n\t\tattributes: {}\n\t};\n}\n\n// Checks whether an attribute should be extended when\n// {@link module:ui/template~Template#apply} is called.\n//\n// @private\n// @param {String} attrName Attribute name to check.\nfunction shouldExtend( attrName ) {\n\treturn attrName == 'class' || attrName == 'style';\n}\n\n/**\n * A definition of the {@link module:ui/template~Template}. It describes what kind of\n * node a template will render (HTML element or text), attributes of an element, DOM event\n * listeners and children.\n *\n * Also see:\n * * {@link module:ui/template~TemplateValueSchema} to learn about HTML element attributes,\n * * {@link module:ui/template~TemplateListenerSchema} to learn about DOM event listeners.\n *\n * A sample definition on an HTML element can look like this:\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\ttag: 'span',\n *\t\t\t\t\tattributes: { ... },\n *\t\t\t\t\tchildren: [ ... ],\n *\t\t\t\t},\n *\t\t\t\t{\n *\t\t\t\t\ttext: 'statictext'\n *\t\t\t\t},\n *\t\t\t\t'also-statictext',\n *\t\t\t],\n *\t\t\tattributes: {\n *\t\t\t\tclass: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tid: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tstyle: {@link module:ui/template~TemplateValueSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\t'click': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// Document.querySelector format is also accepted.\n *\t\t\t\t'keyup@a.some-class': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t}\n *\t\t} );\n *\n * A {@link module:ui/view~View}, another {@link module:ui/template~Template} or a native DOM node\n * can also become a child of a template. When a view is passed, its {@link module:ui/view~View#element} is used:\n *\n *\t\tconst view = new SomeView();\n *\t\tconst childTemplate = new Template( { ... } );\n *\t\tconst childNode = document.createElement( 'b' );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: [\n *\t\t\t\t// view#element will be added as a child of this <p>.\n *\t\t\t\tview,\n *\n * \t\t\t\t// The output of childTemplate.render() will be added here.\n *\t\t\t\tchildTemplate,\n *\n *\t\t\t\t// Native DOM nodes are included directly in the rendered output.\n *\t\t\t\tchildNode\n *\t\t\t]\n *\t\t} );\n *\n * An entire {@link module:ui/viewcollection~ViewCollection} can be used as a child in the definition:\n *\n *\t\tconst collection = new ViewCollection();\n *\t\tcollection.add( someView );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: collection\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateDefinition\n * @type Object\n *\n * @property {String} tag See the template {@link module:ui/template~Template#tag} property.\n *\n * @property {Array.<module:ui/template~TemplateDefinition>} [children]\n * See the template {@link module:ui/template~Template#children} property.\n *\n * @property {Object.<String, module:ui/template~TemplateValueSchema>} [attributes]\n * See the template {@link module:ui/template~Template#attributes} property.\n *\n * @property {String|module:ui/template~TemplateValueSchema|Array.<String|module:ui/template~TemplateValueSchema>} [text]\n * See the template {@link module:ui/template~Template#text} property.\n *\n * @property {Object.<String, module:ui/template~TemplateListenerSchema>} [on]\n * See the template {@link module:ui/template~Template#eventListeners} property.\n */\n\n/**\n * Describes a value of an HTML element attribute or `textContent`. It allows combining multiple\n * data sources like static values and {@link module:utils/observablemixin~Observable} attributes.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn where to use it,\n * * {@link module:ui/template~Template.bind} to learn how to configure\n * {@link module:utils/observablemixin~Observable} attribute bindings,\n * * {@link module:ui/template~Template#render} to learn how to render a template,\n * * {@link module:ui/template~BindChain#to `to()`} and {@link module:ui/template~BindChain#if `if()`}\n * methods to learn more about bindings.\n *\n * Attribute values can be described in many different ways:\n *\n *\t\t// Bind helper will create bindings to attributes of the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// A plain string schema.\n *\t\t\t\t'class': 'static-text',\n *\n *\t\t\t\t// An object schema, binds to the \"foo\" attribute of the\n *\t\t\t\t// observable and follows its value.\n *\t\t\t\t'class': bind.to( 'foo' ),\n *\n *\t\t\t\t// An array schema, combines the above.\n *\t\t\t\t'class': [\n *\t\t\t\t\t'static-text',\n *\t\t\t\t\tbind.to( 'bar', () => { ... } ),\n *\n * \t\t\t\t\t// Bindings can also be conditional.\n *\t\t\t\t\tbind.if( 'baz', 'class-when-baz-is-true' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema, with a custom namespace, e.g. useful for creating SVGs.\n *\t\t\t\t'class': {\n *\t\t\t\t\tns: 'http://ns.url',\n *\t\t\t\t\tvalue: [\n *\t\t\t\t\t\tbind.if( 'baz', 'value-when-true' ),\n *\t\t\t\t\t\t'static-text'\n *\t\t\t\t\t]\n *\t\t\t\t},\n *\n *\t\t\t\t// An object schema, specific for styles.\n *\t\t\t\tstyle: {\n *\t\t\t\t\tcolor: 'red',\n *\t\t\t\t\tbackgroundColor: bind.to( 'qux', () => { ... } )\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * Text nodes can also have complex values:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\t// Will render a \"foo\" text node.\n *\t\tnew Template( {\n *\t\t\ttext: 'foo'\n *\t\t} );\n *\n *\t\t// Will render a \"static text: {observable.foo}\" text node.\n *\t\t// The text of the node will be updated as the \"foo\" attribute changes.\n *\t\tnew Template( {\n *\t\t\ttext: [\n *\t\t\t\t'static text: ',\n *\t\t\t\tbind.to( 'foo', () => { ... } )\n *\t\t\t]\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateValueSchema\n * @type {Object|String|Array}\n */\n\n/**\n * Describes an event listener attached to an HTML element. Such listener can propagate DOM events\n * through an {@link module:utils/observablemixin~Observable} instance, execute custom callbacks\n * or both, if necessary.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn more about template definitions,\n * * {@link module:ui/template~BindChain#to `to()`} method to learn more about bindings.\n *\n * Check out different ways of attaching event listeners below:\n *\n *\t\t// Bind helper will propagate events through the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\ton: {\n *\t\t\t\t// An object schema. The observable will fire the \"clicked\" event upon DOM \"click\".\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\n *\t\t\t\t// An object schema. It will work for \"click\" event on \"a.foo\" children only.\n *\t\t\t\t'click@a.foo': bind.to( 'clicked' )\n *\n *\t\t\t\t// An array schema, makes the observable propagate multiple events.\n *\t\t\t\tclick: [\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( 'executed' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema with a custom callback.\n *\t\t\t\t'click@a.foo': {\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( evt => {\n *\t\t\t\t\t\tconsole.log( `${ evt.target } has been clicked!` );\n *\t\t\t\t\t} }\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateListenerSchema\n * @type {Object|String|Array}\n */\n\n/**\n * The return value of {@link ~Template.bind `Template.bind()`}. It provides `to()` and `if()`\n * methods to create the {@link module:utils/observablemixin~Observable observable} attribute and event bindings.\n *\n * @interface module:ui/template~BindChain\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to either:\n *\n * * an HTML element attribute or a text node `textContent`, so it remains in sync with the observable\n * attribute as it changes,\n * * or an HTML element DOM event, so the DOM events are propagated through an observable.\n *\n * Some common use cases of `to()` bindings are presented below:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// class=\"...\" attribute gets bound to `observable#a`\n *\t\t\t\tclass: bind.to( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t// <p>...</p> gets bound to observable#b; always `toUpperCase()`.\n *\t\t\t\t{\n *\t\t\t\t\ttext: bind.to( 'b', ( value, node ) => value.toUpperCase() )\n *\t\t\t\t}\n *\t\t\t],\n *\t\t\ton: {\n *\t\t\t\tclick: [\n *\t\t\t\t\t// An observable will fire \"clicked\" upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\n *\t\t\t\t\t// A custom callback will be executed upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( () => {\n *\t\t\t\t\t\t...\n *\t\t\t\t\t} )\n *\t\t\t\t]\n *\t\t\t}\n *\t\t} ).render();\n *\n * Learn more about using `to()` in the {@link module:ui/template~TemplateValueSchema} and\n * {@link module:ui/template~TemplateListenerSchema}.\n *\n * @method #to\n * @param {String|Function} eventNameOrFunctionOrAttribute An attribute name of\n * {@link module:utils/observablemixin~Observable} or a DOM event name or an event callback.\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to an HTML element attribute or a text\n * node `textContent` so it remains in sync with the observable attribute as it changes.\n *\n * Unlike {@link module:ui/template~BindChain#to}, it controls the presence of the attribute or `textContent`\n * depending on the \"falseness\" of an {@link module:utils/observablemixin~Observable} attribute.\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'input',\n *\t\t\tattributes: {\n *\t\t\t\t// <input checked> when `observable#a` is not undefined/null/false/''\n *\t\t\t\t// <input> when `observable#a` is undefined/null/false\n *\t\t\t\tchecked: bind.if( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\t// <input>\"b-is-not-set\"</input> when `observable#b` is undefined/null/false/''\n *\t\t\t\t\t// <input></input> when `observable#b` is not \"falsy\"\n *\t\t\t\t\ttext: bind.if( 'b', 'b-is-not-set', ( value, node ) => !value )\n *\t\t\t\t}\n *\t\t\t]\n *\t\t} ).render();\n *\n * Learn more about using `if()` in the {@link module:ui/template~TemplateValueSchema}.\n *\n * @method #if\n * @param {String} attribute An attribute name of {@link module:utils/observablemixin~Observable} used in the binding.\n * @param {String} [valueIfTrue] Value set when the {@link module:utils/observablemixin~Observable} attribute is not\n * undefined/null/false/'' (empty string).\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * The {@link module:ui/template~Template#_renderNode} configuration.\n *\n * @private\n * @interface module:ui/template~RenderData\n */\n\n/**\n * Tells {@link module:ui/template~Template#_renderNode} to render\n * children into `DocumentFragment` first and then append the fragment\n * to the parent element. It is a speed optimization.\n *\n * @member {Boolean} #intoFragment\n */\n\n/**\n * A node which is being rendered.\n *\n * @member {HTMLElement|Text} #node\n */\n\n/**\n * Indicates whether the {@module:ui/template~RenderNodeOptions#node} has\n * been provided by {@module:ui/template~Template#apply}.\n *\n * @member {Boolean} #isApplying\n */\n\n/**\n * An object storing the data that helps {@module:ui/template~Template#revert}\n * bringing back an element to its initial state, i.e. before\n * {@module:ui/template~Template#apply} was called.\n *\n * @member {Object} #revertData\n */\n"]}]}