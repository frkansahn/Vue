{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-utils\\src\\collection.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-utils\\src\\collection.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLndlYWstbWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjAsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgdXRpbHMvY29sbGVjdGlvbgogKi8KaW1wb3J0IEVtaXR0ZXJNaXhpbiBmcm9tICcuL2VtaXR0ZXJtaXhpbic7CmltcG9ydCBDS0VkaXRvckVycm9yIGZyb20gJy4vY2tlZGl0b3JlcnJvcic7CmltcG9ydCB1aWQgZnJvbSAnLi91aWQnOwppbXBvcnQgbWl4IGZyb20gJy4vbWl4JzsKLyoqCiAqIENvbGxlY3Rpb25zIGFyZSBvcmRlcmVkIHNldHMgb2Ygb2JqZWN0cy4gSXRlbXMgaW4gdGhlIGNvbGxlY3Rpb24gY2FuIGJlIHJldHJpZXZlZCBieSB0aGVpciBpbmRleGVzCiAqIGluIHRoZSBjb2xsZWN0aW9uIChsaWtlIGluIGFuIGFycmF5KSBvciBieSB0aGVpciBpZHMuCiAqCiAqIElmIGFuIG9iamVjdCB3aXRob3V0IGFuIGBpZGAgcHJvcGVydHkgaXMgYmVpbmcgYWRkZWQgdG8gdGhlIGNvbGxlY3Rpb24sIHRoZSBgaWRgIHByb3BlcnR5IHdpbGwgYmUgZ2VuZXJhdGVkCiAqIGF1dG9tYXRpY2FsbHkuIE5vdGUgdGhhdCB0aGUgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgaWQgaXMgdW5pcXVlIG9ubHkgd2l0aGluIHRoaXMgc2luZ2xlIGNvbGxlY3Rpb24gaW5zdGFuY2UuCiAqCiAqIEJ5IGRlZmF1bHQgYW4gaXRlbSBpbiB0aGUgY29sbGVjdGlvbiBpcyBpZGVudGlmaWVkIGJ5IGl0cyBgaWRgIHByb3BlcnR5LiBUaGUgbmFtZSBvZiB0aGUgaWRlbnRpZmllciBjYW4gYmUKICogY29uZmlndXJlZCB0aHJvdWdoIHRoZSBjb25zdHJ1Y3RvciBvZiB0aGUgY29sbGVjdGlvbi4KICoKICogQG1peGVzIG1vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlck1peGluCiAqLwoKdmFyIENvbGxlY3Rpb24gPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2UuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIFRoZSBvcHRpb25zIG9iamVjdC4KICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuaWRQcm9wZXJ0eT0naWQnXSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2hpY2ggaXMgY29uc2lkZXJlZCB0byBpZGVudGlmeSBhbiBpdGVtLgogICAqLwogIGZ1bmN0aW9uIENvbGxlY3Rpb24oKSB7CiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbGxlY3Rpb24pOwoKICAgIC8qKgogICAgICogVGhlIGludGVybmFsIGxpc3Qgb2YgaXRlbXMgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge09iamVjdFtdfQogICAgICovCiAgICB0aGlzLl9pdGVtcyA9IFtdOwogICAgLyoqCiAgICAgKiBUaGUgaW50ZXJuYWwgbWFwIG9mIGl0ZW1zIGluIHRoZSBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtNYXB9CiAgICAgKi8KCiAgICB0aGlzLl9pdGVtTWFwID0gbmV3IE1hcCgpOwogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2hpY2ggaXMgY29uc2lkZXJlZCB0byBpZGVudGlmeSBhbiBpdGVtLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLl9pZFByb3BlcnR5ID0gb3B0aW9ucy5pZFByb3BlcnR5IHx8ICdpZCc7CiAgICAvKioKICAgICAqIEEgaGVscGVyIG1hcHBpbmcgZXh0ZXJuYWwgaXRlbXMgb2YgYSBib3VuZCBjb2xsZWN0aW9uICh7QGxpbmsgI2JpbmRUb30pCiAgICAgKiBhbmQgYWN0dWFsIGl0ZW1zIG9mIHRoaXMgY29sbGVjdGlvbi4gSXQgcHJvdmlkZXMgaW5mb3JtYXRpb24KICAgICAqIG5lY2Vzc2FyeSB0byBwcm9wZXJseSByZW1vdmUgaXRlbXMgYm91bmQgdG8gYW5vdGhlciBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgI19iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXB9LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge1dlYWtNYXB9CiAgICAgKi8KCiAgICB0aGlzLl9iaW5kVG9FeHRlcm5hbFRvSW50ZXJuYWxNYXAgPSBuZXcgV2Vha01hcCgpOwogICAgLyoqCiAgICAgKiBBIGhlbHBlciBtYXBwaW5nIGl0ZW1zIG9mIHRoaXMgY29sbGVjdGlvbiB0byBleHRlcm5hbCBpdGVtcyBvZiBhIGJvdW5kIGNvbGxlY3Rpb24KICAgICAqICh7QGxpbmsgI2JpbmRUb30pLiBJdCBwcm92aWRlcyBpbmZvcm1hdGlvbiBuZWNlc3NhcnkgdG8gbWFuYWdlIHRoZSBiaW5kaW5ncywgZS5nLgogICAgICogdG8gYXZvaWQgbG9vcHMgaW4gdHdv4oCTd2F5IGJpbmRpbmdzLgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgI19iaW5kVG9FeHRlcm5hbFRvSW50ZXJuYWxNYXB9LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge1dlYWtNYXB9CiAgICAgKi8KCiAgICB0aGlzLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAgPSBuZXcgV2Vha01hcCgpOwogICAgLyoqCiAgICAgKiBTdG9yZXMgaW5kZXhlcyBvZiBza2lwcGVkIGl0ZW1zIGZyb20gYm91bmQgZXh0ZXJuYWwgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7QXJyYXl9CiAgICAgKi8KCiAgICB0aGlzLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbCA9IFtdOwogICAgLyoqCiAgICAgKiBBIGNvbGxlY3Rpb24gaW5zdGFuY2UgdGhpcyBjb2xsZWN0aW9uIGlzIGJvdW5kIHRvIGFzIGEgcmVzdWx0CiAgICAgKiBvZiBjYWxsaW5nIHtAbGluayAjYmluZFRvfSBtZXRob2QuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7bW9kdWxlOnV0aWxzL2NvbGxlY3Rpb25+Q29sbGVjdGlvbn0gI19iaW5kVG9Db2xsZWN0aW9uCiAgICAgKi8KICB9CiAgLyoqCiAgICogVGhlIG51bWJlciBvZiBpdGVtcyBhdmFpbGFibGUgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICoKICAgKiBAbWVtYmVyIHtOdW1iZXJ9ICNsZW5ndGgKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhDb2xsZWN0aW9uLCBbewogICAga2V5OiAiYWRkIiwKCiAgICAvKioKICAgICAqIEFkZHMgYW4gaXRlbSBpbnRvIHRoZSBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIElmIHRoZSBpdGVtIGRvZXMgbm90IGhhdmUgYW4gaWQsIHRoZW4gaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhbmQgc2V0IG9uIHRoZSBpdGVtLgogICAgICoKICAgICAqIEBjaGFpbmFibGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtCiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSBUaGUgcG9zaXRpb24gb2YgdGhlIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24uIFRoZSBpdGVtCiAgICAgKiBpcyBwdXNoZWQgdG8gdGhlIGNvbGxlY3Rpb24gd2hlbiBgaW5kZXhgIG5vdCBzcGVjaWZpZWQuCiAgICAgKiBAZmlyZXMgYWRkCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGQoaXRlbSwgaW5kZXgpIHsKICAgICAgdmFyIGl0ZW1JZDsKICAgICAgdmFyIGlkUHJvcGVydHkgPSB0aGlzLl9pZFByb3BlcnR5OwoKICAgICAgaWYgKGlkUHJvcGVydHkgaW4gaXRlbSkgewogICAgICAgIGl0ZW1JZCA9IGl0ZW1baWRQcm9wZXJ0eV07CgogICAgICAgIGlmICh0eXBlb2YgaXRlbUlkICE9ICdzdHJpbmcnKSB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXRlbSdzIGlkIHNob3VsZCBiZSBhIHN0cmluZy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZXJyb3IgY29sbGVjdGlvbi1hZGQtaW52YWxpZC1pZAogICAgICAgICAgICovCiAgICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1hZGQtaW52YWxpZC1pZCcsIHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZ2V0KGl0ZW1JZCkpIHsKICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhpcyBpdGVtIGFscmVhZHkgZXhpc3RzIGluIHRoZSBjb2xsZWN0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBlcnJvciBjb2xsZWN0aW9uLWFkZC1pdGVtLWFscmVhZHktZXhpc3RzCiAgICAgICAgICAgKi8KICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWFkZC1pdGVtLWFscmVhZHktZXhpc3RzJywgdGhpcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW1baWRQcm9wZXJ0eV0gPSBpdGVtSWQgPSB1aWQoKTsKICAgICAgfSAvLyBUT0RPOiBVc2UgRVM2IGRlZmF1bHQgZnVuY3Rpb24gYXJndW1lbnQuCgoKICAgICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBpbmRleCA9IHRoaXMuX2l0ZW1zLmxlbmd0aDsKICAgICAgfSBlbHNlIGlmIChpbmRleCA+IHRoaXMuX2l0ZW1zLmxlbmd0aCB8fCBpbmRleCA8IDApIHsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgaW5kZXggbnVtYmVyIGhhcyBpbnZhbGlkIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGNvbGxlY3Rpb24tYWRkLWl0ZW0tYmFkLWluZGV4CiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbGxlY3Rpb24tYWRkLWl0ZW0taW52YWxpZC1pbmRleCcsIHRoaXMpOwogICAgICB9CgogICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXgsIDAsIGl0ZW0pOwoKICAgICAgdGhpcy5faXRlbU1hcC5zZXQoaXRlbUlkLCBpdGVtKTsKCiAgICAgIHRoaXMuZmlyZSgnYWRkJywgaXRlbSwgaW5kZXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0cyBpdGVtIGJ5IGl0cyBpZCBvciBpbmRleC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xOdW1iZXJ9IGlkT3JJbmRleCBUaGUgaXRlbSBpZCBvciBpbmRleCBpbiB0aGUgY29sbGVjdGlvbi4KICAgICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gVGhlIHJlcXVlc3RlZCBpdGVtIG9yIGBudWxsYCBpZiBzdWNoIGl0ZW0gZG9lcyBub3QgZXhpc3QuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXQoaWRPckluZGV4KSB7CiAgICAgIHZhciBpdGVtOwoKICAgICAgaWYgKHR5cGVvZiBpZE9ySW5kZXggPT0gJ3N0cmluZycpIHsKICAgICAgICBpdGVtID0gdGhpcy5faXRlbU1hcC5nZXQoaWRPckluZGV4KTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaWRPckluZGV4ID09ICdudW1iZXInKSB7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1zW2lkT3JJbmRleF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyoqCiAgICAgICAgICogSW5kZXggb3IgaWQgbXVzdCBiZSBnaXZlbi4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciBjb2xsZWN0aW9uLWdldC1pbnZhbGlkLWFyZwogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWdldC1pbnZhbGlkLWFyZzogSW5kZXggb3IgaWQgbXVzdCBiZSBnaXZlbi4nLCB0aGlzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZW0gfHwgbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIGFuIGl0ZW0uCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBpdGVtT3JJZCBUaGUgaXRlbSBvciBpdHMgaWQgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYHRydWVgIGlmIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoZSBpdGVtLCBgZmFsc2VgIG90aGVyd2lzZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhcyhpdGVtT3JJZCkgewogICAgICBpZiAodHlwZW9mIGl0ZW1PcklkID09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1NYXAuaGFzKGl0ZW1PcklkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBPYmplY3QKICAgICAgICB2YXIgaWRQcm9wZXJ0eSA9IHRoaXMuX2lkUHJvcGVydHk7CiAgICAgICAgdmFyIGlkID0gaXRlbU9ySWRbaWRQcm9wZXJ0eV07CiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1NYXAuaGFzKGlkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIGluZGV4IG9mIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKiBXaGVuIGl0ZW0gaXMgbm90IGRlZmluZWQgaW4gdGhlIGNvbGxlY3Rpb24gdGhlbiBpbmRleCB3aWxsIGJlIGVxdWFsIC0xLgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gaXRlbU9ySWQgVGhlIGl0ZW0gb3IgaXRzIGlkIGluIHRoZSBjb2xsZWN0aW9uLgogICAgICogQHJldHVybnMge051bWJlcn0gSW5kZXggb2YgZ2l2ZW4gaXRlbS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJbmRleCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5kZXgoaXRlbU9ySWQpIHsKICAgICAgdmFyIGl0ZW07CgogICAgICBpZiAodHlwZW9mIGl0ZW1PcklkID09ICdzdHJpbmcnKSB7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1NYXAuZ2V0KGl0ZW1PcklkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtID0gaXRlbU9ySWQ7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGFuIGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdHxOdW1iZXJ8U3RyaW5nfSBzdWJqZWN0IFRoZSBpdGVtIHRvIHJlbW92ZSwgaXRzIGlkIG9yIGluZGV4IGluIHRoZSBjb2xsZWN0aW9uLgogICAgICogQHJldHVybnMge09iamVjdH0gVGhlIHJlbW92ZWQgaXRlbS4KICAgICAqIEBmaXJlcyByZW1vdmUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShzdWJqZWN0KSB7CiAgICAgIHZhciBpbmRleCwgaWQsIGl0ZW07CiAgICAgIHZhciBpdGVtRG9lc05vdEV4aXN0ID0gZmFsc2U7CiAgICAgIHZhciBpZFByb3BlcnR5ID0gdGhpcy5faWRQcm9wZXJ0eTsKCiAgICAgIGlmICh0eXBlb2Ygc3ViamVjdCA9PSAnc3RyaW5nJykgewogICAgICAgIGlkID0gc3ViamVjdDsKICAgICAgICBpdGVtID0gdGhpcy5faXRlbU1hcC5nZXQoaWQpOwogICAgICAgIGl0ZW1Eb2VzTm90RXhpc3QgPSAhaXRlbTsKCiAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgIGluZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihpdGVtKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHN1YmplY3QgPT0gJ251bWJlcicpIHsKICAgICAgICBpbmRleCA9IHN1YmplY3Q7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1zW2luZGV4XTsKICAgICAgICBpdGVtRG9lc05vdEV4aXN0ID0gIWl0ZW07CgogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICBpZCA9IGl0ZW1baWRQcm9wZXJ0eV07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0gPSBzdWJqZWN0OwogICAgICAgIGlkID0gaXRlbVtpZFByb3BlcnR5XTsKICAgICAgICBpbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoaXRlbSk7CiAgICAgICAgaXRlbURvZXNOb3RFeGlzdCA9IGluZGV4ID09IC0xIHx8ICF0aGlzLl9pdGVtTWFwLmdldChpZCk7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtRG9lc05vdEV4aXN0KSB7CiAgICAgICAgLyoqCiAgICAgICAgICogSXRlbSBub3QgZm91bmQuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgY29sbGVjdGlvbi1yZW1vdmUtNDA0CiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbGxlY3Rpb24tcmVtb3ZlLTQwNDogSXRlbSBub3QgZm91bmQuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleCwgMSk7CgogICAgICB0aGlzLl9pdGVtTWFwLmRlbGV0ZShpZCk7CgogICAgICB2YXIgZXh0ZXJuYWxJdGVtID0gdGhpcy5fYmluZFRvSW50ZXJuYWxUb0V4dGVybmFsTWFwLmdldChpdGVtKTsKCiAgICAgIHRoaXMuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcC5kZWxldGUoaXRlbSk7CgogICAgICB0aGlzLl9iaW5kVG9FeHRlcm5hbFRvSW50ZXJuYWxNYXAuZGVsZXRlKGV4dGVybmFsSXRlbSk7CgogICAgICB0aGlzLmZpcmUoJ3JlbW92ZScsIGl0ZW0sIGluZGV4KTsKICAgICAgcmV0dXJuIGl0ZW07CiAgICB9CiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBmb3IgZWFjaCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uIGFuZCBjb21wb3NlcyBhbiBhcnJheSBvciB2YWx1ZXMgcmV0dXJuZWQgYnkgdGhpcyBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQHBhcmFtIHtPYmplY3R9IGNhbGxiYWNrLml0ZW0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjYWxsYmFjay5pbmRleAogICAgICogQHBhcmFtIHtPYmplY3R9IGN0eCBDb250ZXh0IGluIHdoaWNoIHRoZSBgY2FsbGJhY2tgIHdpbGwgYmUgY2FsbGVkLgogICAgICogQHJldHVybnMge0FycmF5fSBUaGUgcmVzdWx0IG9mIG1hcHBpbmcuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibWFwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXAoY2FsbGJhY2ssIGN0eCkgewogICAgICByZXR1cm4gdGhpcy5faXRlbXMubWFwKGNhbGxiYWNrLCBjdHgpOwogICAgfQogICAgLyoqCiAgICAgKiBGaW5kcyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgY29sbGVjdGlvbiBmb3Igd2hpY2ggdGhlIGBjYWxsYmFja2AgcmV0dXJucyBhIHRydWUgdmFsdWUuCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjYWxsYmFjay5pdGVtCiAgICAgKiBAcGFyYW0ge051bWJlcn0gY2FsbGJhY2suaW5kZXgKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjdHggQ29udGV4dCBpbiB3aGljaCB0aGUgYGNhbGxiYWNrYCB3aWxsIGJlIGNhbGxlZC4KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBpdGVtIGZvciB3aGljaCBgY2FsbGJhY2tgIHJldHVybmVkIGEgdHJ1ZSB2YWx1ZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kKGNhbGxiYWNrLCBjdHgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbmQoY2FsbGJhY2ssIGN0eCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgd2l0aCBpdGVtcyBmb3Igd2hpY2ggdGhlIGBjYWxsYmFja2AgcmV0dXJuZWQgYSB0cnVlIHZhbHVlLgogICAgICoKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2FsbGJhY2suaXRlbQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGNhbGxiYWNrLmluZGV4CiAgICAgKiBAcGFyYW0ge09iamVjdH0gY3R4IENvbnRleHQgaW4gd2hpY2ggdGhlIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxsZWQuCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0W119IFRoZSBhcnJheSB3aXRoIG1hdGNoaW5nIGl0ZW1zLgogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbHRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrLCBjdHgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbHRlcihjYWxsYmFjaywgY3R4KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSB0aGUgY29sbGVjdGlvbiBhbmQgZGVzdHJveXMgdGhlIGJpbmRpbmcgY3JlYXRlZCB1c2luZwogICAgICoge0BsaW5rICNiaW5kVG99LgogICAgICovCgogIH0sIHsKICAgIGtleTogImNsZWFyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgaWYgKHRoaXMuX2JpbmRUb0NvbGxlY3Rpb24pIHsKICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodGhpcy5fYmluZFRvQ29sbGVjdGlvbik7CiAgICAgICAgdGhpcy5fYmluZFRvQ29sbGVjdGlvbiA9IG51bGw7CiAgICAgIH0KCiAgICAgIHdoaWxlICh0aGlzLmxlbmd0aCkgewogICAgICAgIHRoaXMucmVtb3ZlKDApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEJpbmRzIGFuZCBzeW5jaHJvbml6ZXMgdGhlIGNvbGxlY3Rpb24gd2l0aCBhbm90aGVyIG9uZS4KICAgICAqCiAgICAgKiBUaGUgYmluZGluZyBjYW4gYmUgYSBzaW1wbGUgZmFjdG9yeToKICAgICAqCiAgICAgKgkJY2xhc3MgRmFjdG9yeUNsYXNzIHsKICAgICAqCQkJY29uc3RydWN0b3IoIGRhdGEgKSB7CiAgICAgKgkJCQl0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDsKICAgICAqCQkJfQogICAgICoJCX0KICAgICAqCiAgICAgKgkJY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb24oIHsgaWRQcm9wZXJ0eTogJ2xhYmVsJyB9ICk7CiAgICAgKgkJY29uc3QgdGFyZ2V0ID0gbmV3IENvbGxlY3Rpb24oKTsKICAgICAqCiAgICAgKgkJdGFyZ2V0LmJpbmRUbyggc291cmNlICkuYXMoIEZhY3RvcnlDbGFzcyApOwogICAgICoKICAgICAqCQlzb3VyY2UuYWRkKCB7IGxhYmVsOiAnZm9vJyB9ICk7CiAgICAgKgkJc291cmNlLmFkZCggeyBsYWJlbDogJ2JhcicgfSApOwogICAgICoKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0Lmxlbmd0aCApOyAvLyAyCiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDEgKS5sYWJlbCApOyAvLyAnYmFyJwogICAgICoKICAgICAqCQlzb3VyY2UucmVtb3ZlKCAwICk7CiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5sZW5ndGggKTsgLy8gMQogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAwICkubGFiZWwgKTsgLy8gJ2JhcicKICAgICAqCiAgICAgKiBvciB0aGUgZmFjdG9yeSBkcml2ZW4gYnkgYSBjdXN0b20gY2FsbGJhY2s6CiAgICAgKgogICAgICoJCWNsYXNzIEZvb0NsYXNzIHsKICAgICAqCQkJY29uc3RydWN0b3IoIGRhdGEgKSB7CiAgICAgKgkJCQl0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDsKICAgICAqCQkJfQogICAgICoJCX0KICAgICAqCiAgICAgKgkJY2xhc3MgQmFyQ2xhc3MgewogICAgICoJCQljb25zdHJ1Y3RvciggZGF0YSApIHsKICAgICAqCQkJCXRoaXMubGFiZWwgPSBkYXRhLmxhYmVsOwogICAgICoJCQl9CiAgICAgKgkJfQogICAgICoKICAgICAqCQljb25zdCBzb3VyY2UgPSBuZXcgQ29sbGVjdGlvbiggeyBpZFByb3BlcnR5OiAnbGFiZWwnIH0gKTsKICAgICAqCQljb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbigpOwogICAgICoKICAgICAqCQl0YXJnZXQuYmluZFRvKCBzb3VyY2UgKS51c2luZyggKCBpdGVtICkgPT4gewogICAgICoJCQlpZiAoIGl0ZW0ubGFiZWwgPT0gJ2ZvbycgKSB7CiAgICAgKgkJCQlyZXR1cm4gbmV3IEZvb0NsYXNzKCBpdGVtICk7CiAgICAgKgkJCX0gZWxzZSB7CiAgICAgKgkJCQlyZXR1cm4gbmV3IEJhckNsYXNzKCBpdGVtICk7CiAgICAgKgkJCX0KICAgICAqCQl9ICk7CiAgICAgKgogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6ICdmb28nIH0gKTsKICAgICAqCQlzb3VyY2UuYWRkKCB7IGxhYmVsOiAnYmFyJyB9ICk7CiAgICAgKgogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDIKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0LmdldCggMCApIGluc3RhbmNlb2YgRm9vQ2xhc3MgKTsgLy8gdHJ1ZQogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAxICkgaW5zdGFuY2VvZiBCYXJDbGFzcyApOyAvLyB0cnVlCiAgICAgKgogICAgICogb3IgdGhlIGZhY3Rvcnkgb3V0IG9mIHByb3BlcnR5IG5hbWU6CiAgICAgKgogICAgICoJCWNvbnN0IHNvdXJjZSA9IG5ldyBDb2xsZWN0aW9uKCB7IGlkUHJvcGVydHk6ICdsYWJlbCcgfSApOwogICAgICoJCWNvbnN0IHRhcmdldCA9IG5ldyBDb2xsZWN0aW9uKCk7CiAgICAgKgogICAgICoJCXRhcmdldC5iaW5kVG8oIHNvdXJjZSApLnVzaW5nKCAnbGFiZWwnICk7CiAgICAgKgogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6IHsgdmFsdWU6ICdmb28nIH0gfSApOwogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6IHsgdmFsdWU6ICdiYXInIH0gfSApOwogICAgICoKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0Lmxlbmd0aCApOyAvLyAyCiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDAgKS52YWx1ZSApOyAvLyAnZm9vJwogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAxICkudmFsdWUgKTsgLy8gJ2JhcicKICAgICAqCiAgICAgKiBJdCdzIHBvc3NpYmxlIHRvIHNraXAgc3BlY2lmaWVkIGl0ZW1zIGJ5IHJldHVybmluZyBmYWxzeSB2YWx1ZToKICAgICAqCiAgICAgKgkJY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb24oKTsKICAgICAqCQljb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbigpOwogICAgICoKICAgICAqCQl0YXJnZXQuYmluZFRvKCBzb3VyY2UgKS51c2luZyggaXRlbSA9PiB7CiAgICAgKgkJCWlmICggaXRlbS5oaWRkZW4gKSB7CiAgICAgKgkJCQlyZXR1cm4gbnVsbDsKICAgICAqCQkJfQogICAgICoKICAgICAqCQkJcmV0dXJuIGl0ZW07CiAgICAgKgkJfSApOwogICAgICoKICAgICAqCQlzb3VyY2UuYWRkKCB7IGhpZGRlbjogdHJ1ZSB9ICk7CiAgICAgKgkJc291cmNlLmFkZCggeyBoaWRkZW46IGZhbHNlIH0gKTsKICAgICAqCiAgICAgKgkJY29uc29sZS5sb2coIHNvdXJjZS5sZW5ndGggKTsgLy8gMgogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDEKICAgICAqCiAgICAgKiAqKk5vdGUqKjoge0BsaW5rICNjbGVhcn0gY2FuIGJlIHVzZWQgdG8gYnJlYWsgdGhlIGJpbmRpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9ufSBleHRlcm5hbENvbGxlY3Rpb24gQSBjb2xsZWN0aW9uIHRvIGJlIGJvdW5kLgogICAgICogQHJldHVybnMge09iamVjdH0KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9uQmluZFRvQ2hhaW59IFRoZSBiaW5kaW5nIGNoYWluIG9iamVjdC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJiaW5kVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGJpbmRUbyhleHRlcm5hbENvbGxlY3Rpb24pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLl9iaW5kVG9Db2xsZWN0aW9uKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGNvbGxlY3Rpb24gY2Fubm90IGJlIGJvdW5kIG1vcmUgdGhhbiBvbmNlLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGNvbGxlY3Rpb24tYmluZC10by1yZWJpbmQKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1iaW5kLXRvLXJlYmluZDogVGhlIGNvbGxlY3Rpb24gY2Fubm90IGJlIGJvdW5kIG1vcmUgdGhhbiBvbmNlLicsIHRoaXMpOwogICAgICB9CgogICAgICB0aGlzLl9iaW5kVG9Db2xsZWN0aW9uID0gZXh0ZXJuYWxDb2xsZWN0aW9uOwogICAgICByZXR1cm4gewogICAgICAgIGFzOiBmdW5jdGlvbiBhcyhDbGFzcykgewogICAgICAgICAgX3RoaXMuX3NldFVwQmluZFRvQmluZGluZyhmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gbmV3IENsYXNzKGl0ZW0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB1c2luZzogZnVuY3Rpb24gdXNpbmcoY2FsbGJhY2tPclByb3BlcnR5KSB7CiAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrT3JQcm9wZXJ0eSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIF90aGlzLl9zZXRVcEJpbmRUb0JpbmRpbmcoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2tPclByb3BlcnR5KGl0ZW0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzLl9zZXRVcEJpbmRUb0JpbmRpbmcoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbVtjYWxsYmFja09yUHJvcGVydHldOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIEZpbmFsaXplcyBhbmQgYWN0aXZhdGVzIGEgYmluZGluZyBpbml0aWF0ZWQgYnkgeyNiaW5kVG99LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZhY3RvcnkgQSBmdW5jdGlvbiB3aGljaCBwcm9kdWNlcyBjb2xsZWN0aW9uIGl0ZW1zLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRVcEJpbmRUb0JpbmRpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRVcEJpbmRUb0JpbmRpbmcoZmFjdG9yeSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBleHRlcm5hbENvbGxlY3Rpb24gPSB0aGlzLl9iaW5kVG9Db2xsZWN0aW9uOyAvLyBBZGRzIHRoZSBpdGVtIHRvIHRoZSBjb2xsZWN0aW9uIG9uY2UgYSBjaGFuZ2UgaGFzIGJlZW4gZG9uZSB0byB0aGUgZXh0ZXJuYWwgY29sbGVjdGlvbi4KICAgICAgLy8KICAgICAgLy8gQHByaXZhdGUKCiAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24gYWRkSXRlbShldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpIHsKICAgICAgICB2YXIgaXNFeHRlcm5hbEJvdW5kVG9UaGlzID0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9iaW5kVG9Db2xsZWN0aW9uID09IF90aGlzMjsKCiAgICAgICAgdmFyIGV4dGVybmFsSXRlbUJvdW5kID0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuZ2V0KGV4dGVybmFsSXRlbSk7IC8vIElmIGFuIGV4dGVybmFsIGNvbGxlY3Rpb24gaXMgYm91bmQgdG8gdGhpcyBjb2xsZWN0aW9uLCB3aGljaCBtYWtlcyBpdCBhIDLigJN3YXkgYmluZGluZywKICAgICAgICAvLyBhbmQgdGhlIHBhcnRpY3VsYXIgZXh0ZXJuYWwgY29sbGVjdGlvbiBpdGVtIGlzIGFscmVhZHkgYm91bmQsIGRvbid0IGFkZCBpdCBoZXJlLgogICAgICAgIC8vIFRoZSBleHRlcm5hbCBpdGVtIGhhcyBiZWVuIGNyZWF0ZWQgKipvdXQgb2YgdGhpcyBjb2xsZWN0aW9uJ3MgaXRlbSoqIGFuZCAocmUpYWRkaW5nIGl0IHdpbGwKICAgICAgICAvLyBjYXVzZSBhIGxvb3AuCgoKICAgICAgICBpZiAoaXNFeHRlcm5hbEJvdW5kVG9UaGlzICYmIGV4dGVybmFsSXRlbUJvdW5kKSB7CiAgICAgICAgICBfdGhpczIuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5zZXQoZXh0ZXJuYWxJdGVtLCBleHRlcm5hbEl0ZW1Cb3VuZCk7CgogICAgICAgICAgX3RoaXMyLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuc2V0KGV4dGVybmFsSXRlbUJvdW5kLCBleHRlcm5hbEl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGZhY3RvcnkoZXh0ZXJuYWxJdGVtKTsgLy8gV2hlbiB0aGVyZSBpcyBubyBpdGVtIHdlIG5lZWQgdG8gcmVtZW1iZXIgc2tpcHBlZCBpbmRleCBmaXJzdCBhbmQgdGhlbiB3ZSBjYW4gc2tpcCB0aGlzIGl0ZW0uCgogICAgICAgICAgaWYgKCFpdGVtKSB7CiAgICAgICAgICAgIF90aGlzMi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwucHVzaChpbmRleCk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIExldHMgdHJ5IHRvIHB1dCBpdGVtIGF0IHRoZSBzYW1lIGluZGV4IGFzIGluZGV4IGluIGV4dGVybmFsIGNvbGxlY3Rpb24KICAgICAgICAgIC8vIGJ1dCB3aGVuIHRoZXJlIGFyZSBhIHNraXBwZWQgaXRlbXMgaW4gb25lIG9yIGJvdGggY29sbGVjdGlvbnMgd2UgbmVlZCB0byByZWNhbGN1bGF0ZSB0aGlzIGluZGV4LgoKCiAgICAgICAgICB2YXIgZmluYWxJbmRleCA9IGluZGV4OyAvLyBXaGVuIHdlIHRyeSB0byBpbnNlcnQgaXRlbSBhZnRlciBzb21lIHNraXBwZWQgaXRlbXMgZnJvbSBleHRlcm5hbCBjb2xsZWN0aW9uIHdlIG5lZWQKICAgICAgICAgIC8vIHRvIGluY2x1ZGUgdGhpcyBza2lwcGVkIGl0ZW1zIGFuZCBkZWNyZWFzZSBpbmRleC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBGb3IgdGhlIGZvbGxvd2luZyBleGFtcGxlOgogICAgICAgICAgLy8gZXh0ZXJuYWwgLT4gWyAnQScsICdCIC0gc2tpcHBlZCBmb3IgaW50ZXJuYWwnLCAnQyAtIHNraXBwZWQgZm9yIGludGVybmFsJyBdCiAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbIEEgXQogICAgICAgICAgLy8KICAgICAgICAgIC8vIEFub3RoZXIgaXRlbSBpcyBiZWVuIGFkZGVkIGF0IHRoZSBlbmQgb2YgZXh0ZXJuYWwgY29sbGVjdGlvbjoKICAgICAgICAgIC8vIGV4dGVybmFsLmFkZCggJ0QnICkKICAgICAgICAgIC8vIGV4dGVybmFsIC0+IFsgJ0EnLCAnQiAtIHNraXBwZWQgZm9yIGludGVybmFsJywgJ0MgLSBza2lwcGVkIGZvciBpbnRlcm5hbCcsICdEJyBdCiAgICAgICAgICAvLwogICAgICAgICAgLy8gV2UgY2FuJ3QganVzdCBhZGQgJ0QnIHRvIGludGVybmFsIGF0IHRoZSBzYW1lIGluZGV4IGFzIGluZGV4IGluIGV4dGVybmFsIGJlY2F1c2UKICAgICAgICAgIC8vIHRoaXMgd2lsbCBwcm9kdWNlIGVtcHR5IGluZGV4ZXMgd2hhdCBpcyBpbnZhbGlkOgogICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsIGVtcHR5LCBlbXB0eSwgJ0QnIF0KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBTbyB3ZSBuZWVkIHRvIGluY2x1ZGUgc2tpcHBlZCBpdGVtcyBhbmQgZGVjcmVhc2UgaW5kZXgKICAgICAgICAgIC8vIGludGVybmFsIC0+IFsgJ0EnLCAnRCcgXQoKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IF90aGlzMi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWxbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIHNraXBwZWQgPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gc2tpcHBlZCkgewogICAgICAgICAgICAgICAgZmluYWxJbmRleC0tOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBXZSBuZWVkIHRvIHRha2UgaW50byBjb25zaWRlcmF0aW9uIHRoYXQgZXh0ZXJuYWwgY29sbGVjdGlvbiBjb3VsZCBza2lwIHNvbWUgaXRlbXMgZnJvbQogICAgICAgICAgICAvLyBpbnRlcm5hbCBjb2xsZWN0aW9uLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBGb3IgdGhlIGZvbGxvd2luZyBleGFtcGxlOgogICAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbICdBJywgJ0IgLSBza2lwcGVkIGZvciBleHRlcm5hbCcsICdDIC0gc2tpcHBlZCBmb3IgZXh0ZXJuYWwnIF0KICAgICAgICAgICAgLy8gZXh0ZXJuYWwgLT4gWyBBIF0KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gQW5vdGhlciBpdGVtIGlzIGJlZW4gYWRkZWQgYXQgdGhlIGVuZCBvZiBleHRlcm5hbCBjb2xsZWN0aW9uOgogICAgICAgICAgICAvLyBleHRlcm5hbC5hZGQoICdEJyApCiAgICAgICAgICAgIC8vIGV4dGVybmFsIC0+IFsgJ0EnLCAnRCcgXQogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGluY2x1ZGUgc2tpcHBlZCBpdGVtcyBhbmQgcGxhY2UgbmV3IGl0ZW0gYWZ0ZXIgdGhlbToKICAgICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsICdCIC0gc2tpcHBlZCBmb3IgZXh0ZXJuYWwnLCAnQyAtIHNraXBwZWQgZm9yIGV4dGVybmFsJywgJ0QnIF0KCiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBleHRlcm5hbENvbGxlY3Rpb24uX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAyOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gKF9zdGVwMiA9IF9pdGVyYXRvcjIubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIF9za2lwcGVkID0gX3N0ZXAyLnZhbHVlOwoKICAgICAgICAgICAgICBpZiAoZmluYWxJbmRleCA+PSBfc2tpcHBlZCkgewogICAgICAgICAgICAgICAgZmluYWxJbmRleCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IGVycjsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IyLnJldHVybigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLl9iaW5kVG9FeHRlcm5hbFRvSW50ZXJuYWxNYXAuc2V0KGV4dGVybmFsSXRlbSwgaXRlbSk7CgogICAgICAgICAgX3RoaXMyLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuc2V0KGl0ZW0sIGV4dGVybmFsSXRlbSk7CgogICAgICAgICAgX3RoaXMyLmFkZChpdGVtLCBmaW5hbEluZGV4KTsgLy8gQWZ0ZXIgYWRkaW5nIG5ldyBlbGVtZW50IHRvIGludGVybmFsIGNvbGxlY3Rpb24gd2UgbmVlZCB1cGRhdGUgaW5kZXhlcwogICAgICAgICAgLy8gb2Ygc2tpcHBlZCBpdGVtcyBpbiBleHRlcm5hbCBjb2xsZWN0aW9uLgoKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV4dGVybmFsQ29sbGVjdGlvbi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZpbmFsSW5kZXggPD0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbFtpXSkgewogICAgICAgICAgICAgIGV4dGVybmFsQ29sbGVjdGlvbi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWxbaV0rKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsgLy8gTG9hZCB0aGUgaW5pdGlhbCBjb250ZW50IG9mIHRoZSBjb2xsZWN0aW9uLgoKCiAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjMgPSBmYWxzZTsKICAgICAgdmFyIF9pdGVyYXRvckVycm9yMyA9IHVuZGVmaW5lZDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yMyA9IGV4dGVybmFsQ29sbGVjdGlvbltTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IChfc3RlcDMgPSBfaXRlcmF0b3IzLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZSkgewogICAgICAgICAgdmFyIGV4dGVybmFsSXRlbSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgIGFkZEl0ZW0obnVsbCwgZXh0ZXJuYWxJdGVtLCBleHRlcm5hbENvbGxlY3Rpb24uZ2V0SW5kZXgoZXh0ZXJuYWxJdGVtKSk7CiAgICAgICAgfSAvLyBTeW5jaHJvbml6ZSB0aGUgd2l0aCBjb2xsZWN0aW9uIGFzIG5ldyBpdGVtcyBhcmUgYWRkZWQuCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yMyA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyAmJiBfaXRlcmF0b3IzLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjMucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjMpIHsKICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5saXN0ZW5UbyhleHRlcm5hbENvbGxlY3Rpb24sICdhZGQnLCBhZGRJdGVtKTsgLy8gU3luY2hyb25pemUgdGhlIHdpdGggY29sbGVjdGlvbiBhcyBuZXcgaXRlbXMgYXJlIHJlbW92ZWQuCgogICAgICB0aGlzLmxpc3RlblRvKGV4dGVybmFsQ29sbGVjdGlvbiwgJ3JlbW92ZScsIGZ1bmN0aW9uIChldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpIHsKICAgICAgICB2YXIgaXRlbSA9IF90aGlzMi5fYmluZFRvRXh0ZXJuYWxUb0ludGVybmFsTWFwLmdldChleHRlcm5hbEl0ZW0pOwoKICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgX3RoaXMyLnJlbW92ZShpdGVtKTsKICAgICAgICB9IC8vIEFmdGVyIHJlbW92aW5nIGVsZW1lbnQgZnJvbSBleHRlcm5hbCBjb2xsZWN0aW9uIHdlIG5lZWQgdXBkYXRlL3JlbW92ZSBpbmRleGVzCiAgICAgICAgLy8gb2Ygc2tpcHBlZCBpdGVtcyBpbiBpbnRlcm5hbCBjb2xsZWN0aW9uLgoKCiAgICAgICAgX3RoaXMyLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbCA9IF90aGlzMi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwucmVkdWNlKGZ1bmN0aW9uIChyZXN1bHQsIHNraXBwZWQpIHsKICAgICAgICAgIGlmIChpbmRleCA8IHNraXBwZWQpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goc2tpcHBlZCAtIDEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmRleCA+IHNraXBwZWQpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goc2tpcHBlZCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LCBbXSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBJdGVyYWJsZSBpbnRlcmZhY2UuCiAgICAgKgogICAgICogQHJldHVybnMge0l0ZXJhYmxlLjwqPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6IFN5bWJvbC5pdGVyYXRvciwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTsKICAgIH0KICAgIC8qKgogICAgICogRmlyZWQgd2hlbiBhbiBpdGVtIGlzIGFkZGVkIHRvIHRoZSBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIEBldmVudCBhZGQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBhZGRlZCBpdGVtLgogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJlZCB3aGVuIGFuIGl0ZW0gaXMgcmVtb3ZlZCBmcm9tIHRoZSBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIEBldmVudCByZW1vdmUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSByZW1vdmVkIGl0ZW0uCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggZnJvbSB3aGljaCBpdGVtIHdhcyByZW1vdmVkLgogICAgICovCgogIH0sIHsKICAgIGtleTogImxlbmd0aCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmxlbmd0aDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZmlyc3QgaXRlbSBmcm9tIHRoZSBjb2xsZWN0aW9uIG9yIG51bGwgd2hlbiBjb2xsZWN0aW9uIGlzIGVtcHR5LgogICAgICoKICAgICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gVGhlIGZpcnN0IGl0ZW0gb3IgYG51bGxgIGlmIGNvbGxlY3Rpb24gaXMgZW1wdHkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlyc3QiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9pdGVtc1swXSB8fCBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsYXN0IGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbiBvciBudWxsIHdoZW4gY29sbGVjdGlvbiBpcyBlbXB0eS4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IFRoZSBsYXN0IGl0ZW0gb3IgYG51bGxgIGlmIGNvbGxlY3Rpb24gaXMgZW1wdHkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibGFzdCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zW3RoaXMubGVuZ3RoIC0gMV0gfHwgbnVsbDsKICAgIH0KICB9XSk7CgogIHJldHVybiBDb2xsZWN0aW9uOwp9KCk7CgpleHBvcnQgeyBDb2xsZWN0aW9uIGFzIGRlZmF1bHQgfTsKbWl4KENvbGxlY3Rpb24sIEVtaXR0ZXJNaXhpbik7Ci8qKgogKiBBbiBvYmplY3QgcmV0dXJuZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9uI2JpbmRUbyBgYmluZFRvKClgfSBtZXRob2QKICogcHJvdmlkaW5nIGZ1bmN0aW9ucyB0aGF0IHNwZWNpZnkgdGhlIHR5cGUgb2YgdGhlIGJpbmRpbmcuCiAqCiAqIFNlZSB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9jb2xsZWN0aW9ufkNvbGxlY3Rpb24jYmluZFRvIGBiaW5kVG8oKWB9IGRvY3VtZW50YXRpb24gZm9yIGV4YW1wbGVzLgogKgogKiBAaW50ZXJmYWNlIG1vZHVsZTp1dGlscy9jb2xsZWN0aW9ufkNvbGxlY3Rpb25CaW5kVG9DaGFpbgogKi8KCi8qKgogKiBDcmVhdGVzIGEgY2FsbGJhY2sgb3IgYSBwcm9wZXJ0eSBiaW5kaW5nLgogKgogKiBAbWV0aG9kICN1c2luZwogKiBAcGFyYW0ge0Z1bmN0aW9ufFN0cmluZ30gY2FsbGJhY2tPclByb3BlcnR5ICBXaGVuIHRoZSBmdW5jdGlvbiBpcyBwYXNzZWQsIGl0IHNob3VsZCByZXR1cm4KICogdGhlIGNvbGxlY3Rpb24gaXRlbXMuIFdoZW4gdGhlIHN0cmluZyBpcyBwcm92aWRlZCwgdGhlIHByb3BlcnR5IHZhbHVlIGlzIHVzZWQgdG8gY3JlYXRlIHRoZSBib3VuZCBjb2xsZWN0aW9uIGl0ZW1zLgogKi8KCi8qKgogKiBDcmVhdGVzIHRoZSBjbGFzcyBmYWN0b3J5IGJpbmRpbmcgaW4gd2hpY2ggaXRlbXMgb2YgdGhlIHNvdXJjZSBjb2xsZWN0aW9uIGFyZSBwYXNzZWQgdG8KICogdGhlIGNvbnN0cnVjdG9yIG9mIHRoZSBzcGVjaWZpZWQgY2xhc3MuCiAqCiAqIEBtZXRob2QgI2FzCiAqIEBwYXJhbSB7RnVuY3Rpb259IENsYXNzIFRoZSBjbGFzcyBjb25zdHJ1Y3RvciB1c2VkIHRvIGNyZWF0ZSBpbnN0YW5jZXMgaW4gdGhlIGZhY3RvcnkuCiAqLw=="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-utils/src/collection.js"],"names":["EmitterMixin","CKEditorError","uid","mix","Collection","options","_items","_itemMap","Map","_idProperty","idProperty","_bindToExternalToInternalMap","WeakMap","_bindToInternalToExternalMap","_skippedIndexesFromExternal","item","index","itemId","get","undefined","length","splice","set","fire","idOrIndex","itemOrId","has","id","indexOf","subject","itemDoesNotExist","delete","externalItem","callback","ctx","map","find","filter","_bindToCollection","stopListening","remove","externalCollection","as","Class","_setUpBindToBinding","using","callbackOrProperty","factory","addItem","evt","isExternalBoundToThis","externalItemBound","push","finalIndex","skipped","add","i","getIndex","listenTo","reduce","result","Symbol","iterator"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;;;;AAKA;;;AAIA,OAAOA,YAAP,MAAyB,gBAAzB;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,GAAP,MAAgB,OAAhB;AACA,OAAOC,GAAP,MAAgB,OAAhB;AAEA;;;;;;;;;;;;;IAYqBC,U;;;AACpB;;;;;;AAMA,wBAA4B;AAAA,QAAfC,OAAe,uEAAL,EAAK;;AAAA;;AAC3B;;;;;;AAMA,SAAKC,MAAL,GAAc,EAAd;AAEA;;;;;;;AAMA,SAAKC,QAAL,GAAgB,IAAIC,GAAJ,EAAhB;AAEA;;;;;;;AAMA,SAAKC,WAAL,GAAmBJ,OAAO,CAACK,UAAR,IAAsB,IAAzC;AAEA;;;;;;;;;;;AAUA,SAAKC,4BAAL,GAAoC,IAAIC,OAAJ,EAApC;AAEA;;;;;;;;;;;AAUA,SAAKC,4BAAL,GAAoC,IAAID,OAAJ,EAApC;AAEA;;;;;;;AAMA,SAAKE,2BAAL,GAAmC,EAAnC;AAEA;;;;;;;AAOA;AAED;;;;;;;;;;AA2BA;;;;;;;;;;;wBAWKC,I,EAAMC,K,EAAQ;AAClB,UAAIC,MAAJ;AACA,UAAMP,UAAU,GAAG,KAAKD,WAAxB;;AAEA,UAAOC,UAAU,IAAIK,IAArB,EAA8B;AAC7BE,QAAAA,MAAM,GAAGF,IAAI,CAAEL,UAAF,CAAb;;AAEA,YAAK,OAAOO,MAAP,IAAiB,QAAtB,EAAiC;AAChC;;;;;AAKA,gBAAM,IAAIhB,aAAJ,CAAmB,2BAAnB,EAAgD,IAAhD,CAAN;AACA;;AAED,YAAK,KAAKiB,GAAL,CAAUD,MAAV,CAAL,EAA0B;AACzB;;;;;AAKA,gBAAM,IAAIhB,aAAJ,CAAmB,oCAAnB,EAAyD,IAAzD,CAAN;AACA;AACD,OApBD,MAoBO;AACNc,QAAAA,IAAI,CAAEL,UAAF,CAAJ,GAAqBO,MAAM,GAAGf,GAAG,EAAjC;AACA,OA1BiB,CA4BlB;;;AACA,UAAKc,KAAK,KAAKG,SAAf,EAA2B;AAC1BH,QAAAA,KAAK,GAAG,KAAKV,MAAL,CAAYc,MAApB;AACA,OAFD,MAEO,IAAKJ,KAAK,GAAG,KAAKV,MAAL,CAAYc,MAApB,IAA8BJ,KAAK,GAAG,CAA3C,EAA+C;AACrD;;;;;AAKA,cAAM,IAAIf,aAAJ,CAAmB,mCAAnB,EAAwD,IAAxD,CAAN;AACA;;AAED,WAAKK,MAAL,CAAYe,MAAZ,CAAoBL,KAApB,EAA2B,CAA3B,EAA8BD,IAA9B;;AAEA,WAAKR,QAAL,CAAce,GAAd,CAAmBL,MAAnB,EAA2BF,IAA3B;;AAEA,WAAKQ,IAAL,CAAW,KAAX,EAAkBR,IAAlB,EAAwBC,KAAxB;AAEA,aAAO,IAAP;AACA;AAED;;;;;;;;;wBAMKQ,S,EAAY;AAChB,UAAIT,IAAJ;;AAEA,UAAK,OAAOS,SAAP,IAAoB,QAAzB,EAAoC;AACnCT,QAAAA,IAAI,GAAG,KAAKR,QAAL,CAAcW,GAAd,CAAmBM,SAAnB,CAAP;AACA,OAFD,MAEO,IAAK,OAAOA,SAAP,IAAoB,QAAzB,EAAoC;AAC1CT,QAAAA,IAAI,GAAG,KAAKT,MAAL,CAAakB,SAAb,CAAP;AACA,OAFM,MAEA;AACN;;;;;AAKA,cAAM,IAAIvB,aAAJ,CAAmB,wDAAnB,EAA6E,IAA7E,CAAN;AACA;;AAED,aAAOc,IAAI,IAAI,IAAf;AACA;AAED;;;;;;;;;wBAMKU,Q,EAAW;AACf,UAAK,OAAOA,QAAP,IAAmB,QAAxB,EAAmC;AAClC,eAAO,KAAKlB,QAAL,CAAcmB,GAAd,CAAmBD,QAAnB,CAAP;AACA,OAFD,MAEO;AAAE;AACR,YAAMf,UAAU,GAAG,KAAKD,WAAxB;AACA,YAAMkB,EAAE,GAAGF,QAAQ,CAAEf,UAAF,CAAnB;AAEA,eAAO,KAAKH,QAAL,CAAcmB,GAAd,CAAmBC,EAAnB,CAAP;AACA;AACD;AAED;;;;;;;;;;6BAOUF,Q,EAAW;AACpB,UAAIV,IAAJ;;AAEA,UAAK,OAAOU,QAAP,IAAmB,QAAxB,EAAmC;AAClCV,QAAAA,IAAI,GAAG,KAAKR,QAAL,CAAcW,GAAd,CAAmBO,QAAnB,CAAP;AACA,OAFD,MAEO;AACNV,QAAAA,IAAI,GAAGU,QAAP;AACA;;AAED,aAAO,KAAKnB,MAAL,CAAYsB,OAAZ,CAAqBb,IAArB,CAAP;AACA;AAED;;;;;;;;;;2BAOQc,O,EAAU;AACjB,UAAIb,KAAJ,EAAWW,EAAX,EAAeZ,IAAf;AACA,UAAIe,gBAAgB,GAAG,KAAvB;AACA,UAAMpB,UAAU,GAAG,KAAKD,WAAxB;;AAEA,UAAK,OAAOoB,OAAP,IAAkB,QAAvB,EAAkC;AACjCF,QAAAA,EAAE,GAAGE,OAAL;AACAd,QAAAA,IAAI,GAAG,KAAKR,QAAL,CAAcW,GAAd,CAAmBS,EAAnB,CAAP;AACAG,QAAAA,gBAAgB,GAAG,CAACf,IAApB;;AAEA,YAAKA,IAAL,EAAY;AACXC,UAAAA,KAAK,GAAG,KAAKV,MAAL,CAAYsB,OAAZ,CAAqBb,IAArB,CAAR;AACA;AACD,OARD,MAQO,IAAK,OAAOc,OAAP,IAAkB,QAAvB,EAAkC;AACxCb,QAAAA,KAAK,GAAGa,OAAR;AACAd,QAAAA,IAAI,GAAG,KAAKT,MAAL,CAAaU,KAAb,CAAP;AACAc,QAAAA,gBAAgB,GAAG,CAACf,IAApB;;AAEA,YAAKA,IAAL,EAAY;AACXY,UAAAA,EAAE,GAAGZ,IAAI,CAAEL,UAAF,CAAT;AACA;AACD,OARM,MAQA;AACNK,QAAAA,IAAI,GAAGc,OAAP;AACAF,QAAAA,EAAE,GAAGZ,IAAI,CAAEL,UAAF,CAAT;AACAM,QAAAA,KAAK,GAAG,KAAKV,MAAL,CAAYsB,OAAZ,CAAqBb,IAArB,CAAR;AACAe,QAAAA,gBAAgB,GAAKd,KAAK,IAAI,CAAC,CAAV,IAAe,CAAC,KAAKT,QAAL,CAAcW,GAAd,CAAmBS,EAAnB,CAArC;AACA;;AAED,UAAKG,gBAAL,EAAwB;AACvB;;;;;AAKA,cAAM,IAAI7B,aAAJ,CAAmB,wCAAnB,EAA6D,IAA7D,CAAN;AACA;;AAED,WAAKK,MAAL,CAAYe,MAAZ,CAAoBL,KAApB,EAA2B,CAA3B;;AACA,WAAKT,QAAL,CAAcwB,MAAd,CAAsBJ,EAAtB;;AAEA,UAAMK,YAAY,GAAG,KAAKnB,4BAAL,CAAkCK,GAAlC,CAAuCH,IAAvC,CAArB;;AACA,WAAKF,4BAAL,CAAkCkB,MAAlC,CAA0ChB,IAA1C;;AACA,WAAKJ,4BAAL,CAAkCoB,MAAlC,CAA0CC,YAA1C;;AAEA,WAAKT,IAAL,CAAW,QAAX,EAAqBR,IAArB,EAA2BC,KAA3B;AAEA,aAAOD,IAAP;AACA;AAED;;;;;;;;;;;;wBASKkB,Q,EAAUC,G,EAAM;AACpB,aAAO,KAAK5B,MAAL,CAAY6B,GAAZ,CAAiBF,QAAjB,EAA2BC,GAA3B,CAAP;AACA;AAED;;;;;;;;;;;;yBASMD,Q,EAAUC,G,EAAM;AACrB,aAAO,KAAK5B,MAAL,CAAY8B,IAAZ,CAAkBH,QAAlB,EAA4BC,GAA5B,CAAP;AACA;AAED;;;;;;;;;;;;2BASQD,Q,EAAUC,G,EAAM;AACvB,aAAO,KAAK5B,MAAL,CAAY+B,MAAZ,CAAoBJ,QAApB,EAA8BC,GAA9B,CAAP;AACA;AAED;;;;;;;4BAIQ;AACP,UAAK,KAAKI,iBAAV,EAA8B;AAC7B,aAAKC,aAAL,CAAoB,KAAKD,iBAAzB;AACA,aAAKA,iBAAL,GAAyB,IAAzB;AACA;;AAED,aAAQ,KAAKlB,MAAb,EAAsB;AACrB,aAAKoB,MAAL,CAAa,CAAb;AACA;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BAiGQC,kB,EAAqB;AAAA;;AAC5B,UAAK,KAAKH,iBAAV,EAA8B;AAC7B;;;;;AAKA,cAAM,IAAIrC,aAAJ,CAAmB,2EAAnB,EAAgG,IAAhG,CAAN;AACA;;AAED,WAAKqC,iBAAL,GAAyBG,kBAAzB;AAEA,aAAO;AACNC,QAAAA,EAAE,EAAE,YAAAC,KAAK,EAAI;AACZ,UAAA,KAAI,CAACC,mBAAL,CAA0B,UAAA7B,IAAI;AAAA,mBAAI,IAAI4B,KAAJ,CAAW5B,IAAX,CAAJ;AAAA,WAA9B;AACA,SAHK;AAKN8B,QAAAA,KAAK,EAAE,eAAAC,kBAAkB,EAAI;AAC5B,cAAK,OAAOA,kBAAP,IAA6B,UAAlC,EAA+C;AAC9C,YAAA,KAAI,CAACF,mBAAL,CAA0B,UAAA7B,IAAI;AAAA,qBAAI+B,kBAAkB,CAAE/B,IAAF,CAAtB;AAAA,aAA9B;AACA,WAFD,MAEO;AACN,YAAA,KAAI,CAAC6B,mBAAL,CAA0B,UAAA7B,IAAI;AAAA,qBAAIA,IAAI,CAAE+B,kBAAF,CAAR;AAAA,aAA9B;AACA;AACD;AAXK,OAAP;AAaA;AAED;;;;;;;;;wCAMqBC,O,EAAU;AAAA;;AAC9B,UAAMN,kBAAkB,GAAG,KAAKH,iBAAhC,CAD8B,CAG9B;AACA;AACA;;AACA,UAAMU,OAAO,GAAG,SAAVA,OAAU,CAAEC,GAAF,EAAOjB,YAAP,EAAqBhB,KAArB,EAAgC;AAC/C,YAAMkC,qBAAqB,GAAGT,kBAAkB,CAACH,iBAAnB,IAAwC,MAAtE;;AACA,YAAMa,iBAAiB,GAAGV,kBAAkB,CAAC5B,4BAAnB,CAAgDK,GAAhD,CAAqDc,YAArD,CAA1B,CAF+C,CAI/C;AACA;AACA;AACA;;;AACA,YAAKkB,qBAAqB,IAAIC,iBAA9B,EAAkD;AACjD,UAAA,MAAI,CAACxC,4BAAL,CAAkCW,GAAlC,CAAuCU,YAAvC,EAAqDmB,iBAArD;;AACA,UAAA,MAAI,CAACtC,4BAAL,CAAkCS,GAAlC,CAAuC6B,iBAAvC,EAA0DnB,YAA1D;AACA,SAHD,MAGO;AACN,cAAMjB,IAAI,GAAGgC,OAAO,CAAEf,YAAF,CAApB,CADM,CAGN;;AACA,cAAK,CAACjB,IAAN,EAAa;AACZ,YAAA,MAAI,CAACD,2BAAL,CAAiCsC,IAAjC,CAAuCpC,KAAvC;;AAEA;AACA,WARK,CAUN;AACA;;;AACA,cAAIqC,UAAU,GAAGrC,KAAjB,CAZM,CAcN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA9BM;AAAA;AAAA;;AAAA;AA+BN,iCAAuB,MAAI,CAACF,2BAA5B,8HAA0D;AAAA,kBAA9CwC,OAA8C;;AACzD,kBAAKtC,KAAK,GAAGsC,OAAb,EAAuB;AACtBD,gBAAAA,UAAU;AACV;AACD,aAnCK,CAqCN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAjDM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAkDN,kCAAuBZ,kBAAkB,CAAC3B,2BAA1C,mIAAwE;AAAA,kBAA5DwC,QAA4D;;AACvE,kBAAKD,UAAU,IAAIC,QAAnB,EAA6B;AAC5BD,gBAAAA,UAAU;AACV;AACD;AAtDK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAwDN,UAAA,MAAI,CAAC1C,4BAAL,CAAkCW,GAAlC,CAAuCU,YAAvC,EAAqDjB,IAArD;;AACA,UAAA,MAAI,CAACF,4BAAL,CAAkCS,GAAlC,CAAuCP,IAAvC,EAA6CiB,YAA7C;;AACA,UAAA,MAAI,CAACuB,GAAL,CAAUxC,IAAV,EAAgBsC,UAAhB,EA1DM,CA4DN;AACA;;;AACA,eAAM,IAAIG,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGf,kBAAkB,CAAC3B,2BAAnB,CAA+CM,MAApE,EAA4EoC,CAAC,EAA7E,EAAkF;AACjF,gBAAKH,UAAU,IAAIZ,kBAAkB,CAAC3B,2BAAnB,CAAgD0C,CAAhD,CAAnB,EAAyE;AACxEf,cAAAA,kBAAkB,CAAC3B,2BAAnB,CAAgD0C,CAAhD;AACA;AACD;AACD;AACD,OA/ED,CAN8B,CAuF9B;;;AAvF8B;AAAA;AAAA;;AAAA;AAwF9B,8BAA4Bf,kBAA5B,mIAAiD;AAAA,cAArCT,YAAqC;AAChDgB,UAAAA,OAAO,CAAE,IAAF,EAAQhB,YAAR,EAAsBS,kBAAkB,CAACgB,QAAnB,CAA6BzB,YAA7B,CAAtB,CAAP;AACA,SA1F6B,CA4F9B;;AA5F8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA6F9B,WAAK0B,QAAL,CAAejB,kBAAf,EAAmC,KAAnC,EAA0CO,OAA1C,EA7F8B,CA+F9B;;AACA,WAAKU,QAAL,CAAejB,kBAAf,EAAmC,QAAnC,EAA6C,UAAEQ,GAAF,EAAOjB,YAAP,EAAqBhB,KAArB,EAAgC;AAC5E,YAAMD,IAAI,GAAG,MAAI,CAACJ,4BAAL,CAAkCO,GAAlC,CAAuCc,YAAvC,CAAb;;AAEA,YAAKjB,IAAL,EAAY;AACX,UAAA,MAAI,CAACyB,MAAL,CAAazB,IAAb;AACA,SAL2E,CAO5E;AACA;;;AACA,QAAA,MAAI,CAACD,2BAAL,GAAmC,MAAI,CAACA,2BAAL,CAAiC6C,MAAjC,CAAyC,UAAEC,MAAF,EAAUN,OAAV,EAAuB;AAClG,cAAKtC,KAAK,GAAGsC,OAAb,EAAuB;AACtBM,YAAAA,MAAM,CAACR,IAAP,CAAaE,OAAO,GAAG,CAAvB;AACA;;AAED,cAAKtC,KAAK,GAAGsC,OAAb,EAAuB;AACtBM,YAAAA,MAAM,CAACR,IAAP,CAAaE,OAAb;AACA;;AAED,iBAAOM,MAAP;AACA,SAVkC,EAUhC,EAVgC,CAAnC;AAWA,OApBD;AAqBA;AAED;;;;;;;SAKEC,MAAM,CAACC,Q;4BAAa;AACrB,aAAO,KAAKxD,MAAL,CAAauD,MAAM,CAACC,QAApB,GAAP;AACA;AAED;;;;;;;AAOA;;;;;;;;;;wBAtgBa;AACZ,aAAO,KAAKxD,MAAL,CAAYc,MAAnB;AACA;AAED;;;;;;;;wBAKY;AACX,aAAO,KAAKd,MAAL,CAAa,CAAb,KAAoB,IAA3B;AACA;AAED;;;;;;;;wBAKW;AACV,aAAO,KAAKA,MAAL,CAAa,KAAKc,MAAL,GAAc,CAA3B,KAAkC,IAAzC;AACA;;;;;;SAlGmBhB,U;AA6lBrBD,GAAG,CAAEC,UAAF,EAAcJ,YAAd,CAAH;AAEA;;;;;;;;;AASA;;;;;;;;AAQA","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module utils/collection\n */\n\nimport EmitterMixin from './emittermixin';\nimport CKEditorError from './ckeditorerror';\nimport uid from './uid';\nimport mix from './mix';\n\n/**\n * Collections are ordered sets of objects. Items in the collection can be retrieved by their indexes\n * in the collection (like in an array) or by their ids.\n *\n * If an object without an `id` property is being added to the collection, the `id` property will be generated\n * automatically. Note that the automatically generated id is unique only within this single collection instance.\n *\n * By default an item in the collection is identified by its `id` property. The name of the identifier can be\n * configured through the constructor of the collection.\n *\n * @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Collection {\n\t/**\n\t * Creates a new Collection instance.\n\t *\n\t * @param {Object} [options={}] The options object.\n\t * @param {String} [options.idProperty='id'] The name of the property which is considered to identify an item.\n\t */\n\tconstructor( options = {} ) {\n\t\t/**\n\t\t * The internal list of items in the collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Object[]}\n\t\t */\n\t\tthis._items = [];\n\n\t\t/**\n\t\t * The internal map of items in the collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Map}\n\t\t */\n\t\tthis._itemMap = new Map();\n\n\t\t/**\n\t\t * The name of the property which is considered to identify an item.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._idProperty = options.idProperty || 'id';\n\n\t\t/**\n\t\t * A helper mapping external items of a bound collection ({@link #bindTo})\n\t\t * and actual items of this collection. It provides information\n\t\t * necessary to properly remove items bound to another collection.\n\t\t *\n\t\t * See {@link #_bindToInternalToExternalMap}.\n\t\t *\n\t\t * @protected\n\t\t * @member {WeakMap}\n\t\t */\n\t\tthis._bindToExternalToInternalMap = new WeakMap();\n\n\t\t/**\n\t\t * A helper mapping items of this collection to external items of a bound collection\n\t\t * ({@link #bindTo}). It provides information necessary to manage the bindings, e.g.\n\t\t * to avoid loops in twoâ€“way bindings.\n\t\t *\n\t\t * See {@link #_bindToExternalToInternalMap}.\n\t\t *\n\t\t * @protected\n\t\t * @member {WeakMap}\n\t\t */\n\t\tthis._bindToInternalToExternalMap = new WeakMap();\n\n\t\t/**\n\t\t * Stores indexes of skipped items from bound external collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Array}\n\t\t */\n\t\tthis._skippedIndexesFromExternal = [];\n\n\t\t/**\n\t\t * A collection instance this collection is bound to as a result\n\t\t * of calling {@link #bindTo} method.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:utils/collection~Collection} #_bindToCollection\n\t\t */\n\t}\n\n\t/**\n\t * The number of items available in the collection.\n\t *\n\t * @member {Number} #length\n\t */\n\tget length() {\n\t\treturn this._items.length;\n\t}\n\n\t/**\n\t * Returns the first item from the collection or null when collection is empty.\n\t *\n\t * @returns {Object|null} The first item or `null` if collection is empty.\n\t */\n\tget first() {\n\t\treturn this._items[ 0 ] || null;\n\t}\n\n\t/**\n\t * Returns the last item from the collection or null when collection is empty.\n\t *\n\t * @returns {Object|null} The last item or `null` if collection is empty.\n\t */\n\tget last() {\n\t\treturn this._items[ this.length - 1 ] || null;\n\t}\n\n\t/**\n\t * Adds an item into the collection.\n\t *\n\t * If the item does not have an id, then it will be automatically generated and set on the item.\n\t *\n\t * @chainable\n\t * @param {Object} item\n\t * @param {Number} [index] The position of the item in the collection. The item\n\t * is pushed to the collection when `index` not specified.\n\t * @fires add\n\t */\n\tadd( item, index ) {\n\t\tlet itemId;\n\t\tconst idProperty = this._idProperty;\n\n\t\tif ( ( idProperty in item ) ) {\n\t\t\titemId = item[ idProperty ];\n\n\t\t\tif ( typeof itemId != 'string' ) {\n\t\t\t\t/**\n\t\t\t\t * This item's id should be a string.\n\t\t\t\t *\n\t\t\t\t * @error collection-add-invalid-id\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'collection-add-invalid-id', this );\n\t\t\t}\n\n\t\t\tif ( this.get( itemId ) ) {\n\t\t\t\t/**\n\t\t\t\t * This item already exists in the collection.\n\t\t\t\t *\n\t\t\t\t * @error collection-add-item-already-exists\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'collection-add-item-already-exists', this );\n\t\t\t}\n\t\t} else {\n\t\t\titem[ idProperty ] = itemId = uid();\n\t\t}\n\n\t\t// TODO: Use ES6 default function argument.\n\t\tif ( index === undefined ) {\n\t\t\tindex = this._items.length;\n\t\t} else if ( index > this._items.length || index < 0 ) {\n\t\t\t/**\n\t\t\t * The index number has invalid value.\n\t\t\t *\n\t\t\t * @error collection-add-item-bad-index\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-add-item-invalid-index', this );\n\t\t}\n\n\t\tthis._items.splice( index, 0, item );\n\n\t\tthis._itemMap.set( itemId, item );\n\n\t\tthis.fire( 'add', item, index );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Gets item by its id or index.\n\t *\n\t * @param {String|Number} idOrIndex The item id or index in the collection.\n\t * @returns {Object|null} The requested item or `null` if such item does not exist.\n\t */\n\tget( idOrIndex ) {\n\t\tlet item;\n\n\t\tif ( typeof idOrIndex == 'string' ) {\n\t\t\titem = this._itemMap.get( idOrIndex );\n\t\t} else if ( typeof idOrIndex == 'number' ) {\n\t\t\titem = this._items[ idOrIndex ];\n\t\t} else {\n\t\t\t/**\n\t\t\t * Index or id must be given.\n\t\t\t *\n\t\t\t * @error collection-get-invalid-arg\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-get-invalid-arg: Index or id must be given.', this );\n\t\t}\n\n\t\treturn item || null;\n\t}\n\n\t/**\n\t * Returns a boolean indicating whether the collection contains an item.\n\t *\n\t * @param {Object|String} itemOrId The item or its id in the collection.\n\t * @returns {Boolean} `true` if the collection contains the item, `false` otherwise.\n\t */\n\thas( itemOrId ) {\n\t\tif ( typeof itemOrId == 'string' ) {\n\t\t\treturn this._itemMap.has( itemOrId );\n\t\t} else { // Object\n\t\t\tconst idProperty = this._idProperty;\n\t\t\tconst id = itemOrId[ idProperty ];\n\n\t\t\treturn this._itemMap.has( id );\n\t\t}\n\t}\n\n\t/**\n\t * Gets index of item in the collection.\n\t * When item is not defined in the collection then index will be equal -1.\n\t *\n\t * @param {Object|String} itemOrId The item or its id in the collection.\n\t * @returns {Number} Index of given item.\n\t */\n\tgetIndex( itemOrId ) {\n\t\tlet item;\n\n\t\tif ( typeof itemOrId == 'string' ) {\n\t\t\titem = this._itemMap.get( itemOrId );\n\t\t} else {\n\t\t\titem = itemOrId;\n\t\t}\n\n\t\treturn this._items.indexOf( item );\n\t}\n\n\t/**\n\t * Removes an item from the collection.\n\t *\n\t * @param {Object|Number|String} subject The item to remove, its id or index in the collection.\n\t * @returns {Object} The removed item.\n\t * @fires remove\n\t */\n\tremove( subject ) {\n\t\tlet index, id, item;\n\t\tlet itemDoesNotExist = false;\n\t\tconst idProperty = this._idProperty;\n\n\t\tif ( typeof subject == 'string' ) {\n\t\t\tid = subject;\n\t\t\titem = this._itemMap.get( id );\n\t\t\titemDoesNotExist = !item;\n\n\t\t\tif ( item ) {\n\t\t\t\tindex = this._items.indexOf( item );\n\t\t\t}\n\t\t} else if ( typeof subject == 'number' ) {\n\t\t\tindex = subject;\n\t\t\titem = this._items[ index ];\n\t\t\titemDoesNotExist = !item;\n\n\t\t\tif ( item ) {\n\t\t\t\tid = item[ idProperty ];\n\t\t\t}\n\t\t} else {\n\t\t\titem = subject;\n\t\t\tid = item[ idProperty ];\n\t\t\tindex = this._items.indexOf( item );\n\t\t\titemDoesNotExist = ( index == -1 || !this._itemMap.get( id ) );\n\t\t}\n\n\t\tif ( itemDoesNotExist ) {\n\t\t\t/**\n\t\t\t * Item not found.\n\t\t\t *\n\t\t\t * @error collection-remove-404\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-remove-404: Item not found.', this );\n\t\t}\n\n\t\tthis._items.splice( index, 1 );\n\t\tthis._itemMap.delete( id );\n\n\t\tconst externalItem = this._bindToInternalToExternalMap.get( item );\n\t\tthis._bindToInternalToExternalMap.delete( item );\n\t\tthis._bindToExternalToInternalMap.delete( externalItem );\n\n\t\tthis.fire( 'remove', item, index );\n\n\t\treturn item;\n\t}\n\n\t/**\n\t * Executes the callback for each item in the collection and composes an array or values returned by this callback.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Array} The result of mapping.\n\t */\n\tmap( callback, ctx ) {\n\t\treturn this._items.map( callback, ctx );\n\t}\n\n\t/**\n\t * Finds the first item in the collection for which the `callback` returns a true value.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Object} The item for which `callback` returned a true value.\n\t */\n\tfind( callback, ctx ) {\n\t\treturn this._items.find( callback, ctx );\n\t}\n\n\t/**\n\t * Returns an array with items for which the `callback` returned a true value.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Object[]} The array with matching items.\n\t */\n\tfilter( callback, ctx ) {\n\t\treturn this._items.filter( callback, ctx );\n\t}\n\n\t/**\n\t * Removes all items from the collection and destroys the binding created using\n\t * {@link #bindTo}.\n\t */\n\tclear() {\n\t\tif ( this._bindToCollection ) {\n\t\t\tthis.stopListening( this._bindToCollection );\n\t\t\tthis._bindToCollection = null;\n\t\t}\n\n\t\twhile ( this.length ) {\n\t\t\tthis.remove( 0 );\n\t\t}\n\t}\n\n\t/**\n\t * Binds and synchronizes the collection with another one.\n\t *\n\t * The binding can be a simple factory:\n\t *\n\t *\t\tclass FactoryClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).as( FactoryClass );\n\t *\n\t *\t\tsource.add( { label: 'foo' } );\n\t *\t\tsource.add( { label: 'bar' } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 1 ).label ); // 'bar'\n\t *\n\t *\t\tsource.remove( 0 );\n\t *\t\tconsole.log( target.length ); // 1\n\t *\t\tconsole.log( target.get( 0 ).label ); // 'bar'\n\t *\n\t * or the factory driven by a custom callback:\n\t *\n\t *\t\tclass FooClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tclass BarClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( ( item ) => {\n\t *\t\t\tif ( item.label == 'foo' ) {\n\t *\t\t\t\treturn new FooClass( item );\n\t *\t\t\t} else {\n\t *\t\t\t\treturn new BarClass( item );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t *\t\tsource.add( { label: 'foo' } );\n\t *\t\tsource.add( { label: 'bar' } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 0 ) instanceof FooClass ); // true\n\t *\t\tconsole.log( target.get( 1 ) instanceof BarClass ); // true\n\t *\n\t * or the factory out of property name:\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( 'label' );\n\t *\n\t *\t\tsource.add( { label: { value: 'foo' } } );\n\t *\t\tsource.add( { label: { value: 'bar' } } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 0 ).value ); // 'foo'\n\t *\t\tconsole.log( target.get( 1 ).value ); // 'bar'\n\t *\n\t * It's possible to skip specified items by returning falsy value:\n\t *\n\t *\t\tconst source = new Collection();\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( item => {\n\t *\t\t\tif ( item.hidden ) {\n\t *\t\t\t\treturn null;\n\t *\t\t\t}\n\t *\n\t *\t\t\treturn item;\n\t *\t\t} );\n\t *\n\t *\t\tsource.add( { hidden: true } );\n\t *\t\tsource.add( { hidden: false } );\n\t *\n\t *\t\tconsole.log( source.length ); // 2\n\t *\t\tconsole.log( target.length ); // 1\n\t *\n\t * **Note**: {@link #clear} can be used to break the binding.\n\t *\n\t * @param {module:utils/collection~Collection} externalCollection A collection to be bound.\n\t * @returns {Object}\n\t * @returns {module:utils/collection~CollectionBindToChain} The binding chain object.\n\t */\n\tbindTo( externalCollection ) {\n\t\tif ( this._bindToCollection ) {\n\t\t\t/**\n\t\t\t * The collection cannot be bound more than once.\n\t\t\t *\n\t\t\t * @error collection-bind-to-rebind\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-bind-to-rebind: The collection cannot be bound more than once.', this );\n\t\t}\n\n\t\tthis._bindToCollection = externalCollection;\n\n\t\treturn {\n\t\t\tas: Class => {\n\t\t\t\tthis._setUpBindToBinding( item => new Class( item ) );\n\t\t\t},\n\n\t\t\tusing: callbackOrProperty => {\n\t\t\t\tif ( typeof callbackOrProperty == 'function' ) {\n\t\t\t\t\tthis._setUpBindToBinding( item => callbackOrProperty( item ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis._setUpBindToBinding( item => item[ callbackOrProperty ] );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Finalizes and activates a binding initiated by {#bindTo}.\n\t *\n\t * @protected\n\t * @param {Function} factory A function which produces collection items.\n\t */\n\t_setUpBindToBinding( factory ) {\n\t\tconst externalCollection = this._bindToCollection;\n\n\t\t// Adds the item to the collection once a change has been done to the external collection.\n\t\t//\n\t\t// @private\n\t\tconst addItem = ( evt, externalItem, index ) => {\n\t\t\tconst isExternalBoundToThis = externalCollection._bindToCollection == this;\n\t\t\tconst externalItemBound = externalCollection._bindToInternalToExternalMap.get( externalItem );\n\n\t\t\t// If an external collection is bound to this collection, which makes it a 2â€“way binding,\n\t\t\t// and the particular external collection item is already bound, don't add it here.\n\t\t\t// The external item has been created **out of this collection's item** and (re)adding it will\n\t\t\t// cause a loop.\n\t\t\tif ( isExternalBoundToThis && externalItemBound ) {\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, externalItemBound );\n\t\t\t\tthis._bindToInternalToExternalMap.set( externalItemBound, externalItem );\n\t\t\t} else {\n\t\t\t\tconst item = factory( externalItem );\n\n\t\t\t\t// When there is no item we need to remember skipped index first and then we can skip this item.\n\t\t\t\tif ( !item ) {\n\t\t\t\t\tthis._skippedIndexesFromExternal.push( index );\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Lets try to put item at the same index as index in external collection\n\t\t\t\t// but when there are a skipped items in one or both collections we need to recalculate this index.\n\t\t\t\tlet finalIndex = index;\n\n\t\t\t\t// When we try to insert item after some skipped items from external collection we need\n\t\t\t\t// to include this skipped items and decrease index.\n\t\t\t\t//\n\t\t\t\t// For the following example:\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal' ]\n\t\t\t\t// internal -> [ A ]\n\t\t\t\t//\n\t\t\t\t// Another item is been added at the end of external collection:\n\t\t\t\t// external.add( 'D' )\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal', 'D' ]\n\t\t\t\t//\n\t\t\t\t// We can't just add 'D' to internal at the same index as index in external because\n\t\t\t\t// this will produce empty indexes what is invalid:\n\t\t\t\t// internal -> [ 'A', empty, empty, 'D' ]\n\t\t\t\t//\n\t\t\t\t// So we need to include skipped items and decrease index\n\t\t\t\t// internal -> [ 'A', 'D' ]\n\t\t\t\tfor ( const skipped of this._skippedIndexesFromExternal ) {\n\t\t\t\t\tif ( index > skipped ) {\n\t\t\t\t\t\tfinalIndex--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We need to take into consideration that external collection could skip some items from\n\t\t\t\t// internal collection.\n\t\t\t\t//\n\t\t\t\t// For the following example:\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external' ]\n\t\t\t\t// external -> [ A ]\n\t\t\t\t//\n\t\t\t\t// Another item is been added at the end of external collection:\n\t\t\t\t// external.add( 'D' )\n\t\t\t\t// external -> [ 'A', 'D' ]\n\t\t\t\t//\n\t\t\t\t// We need to include skipped items and place new item after them:\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external', 'D' ]\n\t\t\t\tfor ( const skipped of externalCollection._skippedIndexesFromExternal ) {\n\t\t\t\t\tif ( finalIndex >= skipped ) {\n\t\t\t\t\t\tfinalIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, item );\n\t\t\t\tthis._bindToInternalToExternalMap.set( item, externalItem );\n\t\t\t\tthis.add( item, finalIndex );\n\n\t\t\t\t// After adding new element to internal collection we need update indexes\n\t\t\t\t// of skipped items in external collection.\n\t\t\t\tfor ( let i = 0; i < externalCollection._skippedIndexesFromExternal.length; i++ ) {\n\t\t\t\t\tif ( finalIndex <= externalCollection._skippedIndexesFromExternal[ i ] ) {\n\t\t\t\t\t\texternalCollection._skippedIndexesFromExternal[ i ]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Load the initial content of the collection.\n\t\tfor ( const externalItem of externalCollection ) {\n\t\t\taddItem( null, externalItem, externalCollection.getIndex( externalItem ) );\n\t\t}\n\n\t\t// Synchronize the with collection as new items are added.\n\t\tthis.listenTo( externalCollection, 'add', addItem );\n\n\t\t// Synchronize the with collection as new items are removed.\n\t\tthis.listenTo( externalCollection, 'remove', ( evt, externalItem, index ) => {\n\t\t\tconst item = this._bindToExternalToInternalMap.get( externalItem );\n\n\t\t\tif ( item ) {\n\t\t\t\tthis.remove( item );\n\t\t\t}\n\n\t\t\t// After removing element from external collection we need update/remove indexes\n\t\t\t// of skipped items in internal collection.\n\t\t\tthis._skippedIndexesFromExternal = this._skippedIndexesFromExternal.reduce( ( result, skipped ) => {\n\t\t\t\tif ( index < skipped ) {\n\t\t\t\t\tresult.push( skipped - 1 );\n\t\t\t\t}\n\n\t\t\t\tif ( index > skipped ) {\n\t\t\t\t\tresult.push( skipped );\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}, [] );\n\t\t} );\n\t}\n\n\t/**\n\t * Iterable interface.\n\t *\n\t * @returns {Iterable.<*>}\n\t */\n\t[ Symbol.iterator ]() {\n\t\treturn this._items[ Symbol.iterator ]();\n\t}\n\n\t/**\n\t * Fired when an item is added to the collection.\n\t *\n\t * @event add\n\t * @param {Object} item The added item.\n\t */\n\n\t/**\n\t * Fired when an item is removed from the collection.\n\t *\n\t * @event remove\n\t * @param {Object} item The removed item.\n\t * @param {Number} index Index from which item was removed.\n\t */\n}\n\nmix( Collection, EmitterMixin );\n\n/**\n * An object returned by the {@link module:utils/collection~Collection#bindTo `bindTo()`} method\n * providing functions that specify the type of the binding.\n *\n * See the {@link module:utils/collection~Collection#bindTo `bindTo()`} documentation for examples.\n *\n * @interface module:utils/collection~CollectionBindToChain\n */\n\n/**\n * Creates a callback or a property binding.\n *\n * @method #using\n * @param {Function|String} callbackOrProperty  When the function is passed, it should return\n * the collection items. When the string is provided, the property value is used to create the bound collection items.\n */\n\n/**\n * Creates the class factory binding in which items of the source collection are passed to\n * the constructor of the specified class.\n *\n * @method #as\n * @param {Function} Class The class constructor used to create instances in the factory.\n */\n"]}]}