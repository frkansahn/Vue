{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\view\\selection.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\view\\selection.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1581760786382},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuYW5jaG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMCwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSBlbmdpbmUvdmlldy9zZWxlY3Rpb24KICovCmltcG9ydCBDS0VkaXRvckVycm9yIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgUmFuZ2UgZnJvbSAnLi9yYW5nZSc7CmltcG9ydCBQb3NpdGlvbiBmcm9tICcuL3Bvc2l0aW9uJzsKaW1wb3J0IG1peCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9taXgnOwppbXBvcnQgRW1pdHRlck1peGluIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2VtaXR0ZXJtaXhpbic7CmltcG9ydCBOb2RlIGZyb20gJy4vbm9kZSc7CmltcG9ydCBjb3VudCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9jb3VudCc7CmltcG9ydCBpc0l0ZXJhYmxlIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2lzaXRlcmFibGUnOwppbXBvcnQgRG9jdW1lbnRTZWxlY3Rpb24gZnJvbSAnLi9kb2N1bWVudHNlbGVjdGlvbic7Ci8qKgogKiBDbGFzcyByZXByZXNlbnRpbmcgYW4gYXJiaXJ0YXJ5IHNlbGVjdGlvbiBpbiB0aGUgdmlldy4KICogU2VlIGFsc28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbn0uCiAqCiAqIE5ldyBzZWxlY3Rpb24gaW5zdGFuY2VzIGNhbiBiZSBjcmVhdGVkIHZpYSB0aGUgY29uc3RydWN0b3Igb3Igb25lIHRoZXNlIG1ldGhvZHM6CiAqCiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY3JlYXRlU2VsZWN0aW9uIGBWaWV3I2NyZWF0ZVNlbGVjdGlvbigpYH0sCiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91cGNhc3R3cml0ZXJ+VXBjYXN0V3JpdGVyI2NyZWF0ZVNlbGVjdGlvbiBgVXBjYXN0V3JpdGVyI2NyZWF0ZVNlbGVjdGlvbigpYH0uCiAqCiAqIEEgc2VsZWN0aW9uIGNhbiBjb25zaXN0IG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2VzfSB0aGF0IGNhbiBiZSBzZXQgYnkgdXNpbmcKICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbiNzZXRUbyBgU2VsZWN0aW9uI3NldFRvKClgfSBtZXRob2QuCiAqLwoKdmFyIFNlbGVjdGlvbiA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIC8qKgogICAqIENyZWF0ZXMgbmV3IHNlbGVjdGlvbiBpbnN0YW5jZS4KICAgKgogICAqICoqTm90ZSoqOiBUaGUgc2VsZWN0aW9uIGNvbnN0cnVjdG9yIGlzIGF2YWlsYWJsZSBhcyBhIGZhY3RvcnkgbWV0aG9kOgogICAqCiAgICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVTZWxlY3Rpb24gYFZpZXcjY3JlYXRlU2VsZWN0aW9uKClgfSwKICAgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdXBjYXN0d3JpdGVyflVwY2FzdFdyaXRlciNjcmVhdGVTZWxlY3Rpb24gYFVwY2FzdFdyaXRlciNjcmVhdGVTZWxlY3Rpb24oKWB9LgogICAqCiAgICogCQkvLyBDcmVhdGVzIGVtcHR5IHNlbGVjdGlvbiB3aXRob3V0IHJhbmdlcy4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpOwogICAqCiAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiByYW5nZS4KICAgKgkJY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTsKICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2UgKTsKICAgKgogICAqCQkvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcmFuZ2VzCiAgICogCQljb25zdCByYW5nZXMgPSBbIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcnQxLCBlbmQyICksIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcjIsIGVuZDIgKSBdOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZXMgKTsKICAgKgogICAqCQkvLyBDcmVhdGVzIHNlbGVjdGlvbiBmcm9tIHRoZSBvdGhlciBzZWxlY3Rpb24uCiAgICoJCWNvbnN0IG90aGVyU2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBvdGhlclNlbGVjdGlvbiApOwogICAqCiAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGZyb20gdGhlIGRvY3VtZW50IHNlbGVjdGlvbi4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb24gKTsKICAgKgogICAqIAkJLy8gQ3JlYXRlcyBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHBvc2l0aW9uLgogICAqCQljb25zdCBwb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBwYXRoICk7CiAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHBvc2l0aW9uICk7CiAgICoKICAgKgkJLy8gQ3JlYXRlcyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiBnaXZlbiBpdGVtIGFuZCBvZmZzZXQuCiAgICoJCWNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAncGFyYWdyYXBoJyApOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsIG9mZnNldCApOwogICAqCiAgICoJCS8vIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUKICAgKgkJLy8gZmlyc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnaW4nICk7CiAgICoKICAgKgkJLy8gQ3JlYXRlcyBhIHJhbmdlIG9uIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHMKICAgKgkJLy8ganVzdCBhZnRlciB0aGUgaXRlbS4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnb24nICk7CiAgICoKICAgKiBgU2VsZWN0aW9uYCdzIGNvbnN0cnVjdG9yIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBvcHRpb25zIChgYmFja3dhcmRgLCBgZmFrZWAgYW5kIGBsYWJlbGApIGFzIHRoZSBsYXN0IGFyZ3VtZW50LgogICAqCiAgICoJCS8vIENyZWF0ZXMgYmFja3dhcmQgc2VsZWN0aW9uLgogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBiYWNrd2FyZDogdHJ1ZSB9ICk7CiAgICoKICAgKiBGYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uIG92ZXIgc2VsZWN0ZWQgZWxlbWVudHMgYW5kIGlzIGhpZGRlbiB0byB0aGUgdXNlci4KICAgKiBUaGlzIHdheSwgbm8gbmF0aXZlIHNlbGVjdGlvbiBVSSBhcnRpZmFjdHMgYXJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhbmQgc2VsZWN0aW9uIG92ZXIgZWxlbWVudHMgY2FuIGJlCiAgICogcmVwcmVzZW50ZWQgaW4gb3RoZXIgd2F5LCBmb3IgZXhhbXBsZSBieSBhcHBseWluZyBwcm9wZXIgQ1NTIGNsYXNzLgogICAqCiAgICogQWRkaXRpb25hbGx5IGZha2UncyBzZWxlY3Rpb24gbGFiZWwgY2FuIGJlIHByb3ZpZGVkLiBJdCB3aWxsIGJlIHVzZWQgdG8gZGVzY3JpYmUgZmFrZSBzZWxlY3Rpb24gaW4gRE9NCiAgICogKGFuZCBiZSAgcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuCiAgICoKICAgKgkJLy8gQ3JlYXRlcyBmYWtlIHNlbGVjdGlvbiB3aXRoIGxhYmVsLgogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApOwogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGFibGV9IFtzZWxlY3RhYmxlPW51bGxdCiAgICogQHBhcmFtIHtOdW1iZXJ8J2JlZm9yZSd8J2VuZCd8J2FmdGVyJ3wnb24nfCdpbid9IFtwbGFjZU9yT2Zmc2V0XSBPZmZzZXQgb3IgcGxhY2Ugd2hlbiBzZWxlY3RhYmxlIGlzIGFuIGBJdGVtYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5iYWNrd2FyZF0gU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBiYWNrd2FyZC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmZha2VdIFNldHMgdGhpcyBzZWxlY3Rpb24gaW5zdGFuY2UgdG8gYmUgbWFya2VkIGFzIGBmYWtlYC4KICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMubGFiZWxdIExhYmVsIGZvciB0aGUgZmFrZSBzZWxlY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gU2VsZWN0aW9uKCkgewogICAgdmFyIHNlbGVjdGFibGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IG51bGw7CiAgICB2YXIgcGxhY2VPck9mZnNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2VsZWN0aW9uKTsKCiAgICAvKioKICAgICAqIFN0b3JlcyBhbGwgcmFuZ2VzIHRoYXQgYXJlIHNlbGVjdGVkLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2U+fQogICAgICovCiAgICB0aGlzLl9yYW5nZXMgPSBbXTsKICAgIC8qKgogICAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGxhc3QgYWRkZWQgcmFuZ2Ugd2FzIGFkZGVkIGFzIGEgYmFja3dhcmQgb3IgZm9yd2FyZCByYW5nZS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHtCb29sZWFufQogICAgICovCgogICAgdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPSBmYWxzZTsKICAgIC8qKgogICAgICogU3BlY2lmaWVzIHdoZXRoZXIgc2VsZWN0aW9uIGluc3RhbmNlIGlzIGZha2UuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9pc0Zha2UgPSBmYWxzZTsKICAgIC8qKgogICAgICogRmFrZSBzZWxlY3Rpb24ncyBsYWJlbC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7U3RyaW5nfQogICAgICovCgogICAgdGhpcy5fZmFrZVNlbGVjdGlvbkxhYmVsID0gJyc7CiAgICB0aGlzLnNldFRvKHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQsIG9wdGlvbnMpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgc2VsZWN0aW9uIGluc3RhbmNlIGlzIG1hcmtlZCBhcyBgZmFrZWAuCiAgICoKICAgKiBAc2VlICNzZXRUbwogICAqIEByZXR1cm5zIHtCb29sZWFufQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKFNlbGVjdGlvbiwgW3sKICAgIGtleTogImdldFJhbmdlcyIsCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGl0ZXJhYmxlIHRoYXQgY29udGFpbnMgY29waWVzIG9mIGFsbCByYW5nZXMgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7SXRlcmFibGUuPG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZT59CiAgICAgKi8KICAgIHZhbHVlOgogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gZ2V0UmFuZ2VzKCkgewogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiwgX2RpZEl0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvckVycm9yLCBfaXRlcmF0b3IsIF9zdGVwLCByYW5nZTsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBnZXRSYW5nZXMkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDM7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gdGhpcy5fcmFuZ2VzW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmFuZ2UgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcmFuZ2UuY2xvbmUoKTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE4OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgzKTsKICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBfY29udGV4dC50MDsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE4OwogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxOTsKCiAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDIxOwoKICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwoKICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDIxKTsKCiAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmZpbmlzaCgxOCk7CgogICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBnZXRSYW5nZXMsIHRoaXMsIFtbMywgMTQsIDE4LCAyNl0sIFsxOSwsIDIxLCAyNV1dKTsKICAgIH0pCiAgICAvKioKICAgICAqIFJldHVybnMgY29weSBvZiB0aGUgZmlyc3QgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbi4gRmlyc3QgcmFuZ2UgaXMgdGhlIG9uZSB3aGljaAogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gcG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNpc0JlZm9yZSBpcyBiZWZvcmV9IHN0YXJ0CiAgICAgKiBwb3NpdGlvbiBvZiBhbGwgb3RoZXIgcmFuZ2VzIChub3QgdG8gY29uZnVzZSB3aXRoIHRoZSBmaXJzdCByYW5nZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uKS4KICAgICAqIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLgogICAgICoKICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V8bnVsbH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRGaXJzdFJhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaXJzdFJhbmdlKCkgewogICAgICB2YXIgZmlyc3QgPSBudWxsOwogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSB0aGlzLl9yYW5nZXNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDI7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSAoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IHRydWUpIHsKICAgICAgICAgIHZhciByYW5nZSA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICBpZiAoIWZpcnN0IHx8IHJhbmdlLnN0YXJ0LmlzQmVmb3JlKGZpcnN0LnN0YXJ0KSkgewogICAgICAgICAgICBmaXJzdCA9IHJhbmdlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IyID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBlcnI7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMi5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3IyLnJldHVybigpOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IyKSB7CiAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmaXJzdCA/IGZpcnN0LmNsb25lKCkgOiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGxhc3QgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbi4gTGFzdCByYW5nZSBpcyB0aGUgb25lIHdoaWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0KICAgICAqIHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gZW5kIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlCiAgICAgKiB3aXRoIHRoZSBsYXN0IHJhbmdlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24pLiBSZXR1cm5zIGBudWxsYCBpZiBubyByYW5nZXMgYXJlIGFkZGVkIHRvIHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0TGFzdFJhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMYXN0UmFuZ2UoKSB7CiAgICAgIHZhciBsYXN0ID0gbnVsbDsKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gdHJ1ZTsKICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMyA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IzID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IzID0gdGhpcy5fcmFuZ2VzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXAzOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zID0gKF9zdGVwMyA9IF9pdGVyYXRvcjMubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlKSB7CiAgICAgICAgICB2YXIgcmFuZ2UgPSBfc3RlcDMudmFsdWU7CgogICAgICAgICAgaWYgKCFsYXN0IHx8IHJhbmdlLmVuZC5pc0FmdGVyKGxhc3QuZW5kKSkgewogICAgICAgICAgICBsYXN0ID0gcmFuZ2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjMgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yMyA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyAmJiBfaXRlcmF0b3IzLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjMucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjMpIHsKICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGxhc3QgPyBsYXN0LmNsb25lKCkgOiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGZpcnN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uIEZpcnN0IHBvc2l0aW9uIGlzIHRoZSBwb3NpdGlvbiB0aGF0CiAgICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI2lzQmVmb3JlIGlzIGJlZm9yZX0gYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24gcmFuZ2VzLgogICAgICogUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uCiAgICAgKgogICAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbnxudWxsfQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEZpcnN0UG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpcnN0UG9zaXRpb24oKSB7CiAgICAgIHZhciBmaXJzdFJhbmdlID0gdGhpcy5nZXRGaXJzdFJhbmdlKCk7CiAgICAgIHJldHVybiBmaXJzdFJhbmdlID8gZmlyc3RSYW5nZS5zdGFydC5jbG9uZSgpIDogbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBjb3B5IG9mIHRoZSBsYXN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uIExhc3QgcG9zaXRpb24gaXMgdGhlIHBvc2l0aW9uIHRoYXQKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24gcmFuZ2VzLgogICAgICogUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uCiAgICAgKgogICAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbnxudWxsfQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldExhc3RQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGFzdFBvc2l0aW9uKCkgewogICAgICB2YXIgbGFzdFJhbmdlID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTsKICAgICAgcmV0dXJuIGxhc3RSYW5nZSA/IGxhc3RSYW5nZS5lbmQuY2xvbmUoKSA6IG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrcyB3aGV0aGVyLCB0aGlzIHNlbGVjdGlvbiBpcyBlcXVhbCB0byBnaXZlbiBzZWxlY3Rpb24uIFNlbGVjdGlvbnMgYXJlIGVxdWFsIGlmIHRoZXkgaGF2ZSBzYW1lIGRpcmVjdGlvbnMsCiAgICAgKiBzYW1lIG51bWJlciBvZiByYW5nZXMgYW5kIGFsbCByYW5nZXMgZnJvbSBvbmUgc2VsZWN0aW9uIGVxdWFsIHRvIGEgcmFuZ2UgZnJvbSBvdGhlciBzZWxlY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbnxtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb259IG90aGVyU2VsZWN0aW9uCiAgICAgKiBTZWxlY3Rpb24gdG8gY29tcGFyZSB3aXRoLgogICAgICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiBzZWxlY3Rpb25zIGFyZSBlcXVhbCwgYGZhbHNlYCBvdGhlcndpc2UuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNFcXVhbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNFcXVhbChvdGhlclNlbGVjdGlvbikgewogICAgICBpZiAodGhpcy5pc0Zha2UgIT0gb3RoZXJTZWxlY3Rpb24uaXNGYWtlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc0Zha2UgJiYgdGhpcy5mYWtlU2VsZWN0aW9uTGFiZWwgIT0gb3RoZXJTZWxlY3Rpb24uZmFrZVNlbGVjdGlvbkxhYmVsKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5yYW5nZUNvdW50ICE9IG90aGVyU2VsZWN0aW9uLnJhbmdlQ291bnQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5yYW5nZUNvdW50ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5hbmNob3IuaXNFcXVhbChvdGhlclNlbGVjdGlvbi5hbmNob3IpIHx8ICF0aGlzLmZvY3VzLmlzRXF1YWwob3RoZXJTZWxlY3Rpb24uZm9jdXMpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I0ID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjQgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjQgPSB0aGlzLl9yYW5nZXNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDQ7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSAoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCA9IHRydWUpIHsKICAgICAgICAgIHZhciB0aGlzUmFuZ2UgPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I1ID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I1ID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjUgPSBvdGhlclNlbGVjdGlvbi5fcmFuZ2VzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA1OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ID0gKF9zdGVwNSA9IF9pdGVyYXRvcjUubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIG90aGVyUmFuZ2UgPSBfc3RlcDUudmFsdWU7CgogICAgICAgICAgICAgIGlmICh0aGlzUmFuZ2UuaXNFcXVhbChvdGhlclJhbmdlKSkgewogICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I1ID0gdHJ1ZTsKICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3I1ID0gZXJyOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ICYmIF9pdGVyYXRvcjUucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjUucmV0dXJuKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjUpIHsKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yNCA9IHRydWU7CiAgICAgICAgX2l0ZXJhdG9yRXJyb3I0ID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ICYmIF9pdGVyYXRvcjQucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yNC5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNCkgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBzZWxlY3Rpb24gaXMgc2ltaWxhciB0byBnaXZlbiBzZWxlY3Rpb24uIFNlbGVjdGlvbnMgYXJlIHNpbWlsYXIgaWYgdGhleSBoYXZlIHNhbWUgZGlyZWN0aW9ucywgc2FtZQogICAgICogbnVtYmVyIG9mIHJhbmdlcywgYW5kIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2dldFRyaW1tZWQgdHJpbW1lZH0gcmFuZ2VzIGZyb20gb25lIHNlbGVjdGlvbiBhcmUKICAgICAqIGVxdWFsIHRvIGFueSB0cmltbWVkIHJhbmdlIGZyb20gb3RoZXIgc2VsZWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258bW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufSBvdGhlclNlbGVjdGlvbgogICAgICogU2VsZWN0aW9uIHRvIGNvbXBhcmUgd2l0aC4KICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBgdHJ1ZWAgaWYgc2VsZWN0aW9ucyBhcmUgc2ltaWxhciwgYGZhbHNlYCBvdGhlcndpc2UuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNTaW1pbGFyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1NpbWlsYXIob3RoZXJTZWxlY3Rpb24pIHsKICAgICAgaWYgKHRoaXMuaXNCYWNrd2FyZCAhPSBvdGhlclNlbGVjdGlvbi5pc0JhY2t3YXJkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgbnVtT2ZSYW5nZXNBID0gY291bnQodGhpcy5nZXRSYW5nZXMoKSk7CiAgICAgIHZhciBudW1PZlJhbmdlc0IgPSBjb3VudChvdGhlclNlbGVjdGlvbi5nZXRSYW5nZXMoKSk7IC8vIElmIHNlbGVjdGlvbnMgaGF2ZSBkaWZmZXJlbnQgbnVtYmVyIG9mIHJhbmdlcywgdGhleSBjYW5ub3QgYmUgc2ltaWxhci4KCiAgICAgIGlmIChudW1PZlJhbmdlc0EgIT0gbnVtT2ZSYW5nZXNCKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIElmIGJvdGggc2VsZWN0aW9ucyBoYXZlIG5vIHJhbmdlcywgdGhleSBhcmUgc2ltaWxhci4KCgogICAgICBpZiAobnVtT2ZSYW5nZXNBID09IDApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSAvLyBDaGVjayBpZiBlYWNoIHJhbmdlIGluIG9uZSBzZWxlY3Rpb24gaGFzIGEgc2ltaWxhciByYW5nZSBpbiBvdGhlciBzZWxlY3Rpb24uCgoKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ID0gdHJ1ZTsKICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNiA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I2ID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I2ID0gdGhpcy5nZXRSYW5nZXMoKVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiA9IChfc3RlcDYgPSBfaXRlcmF0b3I2Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb242ID0gdHJ1ZSkgewogICAgICAgICAgdmFyIHJhbmdlQSA9IF9zdGVwNi52YWx1ZTsKICAgICAgICAgIHJhbmdlQSA9IHJhbmdlQS5nZXRUcmltbWVkKCk7CiAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNyA9IHRydWU7CiAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I3ID0gZmFsc2U7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I3ID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjcgPSBvdGhlclNlbGVjdGlvbi5nZXRSYW5nZXMoKVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNzsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNyA9IChfc3RlcDcgPSBfaXRlcmF0b3I3Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb243ID0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciByYW5nZUIgPSBfc3RlcDcudmFsdWU7CiAgICAgICAgICAgICAgcmFuZ2VCID0gcmFuZ2VCLmdldFRyaW1tZWQoKTsKCiAgICAgICAgICAgICAgaWYgKHJhbmdlQS5zdGFydC5pc0VxdWFsKHJhbmdlQi5zdGFydCkgJiYgcmFuZ2VBLmVuZC5pc0VxdWFsKHJhbmdlQi5lbmQpKSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gRm9yIGByYW5nZUFgLCBuZWl0aGVyIHJhbmdlIGluIGBvdGhlclNlbGVjdGlvbmAgd2FzIHNpbWlsYXIuIFNvIHNlbGVjdGlvbnMgYXJlIG5vdCBzaW1pbGFyLgoKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjcgPSB0cnVlOwogICAgICAgICAgICBfaXRlcmF0b3JFcnJvcjcgPSBlcnI7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjcgJiYgX2l0ZXJhdG9yNy5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yNy5yZXR1cm4oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNykgewogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I3OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gVGhlcmUgd2VyZSBubyByYW5nZXMgdGhhdCB3ZXJlbid0IG1hdGNoZWQuIFNlbGVjdGlvbnMgYXJlIHNpbWlsYXIuCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjYgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yNiA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNiAmJiBfaXRlcmF0b3I2LnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjYucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjYpIHsKICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I2OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHNlbGVjdGVkIGVsZW1lbnQuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IEVsZW1lbnR9IGlzIGNvbnNpZGVyZWQgYXMgc2VsZWN0ZWQgaWYgdGhlcmUgaXMgb25seQogICAgICogb25lIHJhbmdlIGluIHRoZSBzZWxlY3Rpb24sIGFuZCB0aGF0IHJhbmdlIGNvbnRhaW5zIGV4YWN0bHkgb25lIGVsZW1lbnQuCiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzZWxlY3RlZCBlbGVtZW50LgogICAgICoKICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0U2VsZWN0ZWRFbGVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3RlZEVsZW1lbnQoKSB7CiAgICAgIGlmICh0aGlzLnJhbmdlQ291bnQgIT09IDEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZ2V0Rmlyc3RSYW5nZSgpLmdldENvbnRhaW5lZEVsZW1lbnQoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGlzIHNlbGVjdGlvbidzIHJhbmdlcyBhbmQgZGlyZWN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24gYmFzZWQgb24gdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3RhYmxlIHNlbGVjdGFibGV9LgogICAgICoKICAgICAqCQkvLyBTZXRzIHNlbGVjdGlvbiB0byB0aGUgZ2l2ZW4gcmFuZ2UuCiAgICAgKgkJY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTsKICAgICAqCQlzZWxlY3Rpb24uc2V0VG8oIHJhbmdlICk7CiAgICAgKgogICAgICoJCS8vIFNldHMgc2VsZWN0aW9uIHRvIGdpdmVuIHJhbmdlcy4KICAgICAqIAkJY29uc3QgcmFuZ2VzID0gWyB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0MSwgZW5kMiApLCB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXIyLCBlbmQyICkgXTsKICAgICAqCQlzZWxlY3Rpb24uc2V0VG8oIHJhbmdlICk7CiAgICAgKgogICAgICoJCS8vIFNldHMgc2VsZWN0aW9uIHRvIHRoZSBvdGhlciBzZWxlY3Rpb24uCiAgICAgKgkJY29uc3Qgb3RoZXJTZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCk7CiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCBvdGhlclNlbGVjdGlvbiApOwogICAgICoKICAgICAqCSAJLy8gU2V0cyBzZWxlY3Rpb24gdG8gY29udGVudHMgb2YgRG9jdW1lbnRTZWxlY3Rpb24uCiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCBlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbiApOwogICAgICoKICAgICAqIAkJLy8gU2V0cyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi4KICAgICAqCQljb25zdCBwb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCByb290LCBwYXRoICk7CiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCBwb3NpdGlvbiApOwogICAgICoKICAgICAqIAkJLy8gU2V0cyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiBnaXZlbiBpdGVtIGFuZCBvZmZzZXQuCiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCBwYXJhZ3JhcGgsIG9mZnNldCApOwogICAgICoKICAgICAqIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3QgY2hpbGQgb2YKICAgICAqIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuCiAgICAgKgogICAgICoJCXNlbGVjdGlvbi5zZXRUbyggcGFyYWdyYXBoLCAnaW4nICk7CiAgICAgKgogICAgICogQ3JlYXRlcyBhIHJhbmdlIG9uIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHMganVzdCBhZnRlciB0aGUgaXRlbS4KICAgICAqCiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCBwYXJhZ3JhcGgsICdvbicgKTsKICAgICAqCiAgICAgKiAJCS8vIENsZWFycyBzZWxlY3Rpb24uIFJlbW92ZXMgYWxsIHJhbmdlcy4KICAgICAqCQlzZWxlY3Rpb24uc2V0VG8oIG51bGwgKTsKICAgICAqCiAgICAgKiBgU2VsZWN0aW9uI3NldFRvKClgIG1ldGhvZCBhbGxvdyBwYXNzaW5nIGFkZGl0aW9uYWwgb3B0aW9ucyAoYGJhY2t3YXJkYCwgYGZha2VgIGFuZCBgbGFiZWxgKSBhcyB0aGUgbGFzdCBhcmd1bWVudC4KICAgICAqCiAgICAgKgkJLy8gU2V0cyBzZWxlY3Rpb24gYXMgYmFja3dhcmQuCiAgICAgKgkJc2VsZWN0aW9uLnNldFRvKCByYW5nZSwgeyBiYWNrd2FyZDogdHJ1ZSB9ICk7CiAgICAgKgogICAgICogRmFrZSBzZWxlY3Rpb24gZG9lcyBub3QgcmVuZGVyIGFzIGJyb3dzZXIgbmF0aXZlIHNlbGVjdGlvbiBvdmVyIHNlbGVjdGVkIGVsZW1lbnRzIGFuZCBpcyBoaWRkZW4gdG8gdGhlIHVzZXIuCiAgICAgKiBUaGlzIHdheSwgbm8gbmF0aXZlIHNlbGVjdGlvbiBVSSBhcnRpZmFjdHMgYXJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhbmQgc2VsZWN0aW9uIG92ZXIgZWxlbWVudHMgY2FuIGJlCiAgICAgKiByZXByZXNlbnRlZCBpbiBvdGhlciB3YXksIGZvciBleGFtcGxlIGJ5IGFwcGx5aW5nIHByb3BlciBDU1MgY2xhc3MuCiAgICAgKgogICAgICogQWRkaXRpb25hbGx5IGZha2UncyBzZWxlY3Rpb24gbGFiZWwgY2FuIGJlIHByb3ZpZGVkLiBJdCB3aWxsIGJlIHVzZWQgdG8gZGVzY3JpYmUgZmFrZSBzZWxlY3Rpb24gaW4gRE9NCiAgICAgKiAoYW5kIGJlICBwcm9wZXJseSBoYW5kbGVkIGJ5IHNjcmVlbiByZWFkZXJzKS4KICAgICAqCiAgICAgKgkJLy8gQ3JlYXRlcyBmYWtlIHNlbGVjdGlvbiB3aXRoIGxhYmVsLgogICAgICoJCXNlbGVjdGlvbi5zZXRUbyggcmFuZ2UsIHsgZmFrZTogdHJ1ZSwgbGFiZWw6ICdmb28nIH0gKTsKICAgICAqCiAgICAgKiBAZmlyZXMgY2hhbmdlCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0YWJsZX0gc2VsZWN0YWJsZQogICAgICogQHBhcmFtIHtOdW1iZXJ8J2JlZm9yZSd8J2VuZCd8J2FmdGVyJ3wnb24nfCdpbid9IFtwbGFjZU9yT2Zmc2V0XSBTZXRzIHBsYWNlIG9yIG9mZnNldCBvZiB0aGUgc2VsZWN0aW9uLgogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXQogICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5iYWNrd2FyZF0gU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBiYWNrd2FyZC4KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZmFrZV0gU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBtYXJrZWQgYXMgYGZha2VgLgogICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmxhYmVsXSBMYWJlbCBmb3IgdGhlIGZha2Ugc2VsZWN0aW9uLgogICAgICovCgogIH0sIHsKICAgIGtleTogInNldFRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUbyhzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0LCBvcHRpb25zKSB7CiAgICAgIGlmIChzZWxlY3RhYmxlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtdKTsKCiAgICAgICAgdGhpcy5fc2V0RmFrZU9wdGlvbnMocGxhY2VPck9mZnNldCk7CiAgICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIFNlbGVjdGlvbiB8fCBzZWxlY3RhYmxlIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgICB0aGlzLl9zZXRSYW5nZXMoc2VsZWN0YWJsZS5nZXRSYW5nZXMoKSwgc2VsZWN0YWJsZS5pc0JhY2t3YXJkKTsKCiAgICAgICAgdGhpcy5fc2V0RmFrZU9wdGlvbnMoewogICAgICAgICAgZmFrZTogc2VsZWN0YWJsZS5pc0Zha2UsCiAgICAgICAgICBsYWJlbDogc2VsZWN0YWJsZS5mYWtlU2VsZWN0aW9uTGFiZWwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUmFuZ2UpIHsKICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW3NlbGVjdGFibGVdLCBwbGFjZU9yT2Zmc2V0ICYmIHBsYWNlT3JPZmZzZXQuYmFja3dhcmQpOwoKICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhwbGFjZU9yT2Zmc2V0KTsKICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUG9zaXRpb24pIHsKICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW25ldyBSYW5nZShzZWxlY3RhYmxlKV0pOwoKICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhwbGFjZU9yT2Zmc2V0KTsKICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgTm9kZSkgewogICAgICAgIHZhciBiYWNrd2FyZCA9ICEhb3B0aW9ucyAmJiAhIW9wdGlvbnMuYmFja3dhcmQ7CiAgICAgICAgdmFyIHJhbmdlOwoKICAgICAgICBpZiAocGxhY2VPck9mZnNldCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIHNlbGVjdGlvbi5zZXRUbyByZXF1aXJlcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSBub2RlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXRUby1yZXF1aXJlZC1zZWNvbmQtcGFyYW1ldGVyCiAgICAgICAgICAgKi8KICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1zZXRUby1yZXF1aXJlZC1zZWNvbmQtcGFyYW1ldGVyOiAnICsgJ3NlbGVjdGlvbi5zZXRUbyByZXF1aXJlcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSBub2RlLicsIHRoaXMpOwogICAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCA9PSAnaW4nKSB7CiAgICAgICAgICByYW5nZSA9IFJhbmdlLl9jcmVhdGVJbihzZWxlY3RhYmxlKTsKICAgICAgICB9IGVsc2UgaWYgKHBsYWNlT3JPZmZzZXQgPT0gJ29uJykgewogICAgICAgICAgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlT24oc2VsZWN0YWJsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVBdChzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0KSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW3JhbmdlXSwgYmFja3dhcmQpOwoKICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhvcHRpb25zKTsKICAgICAgfSBlbHNlIGlmIChpc0l0ZXJhYmxlKHNlbGVjdGFibGUpKSB7CiAgICAgICAgLy8gV2UgYXNzdW1lIHRoYXQgdGhlIHNlbGVjdGFibGUgaXMgYW4gaXRlcmFibGUgb2YgcmFuZ2VzLgogICAgICAgIC8vIEFycmF5LmZyb20oKSBpcyB1c2VkIHRvIHByZXZlbnQgc2V0dGluZyByYW5nZXMgdG8gdGhlIG9sZCBpdGVyYWJsZQogICAgICAgIHRoaXMuX3NldFJhbmdlcyhzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0ICYmIHBsYWNlT3JPZmZzZXQuYmFja3dhcmQpOwoKICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhwbGFjZU9yT2Zmc2V0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKioKICAgICAgICAgKiBDYW5ub3Qgc2V0IHNlbGVjdGlvbiB0byBnaXZlbiBwbGFjZS4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXRUby1ub3Qtc2VsZWN0YWJsZQogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1zZXRUby1ub3Qtc2VsZWN0YWJsZTogQ2Fubm90IHNldCBzZWxlY3Rpb24gdG8gZ2l2ZW4gcGxhY2UuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJyk7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmVzIHtAbGluayAjZm9jdXN9IHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24uCiAgICAgKgogICAgICogVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgaW4gdGhlIHNhbWUgZm9ybSBhcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVQb3NpdGlvbkF0IHZpZXcuY3JlYXRlUG9zaXRpb25BdCgpfQogICAgICogcGFyYW1ldGVycy4KICAgICAqCiAgICAgKiBAZmlyZXMgY2hhbmdlCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW18bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufSBpdGVtT3JQb3NpdGlvbgogICAgICogQHBhcmFtIHtOdW1iZXJ8J2VuZCd8J2JlZm9yZSd8J2FmdGVyJ30gW29mZnNldF0gT2Zmc2V0IG9yIG9uZSBvZiB0aGUgZmxhZ3MuIFVzZWQgb25seSB3aGVuCiAgICAgKiBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19LgogICAgICovCgogIH0sIHsKICAgIGtleTogInNldEZvY3VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7CiAgICAgIGlmICh0aGlzLmFuY2hvciA9PT0gbnVsbCkgewogICAgICAgIC8qKgogICAgICAgICAqIENhbm5vdCBzZXQgc2VsZWN0aW9uIGZvY3VzIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIHZpZXctc2VsZWN0aW9uLXNldEZvY3VzLW5vLXJhbmdlcwogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1zZXRGb2N1cy1uby1yYW5nZXM6IENhbm5vdCBzZXQgc2VsZWN0aW9uIGZvY3VzIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLicsIHRoaXMpOwogICAgICB9CgogICAgICB2YXIgbmV3Rm9jdXMgPSBQb3NpdGlvbi5fY3JlYXRlQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCk7CgogICAgICBpZiAobmV3Rm9jdXMuY29tcGFyZVdpdGgodGhpcy5mb2N1cykgPT0gJ3NhbWUnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYW5jaG9yID0gdGhpcy5hbmNob3I7CgogICAgICB0aGlzLl9yYW5nZXMucG9wKCk7CgogICAgICBpZiAobmV3Rm9jdXMuY29tcGFyZVdpdGgoYW5jaG9yKSA9PSAnYmVmb3JlJykgewogICAgICAgIHRoaXMuX2FkZFJhbmdlKG5ldyBSYW5nZShuZXdGb2N1cywgYW5jaG9yKSwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fYWRkUmFuZ2UobmV3IFJhbmdlKGFuY2hvciwgbmV3Rm9jdXMpKTsKICAgICAgfQoKICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBvYmplY3QgaXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKgogICAgICoJCXNlbGVjdGlvbi5pcyggJ3NlbGVjdGlvbicgKTsgLy8gLT4gdHJ1ZQogICAgICoJCXNlbGVjdGlvbi5pcyggJ3ZpZXc6c2VsZWN0aW9uJyApOyAvLyAtPiB0cnVlCiAgICAgKgogICAgICoJCXNlbGVjdGlvbi5pcyggJ21vZGVsOnNlbGVjdGlvbicgKTsgLy8gLT4gZmFsc2UKICAgICAqCQlzZWxlY3Rpb24uaXMoICdlbGVtZW50JyApOyAvLyAtPiBmYWxzZQogICAgICoJCXNlbGVjdGlvbi5pcyggJ3JhbmdlJyApOyAvLyAtPiBmYWxzZQogICAgICoKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2lzIENoZWNrIHRoZSBlbnRpcmUgbGlzdCBvZiB2aWV3IG9iamVjdHN9IHdoaWNoIGltcGxlbWVudCB0aGUgYGlzKClgIG1ldGhvZC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzKHR5cGUpIHsKICAgICAgcmV0dXJuIHR5cGUgPT0gJ3NlbGVjdGlvbicgfHwgdHlwZSA9PSAndmlldzpzZWxlY3Rpb24nOwogICAgfQogICAgLyoqCiAgICAgKiBSZXBsYWNlcyBhbGwgcmFuZ2VzIHRoYXQgd2VyZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uIHdpdGggZ2l2ZW4gYXJyYXkgb2YgcmFuZ2VzLiBMYXN0IHJhbmdlIG9mIHRoZSBhcnJheQogICAgICogaXMgdHJlYXRlZCBsaWtlIHRoZSBsYXN0IGFkZGVkIHJhbmdlIGFuZCBpcyB1c2VkIHRvIHNldCB7QGxpbmsgI2FuY2hvciBhbmNob3J9IGFuZCB7QGxpbmsgI2ZvY3VzIGZvY3VzfS4KICAgICAqIEFjY2VwdHMgYSBmbGFnIGRlc2NyaWJpbmcgaW4gd2hpY2ggd2F5IHRoZSBzZWxlY3Rpb24gaXMgbWFkZS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtJdGVyYWJsZS48bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlPn0gbmV3UmFuZ2VzIEl0ZXJhYmxlIG9iamVjdCBvZiByYW5nZXMgdG8gc2V0LgogICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNMYXN0QmFja3dhcmQ9ZmFsc2VdIEZsYWcgZGVzY3JpYmluZyBpZiBsYXN0IGFkZGVkIHJhbmdlIHdhcyBzZWxlY3RlZCBmb3J3YXJkIC0gZnJvbSBzdGFydCB0byBlbmQKICAgICAqIChgZmFsc2VgKSBvciBiYWNrd2FyZCAtIGZyb20gZW5kIHRvIHN0YXJ0IChgdHJ1ZWApLiBEZWZhdWx0cyB0byBgZmFsc2VgLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRSYW5nZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRSYW5nZXMobmV3UmFuZ2VzKSB7CiAgICAgIHZhciBpc0xhc3RCYWNrd2FyZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIC8vIE5ldyByYW5nZXMgc2hvdWxkIGJlIGNvcGllZCB0byBwcmV2ZW50IHJlbW92aW5nIHRoZW0gYnkgc2V0dGluZyB0aGVtIHRvIGBbXWAgZmlyc3QuCiAgICAgIC8vIE9ubHkgYXBwbGllcyB0byBzaXR1YXRpb25zIHdoZW4gc2VsZWN0aW9uIGlzIHNldCB0byB0aGUgc2FtZSBzZWxlY3Rpb24gb3Igc2FtZSBzZWxlY3Rpb24ncyByYW5nZXMuCiAgICAgIG5ld1JhbmdlcyA9IEFycmF5LmZyb20obmV3UmFuZ2VzKTsKICAgICAgdGhpcy5fcmFuZ2VzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uOCA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjggPSBmYWxzZTsKICAgICAgdmFyIF9pdGVyYXRvckVycm9yOCA9IHVuZGVmaW5lZDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yOCA9IG5ld1Jhbmdlc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwODsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uOCA9IChfc3RlcDggPSBfaXRlcmF0b3I4Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb244ID0gdHJ1ZSkgewogICAgICAgICAgdmFyIHJhbmdlID0gX3N0ZXA4LnZhbHVlOwoKICAgICAgICAgIHRoaXMuX2FkZFJhbmdlKHJhbmdlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yOCA9IHRydWU7CiAgICAgICAgX2l0ZXJhdG9yRXJyb3I4ID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb244ICYmIF9pdGVyYXRvcjgucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yOC5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yOCkgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9ICEhaXNMYXN0QmFja3dhcmQ7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhpcyBzZWxlY3Rpb24gaW5zdGFuY2UgdG8gYmUgbWFya2VkIGFzIGBmYWtlYC4gQSBmYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uCiAgICAgKiBvdmVyIHNlbGVjdGVkIGVsZW1lbnRzIGFuZCBpcyBoaWRkZW4gdG8gdGhlIHVzZXIuIFRoaXMgd2F5LCBubyBuYXRpdmUgc2VsZWN0aW9uIFVJIGFydGlmYWN0cyBhcmUgZGlzcGxheWVkIHRvCiAgICAgKiB0aGUgdXNlciBhbmQgc2VsZWN0aW9uIG92ZXIgZWxlbWVudHMgY2FuIGJlIHJlcHJlc2VudGVkIGluIG90aGVyIHdheSwgZm9yIGV4YW1wbGUgYnkgYXBwbHlpbmcgcHJvcGVyIENTUyBjbGFzcy4KICAgICAqCiAgICAgKiBBZGRpdGlvbmFsbHkgZmFrZSdzIHNlbGVjdGlvbiBsYWJlbCBjYW4gYmUgcHJvdmlkZWQuIEl0IHdpbGwgYmUgdXNlZCB0byBkZXNjcmliZSBmYWtlIHNlbGVjdGlvbiBpbiBET00gKGFuZCBiZQogICAgICogcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucy4KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZmFrZV0gSWYgc2V0IHRvIHRydWUgc2VsZWN0aW9uIHdpbGwgYmUgbWFya2VkIGFzIGBmYWtlYC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5sYWJlbD0nJ10gRmFrZSBzZWxlY3Rpb24gbGFiZWwuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3NldEZha2VPcHRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0RmFrZU9wdGlvbnMoKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgdGhpcy5faXNGYWtlID0gISFvcHRpb25zLmZha2U7CiAgICAgIHRoaXMuX2Zha2VTZWxlY3Rpb25MYWJlbCA9IG9wdGlvbnMuZmFrZSA/IG9wdGlvbnMubGFiZWwgfHwgJycgOiAnJzsKICAgIH0KICAgIC8qKgogICAgICogQWRkcyBhIHJhbmdlIHRvIHRoZSBzZWxlY3Rpb24uIEFkZGVkIHJhbmdlIGlzIGNvcGllZC4gVGhpcyBtZWFucyB0aGF0IHBhc3NlZCByYW5nZSBpcyBub3Qgc2F2ZWQgaW4gdGhlCiAgICAgKiBzZWxlY3Rpb24gaW5zdGFuY2UgYW5kIHlvdSBjYW4gc2FmZWx5IG9wZXJhdGUgb24gaXQuCiAgICAgKgogICAgICogQWNjZXB0cyBhIGZsYWcgZGVzY3JpYmluZyBpbiB3aGljaCB3YXkgdGhlIHNlbGVjdGlvbiBpcyBtYWRlIC0gcGFzc2VkIHJhbmdlIG1pZ2h0IGJlIHNlbGVjdGVkIGZyb20KICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0KICAgICAqIG9yIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgZW5kfSB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fS4KICAgICAqIFRoZSBmbGFnIGlzIHVzZWQgdG8gc2V0IHtAbGluayAjYW5jaG9yIGFuY2hvcn0gYW5kIHtAbGluayAjZm9jdXMgZm9jdXN9IHByb3BlcnRpZXMuCiAgICAgKgogICAgICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGB2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzYCBpZiBhZGRlZCByYW5nZSBpbnRlcnNlY3RzCiAgICAgKiB3aXRoIHJhbmdlcyBhbHJlYWR5IHN0b3JlZCBpbiBTZWxlY3Rpb24gaW5zdGFuY2UuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBmaXJlcyBjaGFuZ2UKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfSByYW5nZQogICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNCYWNrd2FyZF0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfYWRkUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRSYW5nZShyYW5nZSkgewogICAgICB2YXIgaXNCYWNrd2FyZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoIShyYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSkgewogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdGlvbiByYW5nZSBzZXQgdG8gYW4gb2JqZWN0IHRoYXQgaXMgbm90IGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9LgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIHZpZXctc2VsZWN0aW9uLWFkZC1yYW5nZS1ub3QtcmFuZ2UKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1zZWxlY3Rpb24tYWRkLXJhbmdlLW5vdC1yYW5nZTogJyArICdTZWxlY3Rpb24gcmFuZ2Ugc2V0IHRvIGFuIG9iamVjdCB0aGF0IGlzIG5vdCBhbiBpbnN0YW5jZSBvZiB2aWV3LlJhbmdlJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3B1c2hSYW5nZShyYW5nZSk7CgogICAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9ICEhaXNCYWNrd2FyZDsKICAgIH0KICAgIC8qKgogICAgICogQWRkcyByYW5nZSB0byBzZWxlY3Rpb24gLSBjcmVhdGVzIGNvcHkgb2YgZ2l2ZW4gcmFuZ2Ugc28gaXQgY2FuIGJlIHNhZmVseSB1c2VkIGFuZCBtb2RpZmllZC4KICAgICAqCiAgICAgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctc2VsZWN0aW9uLXJhbmdlLWludGVyc2VjdHNgIGlmIGFkZGVkIHJhbmdlIGludGVyc2VjdHMKICAgICAqIHdpdGggcmFuZ2VzIGFscmVhZHkgc3RvcmVkIGluIHNlbGVjdGlvbiBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IHJhbmdlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3B1c2hSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3B1c2hSYW5nZShyYW5nZSkgewogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjkgPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3I5ID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjkgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjkgPSB0aGlzLl9yYW5nZXNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDk7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjkgPSAoX3N0ZXA5ID0gX2l0ZXJhdG9yOS5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uOSA9IHRydWUpIHsKICAgICAgICAgIHZhciBzdG9yZWRSYW5nZSA9IF9zdGVwOS52YWx1ZTsKCiAgICAgICAgICBpZiAocmFuZ2UuaXNJbnRlcnNlY3Rpbmcoc3RvcmVkUmFuZ2UpKSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUcnlpbmcgdG8gYWRkIGEgcmFuZ2UgdGhhdCBpbnRlcnNlY3RzIHdpdGggYW5vdGhlciByYW5nZSBmcm9tIHNlbGVjdGlvbi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQGVycm9yIHZpZXctc2VsZWN0aW9uLXJhbmdlLWludGVyc2VjdHMKICAgICAgICAgICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IGFkZGVkUmFuZ2UgUmFuZ2UgdGhhdCB3YXMgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbi4KICAgICAgICAgICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IGludGVyc2VjdGluZ1JhbmdlIFJhbmdlIGZyb20gc2VsZWN0aW9uIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGBhZGRlZFJhbmdlYC4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzOiBUcnlpbmcgdG8gYWRkIGEgcmFuZ2UgdGhhdCBpbnRlcnNlY3RzIHdpdGggYW5vdGhlciByYW5nZSBmcm9tIHNlbGVjdGlvbi4nLCB0aGlzLCB7CiAgICAgICAgICAgICAgYWRkZWRSYW5nZTogcmFuZ2UsCiAgICAgICAgICAgICAgaW50ZXJzZWN0aW5nUmFuZ2U6IHN0b3JlZFJhbmdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I5ID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvcjkgPSBlcnI7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjkgJiYgX2l0ZXJhdG9yOS5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3I5LnJldHVybigpOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I5KSB7CiAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX3Jhbmdlcy5wdXNoKG5ldyBSYW5nZShyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKSk7CiAgICB9CiAgICAvKioKICAgICAqIEZpcmVkIHdoZW5ldmVyIHNlbGVjdGlvbiByYW5nZXMgYXJlIGNoYW5nZWQgdGhyb3VnaCB7QGxpbmsgflNlbGVjdGlvbiBTZWxlY3Rpb24gQVBJfS4KICAgICAqCiAgICAgKiBAZXZlbnQgY2hhbmdlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNGYWtlIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5faXNGYWtlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGZha2Ugc2VsZWN0aW9uIGxhYmVsLgogICAgICoKICAgICAqIEBzZWUgI3NldFRvCiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAgICovCgogIH0sIHsKICAgIGtleTogImZha2VTZWxlY3Rpb25MYWJlbCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2Zha2VTZWxlY3Rpb25MYWJlbDsKICAgIH0KICAgIC8qKgogICAgICogU2VsZWN0aW9uIGFuY2hvci4gQW5jaG9yIG1heSBiZSBkZXNjcmliZWQgYXMgYSBwb3NpdGlvbiB3aGVyZSB0aGUgc2VsZWN0aW9uIHN0YXJ0cy4gVG9nZXRoZXIgd2l0aAogICAgICoge0BsaW5rICNmb2N1cyBmb2N1c30gdGhleSBkZWZpbmUgdGhlIGRpcmVjdGlvbiBvZiBzZWxlY3Rpb24sIHdoaWNoIGlzIGltcG9ydGFudAogICAgICogd2hlbiBleHBhbmRpbmcvc2hyaW5raW5nIHNlbGVjdGlvbi4gQW5jaG9yIGlzIGFsd2F5cyB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBtb3N0IHJlY2VudCBhZGRlZCByYW5nZS4KICAgICAqIEl0IG1heSBiZSBhIGJpdCB1bmludHVpdGl2ZSB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZSByYW5nZXMgaW4gc2VsZWN0aW9uLgogICAgICoKICAgICAqIEBzZWUgI2ZvY3VzCiAgICAgKiBAdHlwZSB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufQogICAgICovCgogIH0sIHsKICAgIGtleTogImFuY2hvciIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgaWYgKCF0aGlzLl9yYW5nZXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciByYW5nZSA9IHRoaXMuX3Jhbmdlc1t0aGlzLl9yYW5nZXMubGVuZ3RoIC0gMV07CiAgICAgIHZhciBhbmNob3IgPSB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA/IHJhbmdlLmVuZCA6IHJhbmdlLnN0YXJ0OwogICAgICByZXR1cm4gYW5jaG9yLmNsb25lKCk7CiAgICB9CiAgICAvKioKICAgICAqIFNlbGVjdGlvbiBmb2N1cy4gRm9jdXMgaXMgYSBwb3NpdGlvbiB3aGVyZSB0aGUgc2VsZWN0aW9uIGVuZHMuCiAgICAgKgogICAgICogQHNlZSAjYW5jaG9yCiAgICAgKiBAdHlwZSB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICBpZiAoIXRoaXMuX3Jhbmdlcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIHJhbmdlID0gdGhpcy5fcmFuZ2VzW3RoaXMuX3Jhbmdlcy5sZW5ndGggLSAxXTsKICAgICAgdmFyIGZvY3VzID0gdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPyByYW5nZS5zdGFydCA6IHJhbmdlLmVuZDsKICAgICAgcmV0dXJuIGZvY3VzLmNsb25lKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZC4gU2VsZWN0aW9uIGlzIGNvbGxhcHNlZCB3aGVuIHRoZXJlIGlzIGV4YWN0bHkgb25lIHJhbmdlIHdoaWNoIGlzCiAgICAgKiBjb2xsYXBzZWQuCiAgICAgKgogICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNDb2xsYXBzZWQiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnJhbmdlQ291bnQgPT09IDEgJiYgdGhpcy5fcmFuZ2VzWzBdLmlzQ29sbGFwc2VkOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIG51bWJlciBvZiByYW5nZXMgaW4gc2VsZWN0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtOdW1iZXJ9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmFuZ2VDb3VudCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3Jhbmdlcy5sZW5ndGg7CiAgICB9CiAgICAvKioKICAgICAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSB7QGxpbmsgI2ZvY3VzfSBwcmVjZWRlcyB7QGxpbmsgI2FuY2hvcn0uCiAgICAgKgogICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNCYWNrd2FyZCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICF0aGlzLmlzQ29sbGFwc2VkICYmIHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkOwogICAgfQogICAgLyoqCiAgICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnQgRWRpdGFibGVFbGVtZW50fSBpbnN0YW5jZSB0aGF0IGNvbnRhaW5zIHRoaXMgc2VsZWN0aW9uLCBvciBgbnVsbGAKICAgICAqIGlmIHRoZSBzZWxlY3Rpb24gaXMgbm90IGluc2lkZSBhbiBlZGl0YWJsZSBlbGVtZW50LgogICAgICoKICAgICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudHxudWxsfQogICAgICovCgogIH0sIHsKICAgIGtleTogImVkaXRhYmxlRWxlbWVudCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgaWYgKHRoaXMuYW5jaG9yKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9yLmVkaXRhYmxlRWxlbWVudDsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2VsZWN0aW9uOwp9KCk7CgpleHBvcnQgeyBTZWxlY3Rpb24gYXMgZGVmYXVsdCB9OwptaXgoU2VsZWN0aW9uLCBFbWl0dGVyTWl4aW4pOwovKioKICogQW4gZW50aXR5IHRoYXQgaXMgdXNlZCB0byBzZXQgc2VsZWN0aW9uLgogKgogKiBTZWUgYWxzbyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb24jc2V0VG99CiAqCiAqIEB0eXBlZGVmIHsKICogICAgbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258CiAqICAgIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbnwKICogICAgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufAogKiAgICBJdGVyYWJsZS48bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlPnwKICogICAgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfAogKiAgICBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtfAogKiAgICBudWxsCiAqIH0gbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3RhYmxlCiAqLw=="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-engine/src/view/selection.js"],"names":["CKEditorError","Range","Position","mix","EmitterMixin","Node","count","isIterable","DocumentSelection","Selection","selectable","placeOrOffset","options","_ranges","_lastRangeBackward","_isFake","_fakeSelectionLabel","setTo","range","clone","first","start","isBefore","last","end","isAfter","firstRange","getFirstRange","lastRange","getLastRange","otherSelection","isFake","fakeSelectionLabel","rangeCount","anchor","isEqual","focus","thisRange","found","otherRange","isBackward","numOfRangesA","getRanges","numOfRangesB","rangeA","getTrimmed","rangeB","getContainedElement","_setRanges","_setFakeOptions","fake","label","backward","undefined","_createIn","_createOn","_createAt","fire","itemOrPosition","offset","newFocus","compareWith","pop","_addRange","type","newRanges","isLastBackward","Array","from","_pushRange","storedRange","isIntersecting","addedRange","intersectingRange","push","length","isCollapsed","editableElement"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/view/selection\n */\n\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport Range from './range';\nimport Position from './position';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport Node from './node';\nimport count from '@ckeditor/ckeditor5-utils/src/count';\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\nimport DocumentSelection from './documentselection';\n\n/**\n * Class representing an arbirtary selection in the view.\n * See also {@link module:engine/view/documentselection~DocumentSelection}.\n *\n * New selection instances can be created via the constructor or one these methods:\n *\n * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\n * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\n *\n * A selection can consist of {@link module:engine/view/range~Range ranges} that can be set by using\n * the {@link module:engine/view/selection~Selection#setTo `Selection#setTo()`} method.\n */\nexport default class Selection {\n\t/**\n\t * Creates new selection instance.\n\t *\n\t * **Note**: The selection constructor is available as a factory method:\n\t *\n\t * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\n\t * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\n\t *\n\t * \t\t// Creates empty selection without ranges.\n\t *\t\tconst selection = writer.createSelection();\n\t *\n\t *\t\t// Creates selection at the given range.\n\t *\t\tconst range = writer.createRange( start, end );\n\t *\t\tconst selection = writer.createSelection( range );\n\t *\n\t *\t\t// Creates selection at the given ranges\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\n\t *\t\tconst selection = writer.createSelection( ranges );\n\t *\n\t *\t\t// Creates selection from the other selection.\n\t *\t\tconst otherSelection = writer.createSelection();\n\t *\t\tconst selection = writer.createSelection( otherSelection );\n\t *\n\t *\t\t// Creates selection from the document selection.\n\t *\t\tconst selection = writer.createSelection( editor.editing.view.document.selection );\n\t *\n\t * \t\t// Creates selection at the given position.\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\n\t *\t\tconst selection = writer.createSelection( position );\n\t *\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\n\t *\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\n\t *\t\t// first child of that element and ends after the last child of that element.\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\n\t *\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\n\t *\t\t// just after the item.\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\n\t *\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\n\t *\n\t *\t\t// Creates backward selection.\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\n\t *\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\n\t * represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\n\t * (and be  properly handled by screen readers).\n\t *\n\t *\t\t// Creates fake selection with label.\n\t *\t\tconst selection = writer.createSelection( range, { fake: true, label: 'foo' } );\n\t *\n\t * @param {module:engine/view/selection~Selectable} [selectable=null]\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\n\t * @param {Object} [options]\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\n\t * @param {String} [options.label] Label for the fake selection.\n\t */\n\tconstructor( selectable = null, placeOrOffset, options ) {\n\t\t/**\n\t\t * Stores all ranges that are selected.\n\t\t *\n\t\t * @protected\n\t\t * @member {Array.<module:engine/view/range~Range>}\n\t\t */\n\t\tthis._ranges = [];\n\n\t\t/**\n\t\t * Specifies whether the last added range was added as a backward or forward range.\n\t\t *\n\t\t * @protected\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._lastRangeBackward = false;\n\n\t\t/**\n\t\t * Specifies whether selection instance is fake.\n\t\t *\n\t\t * @private\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._isFake = false;\n\n\t\t/**\n\t\t * Fake selection's label.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._fakeSelectionLabel = '';\n\n\t\tthis.setTo( selectable, placeOrOffset, options );\n\t}\n\n\t/**\n\t * Returns true if selection instance is marked as `fake`.\n\t *\n\t * @see #setTo\n\t * @returns {Boolean}\n\t */\n\tget isFake() {\n\t\treturn this._isFake;\n\t}\n\n\t/**\n\t * Returns fake selection label.\n\t *\n\t * @see #setTo\n\t * @returns {String}\n\t */\n\tget fakeSelectionLabel() {\n\t\treturn this._fakeSelectionLabel;\n\t}\n\n\t/**\n\t * Selection anchor. Anchor may be described as a position where the selection starts. Together with\n\t * {@link #focus focus} they define the direction of selection, which is important\n\t * when expanding/shrinking selection. Anchor is always the start or end of the most recent added range.\n\t * It may be a bit unintuitive when there are multiple ranges in selection.\n\t *\n\t * @see #focus\n\t * @type {module:engine/view/position~Position}\n\t */\n\tget anchor() {\n\t\tif ( !this._ranges.length ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\n\t\tconst anchor = this._lastRangeBackward ? range.end : range.start;\n\n\t\treturn anchor.clone();\n\t}\n\n\t/**\n\t * Selection focus. Focus is a position where the selection ends.\n\t *\n\t * @see #anchor\n\t * @type {module:engine/view/position~Position}\n\t */\n\tget focus() {\n\t\tif ( !this._ranges.length ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\n\t\tconst focus = this._lastRangeBackward ? range.start : range.end;\n\n\t\treturn focus.clone();\n\t}\n\n\t/**\n\t * Returns whether the selection is collapsed. Selection is collapsed when there is exactly one range which is\n\t * collapsed.\n\t *\n\t * @type {Boolean}\n\t */\n\tget isCollapsed() {\n\t\treturn this.rangeCount === 1 && this._ranges[ 0 ].isCollapsed;\n\t}\n\n\t/**\n\t * Returns number of ranges in selection.\n\t *\n\t * @type {Number}\n\t */\n\tget rangeCount() {\n\t\treturn this._ranges.length;\n\t}\n\n\t/**\n\t * Specifies whether the {@link #focus} precedes {@link #anchor}.\n\t *\n\t * @type {Boolean}\n\t */\n\tget isBackward() {\n\t\treturn !this.isCollapsed && this._lastRangeBackward;\n\t}\n\n\t/**\n\t * {@link module:engine/view/editableelement~EditableElement EditableElement} instance that contains this selection, or `null`\n\t * if the selection is not inside an editable element.\n\t *\n\t * @type {module:engine/view/editableelement~EditableElement|null}\n\t */\n\tget editableElement() {\n\t\tif ( this.anchor ) {\n\t\t\treturn this.anchor.editableElement;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns an iterable that contains copies of all ranges added to the selection.\n\t *\n\t * @returns {Iterable.<module:engine/view/range~Range>}\n\t */\n\t* getRanges() {\n\t\tfor ( const range of this._ranges ) {\n\t\t\tyield range.clone();\n\t\t}\n\t}\n\n\t/**\n\t * Returns copy of the first range in the selection. First range is the one which\n\t * {@link module:engine/view/range~Range#start start} position {@link module:engine/view/position~Position#isBefore is before} start\n\t * position of all other ranges (not to confuse with the first range added to the selection).\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/range~Range|null}\n\t */\n\tgetFirstRange() {\n\t\tlet first = null;\n\n\t\tfor ( const range of this._ranges ) {\n\t\t\tif ( !first || range.start.isBefore( first.start ) ) {\n\t\t\t\tfirst = range;\n\t\t\t}\n\t\t}\n\n\t\treturn first ? first.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the last range in the selection. Last range is the one which {@link module:engine/view/range~Range#end end}\n\t * position {@link module:engine/view/position~Position#isAfter is after} end position of all other ranges (not to confuse\n\t * with the last range added to the selection). Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/range~Range|null}\n\t */\n\tgetLastRange() {\n\t\tlet last = null;\n\n\t\tfor ( const range of this._ranges ) {\n\t\t\tif ( !last || range.end.isAfter( last.end ) ) {\n\t\t\t\tlast = range;\n\t\t\t}\n\t\t}\n\n\t\treturn last ? last.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the first position in the selection. First position is the position that\n\t * {@link module:engine/view/position~Position#isBefore is before} any other position in the selection ranges.\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/position~Position|null}\n\t */\n\tgetFirstPosition() {\n\t\tconst firstRange = this.getFirstRange();\n\n\t\treturn firstRange ? firstRange.start.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the last position in the selection. Last position is the position that\n\t * {@link module:engine/view/position~Position#isAfter is after} any other position in the selection ranges.\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/position~Position|null}\n\t */\n\tgetLastPosition() {\n\t\tconst lastRange = this.getLastRange();\n\n\t\treturn lastRange ? lastRange.end.clone() : null;\n\t}\n\n\t/**\n\t * Checks whether, this selection is equal to given selection. Selections are equal if they have same directions,\n\t * same number of ranges and all ranges from one selection equal to a range from other selection.\n\t *\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\n\t * Selection to compare with.\n\t * @returns {Boolean} `true` if selections are equal, `false` otherwise.\n\t */\n\tisEqual( otherSelection ) {\n\t\tif ( this.isFake != otherSelection.isFake ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.isFake && this.fakeSelectionLabel != otherSelection.fakeSelectionLabel ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.rangeCount != otherSelection.rangeCount ) {\n\t\t\treturn false;\n\t\t} else if ( this.rangeCount === 0 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !this.anchor.isEqual( otherSelection.anchor ) || !this.focus.isEqual( otherSelection.focus ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( const thisRange of this._ranges ) {\n\t\t\tlet found = false;\n\n\t\t\tfor ( const otherRange of otherSelection._ranges ) {\n\t\t\t\tif ( thisRange.isEqual( otherRange ) ) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( !found ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Checks whether this selection is similar to given selection. Selections are similar if they have same directions, same\n\t * number of ranges, and all {@link module:engine/view/range~Range#getTrimmed trimmed} ranges from one selection are\n\t * equal to any trimmed range from other selection.\n\t *\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\n\t * Selection to compare with.\n\t * @returns {Boolean} `true` if selections are similar, `false` otherwise.\n\t */\n\tisSimilar( otherSelection ) {\n\t\tif ( this.isBackward != otherSelection.isBackward ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst numOfRangesA = count( this.getRanges() );\n\t\tconst numOfRangesB = count( otherSelection.getRanges() );\n\n\t\t// If selections have different number of ranges, they cannot be similar.\n\t\tif ( numOfRangesA != numOfRangesB ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If both selections have no ranges, they are similar.\n\t\tif ( numOfRangesA == 0 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check if each range in one selection has a similar range in other selection.\n\t\tfor ( let rangeA of this.getRanges() ) {\n\t\t\trangeA = rangeA.getTrimmed();\n\n\t\t\tlet found = false;\n\n\t\t\tfor ( let rangeB of otherSelection.getRanges() ) {\n\t\t\t\trangeB = rangeB.getTrimmed();\n\n\t\t\t\tif ( rangeA.start.isEqual( rangeB.start ) && rangeA.end.isEqual( rangeB.end ) ) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// For `rangeA`, neither range in `otherSelection` was similar. So selections are not similar.\n\t\t\tif ( !found ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// There were no ranges that weren't matched. Selections are similar.\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns the selected element. {@link module:engine/view/element~Element Element} is considered as selected if there is only\n\t * one range in the selection, and that range contains exactly one element.\n\t * Returns `null` if there is no selected element.\n\t *\n\t * @returns {module:engine/view/element~Element|null}\n\t */\n\tgetSelectedElement() {\n\t\tif ( this.rangeCount !== 1 ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.getFirstRange().getContainedElement();\n\t}\n\n\t/**\n\t * Sets this selection's ranges and direction to the specified location based on the given\n\t * {@link module:engine/view/selection~Selectable selectable}.\n\t *\n\t *\t\t// Sets selection to the given range.\n\t *\t\tconst range = writer.createRange( start, end );\n\t *\t\tselection.setTo( range );\n\t *\n\t *\t\t// Sets selection to given ranges.\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\n\t *\t\tselection.setTo( range );\n\t *\n\t *\t\t// Sets selection to the other selection.\n\t *\t\tconst otherSelection = writer.createSelection();\n\t *\t\tselection.setTo( otherSelection );\n\t *\n\t *\t \t// Sets selection to contents of DocumentSelection.\n\t *\t\tselection.setTo( editor.editing.view.document.selection );\n\t *\n\t * \t\t// Sets collapsed selection at the given position.\n\t *\t\tconst position = writer.createPositionAt( root, path );\n\t *\t\tselection.setTo( position );\n\t *\n\t * \t\t// Sets collapsed selection at the position of given item and offset.\n\t *\t\tselection.setTo( paragraph, offset );\n\t *\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\n\t * that element and ends after the last child of that element.\n\t *\n\t *\t\tselection.setTo( paragraph, 'in' );\n\t *\n\t * Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends just after the item.\n\t *\n\t *\t\tselection.setTo( paragraph, 'on' );\n\t *\n\t * \t\t// Clears selection. Removes all ranges.\n\t *\t\tselection.setTo( null );\n\t *\n\t * `Selection#setTo()` method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\n\t *\n\t *\t\t// Sets selection as backward.\n\t *\t\tselection.setTo( range, { backward: true } );\n\t *\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\n\t * represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\n\t * (and be  properly handled by screen readers).\n\t *\n\t *\t\t// Creates fake selection with label.\n\t *\t\tselection.setTo( range, { fake: true, label: 'foo' } );\n\t *\n\t * @fires change\n\t * @param {module:engine/view/selection~Selectable} selectable\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\n\t * @param {Object} [options]\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\n\t * @param {String} [options.label] Label for the fake selection.\n\t */\n\tsetTo( selectable, placeOrOffset, options ) {\n\t\tif ( selectable === null ) {\n\t\t\tthis._setRanges( [] );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\n\t\t\tthis._setRanges( selectable.getRanges(), selectable.isBackward );\n\t\t\tthis._setFakeOptions( { fake: selectable.isFake, label: selectable.fakeSelectionLabel } );\n\t\t} else if ( selectable instanceof Range ) {\n\t\t\tthis._setRanges( [ selectable ], placeOrOffset && placeOrOffset.backward );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Position ) {\n\t\t\tthis._setRanges( [ new Range( selectable ) ] );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Node ) {\n\t\t\tconst backward = !!options && !!options.backward;\n\t\t\tlet range;\n\n\t\t\tif ( placeOrOffset === undefined ) {\n\t\t\t\t/**\n\t\t\t\t * selection.setTo requires the second parameter when the first parameter is a node.\n\t\t\t\t *\n\t\t\t\t * @error view-selection-setTo-required-second-parameter\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'view-selection-setTo-required-second-parameter: ' +\n\t\t\t\t\t'selection.setTo requires the second parameter when the first parameter is a node.',\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\t} else if ( placeOrOffset == 'in' ) {\n\t\t\t\trange = Range._createIn( selectable );\n\t\t\t} else if ( placeOrOffset == 'on' ) {\n\t\t\t\trange = Range._createOn( selectable );\n\t\t\t} else {\n\t\t\t\trange = new Range( Position._createAt( selectable, placeOrOffset ) );\n\t\t\t}\n\n\t\t\tthis._setRanges( [ range ], backward );\n\t\t\tthis._setFakeOptions( options );\n\t\t} else if ( isIterable( selectable ) ) {\n\t\t\t// We assume that the selectable is an iterable of ranges.\n\t\t\t// Array.from() is used to prevent setting ranges to the old iterable\n\t\t\tthis._setRanges( selectable, placeOrOffset && placeOrOffset.backward );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else {\n\t\t\t/**\n\t\t\t * Cannot set selection to given place.\n\t\t\t *\n\t\t\t * @error view-selection-setTo-not-selectable\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'view-selection-setTo-not-selectable: Cannot set selection to given place.', this );\n\t\t}\n\n\t\tthis.fire( 'change' );\n\t}\n\n\t/**\n\t * Moves {@link #focus} to the specified location.\n\t *\n\t * The location can be specified in the same form as {@link module:engine/view/view~View#createPositionAt view.createPositionAt()}\n\t * parameters.\n\t *\n\t * @fires change\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\n\t */\n\tsetFocus( itemOrPosition, offset ) {\n\t\tif ( this.anchor === null ) {\n\t\t\t/**\n\t\t\t * Cannot set selection focus if there are no ranges in selection.\n\t\t\t *\n\t\t\t * @error view-selection-setFocus-no-ranges\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'view-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tconst newFocus = Position._createAt( itemOrPosition, offset );\n\n\t\tif ( newFocus.compareWith( this.focus ) == 'same' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst anchor = this.anchor;\n\n\t\tthis._ranges.pop();\n\n\t\tif ( newFocus.compareWith( anchor ) == 'before' ) {\n\t\t\tthis._addRange( new Range( newFocus, anchor ), true );\n\t\t} else {\n\t\t\tthis._addRange( new Range( anchor, newFocus ) );\n\t\t}\n\n\t\tthis.fire( 'change' );\n\t}\n\n\t/**\n\t * Checks whether this object is of the given type.\n\t *\n\t *\t\tselection.is( 'selection' ); // -> true\n\t *\t\tselection.is( 'view:selection' ); // -> true\n\t *\n\t *\t\tselection.is( 'model:selection' ); // -> false\n\t *\t\tselection.is( 'element' ); // -> false\n\t *\t\tselection.is( 'range' ); // -> false\n\t *\n\t * {@link module:engine/view/node~Node#is Check the entire list of view objects} which implement the `is()` method.\n\t *\n\t * @param {String} type\n\t * @returns {Boolean}\n\t */\n\tis( type ) {\n\t\treturn type == 'selection' || type == 'view:selection';\n\t}\n\n\t/**\n\t * Replaces all ranges that were added to the selection with given array of ranges. Last range of the array\n\t * is treated like the last added range and is used to set {@link #anchor anchor} and {@link #focus focus}.\n\t * Accepts a flag describing in which way the selection is made.\n\t *\n\t * @private\n\t * @param {Iterable.<module:engine/view/range~Range>} newRanges Iterable object of ranges to set.\n\t * @param {Boolean} [isLastBackward=false] Flag describing if last added range was selected forward - from start to end\n\t * (`false`) or backward - from end to start (`true`). Defaults to `false`.\n\t */\n\t_setRanges( newRanges, isLastBackward = false ) {\n\t\t// New ranges should be copied to prevent removing them by setting them to `[]` first.\n\t\t// Only applies to situations when selection is set to the same selection or same selection's ranges.\n\t\tnewRanges = Array.from( newRanges );\n\n\t\tthis._ranges = [];\n\n\t\tfor ( const range of newRanges ) {\n\t\t\tthis._addRange( range );\n\t\t}\n\n\t\tthis._lastRangeBackward = !!isLastBackward;\n\t}\n\n\t/**\n\t * Sets this selection instance to be marked as `fake`. A fake selection does not render as browser native selection\n\t * over selected elements and is hidden to the user. This way, no native selection UI artifacts are displayed to\n\t * the user and selection over elements can be represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM (and be\n\t * properly handled by screen readers).\n\t *\n\t * @private\n\t * @param {Object} [options] Options.\n\t * @param {Boolean} [options.fake] If set to true selection will be marked as `fake`.\n\t * @param {String} [options.label=''] Fake selection label.\n\t */\n\t_setFakeOptions( options = {} ) {\n\t\tthis._isFake = !!options.fake;\n\t\tthis._fakeSelectionLabel = options.fake ? options.label || '' : '';\n\t}\n\n\t/**\n\t * Adds a range to the selection. Added range is copied. This means that passed range is not saved in the\n\t * selection instance and you can safely operate on it.\n\t *\n\t * Accepts a flag describing in which way the selection is made - passed range might be selected from\n\t * {@link module:engine/view/range~Range#start start} to {@link module:engine/view/range~Range#end end}\n\t * or from {@link module:engine/view/range~Range#end end} to {@link module:engine/view/range~Range#start start}.\n\t * The flag is used to set {@link #anchor anchor} and {@link #focus focus} properties.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\n\t * with ranges already stored in Selection instance.\n\t *\n\t * @private\n\t * @fires change\n\t * @param {module:engine/view/range~Range} range\n\t * @param {Boolean} [isBackward]\n\t */\n\t_addRange( range, isBackward = false ) {\n\t\tif ( !( range instanceof Range ) ) {\n\t\t\t/**\n\t\t\t * Selection range set to an object that is not an instance of {@link module:engine/view/range~Range}.\n\t\t\t *\n\t\t\t * @error view-selection-add-range-not-range\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'view-selection-add-range-not-range: ' +\n\t\t\t\t'Selection range set to an object that is not an instance of view.Range',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tthis._pushRange( range );\n\t\tthis._lastRangeBackward = !!isBackward;\n\t}\n\n\t/**\n\t * Adds range to selection - creates copy of given range so it can be safely used and modified.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\n\t * with ranges already stored in selection instance.\n\t *\n\t * @private\n\t * @param {module:engine/view/range~Range} range\n\t */\n\t_pushRange( range ) {\n\t\tfor ( const storedRange of this._ranges ) {\n\t\t\tif ( range.isIntersecting( storedRange ) ) {\n\t\t\t\t/**\n\t\t\t\t * Trying to add a range that intersects with another range from selection.\n\t\t\t\t *\n\t\t\t\t * @error view-selection-range-intersects\n\t\t\t\t * @param {module:engine/view/range~Range} addedRange Range that was added to the selection.\n\t\t\t\t * @param {module:engine/view/range~Range} intersectingRange Range from selection that intersects with `addedRange`.\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'view-selection-range-intersects: Trying to add a range that intersects with another range from selection.',\n\t\t\t\t\tthis,\n\t\t\t\t\t{ addedRange: range, intersectingRange: storedRange }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis._ranges.push( new Range( range.start, range.end ) );\n\t}\n\n\t/**\n\t * Fired whenever selection ranges are changed through {@link ~Selection Selection API}.\n\t *\n\t * @event change\n\t */\n}\n\nmix( Selection, EmitterMixin );\n\n/**\n * An entity that is used to set selection.\n *\n * See also {@link module:engine/view/selection~Selection#setTo}\n *\n * @typedef {\n *    module:engine/view/selection~Selection|\n *    module:engine/view/documentselection~DocumentSelection|\n *    module:engine/view/position~Position|\n *    Iterable.<module:engine/view/range~Range>|\n *    module:engine/view/range~Range|\n *    module:engine/view/item~Item|\n *    null\n * } module:engine/view/selection~Selectable\n */\n"]}]}