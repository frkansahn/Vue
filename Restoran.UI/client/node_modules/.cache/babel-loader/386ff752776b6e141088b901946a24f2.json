{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-upload\\src\\filerepository.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-upload\\src\\filerepository.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1581760786382},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6XFxVc2Vyc1xccGNcXERlc2t0b3BcXFJlc3RvcmFuXFxSZXN0b3JhblxcUmVzdG9yYW4uVUlcXGNsaWVudFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMCwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSB1cGxvYWQvZmlsZXJlcG9zaXRvcnkKICovCgovKiBnbG9iYWxzIGNvbnNvbGUgKi8KaW1wb3J0IFBsdWdpbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWNvcmUvc3JjL3BsdWdpbic7CmltcG9ydCBQZW5kaW5nQWN0aW9ucyBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWNvcmUvc3JjL3BlbmRpbmdhY3Rpb25zJzsKaW1wb3J0IENLRWRpdG9yRXJyb3IsIHsgYXR0YWNoTGlua1RvRG9jdW1lbnRhdGlvbiB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgT2JzZXJ2YWJsZU1peGluIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL29ic2VydmFibGVtaXhpbic7CmltcG9ydCBDb2xsZWN0aW9uIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NvbGxlY3Rpb24nOwppbXBvcnQgbWl4IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL21peCc7CmltcG9ydCBGaWxlUmVhZGVyIGZyb20gJy4vZmlsZXJlYWRlci5qcyc7CmltcG9ydCB1aWQgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvdWlkLmpzJzsKLyoqCiAqIEZpbGUgcmVwb3NpdG9yeSBwbHVnaW4uIEEgY2VudHJhbCBwb2ludCBmb3IgbWFuYWdpbmcgZmlsZSB1cGxvYWQuCiAqCiAqIFRvIHVzZSBpdCwgZmlyc3QgeW91IG5lZWQgYW4gdXBsb2FkIGFkYXB0ZXIuIFVwbG9hZCBhZGFwdGVyJ3Mgam9iIGlzIHRvIGhhbmRsZSBjb21tdW5pY2F0aW9uIHdpdGggdGhlIHNlcnZlcgogKiAoc2VuZGluZyB0aGUgZmlsZSBhbmQgaGFuZGxpbmcgc2VydmVyJ3MgcmVzcG9uc2UpLiBZb3UgY2FuIHVzZSBvbmUgb2YgdGhlIGV4aXN0aW5nIHBsdWdpbnMgaW50cm9kdWNpbmcgdXBsb2FkIGFkYXB0ZXJzCiAqIChlLmcuIHtAbGluayBtb2R1bGU6ZWFzeS1pbWFnZS9jbG91ZHNlcnZpY2VzdXBsb2FkYWRhcHRlcn5DbG91ZFNlcnZpY2VzVXBsb2FkQWRhcHRlcn0gb3IKICoge0BsaW5rIG1vZHVsZTphZGFwdGVyLWNrZmluZGVyL3VwbG9hZGFkYXB0ZXJ+Q0tGaW5kZXJVcGxvYWRBZGFwdGVyfSkgb3Igd3JpdGUgeW91ciBvd24gb25lIOKAkyBzZWUKICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9kZWVwLWRpdmUvdXBsb2FkLWFkYXB0ZXIgIkN1c3RvbSBpbWFnZSB1cGxvYWQgYWRhcHRlciIgZGVlcCBkaXZlIGd1aWRlfS4KICoKICogVGhlbiwgeW91IGNhbiB1c2Uge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVJlcG9zaXRvcnkjY3JlYXRlTG9hZGVyIGBjcmVhdGVMb2FkZXIoKWB9IGFuZCB0aGUgcmV0dXJuZWQKICoge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZUxvYWRlcn0gaW5zdGFuY2UgdG8gbG9hZCBhbmQgdXBsb2FkIGZpbGVzLgogKgogKiBAZXh0ZW5kcyBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2luCiAqLwoKdmFyIEZpbGVSZXBvc2l0b3J5ID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1BsdWdpbikgewogIF9pbmhlcml0cyhGaWxlUmVwb3NpdG9yeSwgX1BsdWdpbik7CgogIGZ1bmN0aW9uIEZpbGVSZXBvc2l0b3J5KCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZpbGVSZXBvc2l0b3J5KTsKCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpbGVSZXBvc2l0b3J5KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICB9CgogIF9jcmVhdGVDbGFzcyhGaWxlUmVwb3NpdG9yeSwgW3sKICAgIGtleTogImluaXQiLAoKICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvKioKICAgICAgICogQ29sbGVjdGlvbiBvZiBsb2FkZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJlcG9zaXRvcnkuCiAgICAgICAqCiAgICAgICAqIEBtZW1iZXIge21vZHVsZTp1dGlscy9jb2xsZWN0aW9ufkNvbGxlY3Rpb259ICNsb2FkZXJzCiAgICAgICAqLwogICAgICB0aGlzLmxvYWRlcnMgPSBuZXcgQ29sbGVjdGlvbigpOyAvLyBLZWVwcyB1cGxvYWQgaW4gYSBzeW5jIHdpdGggcGVuZGluZyBhY3Rpb25zLgoKICAgICAgdGhpcy5sb2FkZXJzLm9uKCdhZGQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLl91cGRhdGVQZW5kaW5nQWN0aW9uKCk7CiAgICAgIH0pOwogICAgICB0aGlzLmxvYWRlcnMub24oJ3JlbW92ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMuX3VwZGF0ZVBlbmRpbmdBY3Rpb24oKTsKICAgICAgfSk7CiAgICAgIC8qKgogICAgICAgKiBMb2FkZXJzIG1hcHBpbmdzIHVzZWQgdG8gcmV0cmlldmUgbG9hZGVycyByZWZlcmVuY2VzLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKiBAbWVtYmVyIHtNYXA8RmlsZXxQcm9taXNlLCBGaWxlTG9hZGVyPn0gI19sb2FkZXJzTWFwCiAgICAgICAqLwoKICAgICAgdGhpcy5fbG9hZGVyc01hcCA9IG5ldyBNYXAoKTsKICAgICAgLyoqCiAgICAgICAqIFJlZmVyZW5jZSB0byBhIHBlbmRpbmcgYWN0aW9uIHJlZ2lzdGVyZWQgaW4gYSB7QGxpbmsgbW9kdWxlOmNvcmUvcGVuZGluZ2FjdGlvbnN+UGVuZGluZ0FjdGlvbnN9IHBsdWdpbgogICAgICAgKiB3aGlsZSB1cGxvYWQgaXMgaW4gcHJvZ3Jlc3MuIFdoZW4gdGhlcmUgaXMgbm8gdXBsb2FkIHRoZW4gdmFsdWUgaXMgYG51bGxgLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKiBAbWVtYmVyIHtPYmplY3R9ICNfcGVuZGluZ0FjdGlvbgogICAgICAgKi8KCiAgICAgIHRoaXMuX3BlbmRpbmdBY3Rpb24gPSBudWxsOwogICAgICAvKioKICAgICAgICogQSBmYWN0b3J5IGZ1bmN0aW9uIHdoaWNoIHNob3VsZCBiZSBkZWZpbmVkIGJlZm9yZSB1c2luZyBgRmlsZVJlcG9zaXRvcnlgLgogICAgICAgKgogICAgICAgKiBJdCBzaG91bGQgcmV0dXJuIGEgbmV3IGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5flVwbG9hZEFkYXB0ZXJ9IHRoYXQgd2lsbCBiZSB1c2VkIHRvIHVwbG9hZCBmaWxlcy4KICAgICAgICoge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZUxvYWRlcn0gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZGFwdGVyCiAgICAgICAqIHdpbGwgYmUgcGFzc2VkIHRvIHRoYXQgZnVuY3Rpb24uCiAgICAgICAqCiAgICAgICAqIEZvciBtb3JlIGluZm9ybWF0aW9uIGFuZCBleGFtcGxlIHNlZSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyfS4KICAgICAgICoKICAgICAgICogQG1lbWJlciB7RnVuY3Rpb259ICNjcmVhdGVVcGxvYWRBZGFwdGVyCiAgICAgICAqLwoKICAgICAgLyoqCiAgICAgICAqIE51bWJlciBvZiBieXRlcyB1cGxvYWRlZC4KICAgICAgICoKICAgICAgICogQHJlYWRvbmx5CiAgICAgICAqIEBvYnNlcnZhYmxlCiAgICAgICAqIEBtZW1iZXIge051bWJlcn0gI3VwbG9hZGVkCiAgICAgICAqLwoKICAgICAgdGhpcy5zZXQoJ3VwbG9hZGVkJywgMCk7CiAgICAgIC8qKgogICAgICAgKiBOdW1iZXIgb2YgdG90YWwgYnl0ZXMgdG8gdXBsb2FkLgogICAgICAgKgogICAgICAgKiBJdCBtaWdodCBiZSBkaWZmZXJlbnQgdGhhbiB0aGUgZmlsZSBzaXplIGJlY2F1c2Ugb2YgaGVhZGVycyBhbmQgYWRkaXRpb25hbCBkYXRhLgogICAgICAgKiBJdCBjb250YWlucyBgbnVsbGAgaWYgdmFsdWUgaXMgbm90IGF2YWlsYWJsZSB5ZXQsIHNvIGl0J3MgYmV0dGVyIHRvIHVzZSB7QGxpbmsgI3VwbG9hZGVkUGVyY2VudH0gdG8gbW9uaXRvcgogICAgICAgKiB0aGUgcHJvZ3Jlc3MuCiAgICAgICAqCiAgICAgICAqIEByZWFkb25seQogICAgICAgKiBAb2JzZXJ2YWJsZQogICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gI3VwbG9hZFRvdGFsCiAgICAgICAqLwoKICAgICAgdGhpcy5zZXQoJ3VwbG9hZFRvdGFsJywgbnVsbCk7CiAgICAgIC8qKgogICAgICAgKiBVcGxvYWQgcHJvZ3Jlc3MgaW4gcGVyY2VudHMuCiAgICAgICAqCiAgICAgICAqIEByZWFkb25seQogICAgICAgKiBAb2JzZXJ2YWJsZQogICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9ICN1cGxvYWRlZFBlcmNlbnQKICAgICAgICovCgogICAgICB0aGlzLmJpbmQoJ3VwbG9hZGVkUGVyY2VudCcpLnRvKHRoaXMsICd1cGxvYWRlZCcsIHRoaXMsICd1cGxvYWRUb3RhbCcsIGZ1bmN0aW9uICh1cGxvYWRlZCwgdG90YWwpIHsKICAgICAgICByZXR1cm4gdG90YWwgPyB1cGxvYWRlZCAvIHRvdGFsICogMTAwIDogMDsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggc3BlY2lmaWVkIGZpbGUgb3IgcHJvbWlzZS4KICAgICAqCiAgICAgKiBUbyBnZXQgbG9hZGVyIGJ5IGlkIHVzZSBgZmlsZVJlcG9zaXRvcnkubG9hZGVycy5nZXQoIGlkIClgLgogICAgICoKICAgICAqIEBwYXJhbSB7RmlsZXxQcm9taXNlLjxGaWxlPn0gZmlsZU9yUHJvbWlzZSBOYXRpdmUgZmlsZSBvciBwcm9taXNlIGhhbmRsZS4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXJ8bnVsbH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRMb2FkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvYWRlcihmaWxlT3JQcm9taXNlKSB7CiAgICAgIHJldHVybiB0aGlzLl9sb2FkZXJzTWFwLmdldChmaWxlT3JQcm9taXNlKSB8fCBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgbG9hZGVyIGluc3RhbmNlIGZvciB0aGUgZ2l2ZW4gZmlsZS4KICAgICAqCiAgICAgKiBSZXF1aXJlcyB7QGxpbmsgI2NyZWF0ZVVwbG9hZEFkYXB0ZXJ9IGZhY3RvcnkgdG8gYmUgZGVmaW5lZC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0ZpbGV8UHJvbWlzZS48RmlsZT59IGZpbGVPclByb21pc2UgTmF0aXZlIEZpbGUgb2JqZWN0IG9yIG5hdGl2ZSBQcm9taXNlIG9iamVjdCB3aGljaCByZXNvbHZlcyB0byBhIEZpbGUuCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyfG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlTG9hZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVMb2FkZXIoZmlsZU9yUHJvbWlzZSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5jcmVhdGVVcGxvYWRBZGFwdGVyKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogWW91IG5lZWQgdG8gZW5hYmxlIGFuIHVwbG9hZCBhZGFwdGVyIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gdXBsb2FkIGZpbGVzLgogICAgICAgICAqCiAgICAgICAgICogVGhpcyB3YXJuaW5nIHNob3dzIHVwIHdoZW4ge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVJlcG9zaXRvcnl9IGlzIGJlaW5nIHVzZWQKICAgICAgICAgKiB3aXRob3V0IHtAbGluayAjY3JlYXRlVXBsb2FkQWRhcHRlciBkZWZpbmluaW5nIGFuIHVwbG9hZCBhZGFwdGVyfS4KICAgICAgICAgKgogICAgICAgICAqICoqSWYgeW91IHNlZSB0aGlzIHdhcm5pbmcgd2hlbiB1c2luZyBvbmUgb2YgdGhlIHtAZ2xpbmsgYnVpbGRzL2luZGV4IENLRWRpdG9yIDUgQnVpbGRzfSoqCiAgICAgICAgICogaXQgbWVhbnMgdGhhdCB5b3UgZGlkIG5vdCBjb25maWd1cmUgYW55IG9mIHRoZSB1cGxvYWQgYWRhcHRlcnMgYXZhaWxhYmxlIGJ5IGRlZmF1bHQgaW4gdGhvc2UgYnVpbGRzLgogICAgICAgICAqCiAgICAgICAgICogU2VlIHRoZSB7QGdsaW5rIGZlYXR1cmVzL2ltYWdlLXVwbG9hZC9pbWFnZS11cGxvYWQgY29tcHJlaGVuc2l2ZSAiSW1hZ2UgdXBsb2FkIG92ZXJ2aWV3In0gdG8gbGVhcm4gd2hpY2ggdXBsb2FkCiAgICAgICAgICogYWRhcHRlcnMgYXJlIGF2YWlsYWJsZSBpbiB0aGUgYnVpbGRzIGFuZCBob3cgdG8gY29uZmlndXJlIHRoZW0uCiAgICAgICAgICoKICAgICAgICAgKiAqKklmIHlvdSBzZWUgdGhpcyB3YXJuaW5nIHdoZW4gdXNpbmcgYSBjdXN0b20gYnVpbGQqKiB0aGVyZSBpcyBhIGNoYW5jZSB0aGF0IHlvdSBlbmFibGVkCiAgICAgICAgICogYSBmZWF0dXJlIGxpa2Uge0BsaW5rIG1vZHVsZTppbWFnZS9pbWFnZXVwbG9hZH5JbWFnZVVwbG9hZH0sCiAgICAgICAgICogb3Ige0BsaW5rIG1vZHVsZTppbWFnZS9pbWFnZXVwbG9hZC9pbWFnZXVwbG9hZHVpfkltYWdlVXBsb2FkVUl9IGJ1dCB5b3UgZGlkIG5vdCBlbmFibGUgYW55IHVwbG9hZCBhZGFwdGVyLgogICAgICAgICAqIFlvdSBjYW4gY2hvb3NlIG9uZSBvZiB0aGUgZXhpc3RpbmcgdXBsb2FkIGFkYXB0ZXJzIGxpc3RlZCBpbiB0aGUKICAgICAgICAgKiB7QGdsaW5rIGZlYXR1cmVzL2ltYWdlLXVwbG9hZC9pbWFnZS11cGxvYWQgIkltYWdlIHVwbG9hZCBvdmVydmlldyJ9LgogICAgICAgICAqCiAgICAgICAgICogWW91IGNhbiBhbHNvIGltcGxlbWVudCB5b3VyIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9kZWVwLWRpdmUvdXBsb2FkLWFkYXB0ZXIgb3duIGltYWdlIHVwbG9hZCBhZGFwdGVyfS4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciBmaWxlcmVwb3NpdG9yeS1uby11cGxvYWQtYWRhcHRlcgogICAgICAgICAqLwogICAgICAgIGNvbnNvbGUud2FybihhdHRhY2hMaW5rVG9Eb2N1bWVudGF0aW9uKCdmaWxlcmVwb3NpdG9yeS1uby11cGxvYWQtYWRhcHRlcjogVXBsb2FkIGFkYXB0ZXIgaXMgbm90IGRlZmluZWQuJykpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoUHJvbWlzZS5yZXNvbHZlKGZpbGVPclByb21pc2UpLCB0aGlzLmNyZWF0ZVVwbG9hZEFkYXB0ZXIpOwogICAgICB0aGlzLmxvYWRlcnMuYWRkKGxvYWRlcik7CgogICAgICB0aGlzLl9sb2FkZXJzTWFwLnNldChmaWxlT3JQcm9taXNlLCBsb2FkZXIpOyAvLyBTdG9yZSBhbHNvIGZpbGUgPT4gbG9hZGVyIG1hcHBpbmcgc28gbG9hZGVyIGNhbiBiZSByZXRyaWV2ZWQgYnkgZmlsZSBpbnN0YW5jZSByZXR1cm5lZCB1cG9uIFByb21pc2UgcmVzb2x1dGlvbi4KCgogICAgICBpZiAoZmlsZU9yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHsKICAgICAgICBsb2FkZXIuZmlsZS50aGVuKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICBfdGhpczIuX2xvYWRlcnNNYXAuc2V0KGZpbGUsIGxvYWRlcik7CiAgICAgICAgfSkgLy8gRXZlcnkgdGhlbigpIG11c3QgaGF2ZSBhIGNhdGNoKCkuCiAgICAgICAgLy8gRmlsZSBsb2FkZXIgc3RhdGUgKGFuZCByZWplY3Rpb25zKSBhcmUgaGFuZGxlZCBpbiByZWFkKCkgYW5kIHVwbG9hZCgpLgogICAgICAgIC8vIEFsc28sIHNlZSB0aGUgImRvZXMgbm90IHN3YWxsb3cgdGhlIGZpbGUgcHJvbWlzZSByZWplY3Rpb24iIHRlc3QuCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTsKICAgICAgfQoKICAgICAgbG9hZGVyLm9uKCdjaGFuZ2U6dXBsb2FkZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGFnZ3JlZ2F0ZWRVcGxvYWRlZCA9IDA7CiAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IF90aGlzMi5sb2FkZXJzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgX2xvYWRlciA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICBhZ2dyZWdhdGVkVXBsb2FkZWQgKz0gX2xvYWRlci51cGxvYWRlZDsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RoaXMyLnVwbG9hZGVkID0gYWdncmVnYXRlZFVwbG9hZGVkOwogICAgICB9KTsKICAgICAgbG9hZGVyLm9uKCdjaGFuZ2U6dXBsb2FkVG90YWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGFnZ3JlZ2F0ZWRUb3RhbCA9IDA7CiAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yMiA9IHVuZGVmaW5lZDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBfdGhpczIubG9hZGVyc1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgX2xvYWRlcjIgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgICBpZiAoX2xvYWRlcjIudXBsb2FkVG90YWwpIHsKICAgICAgICAgICAgICBhZ2dyZWdhdGVkVG90YWwgKz0gX2xvYWRlcjIudXBsb2FkVG90YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yMiA9IHRydWU7CiAgICAgICAgICBfaXRlcmF0b3JFcnJvcjIgPSBlcnI7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgJiYgX2l0ZXJhdG9yMi5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgIF9pdGVyYXRvcjIucmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF90aGlzMi51cGxvYWRUb3RhbCA9IGFnZ3JlZ2F0ZWRUb3RhbDsKICAgICAgfSk7CiAgICAgIHJldHVybiBsb2FkZXI7CiAgICB9CiAgICAvKioKICAgICAqIERlc3Ryb3lzIHRoZSBnaXZlbiBsb2FkZXIuCiAgICAgKgogICAgICogQHBhcmFtIHtGaWxlfFByb21pc2V8bW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyfSBmaWxlT3JQcm9taXNlT3JMb2FkZXIgRmlsZSBvciBQcm9taXNlIGFzc29jaWF0ZWQKICAgICAqIHdpdGggdGhhdCBsb2FkZXIgb3IgbG9hZGVyIGl0c2VsZi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95TG9hZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95TG9hZGVyKGZpbGVPclByb21pc2VPckxvYWRlcikgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBsb2FkZXIgPSBmaWxlT3JQcm9taXNlT3JMb2FkZXIgaW5zdGFuY2VvZiBGaWxlTG9hZGVyID8gZmlsZU9yUHJvbWlzZU9yTG9hZGVyIDogdGhpcy5nZXRMb2FkZXIoZmlsZU9yUHJvbWlzZU9yTG9hZGVyKTsKCiAgICAgIGxvYWRlci5fZGVzdHJveSgpOwoKICAgICAgdGhpcy5sb2FkZXJzLnJlbW92ZShsb2FkZXIpOwoKICAgICAgdGhpcy5fbG9hZGVyc01hcC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgaWYgKHZhbHVlID09PSBsb2FkZXIpIHsKICAgICAgICAgIF90aGlzMy5fbG9hZGVyc01hcC5kZWxldGUoa2V5KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBSZWdpc3RlcnMgb3IgZGVyZWdpc3RlcnMgcGVuZGluZyBhY3Rpb24gYm91bmQgd2l0aCB1cGxvYWQgcHJvZ3Jlc3MuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfdXBkYXRlUGVuZGluZ0FjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZVBlbmRpbmdBY3Rpb24oKSB7CiAgICAgIHZhciBwZW5kaW5nQWN0aW9ucyA9IHRoaXMuZWRpdG9yLnBsdWdpbnMuZ2V0KFBlbmRpbmdBY3Rpb25zKTsKCiAgICAgIGlmICh0aGlzLmxvYWRlcnMubGVuZ3RoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9wZW5kaW5nQWN0aW9uKSB7CiAgICAgICAgICB2YXIgdCA9IHRoaXMuZWRpdG9yLnQ7CgogICAgICAgICAgdmFyIGdldE1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRNZXNzYWdlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiAiIi5jb25jYXQodCgnVXBsb2FkIGluIHByb2dyZXNzJyksICIgIikuY29uY2F0KHBhcnNlSW50KHZhbHVlKSwgIiUuIik7CiAgICAgICAgICB9OwoKICAgICAgICAgIHRoaXMuX3BlbmRpbmdBY3Rpb24gPSBwZW5kaW5nQWN0aW9ucy5hZGQoZ2V0TWVzc2FnZSh0aGlzLnVwbG9hZGVkUGVyY2VudCkpOwoKICAgICAgICAgIHRoaXMuX3BlbmRpbmdBY3Rpb24uYmluZCgnbWVzc2FnZScpLnRvKHRoaXMsICd1cGxvYWRlZFBlcmNlbnQnLCBnZXRNZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGVuZGluZ0FjdGlvbnMucmVtb3ZlKHRoaXMuX3BlbmRpbmdBY3Rpb24pOwogICAgICAgIHRoaXMuX3BlbmRpbmdBY3Rpb24gPSBudWxsOwogICAgICB9CiAgICB9CiAgfV0sIFt7CiAgICBrZXk6ICJwbHVnaW5OYW1lIiwKCiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gJ0ZpbGVSZXBvc2l0b3J5JzsKICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXF1aXJlcyIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIFtQZW5kaW5nQWN0aW9uc107CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRmlsZVJlcG9zaXRvcnk7Cn0oUGx1Z2luKTsKCmV4cG9ydCB7IEZpbGVSZXBvc2l0b3J5IGFzIGRlZmF1bHQgfTsKbWl4KEZpbGVSZXBvc2l0b3J5LCBPYnNlcnZhYmxlTWl4aW4pOwovKioKICogRmlsZSBsb2FkZXIgY2xhc3MuCiAqCiAqIEl0IGlzIHVzZWQgdG8gY29udHJvbCB0aGUgcHJvY2VzcyBvZiByZWFkaW5nIHRoZSBmaWxlIGFuZCB1cGxvYWRpbmcgaXQgdXNpbmcgdGhlIHNwZWNpZmllZCB1cGxvYWQgYWRhcHRlci4KICovCgp2YXIgRmlsZUxvYWRlciA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIC8qKgogICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgYEZpbGVMb2FkZXJgLgogICAqCiAgICogQHBhcmFtIHtQcm9taXNlLjxGaWxlPn0gZmlsZVByb21pc2UgQSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHRvIGEgZmlsZSBpbnN0YW5jZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB1cGxvYWRBZGFwdGVyQ3JlYXRvciBUaGUgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyfSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBGaWxlTG9hZGVyKGZpbGVQcm9taXNlLCB1cGxvYWRBZGFwdGVyQ3JlYXRvcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZpbGVMb2FkZXIpOwoKICAgIC8qKgogICAgICogVW5pcXVlIGlkIG9mIEZpbGVMb2FkZXIgaW5zdGFuY2UuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9CiAgICAgKi8KICAgIHRoaXMuaWQgPSB1aWQoKTsKICAgIC8qKgogICAgICogQWRkaXRpb25hbCB3cmFwcGVyIG92ZXIgdGhlIGluaXRpYWwgZmlsZSBwcm9taXNlIHBhc3NlZCB0byB0aGlzIGxvYWRlci4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVQcm9taXNlV3JhcHBlcn0KICAgICAqLwoKICAgIHRoaXMuX2ZpbGVQcm9taXNlV3JhcHBlciA9IHRoaXMuX2NyZWF0ZUZpbGVQcm9taXNlV3JhcHBlcihmaWxlUHJvbWlzZSk7CiAgICAvKioKICAgICAqIEFkYXB0ZXIgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZmlsZSBsb2FkZXIuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge21vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+VXBsb2FkQWRhcHRlcn0KICAgICAqLwoKICAgIHRoaXMuX2FkYXB0ZXIgPSB1cGxvYWRBZGFwdGVyQ3JlYXRvcih0aGlzKTsKICAgIC8qKgogICAgICogRmlsZVJlYWRlciB1c2VkIGJ5IEZpbGVMb2FkZXIuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7bW9kdWxlOnVwbG9hZC9maWxlcmVhZGVyfkZpbGVSZWFkZXJ9CiAgICAgKi8KCiAgICB0aGlzLl9yZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgLyoqCiAgICAgKiBDdXJyZW50IHN0YXR1cyBvZiBGaWxlTG9hZGVyLiBJdCBjYW4gYmUgb25lIG9mIHRoZSBmb2xsb3dpbmc6CiAgICAgKgogICAgICogKiAnaWRsZScsCiAgICAgKiAqICdyZWFkaW5nJywKICAgICAqICogJ3VwbG9hZGluZycsCiAgICAgKiAqICdhYm9ydGVkJywKICAgICAqICogJ2Vycm9yJy4KICAgICAqCiAgICAgKiBXaGVuIHJlYWRpbmcgc3RhdHVzIGNhbiBjaGFuZ2UgaW4gYSBmb2xsb3dpbmcgd2F5OgogICAgICoKICAgICAqIGBpZGxlYCAtPiBgcmVhZGluZ2AgLT4gYGlkbGVgCiAgICAgKiBgaWRsZWAgLT4gYHJlYWRpbmcgLT4gYGFib3J0ZWRgCiAgICAgKiBgaWRsZWAgLT4gYHJlYWRpbmcgLT4gYGVycm9yYAogICAgICoKICAgICAqIFdoZW4gdXBsb2FkaW5nIHN0YXR1cyBjYW4gY2hhbmdlIGluIGEgZm9sbG93aW5nIHdheToKICAgICAqCiAgICAgKiBgaWRsZWAgLT4gYHVwbG9hZGluZ2AgLT4gYGlkbGVgCiAgICAgKiBgaWRsZWAgLT4gYHVwbG9hZGluZ2AgLT4gYGFib3J0ZWRgCiAgICAgKiBgaWRsZWAgLT4gYHVwbG9hZGluZ2AgLT4gYGVycm9yYAogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge1N0cmluZ30gI3N0YXR1cwogICAgICovCgogICAgdGhpcy5zZXQoJ3N0YXR1cycsICdpZGxlJyk7CiAgICAvKioKICAgICAqIE51bWJlciBvZiBieXRlcyB1cGxvYWRlZC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9ICN1cGxvYWRlZAogICAgICovCgogICAgdGhpcy5zZXQoJ3VwbG9hZGVkJywgMCk7CiAgICAvKioKICAgICAqIE51bWJlciBvZiB0b3RhbCBieXRlcyB0byB1cGxvYWQuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAb2JzZXJ2YWJsZQogICAgICogQG1lbWJlciB7TnVtYmVyfG51bGx9ICN1cGxvYWRUb3RhbAogICAgICovCgogICAgdGhpcy5zZXQoJ3VwbG9hZFRvdGFsJywgbnVsbCk7CiAgICAvKioKICAgICAqIFVwbG9hZCBwcm9ncmVzcyBpbiBwZXJjZW50cy4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9ICN1cGxvYWRlZFBlcmNlbnQKICAgICAqLwoKICAgIHRoaXMuYmluZCgndXBsb2FkZWRQZXJjZW50JykudG8odGhpcywgJ3VwbG9hZGVkJywgdGhpcywgJ3VwbG9hZFRvdGFsJywgZnVuY3Rpb24gKHVwbG9hZGVkLCB0b3RhbCkgewogICAgICByZXR1cm4gdG90YWwgPyB1cGxvYWRlZCAvIHRvdGFsICogMTAwIDogMDsKICAgIH0pOwogICAgLyoqCiAgICAgKiBSZXNwb25zZSBvZiB0aGUgdXBsb2FkLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge09iamVjdHxudWxsfSAjdXBsb2FkUmVzcG9uc2UKICAgICAqLwoKICAgIHRoaXMuc2V0KCd1cGxvYWRSZXNwb25zZScsIG51bGwpOwogIH0KICAvKioKICAgKiBBIGBQcm9taXNlYCB3aGljaCByZXNvbHZlcyB0byBhIGBGaWxlYCBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBmaWxlIGxvYWRlci4KICAgKgogICAqIEB0eXBlIHtQcm9taXNlLjxGaWxlfG51bGw+fQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEZpbGVMb2FkZXIsIFt7CiAgICBrZXk6ICJyZWFkIiwKCiAgICAvKioKICAgICAqIFJlYWRzIGZpbGUgdXNpbmcge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlYWRlcn5GaWxlUmVhZGVyfS4KICAgICAqCiAgICAgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYGZpbGVyZXBvc2l0b3J5LXJlYWQtd3Jvbmctc3RhdHVzYCB3aGVuIHN0YXR1cwogICAgICogaXMgZGlmZmVyZW50IHRoYW4gYGlkbGVgLgogICAgICoKICAgICAqIEV4YW1wbGUgdXNhZ2U6CiAgICAgKgogICAgICoJZmlsZUxvYWRlci5yZWFkKCkKICAgICAqCQkudGhlbiggZGF0YSA9PiB7IC4uLiB9ICkKICAgICAqCQkuY2F0Y2goIGVyciA9PiB7CiAgICAgKgkJCWlmICggZXJyID09PSAnYWJvcnRlZCcgKSB7CiAgICAgKgkJCQljb25zb2xlLmxvZyggJ1JlYWRpbmcgYWJvcnRlZC4nICk7CiAgICAgKgkJCX0gZWxzZSB7CiAgICAgKgkJCQljb25zb2xlLmxvZyggJ1JlYWRpbmcgZXJyb3IuJywgZXJyICk7CiAgICAgKgkJCX0KICAgICAqCQl9ICk7CiAgICAgKgogICAgICogQHJldHVybnMge1Byb21pc2UuPFN0cmluZz59IFJldHVybnMgcHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCByZWFkIGRhdGEuIFByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBpZiBlcnJvcgogICAgICogb2NjdXJzIG9yIGlmIHJlYWQgcHJvY2VzcyBpcyBhYm9ydGVkLgogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zdGF0dXMgIT0gJ2lkbGUnKSB7CiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2ZpbGVyZXBvc2l0b3J5LXJlYWQtd3Jvbmctc3RhdHVzOiBZb3UgY2Fubm90IGNhbGwgcmVhZCBpZiB0aGUgc3RhdHVzIGlzIGRpZmZlcmVudCB0aGFuIGlkbGUuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuc3RhdHVzID0gJ3JlYWRpbmcnOwogICAgICByZXR1cm4gdGhpcy5maWxlLnRoZW4oZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICByZXR1cm4gX3RoaXM0Ll9yZWFkZXIucmVhZChmaWxlKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIF90aGlzNC5zdGF0dXMgPSAnaWRsZSc7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBpZiAoZXJyID09PSAnYWJvcnRlZCcpIHsKICAgICAgICAgIF90aGlzNC5zdGF0dXMgPSAnYWJvcnRlZCc7CiAgICAgICAgICB0aHJvdyAnYWJvcnRlZCc7CiAgICAgICAgfQoKICAgICAgICBfdGhpczQuc3RhdHVzID0gJ2Vycm9yJzsKICAgICAgICB0aHJvdyBfdGhpczQuX3JlYWRlci5lcnJvciA/IF90aGlzNC5fcmVhZGVyLmVycm9yIDogZXJyOwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogUmVhZHMgZmlsZSB1c2luZyB0aGUgcHJvdmlkZWQge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+VXBsb2FkQWRhcHRlcn0uCiAgICAgKgogICAgICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGBmaWxlcmVwb3NpdG9yeS11cGxvYWQtd3Jvbmctc3RhdHVzYCB3aGVuIHN0YXR1cwogICAgICogaXMgZGlmZmVyZW50IHRoYW4gYGlkbGVgLgogICAgICogRXhhbXBsZSB1c2FnZToKICAgICAqCiAgICAgKglmaWxlTG9hZGVyLnVwbG9hZCgpCiAgICAgKgkJLnRoZW4oIGRhdGEgPT4geyAuLi4gfSApCiAgICAgKgkJLmNhdGNoKCBlID0+IHsKICAgICAqCQkJaWYgKCBlID09PSAnYWJvcnRlZCcgKSB7CiAgICAgKgkJCQljb25zb2xlLmxvZyggJ1VwbG9hZGluZyBhYm9ydGVkLicgKTsKICAgICAqCQkJfSBlbHNlIHsKICAgICAqCQkJCWNvbnNvbGUubG9nKCAnVXBsb2FkaW5nIGVycm9yLicsIGUgKTsKICAgICAqCQkJfQogICAgICoJCX0gKTsKICAgICAqCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48T2JqZWN0Pn0gUmV0dXJucyBwcm9taXNlIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHJlc3BvbnNlIGRhdGEuIFByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBpZiBlcnJvcgogICAgICogb2NjdXJzIG9yIGlmIHJlYWQgcHJvY2VzcyBpcyBhYm9ydGVkLgogICAgICovCgogIH0sIHsKICAgIGtleTogInVwbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBsb2FkKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnN0YXR1cyAhPSAnaWRsZScpIHsKICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZmlsZXJlcG9zaXRvcnktdXBsb2FkLXdyb25nLXN0YXR1czogWW91IGNhbm5vdCBjYWxsIHVwbG9hZCBpZiB0aGUgc3RhdHVzIGlzIGRpZmZlcmVudCB0aGFuIGlkbGUuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuc3RhdHVzID0gJ3VwbG9hZGluZyc7CiAgICAgIHJldHVybiB0aGlzLmZpbGUudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNS5fYWRhcHRlci51cGxvYWQoKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIF90aGlzNS51cGxvYWRSZXNwb25zZSA9IGRhdGE7CiAgICAgICAgX3RoaXM1LnN0YXR1cyA9ICdpZGxlJzsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIGlmIChfdGhpczUuc3RhdHVzID09PSAnYWJvcnRlZCcpIHsKICAgICAgICAgIHRocm93ICdhYm9ydGVkJzsKICAgICAgICB9CgogICAgICAgIF90aGlzNS5zdGF0dXMgPSAnZXJyb3InOwogICAgICAgIHRocm93IGVycjsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEFib3J0cyBsb2FkaW5nIHByb2Nlc3MuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWJvcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICB2YXIgc3RhdHVzID0gdGhpcy5zdGF0dXM7CiAgICAgIHRoaXMuc3RhdHVzID0gJ2Fib3J0ZWQnOwoKICAgICAgaWYgKCF0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIuaXNGdWxmaWxsZWQpIHsKICAgICAgICAvLyBFZGdlIGNhc2U6IGZpbGUgbG9hZGVyIGlzIGFib3J0ZWQgYmVmb3JlIHJlYWQoKSBpcyBjYWxsZWQKICAgICAgICAvLyBzbyBpdCBtaWdodCBoYXBwZW4gdGhhdCBubyBvbmUgaGFuZGxlZCB0aGUgcmVqZWN0aW9uIG9mIHRoaXMgcHJvbWlzZS4KICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS11cGxvYWQvcHVsbC8xMDAKICAgICAgICB0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIucHJvbWlzZS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CgogICAgICAgIHRoaXMuX2ZpbGVQcm9taXNlV3JhcHBlci5yZWplY3RlcignYWJvcnRlZCcpOwogICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSAncmVhZGluZycpIHsKICAgICAgICB0aGlzLl9yZWFkZXIuYWJvcnQoKTsKICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gJ3VwbG9hZGluZycgJiYgdGhpcy5fYWRhcHRlci5hYm9ydCkgewogICAgICAgIHRoaXMuX2FkYXB0ZXIuYWJvcnQoKTsKICAgICAgfQoKICAgICAgdGhpcy5fZGVzdHJveSgpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBjbGVhbnVwLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2Rlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZXN0cm95KCkgewogICAgICB0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuX3JlYWRlciA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5fYWRhcHRlciA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy51cGxvYWRSZXNwb25zZSA9IHVuZGVmaW5lZDsKICAgIH0KICAgIC8qKgogICAgICogV3JhcHMgYSBnaXZlbiBmaWxlIHByb21pc2UgaW50byBhbm90aGVyIHByb21pc2UgZ2l2aW5nIGFkZGl0aW9uYWwKICAgICAqIGNvbnRyb2wgKHJlc29sdmluZywgcmVqZWN0aW5nLCBjaGVja2luZyBpZiBmdWxmaWxsZWQpIG92ZXIgaXQuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSBmaWxlUHJvbWlzZSBUaGUgaW5pdGlhbCBmaWxlIHByb21pc2UgdG8gYmUgd3JhcHBlZC4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVQcm9taXNlV3JhcHBlcn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY3JlYXRlRmlsZVByb21pc2VXcmFwcGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRmlsZVByb21pc2VXcmFwcGVyKGZpbGVQcm9taXNlKSB7CiAgICAgIHZhciB3cmFwcGVyID0ge307CiAgICAgIHdyYXBwZXIucHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB3cmFwcGVyLnJlamVjdGVyID0gcmVqZWN0OwogICAgICAgIHdyYXBwZXIuaXNGdWxmaWxsZWQgPSBmYWxzZTsKICAgICAgICBmaWxlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICB3cmFwcGVyLmlzRnVsZmlsbGVkID0gdHJ1ZTsKICAgICAgICAgIHJlc29sdmUoZmlsZSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgd3JhcHBlci5pc0Z1bGZpbGxlZCA9IHRydWU7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB3cmFwcGVyOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbGUiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIpIHsKICAgICAgICAvLyBMb2FkZXIgd2FzIGRlc3Ryb3llZCwgcmV0dXJuIHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgdG8gbnVsbC4KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBgdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyLnByb21pc2VgIGlzIGNoYWluZWQgYW5kIG5vdCBzaW1wbHkgcmV0dXJuZWQgdG8gaGFuZGxlIGEgY2FzZSB3aGVuOgogICAgICAgIC8vCiAgICAgICAgLy8JCSogVGhlIGBsb2FkZXIuZmlsZS50aGVuKCAuLi4gKWAgaXMgY2FsbGVkIGJ5IGV4dGVybmFsIGNvZGUgKHJldHVybmVkIHByb21pc2UgaXMgcGVuZGluZykuCiAgICAgICAgLy8JCSogVGhlbiBgbG9hZGVyLl9kZXN0cm95KClgIGlzIGNhbGxlZCAoY2FsbCBpcyBzeW5jaHJvbm91cykgd2hpY2ggZGVzdHJveXMgdGhlIGBsb2FkZXJgLgogICAgICAgIC8vCQkqIFByb21pc2UgcmV0dXJuZWQgYnkgdGhlIGZpcnN0IGBsb2FkZXIuZmlsZS50aGVuKCAuLi4gKWAgY2FsbCBpcyByZXNvbHZlZC4KICAgICAgICAvLwogICAgICAgIC8vIFJldHVybmluZyBgdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyLnByb21pc2VgIHdpbGwgc3RpbGwgcmVzb2x2ZSB0byBhIGBGaWxlYCBpbnN0YW5jZSBzbyB0aGVyZQogICAgICAgIC8vIGlzIGFuIGFkZGl0aW9uYWwgY2hlY2sgbmVlZGVkIGluIHRoZSBjaGFpbiB0byBzZWUgaWYgYGxvYWRlcmAgd2FzIGRlc3Ryb3llZCBpbiB0aGUgbWVhbnRpbWUuCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVQcm9taXNlV3JhcHBlci5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgIHJldHVybiBfdGhpczYuX2ZpbGVQcm9taXNlV3JhcHBlciA/IGZpbGUgOiBudWxsOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZpbGUgZGF0YS4gVG8gcmVhZCBpdHMgZGF0YSwgeW91IG5lZWQgZm9yIGZpcnN0IGxvYWQgdGhlIGZpbGUKICAgICAqIGJ5IHVzaW5nIHRoZSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyI3JlYWQgYHJlYWQoKWB9IG1ldGhvZC4KICAgICAqCiAgICAgKiBAdHlwZSB7RmlsZXx1bmRlZmluZWR9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGF0YSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlYWRlci5kYXRhOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEZpbGVMb2FkZXI7Cn0oKTsKCm1peChGaWxlTG9hZGVyLCBPYnNlcnZhYmxlTWl4aW4pOwovKioKICogVXBsb2FkIGFkYXB0ZXIgaW50ZXJmYWNlIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVSZXBvc2l0b3J5IGZpbGUgcmVwb3NpdG9yeX0KICogdG8gaGFuZGxlIGZpbGUgdXBsb2FkLiBBbiB1cGxvYWQgYWRhcHRlciBpcyBhIGJyaWRnZSBiZXR3ZWVuIHRoZSBlZGl0b3IgYW5kIHNlcnZlciB0aGF0IGhhbmRsZXMgZmlsZSB1cGxvYWRzLgogKiBJdCBzaG91bGQgY29udGFpbiBhIGxvZ2ljIG5lY2Vzc2FyeSB0byBpbml0aWF0ZSBhbiB1cGxvYWQgcHJvY2VzcyBhbmQgbW9uaXRvciBpdHMgcHJvZ3Jlc3MuCiAqCiAqIExlYXJuIGhvdyB0byBkZXZlbG9wIHlvdXIgb3duIHVwbG9hZCBhZGFwdGVyIGZvciBDS0VkaXRvciA1IGluIHRoZQogKiB7QGdsaW5rIGZyYW1ld29yay9ndWlkZXMvZGVlcC1kaXZlL3VwbG9hZC1hZGFwdGVyICJDdXN0b20gdXBsb2FkIGFkYXB0ZXIiIGd1aWRlfS4KICoKICogQGludGVyZmFjZSBVcGxvYWRBZGFwdGVyCiAqLwoKLyoqCiAqIEV4ZWN1dGVzIHRoZSB1cGxvYWQgcHJvY2Vzcy4KICogVGhpcyBtZXRob2Qgc2hvdWxkIHJldHVybiBhIHByb21pc2UgdGhhdCB3aWxsIHJlc29sdmUgd2hlbiBkYXRhIHdpbGwgYmUgdXBsb2FkZWQgdG8gc2VydmVyLiBQcm9taXNlIHNob3VsZCBiZQogKiByZXNvbHZlZCB3aXRoIGFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHVwbG9hZGVkIGZpbGU6CiAqCiAqCQl7CiAqCQkJZGVmYXVsdDogJ2h0dHA6Ly9zZXJ2ZXIvZGVmYXVsdC1zaXplLmltYWdlLnBuZycKICoJCX0KICoKICogQWRkaXRpb25hbGx5LCBvdGhlciBpbWFnZSBzaXplcyBjYW4gYmUgcHJvdmlkZWQ6CiAqCiAqCQl7CiAqCQkJZGVmYXVsdDogJ2h0dHA6Ly9zZXJ2ZXIvZGVmYXVsdC1zaXplLmltYWdlLnBuZycsCiAqCQkJJzE2MCc6ICdodHRwOi8vc2VydmVyL3NpemUtMTYwLmltYWdlLnBuZycsCiAqCQkJJzUwMCc6ICdodHRwOi8vc2VydmVyL3NpemUtNTAwLmltYWdlLnBuZycsCiAqCQkJJzEwMDAnOiAnaHR0cDovL3NlcnZlci9zaXplLTEwMDAuaW1hZ2UucG5nJywKICoJCQknMTA1Mic6ICdodHRwOi8vc2VydmVyL2RlZmF1bHQtc2l6ZS5pbWFnZS5wbmcnCiAqCQl9CiAqCiAqIE5PVEU6IFdoZW4gcmV0dXJuaW5nIG11bHRpcGxlIGltYWdlcywgdGhlIHdpZGVzdCByZXR1cm5lZCBvbmUgc2hvdWxkIGVxdWFsIHRoZSBkZWZhdWx0IG9uZS4gSXQgaXMgZXNzZW50aWFsIHRvCiAqIGNvcnJlY3RseSBzZXQgYHdpZHRoYCBhdHRyaWJ1dGUgb2YgdGhlIGltYWdlLiBTZWUgdGhpcyBkaXNjdXNzaW9uOgogKiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVhc3ktaW1hZ2UvaXNzdWVzLzQgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAqCiAqIFRha2UgYSBsb29rIGF0IHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5flVwbG9hZEFkYXB0ZXIgZXhhbXBsZSBBZGFwdGVyIGltcGxlbWVudGF0aW9ufSBhbmQKICoge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVJlcG9zaXRvcnkjY3JlYXRlVXBsb2FkQWRhcHRlciBjcmVhdGVVcGxvYWRBZGFwdGVyIG1ldGhvZH0uCiAqCiAqIEBtZXRob2QgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyI3VwbG9hZAogKiBAcmV0dXJucyB7UHJvbWlzZS48T2JqZWN0Pn0gUHJvbWlzZSB0aGF0IHNob3VsZCBiZSByZXNvbHZlZCB3aGVuIGRhdGEgaXMgdXBsb2FkZWQuCiAqLwoKLyoqCiAqIEFib3J0cyB0aGUgdXBsb2FkIHByb2Nlc3MuCiAqIEFmdGVyIGFib3J0aW5nIGl0IHNob3VsZCByZWplY3QgcHJvbWlzZSByZXR1cm5lZCBmcm9tIHtAbGluayAjdXBsb2FkIHVwbG9hZCgpfS4KICoKICogVGFrZSBhIGxvb2sgYXQge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+VXBsb2FkQWRhcHRlciBleGFtcGxlIEFkYXB0ZXIgaW1wbGVtZW50YXRpb259IGFuZAogKiB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlUmVwb3NpdG9yeSNjcmVhdGVVcGxvYWRBZGFwdGVyIGNyZWF0ZVVwbG9hZEFkYXB0ZXIgbWV0aG9kfS4KICoKICogQG1ldGhvZCBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5flVwbG9hZEFkYXB0ZXIjYWJvcnQKICovCgovKioKICogT2JqZWN0IHJldHVybmVkIGJ5IHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXIjX2NyZWF0ZUZpbGVQcm9taXNlV3JhcHBlcn0gbWV0aG9kCiAqIHRvIGFkZCBtb3JlIGNvbnRyb2wgb3ZlciB0aGUgaW5pdGlhbCBmaWxlIHByb21pc2UgcGFzc2VkIHRvIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXJ9LgogKgogKiBAcHJvdGVjdGVkCiAqIEB0eXBlZGVmIHtPYmplY3R9IG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVByb21pc2VXcmFwcGVyCiAqIEBwcm9wZXJ0eSB7UHJvbWlzZS48RmlsZT59IHByb21pc2UgV3JhcHBlciBwcm9taXNlIHdoaWNoIGNhbiBiZSBjaGFpbmVkIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcuCiAqIEBwcm9wZXJ0eSB7RnVuY3Rpb259IHJlamVjdGVyIFJlamVjdHMgdGhlIHByb21pc2Ugd2hlbiBjYWxsZWQuCiAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gaXNGdWxmaWxsZWQgV2hldGhlciBvcmlnaW5hbCBwcm9taXNlIGlzIGFscmVhZHkgZnVsZmlsbGVkLgogKi8="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-upload/src/filerepository.js"],"names":["Plugin","PendingActions","CKEditorError","attachLinkToDocumentation","ObservableMixin","Collection","mix","FileReader","uid","FileRepository","loaders","on","_updatePendingAction","_loadersMap","Map","_pendingAction","set","bind","to","uploaded","total","fileOrPromise","get","createUploadAdapter","console","warn","loader","FileLoader","Promise","resolve","add","file","then","catch","aggregatedUploaded","aggregatedTotal","uploadTotal","fileOrPromiseOrLoader","getLoader","_destroy","remove","forEach","value","key","delete","pendingActions","editor","plugins","length","t","getMessage","parseInt","uploadedPercent","filePromise","uploadAdapterCreator","id","_filePromiseWrapper","_createFilePromiseWrapper","_adapter","_reader","status","read","data","err","error","upload","uploadResponse","isFulfilled","promise","rejecter","abort","undefined","wrapper","reject"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module upload/filerepository\n */\n\n/* globals console */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\n\nimport PendingActions from '@ckeditor/ckeditor5-core/src/pendingactions';\nimport CKEditorError, { attachLinkToDocumentation } from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\n\nimport FileReader from './filereader.js';\n\nimport uid from '@ckeditor/ckeditor5-utils/src/uid.js';\n\n/**\n * File repository plugin. A central point for managing file upload.\n *\n * To use it, first you need an upload adapter. Upload adapter's job is to handle communication with the server\n * (sending the file and handling server's response). You can use one of the existing plugins introducing upload adapters\n * (e.g. {@link module:easy-image/cloudservicesuploadadapter~CloudServicesUploadAdapter} or\n * {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter}) or write your own one – see\n * the {@glink framework/guides/deep-dive/upload-adapter \"Custom image upload adapter\" deep dive guide}.\n *\n * Then, you can use {@link module:upload/filerepository~FileRepository#createLoader `createLoader()`} and the returned\n * {@link module:upload/filerepository~FileLoader} instance to load and upload files.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class FileRepository extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'FileRepository';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ PendingActions ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\t/**\n\t\t * Collection of loaders associated with this repository.\n\t\t *\n\t\t * @member {module:utils/collection~Collection} #loaders\n\t\t */\n\t\tthis.loaders = new Collection();\n\n\t\t// Keeps upload in a sync with pending actions.\n\t\tthis.loaders.on( 'add', () => this._updatePendingAction() );\n\t\tthis.loaders.on( 'remove', () => this._updatePendingAction() );\n\n\t\t/**\n\t\t * Loaders mappings used to retrieve loaders references.\n\t\t *\n\t\t * @private\n\t\t * @member {Map<File|Promise, FileLoader>} #_loadersMap\n\t\t */\n\t\tthis._loadersMap = new Map();\n\n\t\t/**\n\t\t * Reference to a pending action registered in a {@link module:core/pendingactions~PendingActions} plugin\n\t\t * while upload is in progress. When there is no upload then value is `null`.\n\t\t *\n\t\t * @private\n\t\t * @member {Object} #_pendingAction\n\t\t */\n\t\tthis._pendingAction = null;\n\n\t\t/**\n\t\t * A factory function which should be defined before using `FileRepository`.\n\t\t *\n\t\t * It should return a new instance of {@link module:upload/filerepository~UploadAdapter} that will be used to upload files.\n\t\t * {@link module:upload/filerepository~FileLoader} instance associated with the adapter\n\t\t * will be passed to that function.\n\t\t *\n\t\t * For more information and example see {@link module:upload/filerepository~UploadAdapter}.\n\t\t *\n\t\t * @member {Function} #createUploadAdapter\n\t\t */\n\n\t\t/**\n\t\t * Number of bytes uploaded.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploaded\n\t\t */\n\t\tthis.set( 'uploaded', 0 );\n\n\t\t/**\n\t\t * Number of total bytes to upload.\n\t\t *\n\t\t * It might be different than the file size because of headers and additional data.\n\t\t * It contains `null` if value is not available yet, so it's better to use {@link #uploadedPercent} to monitor\n\t\t * the progress.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number|null} #uploadTotal\n\t\t */\n\t\tthis.set( 'uploadTotal', null );\n\n\t\t/**\n\t\t * Upload progress in percents.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploadedPercent\n\t\t */\n\t\tthis.bind( 'uploadedPercent' ).to( this, 'uploaded', this, 'uploadTotal', ( uploaded, total ) => {\n\t\t\treturn total ? ( uploaded / total * 100 ) : 0;\n\t\t} );\n\t}\n\n\t/**\n\t * Returns the loader associated with specified file or promise.\n\t *\n\t * To get loader by id use `fileRepository.loaders.get( id )`.\n\t *\n\t * @param {File|Promise.<File>} fileOrPromise Native file or promise handle.\n\t * @returns {module:upload/filerepository~FileLoader|null}\n\t */\n\tgetLoader( fileOrPromise ) {\n\t\treturn this._loadersMap.get( fileOrPromise ) || null;\n\t}\n\n\t/**\n\t * Creates a loader instance for the given file.\n\t *\n\t * Requires {@link #createUploadAdapter} factory to be defined.\n\t *\n\t * @param {File|Promise.<File>} fileOrPromise Native File object or native Promise object which resolves to a File.\n\t * @returns {module:upload/filerepository~FileLoader|null}\n\t */\n\tcreateLoader( fileOrPromise ) {\n\t\tif ( !this.createUploadAdapter ) {\n\t\t\t/**\n\t\t\t * You need to enable an upload adapter in order to be able to upload files.\n\t\t\t *\n\t\t\t * This warning shows up when {@link module:upload/filerepository~FileRepository} is being used\n\t\t\t * without {@link #createUploadAdapter definining an upload adapter}.\n\t\t\t *\n\t\t\t * **If you see this warning when using one of the {@glink builds/index CKEditor 5 Builds}**\n\t\t\t * it means that you did not configure any of the upload adapters available by default in those builds.\n\t\t\t *\n\t\t\t * See the {@glink features/image-upload/image-upload comprehensive \"Image upload overview\"} to learn which upload\n\t\t\t * adapters are available in the builds and how to configure them.\n\t\t\t *\n\t\t\t * **If you see this warning when using a custom build** there is a chance that you enabled\n\t\t\t * a feature like {@link module:image/imageupload~ImageUpload},\n\t\t\t * or {@link module:image/imageupload/imageuploadui~ImageUploadUI} but you did not enable any upload adapter.\n\t\t\t * You can choose one of the existing upload adapters listed in the\n\t\t\t * {@glink features/image-upload/image-upload \"Image upload overview\"}.\n\t\t\t *\n\t\t\t * You can also implement your {@glink framework/guides/deep-dive/upload-adapter own image upload adapter}.\n\t\t\t *\n\t\t\t * @error filerepository-no-upload-adapter\n\t\t\t */\n\t\t\tconsole.warn( attachLinkToDocumentation(\n\t\t\t\t'filerepository-no-upload-adapter: Upload adapter is not defined.'\n\t\t\t) );\n\n\t\t\treturn null;\n\t\t}\n\n\t\tconst loader = new FileLoader( Promise.resolve( fileOrPromise ), this.createUploadAdapter );\n\n\t\tthis.loaders.add( loader );\n\t\tthis._loadersMap.set( fileOrPromise, loader );\n\n\t\t// Store also file => loader mapping so loader can be retrieved by file instance returned upon Promise resolution.\n\t\tif ( fileOrPromise instanceof Promise ) {\n\t\t\tloader.file\n\t\t\t\t.then( file => {\n\t\t\t\t\tthis._loadersMap.set( file, loader );\n\t\t\t\t} )\n\t\t\t\t// Every then() must have a catch().\n\t\t\t\t// File loader state (and rejections) are handled in read() and upload().\n\t\t\t\t// Also, see the \"does not swallow the file promise rejection\" test.\n\t\t\t\t.catch( () => {} );\n\t\t}\n\n\t\tloader.on( 'change:uploaded', () => {\n\t\t\tlet aggregatedUploaded = 0;\n\n\t\t\tfor ( const loader of this.loaders ) {\n\t\t\t\taggregatedUploaded += loader.uploaded;\n\t\t\t}\n\n\t\t\tthis.uploaded = aggregatedUploaded;\n\t\t} );\n\n\t\tloader.on( 'change:uploadTotal', () => {\n\t\t\tlet aggregatedTotal = 0;\n\n\t\t\tfor ( const loader of this.loaders ) {\n\t\t\t\tif ( loader.uploadTotal ) {\n\t\t\t\t\taggregatedTotal += loader.uploadTotal;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.uploadTotal = aggregatedTotal;\n\t\t} );\n\n\t\treturn loader;\n\t}\n\n\t/**\n\t * Destroys the given loader.\n\t *\n\t * @param {File|Promise|module:upload/filerepository~FileLoader} fileOrPromiseOrLoader File or Promise associated\n\t * with that loader or loader itself.\n\t */\n\tdestroyLoader( fileOrPromiseOrLoader ) {\n\t\tconst loader = fileOrPromiseOrLoader instanceof FileLoader ? fileOrPromiseOrLoader : this.getLoader( fileOrPromiseOrLoader );\n\n\t\tloader._destroy();\n\n\t\tthis.loaders.remove( loader );\n\n\t\tthis._loadersMap.forEach( ( value, key ) => {\n\t\t\tif ( value === loader ) {\n\t\t\t\tthis._loadersMap.delete( key );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Registers or deregisters pending action bound with upload progress.\n\t *\n\t * @private\n\t */\n\t_updatePendingAction() {\n\t\tconst pendingActions = this.editor.plugins.get( PendingActions );\n\n\t\tif ( this.loaders.length ) {\n\t\t\tif ( !this._pendingAction ) {\n\t\t\t\tconst t = this.editor.t;\n\t\t\t\tconst getMessage = value => `${ t( 'Upload in progress' ) } ${ parseInt( value ) }%.`;\n\n\t\t\t\tthis._pendingAction = pendingActions.add( getMessage( this.uploadedPercent ) );\n\t\t\t\tthis._pendingAction.bind( 'message' ).to( this, 'uploadedPercent', getMessage );\n\t\t\t}\n\t\t} else {\n\t\t\tpendingActions.remove( this._pendingAction );\n\t\t\tthis._pendingAction = null;\n\t\t}\n\t}\n}\n\nmix( FileRepository, ObservableMixin );\n\n/**\n * File loader class.\n *\n * It is used to control the process of reading the file and uploading it using the specified upload adapter.\n */\nclass FileLoader {\n\t/**\n\t * Creates a new instance of `FileLoader`.\n\t *\n\t * @param {Promise.<File>} filePromise A promise which resolves to a file instance.\n\t * @param {Function} uploadAdapterCreator The function which returns {@link module:upload/filerepository~UploadAdapter} instance.\n\t */\n\tconstructor( filePromise, uploadAdapterCreator ) {\n\t\t/**\n\t\t * Unique id of FileLoader instance.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Number}\n\t\t */\n\t\tthis.id = uid();\n\n\t\t/**\n\t\t * Additional wrapper over the initial file promise passed to this loader.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:upload/filerepository~FilePromiseWrapper}\n\t\t */\n\t\tthis._filePromiseWrapper = this._createFilePromiseWrapper( filePromise );\n\n\t\t/**\n\t\t * Adapter instance associated with this file loader.\n\t\t *\n\t\t * @private\n\t\t * @member {module:upload/filerepository~UploadAdapter}\n\t\t */\n\t\tthis._adapter = uploadAdapterCreator( this );\n\n\t\t/**\n\t\t * FileReader used by FileLoader.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:upload/filereader~FileReader}\n\t\t */\n\t\tthis._reader = new FileReader();\n\n\t\t/**\n\t\t * Current status of FileLoader. It can be one of the following:\n\t\t *\n\t\t * * 'idle',\n\t\t * * 'reading',\n\t\t * * 'uploading',\n\t\t * * 'aborted',\n\t\t * * 'error'.\n\t\t *\n\t\t * When reading status can change in a following way:\n\t\t *\n\t\t * `idle` -> `reading` -> `idle`\n\t\t * `idle` -> `reading -> `aborted`\n\t\t * `idle` -> `reading -> `error`\n\t\t *\n\t\t * When uploading status can change in a following way:\n\t\t *\n\t\t * `idle` -> `uploading` -> `idle`\n\t\t * `idle` -> `uploading` -> `aborted`\n\t\t * `idle` -> `uploading` -> `error`\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {String} #status\n\t\t */\n\t\tthis.set( 'status', 'idle' );\n\n\t\t/**\n\t\t * Number of bytes uploaded.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploaded\n\t\t */\n\t\tthis.set( 'uploaded', 0 );\n\n\t\t/**\n\t\t * Number of total bytes to upload.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number|null} #uploadTotal\n\t\t */\n\t\tthis.set( 'uploadTotal', null );\n\n\t\t/**\n\t\t * Upload progress in percents.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploadedPercent\n\t\t */\n\t\tthis.bind( 'uploadedPercent' ).to( this, 'uploaded', this, 'uploadTotal', ( uploaded, total ) => {\n\t\t\treturn total ? ( uploaded / total * 100 ) : 0;\n\t\t} );\n\n\t\t/**\n\t\t * Response of the upload.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Object|null} #uploadResponse\n\t\t */\n\t\tthis.set( 'uploadResponse', null );\n\t}\n\n\t/**\n\t * A `Promise` which resolves to a `File` instance associated with this file loader.\n\t *\n\t * @type {Promise.<File|null>}\n\t */\n\tget file() {\n\t\tif ( !this._filePromiseWrapper ) {\n\t\t\t// Loader was destroyed, return promise which resolves to null.\n\t\t\treturn Promise.resolve( null );\n\t\t} else {\n\t\t\t// The `this._filePromiseWrapper.promise` is chained and not simply returned to handle a case when:\n\t\t\t//\n\t\t\t//\t\t* The `loader.file.then( ... )` is called by external code (returned promise is pending).\n\t\t\t//\t\t* Then `loader._destroy()` is called (call is synchronous) which destroys the `loader`.\n\t\t\t//\t\t* Promise returned by the first `loader.file.then( ... )` call is resolved.\n\t\t\t//\n\t\t\t// Returning `this._filePromiseWrapper.promise` will still resolve to a `File` instance so there\n\t\t\t// is an additional check needed in the chain to see if `loader` was destroyed in the meantime.\n\t\t\treturn this._filePromiseWrapper.promise.then( file => this._filePromiseWrapper ? file : null );\n\t\t}\n\t}\n\n\t/**\n\t * Returns the file data. To read its data, you need for first load the file\n\t * by using the {@link module:upload/filerepository~FileLoader#read `read()`} method.\n\t *\n\t * @type {File|undefined}\n\t */\n\tget data() {\n\t\treturn this._reader.data;\n\t}\n\n\t/**\n\t * Reads file using {@link module:upload/filereader~FileReader}.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-read-wrong-status` when status\n\t * is different than `idle`.\n\t *\n\t * Example usage:\n\t *\n\t *\tfileLoader.read()\n\t *\t\t.then( data => { ... } )\n\t *\t\t.catch( err => {\n\t *\t\t\tif ( err === 'aborted' ) {\n\t *\t\t\t\tconsole.log( 'Reading aborted.' );\n\t *\t\t\t} else {\n\t *\t\t\t\tconsole.log( 'Reading error.', err );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * @returns {Promise.<String>} Returns promise that will be resolved with read data. Promise will be rejected if error\n\t * occurs or if read process is aborted.\n\t */\n\tread() {\n\t\tif ( this.status != 'idle' ) {\n\t\t\tthrow new CKEditorError( 'filerepository-read-wrong-status: You cannot call read if the status is different than idle.', this );\n\t\t}\n\n\t\tthis.status = 'reading';\n\n\t\treturn this.file\n\t\t\t.then( file => this._reader.read( file ) )\n\t\t\t.then( data => {\n\t\t\t\tthis.status = 'idle';\n\n\t\t\t\treturn data;\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\tif ( err === 'aborted' ) {\n\t\t\t\t\tthis.status = 'aborted';\n\t\t\t\t\tthrow 'aborted';\n\t\t\t\t}\n\n\t\t\t\tthis.status = 'error';\n\t\t\t\tthrow this._reader.error ? this._reader.error : err;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Reads file using the provided {@link module:upload/filerepository~UploadAdapter}.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-upload-wrong-status` when status\n\t * is different than `idle`.\n\t * Example usage:\n\t *\n\t *\tfileLoader.upload()\n\t *\t\t.then( data => { ... } )\n\t *\t\t.catch( e => {\n\t *\t\t\tif ( e === 'aborted' ) {\n\t *\t\t\t\tconsole.log( 'Uploading aborted.' );\n\t *\t\t\t} else {\n\t *\t\t\t\tconsole.log( 'Uploading error.', e );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * @returns {Promise.<Object>} Returns promise that will be resolved with response data. Promise will be rejected if error\n\t * occurs or if read process is aborted.\n\t */\n\tupload() {\n\t\tif ( this.status != 'idle' ) {\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'filerepository-upload-wrong-status: You cannot call upload if the status is different than idle.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tthis.status = 'uploading';\n\n\t\treturn this.file\n\t\t\t.then( () => this._adapter.upload() )\n\t\t\t.then( data => {\n\t\t\t\tthis.uploadResponse = data;\n\t\t\t\tthis.status = 'idle';\n\n\t\t\t\treturn data;\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\tif ( this.status === 'aborted' ) {\n\t\t\t\t\tthrow 'aborted';\n\t\t\t\t}\n\n\t\t\t\tthis.status = 'error';\n\t\t\t\tthrow err;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Aborts loading process.\n\t */\n\tabort() {\n\t\tconst status = this.status;\n\t\tthis.status = 'aborted';\n\n\t\tif ( !this._filePromiseWrapper.isFulfilled ) {\n\t\t\t// Edge case: file loader is aborted before read() is called\n\t\t\t// so it might happen that no one handled the rejection of this promise.\n\t\t\t// See https://github.com/ckeditor/ckeditor5-upload/pull/100\n\t\t\tthis._filePromiseWrapper.promise.catch( () => {} );\n\n\t\t\tthis._filePromiseWrapper.rejecter( 'aborted' );\n\t\t} else if ( status == 'reading' ) {\n\t\t\tthis._reader.abort();\n\t\t} else if ( status == 'uploading' && this._adapter.abort ) {\n\t\t\tthis._adapter.abort();\n\t\t}\n\n\t\tthis._destroy();\n\t}\n\n\t/**\n\t * Performs cleanup.\n\t *\n\t * @private\n\t */\n\t_destroy() {\n\t\tthis._filePromiseWrapper = undefined;\n\t\tthis._reader = undefined;\n\t\tthis._adapter = undefined;\n\t\tthis.uploadResponse = undefined;\n\t}\n\n\t/**\n\t * Wraps a given file promise into another promise giving additional\n\t * control (resolving, rejecting, checking if fulfilled) over it.\n\t *\n\t * @private\n\t * @param filePromise The initial file promise to be wrapped.\n\t * @returns {module:upload/filerepository~FilePromiseWrapper}\n\t */\n\t_createFilePromiseWrapper( filePromise ) {\n\t\tconst wrapper = {};\n\n\t\twrapper.promise = new Promise( ( resolve, reject ) => {\n\t\t\twrapper.rejecter = reject;\n\t\t\twrapper.isFulfilled = false;\n\n\t\t\tfilePromise\n\t\t\t\t.then( file => {\n\t\t\t\t\twrapper.isFulfilled = true;\n\t\t\t\t\tresolve( file );\n\t\t\t\t} )\n\t\t\t\t.catch( err => {\n\t\t\t\t\twrapper.isFulfilled = true;\n\t\t\t\t\treject( err );\n\t\t\t\t} );\n\t\t} );\n\n\t\treturn wrapper;\n\t}\n}\n\nmix( FileLoader, ObservableMixin );\n\n/**\n * Upload adapter interface used by the {@link module:upload/filerepository~FileRepository file repository}\n * to handle file upload. An upload adapter is a bridge between the editor and server that handles file uploads.\n * It should contain a logic necessary to initiate an upload process and monitor its progress.\n *\n * Learn how to develop your own upload adapter for CKEditor 5 in the\n * {@glink framework/guides/deep-dive/upload-adapter \"Custom upload adapter\" guide}.\n *\n * @interface UploadAdapter\n */\n\n/**\n * Executes the upload process.\n * This method should return a promise that will resolve when data will be uploaded to server. Promise should be\n * resolved with an object containing information about uploaded file:\n *\n *\t\t{\n *\t\t\tdefault: 'http://server/default-size.image.png'\n *\t\t}\n *\n * Additionally, other image sizes can be provided:\n *\n *\t\t{\n *\t\t\tdefault: 'http://server/default-size.image.png',\n *\t\t\t'160': 'http://server/size-160.image.png',\n *\t\t\t'500': 'http://server/size-500.image.png',\n *\t\t\t'1000': 'http://server/size-1000.image.png',\n *\t\t\t'1052': 'http://server/default-size.image.png'\n *\t\t}\n *\n * NOTE: When returning multiple images, the widest returned one should equal the default one. It is essential to\n * correctly set `width` attribute of the image. See this discussion:\n * https://github.com/ckeditor/ckeditor5-easy-image/issues/4 for more information.\n *\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\n *\n * @method module:upload/filerepository~UploadAdapter#upload\n * @returns {Promise.<Object>} Promise that should be resolved when data is uploaded.\n */\n\n/**\n * Aborts the upload process.\n * After aborting it should reject promise returned from {@link #upload upload()}.\n *\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\n *\n * @method module:upload/filerepository~UploadAdapter#abort\n */\n\n/**\n * Object returned by {@link module:upload/filerepository~FileLoader#_createFilePromiseWrapper} method\n * to add more control over the initial file promise passed to {@link module:upload/filerepository~FileLoader}.\n *\n * @protected\n * @typedef {Object} module:upload/filerepository~FilePromiseWrapper\n * @property {Promise.<File>} promise Wrapper promise which can be chained for further processing.\n * @property {Function} rejecter Rejects the promise when called.\n * @property {Boolean} isFulfilled Whether original promise is already fulfilled.\n */\n"]}]}