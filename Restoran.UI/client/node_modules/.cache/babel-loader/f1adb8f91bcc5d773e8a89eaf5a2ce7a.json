{"remainingRequest":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\view\\view.js","dependencies":[{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-engine\\src\\view\\view.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\@ckeditor\\ckeditor5-dev-webpack-plugin\\lib\\translatesourceloader.js","mtime":499162500000},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1581760768702},{"path":"C:\\Users\\pc\\Desktop\\Restoran\\Restoran\\Restoran.UI\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":1581760768279}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLndlYWstbWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiQzpcXFVzZXJzXFxwY1xcRGVza3RvcFxcUmVzdG9yYW5cXFJlc3RvcmFuXFxSZXN0b3Jhbi5VSVxcY2xpZW50XFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOlxcVXNlcnNcXHBjXFxEZXNrdG9wXFxSZXN0b3JhblxcUmVzdG9yYW5cXFJlc3RvcmFuLlVJXFxjbGllbnRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMCwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSBlbmdpbmUvdmlldy92aWV3CiAqLwppbXBvcnQgRG9jdW1lbnQgZnJvbSAnLi9kb2N1bWVudCc7CmltcG9ydCBEb3duY2FzdFdyaXRlciBmcm9tICcuL2Rvd25jYXN0d3JpdGVyJzsKaW1wb3J0IFJlbmRlcmVyIGZyb20gJy4vcmVuZGVyZXInOwppbXBvcnQgRG9tQ29udmVydGVyIGZyb20gJy4vZG9tY29udmVydGVyJzsKaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4vcG9zaXRpb24nOwppbXBvcnQgUmFuZ2UgZnJvbSAnLi9yYW5nZSc7CmltcG9ydCBTZWxlY3Rpb24gZnJvbSAnLi9zZWxlY3Rpb24nOwppbXBvcnQgTXV0YXRpb25PYnNlcnZlciBmcm9tICcuL29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXInOwppbXBvcnQgS2V5T2JzZXJ2ZXIgZnJvbSAnLi9vYnNlcnZlci9rZXlvYnNlcnZlcic7CmltcG9ydCBGYWtlU2VsZWN0aW9uT2JzZXJ2ZXIgZnJvbSAnLi9vYnNlcnZlci9mYWtlc2VsZWN0aW9ub2JzZXJ2ZXInOwppbXBvcnQgU2VsZWN0aW9uT2JzZXJ2ZXIgZnJvbSAnLi9vYnNlcnZlci9zZWxlY3Rpb25vYnNlcnZlcic7CmltcG9ydCBGb2N1c09ic2VydmVyIGZyb20gJy4vb2JzZXJ2ZXIvZm9jdXNvYnNlcnZlcic7CmltcG9ydCBDb21wb3NpdGlvbk9ic2VydmVyIGZyb20gJy4vb2JzZXJ2ZXIvY29tcG9zaXRpb25vYnNlcnZlcic7CmltcG9ydCBJbnB1dE9ic2VydmVyIGZyb20gJy4vb2JzZXJ2ZXIvaW5wdXRvYnNlcnZlcic7CmltcG9ydCBPYnNlcnZhYmxlTWl4aW4gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvb2JzZXJ2YWJsZW1peGluJzsKaW1wb3J0IG1peCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9taXgnOwppbXBvcnQgeyBzY3JvbGxWaWV3cG9ydFRvU2hvd1RhcmdldCB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2RvbS9zY3JvbGwnOwppbXBvcnQgeyBpbmplY3RVaUVsZW1lbnRIYW5kbGluZyB9IGZyb20gJy4vdWllbGVtZW50JzsKaW1wb3J0IHsgaW5qZWN0UXVpcmtzSGFuZGxpbmcgfSBmcm9tICcuL2ZpbGxlcic7CmltcG9ydCBDS0VkaXRvckVycm9yIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgZW52IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2Vudic7Ci8qKgogKiBFZGl0b3IncyB2aWV3IGNvbnRyb2xsZXIgY2xhc3MuIEl0cyBtYWluIHJlc3BvbnNpYmlsaXR5IGlzIERPTSAtIFZpZXcgbWFuYWdlbWVudCBmb3IgZWRpdGluZyBwdXJwb3NlcywgdG8gcHJvdmlkZQogKiBhYnN0cmFjdGlvbiBvdmVyIHRoZSBET00gc3RydWN0dXJlIGFuZCBldmVudHMgYW5kIGhpZGUgYWxsIGJyb3dzZXJzIHF1aXJrcy4KICoKICogVmlldyBjb250cm9sbGVyIHJlbmRlcnMgdmlldyBkb2N1bWVudCB0byBET00gd2hlbmV2ZXIgdmlldyBzdHJ1Y3R1cmUgY2hhbmdlcy4gVG8gZGV0ZXJtaW5lIHdoZW4gdmlldyBjYW4gYmUgcmVuZGVyZWQsCiAqIGFsbCBjaGFuZ2VzIG5lZWQgdG8gYmUgZG9uZSB1c2luZyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY2hhbmdlfSBtZXRob2QsIHVzaW5nCiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9OgogKgogKgkJdmlldy5jaGFuZ2UoIHdyaXRlciA9PiB7CiAqCQkJd3JpdGVyLmluc2VydCggcG9zaXRpb24sIHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApICk7CiAqCQl9ICk7CiAqCiAqIFZpZXcgY29udHJvbGxlciBhbHNvIHJlZ2lzdGVyIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIgb2JzZXJ2ZXJzfSB3aGljaCBvYnNlcnZlcyBjaGFuZ2VzCiAqIG9uIERPTSBhbmQgZmlyZSBldmVudHMgb24gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQgRG9jdW1lbnR9LgogKiBOb3RlIHRoYXQgdGhlIGZvbGxvd2luZyBvYnNlcnZlcnMgYXJlIGFkZGVkIGJ5IHRoZSBjbGFzcyBjb25zdHJ1Y3RvciBhbmQgYXJlIGFsd2F5cyBhdmFpbGFibGU6CiAqCiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0aW9uT2JzZXJ2ZXJ9LAogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvc2VsZWN0aW9ub2JzZXJ2ZXJ+U2VsZWN0aW9uT2JzZXJ2ZXJ9LAogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvZm9jdXNvYnNlcnZlcn5Gb2N1c09ic2VydmVyfSwKICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2tleW9ic2VydmVyfktleU9ic2VydmVyfSwKICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2Zha2VzZWxlY3Rpb25vYnNlcnZlcn5GYWtlU2VsZWN0aW9uT2JzZXJ2ZXJ9LgogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvY29tcG9zaXRpb25vYnNlcnZlcn5Db21wb3NpdGlvbk9ic2VydmVyfS4KICoKICogVGhpcyBjbGFzcyBhbHNvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2F0dGFjaERvbVJvb3QgYmluZHMgdGhlIERPTSBhbmQgdGhlIHZpZXcgZWxlbWVudHN9LgogKgogKiBJZiB5b3UgZG8gbm90IG5lZWQgZnVsbCBhIERPTSAtIHZpZXcgbWFuYWdlbWVudCwgYW5kIG9ubHkgd2FudCB0byB0cmFuc2Zvcm0gYSB0cmVlIG9mIHZpZXcgZWxlbWVudHMgdG8gYSB0cmVlIG9mIERPTQogKiBlbGVtZW50cyB5b3UgZG8gbm90IG5lZWQgdGhpcyBjb250cm9sbGVyLiBZb3UgY2FuIHVzZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyIERvbUNvbnZlcnRlcn0gaW5zdGVhZC4KICoKICogQG1peGVzIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGluCiAqLwoKdmFyIFZpZXcgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zdHlsZXNtYXB+U3R5bGVzUHJvY2Vzc29yfSBzdHlsZXNQcm9jZXNzb3IgVGhlIHN0eWxlcyBwcm9jZXNzb3IgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gVmlldyhzdHlsZXNQcm9jZXNzb3IpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZpZXcpOwoKICAgIC8qKgogICAgICogSW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnR9IGFzc29jaWF0ZWQgd2l0aCB0aGlzIHZpZXcgY29udHJvbGxlci4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnR9CiAgICAgKi8KICAgIHRoaXMuZG9jdW1lbnQgPSBuZXcgRG9jdW1lbnQoc3R5bGVzUHJvY2Vzc29yKTsKICAgIC8qKgogICAgICogSW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciBkb21Db252ZXJ0ZXJ9IHVzZWQgYnkKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I19yZW5kZXJlciByZW5kZXJlcn0KICAgICAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyIG9ic2VydmVyc30uCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAdHlwZSB7bW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXJ9CiAgICAgKi8KCiAgICB0aGlzLmRvbUNvbnZlcnRlciA9IG5ldyBEb21Db252ZXJ0ZXIodGhpcy5kb2N1bWVudCk7CiAgICAvKioKICAgICAqIFJvb3RzIG9mIHRoZSBET00gdHJlZS4gTWFwIG9uIHRoZSBgSFRNTEVsZW1lbnRgcyB3aXRoIHJvb3RzIG5hbWVzIGFzIGtleXMuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAdHlwZSB7TWFwLjxTdHJpbmcsIEhUTUxFbGVtZW50Pn0KICAgICAqLwoKICAgIHRoaXMuZG9tUm9vdHMgPSBuZXcgTWFwKCk7CiAgICAvKioKICAgICAqIFVzZWQgdG8gcHJldmVudCBjYWxsaW5nIHtAbGluayAjZm9yY2VSZW5kZXJ9IGFuZCB7QGxpbmsgI2NoYW5nZX0gZHVyaW5nIHJlbmRlcmluZyB2aWV3IHRvIHRoZSBET00uCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSAjaXNSZW5kZXJpbmdJblByb2dyZXNzCiAgICAgKi8KCiAgICB0aGlzLnNldCgnaXNSZW5kZXJpbmdJblByb2dyZXNzJywgZmFsc2UpOwogICAgLyoqCiAgICAgKiBJbnN0YW5jZSBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlciByZW5kZXJlcn0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHR5cGUge21vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlcn0KICAgICAqLwoKICAgIHRoaXMuX3JlbmRlcmVyID0gbmV3IFJlbmRlcmVyKHRoaXMuZG9tQ29udmVydGVyLCB0aGlzLmRvY3VtZW50LnNlbGVjdGlvbik7CgogICAgdGhpcy5fcmVuZGVyZXIuYmluZCgnaXNGb2N1c2VkJykudG8odGhpcy5kb2N1bWVudCk7CiAgICAvKioKICAgICAqIEEgRE9NIHJvb3QgYXR0cmlidXRlcyBjYWNoZS4gSXQgc2F2ZXMgdGhlIGluaXRpYWwgdmFsdWVzIG9mIERPTSByb290IGF0dHJpYnV0ZXMgYmVmb3JlIHRoZSBET00gZWxlbWVudAogICAgICogaXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjYXR0YWNoRG9tUm9vdCBhdHRhY2hlZH0gdG8gdGhlIHZpZXcgc28gbGF0ZXIgb24sIHdoZW4KICAgICAqIHRoZSB2aWV3IGlzIGRlc3Ryb3llZCAoe0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZGV0YWNoRG9tUm9vdH0pLCB0aGV5IGNhbiBiZSBlYXNpbHkgcmVzdG9yZWQuCiAgICAgKiBUaGlzIHdheSwgdGhlIERPTSBlbGVtZW50IGNhbiBnbyBiYWNrIHRvIHRoZSAoY2xlYW4pIHN0YXRlIGFzIGlmIHRoZSBlZGl0aW5nIHZpZXcgbmV2ZXIgdXNlZCBpdC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7V2Vha01hcC48SFRNTEVsZW1lbnQsT2JqZWN0Pn0KICAgICAqLwoKCiAgICB0aGlzLl9pbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMgPSBuZXcgV2Vha01hcCgpOwogICAgLyoqCiAgICAgKiBNYXAgb2YgcmVnaXN0ZXJlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyIG9ic2VydmVyc30uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEB0eXBlIHtNYXAuPEZ1bmN0aW9uLCBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXI+fQogICAgICovCgogICAgdGhpcy5fb2JzZXJ2ZXJzID0gbmV3IE1hcCgpOwogICAgLyoqCiAgICAgKiBJcyBzZXQgdG8gYHRydWVgIHdoZW4ge0BsaW5rICNjaGFuZ2UgdmlldyBjaGFuZ2VzfSBhcmUgY3VycmVudGx5IGluIHByb2dyZXNzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAqLwoKICAgIHRoaXMuX29uZ29pbmdDaGFuZ2UgPSBmYWxzZTsKICAgIC8qKgogICAgICogVXNlZCB0byBwcmV2ZW50IGNhbGxpbmcge0BsaW5rICNmb3JjZVJlbmRlcn0gYW5kIHtAbGluayAjY2hhbmdlfSBkdXJpbmcgcmVuZGVyaW5nIHZpZXcgdG8gdGhlIERPTS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9wb3N0Rml4ZXJzSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmbGFnIHRvIHRlbXBvcmFyeSBkaXNhYmxlIHJlbmRlcmluZy4gU2VlIHRoZSB1c2FnZSBpbiB0aGUge0BsaW5rICNfZGlzYWJsZVJlbmRlcmluZ30uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCgogICAgdGhpcy5fcmVuZGVyaW5nRGlzYWJsZWQgPSBmYWxzZTsKICAgIC8qKgogICAgICogSW50ZXJuYWwgZmxhZyB0aGF0IGRpc2FibGVzIHJlbmRlcmluZyB3aGVuIHRoZXJlIGFyZSBubyBjaGFuZ2VzIHNpbmNlIHRoZSBsYXN0IHJlbmRlcmluZy4KICAgICAqIEl0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCBjaGFuZ2VkIHNlbGVjdGlvbiBhbmQgY2hhbmdlZCBlbGVtZW50cyBmcm9tIGF0dGFjaGVkIGRvY3VtZW50IHJvb3RzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAqLwoKICAgIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcgPSBmYWxzZTsKICAgIC8qKgogICAgICogRG93bmNhc3RXcml0ZXIgaW5zdGFuY2UgdXNlZCBpbiB7QGxpbmsgI2NoYW5nZSBjaGFuZ2UgbWV0aG9kfSBjYWxsYmFja3MuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9CiAgICAgKi8KCiAgICB0aGlzLl93cml0ZXIgPSBuZXcgRG93bmNhc3RXcml0ZXIodGhpcy5kb2N1bWVudCk7IC8vIEFkZCBkZWZhdWx0IG9ic2VydmVycy4KCiAgICB0aGlzLmFkZE9ic2VydmVyKE11dGF0aW9uT2JzZXJ2ZXIpOwogICAgdGhpcy5hZGRPYnNlcnZlcihTZWxlY3Rpb25PYnNlcnZlcik7CiAgICB0aGlzLmFkZE9ic2VydmVyKEZvY3VzT2JzZXJ2ZXIpOwogICAgdGhpcy5hZGRPYnNlcnZlcihLZXlPYnNlcnZlcik7CiAgICB0aGlzLmFkZE9ic2VydmVyKEZha2VTZWxlY3Rpb25PYnNlcnZlcik7CiAgICB0aGlzLmFkZE9ic2VydmVyKENvbXBvc2l0aW9uT2JzZXJ2ZXIpOwoKICAgIGlmIChlbnYuaXNBbmRyb2lkKSB7CiAgICAgIHRoaXMuYWRkT2JzZXJ2ZXIoSW5wdXRPYnNlcnZlcik7CiAgICB9IC8vIEluamVjdCBxdWlya3MgaGFuZGxlcnMuCgoKICAgIGluamVjdFF1aXJrc0hhbmRsaW5nKHRoaXMpOwogICAgaW5qZWN0VWlFbGVtZW50SGFuZGxpbmcodGhpcyk7IC8vIFVzZSAnbm9ybWFsJyBwcmlvcml0eSBzbyB0aGF0IHJlbmRlcmluZyBpcyBwZXJmb3JtZWQgYXMgZmlyc3Qgd2hlbiB1c2luZyB0aGF0IHByaW9yaXR5LgoKICAgIHRoaXMub24oJ3JlbmRlcicsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuX3JlbmRlcigpOyAvLyBJbmZvcm1zIHRoYXQgbGF5b3V0IGhhcyBjaGFuZ2VkIGFmdGVyIHJlbmRlci4KCgogICAgICBfdGhpcy5kb2N1bWVudC5maXJlKCdsYXlvdXRDaGFuZ2VkJyk7IC8vIFJlc2V0IHRoZSBgX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmdgIGZsYWcgYWZ0ZXIgcmVuZGVyaW5nLgoKCiAgICAgIF90aGlzLl9oYXNDaGFuZ2VkU2luY2VUaGVMYXN0UmVuZGVyaW5nID0gZmFsc2U7CiAgICB9KTsgLy8gTGlzdGVuIHRvIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gY2hhbmdlcyBkaXJlY3RseS4KCiAgICB0aGlzLmxpc3RlblRvKHRoaXMuZG9jdW1lbnQuc2VsZWN0aW9uLCAnY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5faGFzQ2hhbmdlZFNpbmNlVGhlTGFzdFJlbmRlcmluZyA9IHRydWU7CiAgICB9KTsKICB9CiAgLyoqCiAgICogQXR0YWNoZXMgYSBET00gcm9vdCBlbGVtZW50IHRvIHRoZSB2aWV3IGVsZW1lbnQgYW5kIGVuYWJsZSBhbGwgb2JzZXJ2ZXJzIG9uIHRoYXQgZWxlbWVudC4KICAgKiBBbHNvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmVuZGVyZXJ+UmVuZGVyZXIjbWFya1RvU3luYyBtYXJrIGVsZW1lbnR9IHRvIGJlIHN5bmNocm9uaXplZAogICAqIHdpdGggdGhlIHZpZXcgd2hhdCBtZWFucyB0aGF0IGFsbCBjaGlsZCBub2RlcyB3aWxsIGJlIHJlbW92ZWQgYW5kIHJlcGxhY2VkIHdpdGggY29udGVudCBvZiB0aGUgdmlldyByb290LgogICAqCiAgICogVGhpcyBtZXRob2QgYWxzbyB3aWxsIGNoYW5nZSB2aWV3IGVsZW1lbnQgbmFtZSBhcyB0aGUgc2FtZSBhcyB0YWcgbmFtZSBvZiBnaXZlbiBkb20gcm9vdC4KICAgKiBOYW1lIGlzIGFsd2F5cyB0cmFuc2Zvcm1lZCB0byBsb3dlciBjYXNlLgogICAqCiAgICogKipOb3RlOioqIFVzZSB7QGxpbmsgI2RldGFjaERvbVJvb3QgYGRldGFjaERvbVJvb3QoKWB9IHRvIHJldmVydCB0aGlzIGFjdGlvbi4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZG9tUm9vdCBET00gcm9vdCBlbGVtZW50LgogICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nbWFpbiddIE5hbWUgb2YgdGhlIHJvb3QuCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoVmlldywgW3sKICAgIGtleTogImF0dGFjaERvbVJvb3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGF0dGFjaERvbVJvb3QoZG9tUm9vdCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBuYW1lID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnbWFpbic7CiAgICAgIHZhciB2aWV3Um9vdCA9IHRoaXMuZG9jdW1lbnQuZ2V0Um9vdChuYW1lKTsgLy8gU2V0IHZpZXcgcm9vdCBuYW1lIHRoZSBzYW1lIGFzIERPTSByb290IHRhZyBuYW1lLgoKICAgICAgdmlld1Jvb3QuX25hbWUgPSBkb21Sb290LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgdmFyIGluaXRpYWxEb21Sb290QXR0cmlidXRlcyA9IHt9OyAvLyAxLiBDb3B5IGFuZCBjYWNoZSB0aGUgYXR0cmlidXRlcyB0byByZW1lbWJlciB0aGUgc3RhdGUgb2YgdGhlIGVsZW1lbnQgYmVmb3JlIGF0dGFjaGluZy4KICAgICAgLy8gICAgVGhlIGNhY2hlZCBhdHRyaWJ1dGVzIHdpbGwgYmUgcmVzdG9yZWQgaW4gZGV0YWNoRG9tUm9vdCgpIHNvIHRoZSBlbGVtZW50IGdvZXMgdG8gdGhlCiAgICAgIC8vICAgIGNsZWFuIHN0YXRlIGFzIGlmIHRoZSBlZGl0aW5nIHZpZXcgbmV2ZXIgdXNlZCBpdC4KICAgICAgLy8gMi4gQXBwbHkgdGhlIGF0dHJpYnV0ZXMgdXNpbmcgdGhlIHZpZXcgd3JpdGVyLCBzbyB0aGV5IGFsbCBnbyB1bmRlciB0aGUgY29udHJvbCBvZiB0aGUgZW5naW5lLgogICAgICAvLyAgICBUaGUgZWRpdGluZyB2aWV3IHRha2VzIG92ZXIgdGhlIGF0dHJpYnV0ZSBtYW5hZ2VtZW50IGNvbXBsZXRlbHkgYmVjYXVzZSB2YXJpb3VzCiAgICAgIC8vICAgIGZlYXR1cmVzIChlLmcuIGFkZFBsYWNlaG9sZGVyKCkpIHJlcXVpcmUgZHluYW1pYyBjaGFuZ2VzIG9mIHRob3NlIGF0dHJpYnV0ZXMgYW5kIHRoZXkKICAgICAgLy8gICAgY2Fubm90IGJlIG1hbmFnZWQgYnkgdGhlIGVuZ2luZSBhbmQgdGhlIFVJIGxpYnJhcnkgYXQgdGhlIHNhbWUgdGltZS4KCiAgICAgIGZvciAodmFyIF9pID0gMCwgX0FycmF5JGZyb20gPSBBcnJheS5mcm9tKGRvbVJvb3QuYXR0cmlidXRlcyk7IF9pIDwgX0FycmF5JGZyb20ubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgdmFyIF9BcnJheSRmcm9tJF9pID0gX0FycmF5JGZyb21bX2ldLAogICAgICAgICAgICBfbmFtZSA9IF9BcnJheSRmcm9tJF9pLm5hbWUsCiAgICAgICAgICAgIHZhbHVlID0gX0FycmF5JGZyb20kX2kudmFsdWU7CiAgICAgICAgaW5pdGlhbERvbVJvb3RBdHRyaWJ1dGVzW19uYW1lXSA9IHZhbHVlOyAvLyBEbyBub3QgdXNlIHdyaXRlci5zZXRBdHRyaWJ1dGUoKSBmb3IgdGhlIGNsYXNzIGF0dHJpYnV0ZS4gVGhlIEVkaXRhYmxlVUlWaWV3IGNsYXNzCiAgICAgICAgLy8gYW5kIGl0cyBkZXNjZW5kYW50cyBjb3VsZCBoYXZlIGFscmVhZHkgc2V0IHNvbWUgdXNpbmcgdGhlIHdyaXRlci5hZGRDbGFzcygpIG9uIHRoZSB2aWV3CiAgICAgICAgLy8gZG9jdW1lbnQgcm9vdC4gVGhleSBoYXZlbid0IGJlZW4gcmVuZGVyZWQgeWV0IHNvIHRoZXkgYXJlIG5vdCBwcmVzZW50IGluIHRoZSBET00gcm9vdC4KICAgICAgICAvLyBVc2luZyB3cml0ZXIuc2V0QXR0cmlidXRlKCAnY2xhc3MnLCAuLi4gKSB3b3VsZCBvdmVycmlkZSB0aGVtIGNvbXBsZXRlbHkuCgogICAgICAgIGlmIChfbmFtZSA9PT0gJ2NsYXNzJykgewogICAgICAgICAgdGhpcy5fd3JpdGVyLmFkZENsYXNzKHZhbHVlLnNwbGl0KCcgJyksIHZpZXdSb290KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5fd3JpdGVyLnNldEF0dHJpYnV0ZShfbmFtZSwgdmFsdWUsIHZpZXdSb290KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX2luaXRpYWxEb21Sb290QXR0cmlidXRlcy5zZXQoZG9tUm9vdCwgaW5pdGlhbERvbVJvb3RBdHRyaWJ1dGVzKTsKCiAgICAgIHZhciB1cGRhdGVDb250ZW50ZWRpdGFibGVBdHRyaWJ1dGUgPSBmdW5jdGlvbiB1cGRhdGVDb250ZW50ZWRpdGFibGVBdHRyaWJ1dGUoKSB7CiAgICAgICAgX3RoaXMyLl93cml0ZXIuc2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCAhdmlld1Jvb3QuaXNSZWFkT25seSwgdmlld1Jvb3QpOwoKICAgICAgICBpZiAodmlld1Jvb3QuaXNSZWFkT25seSkgewogICAgICAgICAgX3RoaXMyLl93cml0ZXIuYWRkQ2xhc3MoJ2NrLXJlYWQtb25seScsIHZpZXdSb290KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLl93cml0ZXIucmVtb3ZlQ2xhc3MoJ2NrLXJlYWQtb25seScsIHZpZXdSb290KTsKICAgICAgICB9CiAgICAgIH07IC8vIFNldCBpbml0aWFsIHZhbHVlLgoKCiAgICAgIHVwZGF0ZUNvbnRlbnRlZGl0YWJsZUF0dHJpYnV0ZSgpOwogICAgICB0aGlzLmRvbVJvb3RzLnNldChuYW1lLCBkb21Sb290KTsKICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuYmluZEVsZW1lbnRzKGRvbVJvb3QsIHZpZXdSb290KTsKCiAgICAgIHRoaXMuX3JlbmRlcmVyLm1hcmtUb1N5bmMoJ2NoaWxkcmVuJywgdmlld1Jvb3QpOwoKICAgICAgdGhpcy5fcmVuZGVyZXIubWFya1RvU3luYygnYXR0cmlidXRlcycsIHZpZXdSb290KTsKCiAgICAgIHRoaXMuX3JlbmRlcmVyLmRvbURvY3VtZW50cy5hZGQoZG9tUm9vdC5vd25lckRvY3VtZW50KTsKCiAgICAgIHZpZXdSb290Lm9uKCdjaGFuZ2U6Y2hpbGRyZW4nLCBmdW5jdGlvbiAoZXZ0LCBub2RlKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5fcmVuZGVyZXIubWFya1RvU3luYygnY2hpbGRyZW4nLCBub2RlKTsKICAgICAgfSk7CiAgICAgIHZpZXdSb290Lm9uKCdjaGFuZ2U6YXR0cmlidXRlcycsIGZ1bmN0aW9uIChldnQsIG5vZGUpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLl9yZW5kZXJlci5tYXJrVG9TeW5jKCdhdHRyaWJ1dGVzJywgbm9kZSk7CiAgICAgIH0pOwogICAgICB2aWV3Um9vdC5vbignY2hhbmdlOnRleHQnLCBmdW5jdGlvbiAoZXZ0LCBub2RlKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5fcmVuZGVyZXIubWFya1RvU3luYygndGV4dCcsIG5vZGUpOwogICAgICB9KTsKICAgICAgdmlld1Jvb3Qub24oJ2NoYW5nZTppc1JlYWRPbmx5JywgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIuY2hhbmdlKHVwZGF0ZUNvbnRlbnRlZGl0YWJsZUF0dHJpYnV0ZSk7CiAgICAgIH0pOwogICAgICB2aWV3Um9vdC5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5faGFzQ2hhbmdlZFNpbmNlVGhlTGFzdFJlbmRlcmluZyA9IHRydWU7CiAgICAgIH0pOwogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IHRoaXMuX29ic2VydmVycy52YWx1ZXMoKVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgIHZhciBvYnNlcnZlciA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb21Sb290LCBuYW1lKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRGV0YWNoZXMgYSBET00gcm9vdCBlbGVtZW50IGZyb20gdGhlIHZpZXcgZWxlbWVudCBhbmQgcmVzdG9yZXMgaXRzIGF0dHJpYnV0ZXMgdG8gdGhlIHN0YXRlIGJlZm9yZQogICAgICoge0BsaW5rICNhdHRhY2hEb21Sb290IGBhdHRhY2hEb21Sb290KClgfS4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSByb290IHRvIGRldGFjaC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXRhY2hEb21Sb290IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXRhY2hEb21Sb290KG5hbWUpIHsKICAgICAgdmFyIGRvbVJvb3QgPSB0aGlzLmRvbVJvb3RzLmdldChuYW1lKTsgLy8gUmVtb3ZlIGFsbCByb290IGF0dHJpYnV0ZXMgc28gdGhlIERPTSBlbGVtZW50IGlzICJiYXJlIi4KCiAgICAgIEFycmF5LmZyb20oZG9tUm9vdC5hdHRyaWJ1dGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIG5hbWUgPSBfcmVmLm5hbWU7CiAgICAgICAgcmV0dXJuIGRvbVJvb3QucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgICB9KTsKCiAgICAgIHZhciBpbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMgPSB0aGlzLl9pbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMuZ2V0KGRvbVJvb3QpOyAvLyBSZXZlcnQgYWxsIHZpZXcgcm9vdCBhdHRyaWJ1dGVzIGJhY2sgdG8gdGhlIHN0YXRlIGJlZm9yZSBhdHRhY2hEb21Sb290IHdhcyBjYWxsZWQuCgoKICAgICAgZm9yICh2YXIgYXR0cmlidXRlIGluIGluaXRpYWxEb21Sb290QXR0cmlidXRlcykgewogICAgICAgIGRvbVJvb3Quc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgaW5pdGlhbERvbVJvb3RBdHRyaWJ1dGVzW2F0dHJpYnV0ZV0pOwogICAgICB9CgogICAgICB0aGlzLmRvbVJvb3RzLmRlbGV0ZShuYW1lKTsKICAgICAgdGhpcy5kb21Db252ZXJ0ZXIudW5iaW5kRG9tRWxlbWVudChkb21Sb290KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0cyBET00gcm9vdCBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nbWFpbiddICBOYW1lIG9mIHRoZSByb290LgogICAgICogQHJldHVybnMge0VsZW1lbnR9IERPTSByb290IGVsZW1lbnQgaW5zdGFuY2UuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RG9tUm9vdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RG9tUm9vdCgpIHsKICAgICAgdmFyIG5hbWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICdtYWluJzsKICAgICAgcmV0dXJuIHRoaXMuZG9tUm9vdHMuZ2V0KG5hbWUpOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGVzIG9ic2VydmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlmIG5vdCB5ZXQgY3JlYXRlZCwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9vYnNlcnZlcn5PYnNlcnZlciNlbmFibGUgZW5hYmxlc30gaXQKICAgICAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyI29ic2VydmUgYXR0YWNoZXN9IHRvIGFsbCBleGlzdGluZyBhbmQgZnV0dXJlCiAgICAgKiB7QGxpbmsgI2RvbVJvb3RzIERPTSByb290c30uCiAgICAgKgogICAgICogTm90ZTogT2JzZXJ2ZXJzIGFyZSByZWNvZ25pemVkIGJ5IHRoZWlyIGNvbnN0cnVjdG9yIChjbGFzc2VzKS4gQSBzaW5nbGUgb2JzZXJ2ZXIgd2lsbCBiZSBpbnN0YW50aWF0ZWQgYW5kIHVzZWQgb25seQogICAgICogd2hlbiByZWdpc3RlcmVkIGZvciB0aGUgZmlyc3QgdGltZS4gVGhpcyBtZWFucyB0aGF0IGZlYXR1cmVzIGFuZCBvdGhlciBjb21wb25lbnRzIGNhbiByZWdpc3RlciBhIHNpbmdsZSBvYnNlcnZlcgogICAgICogbXVsdGlwbGUgdGltZXMgd2l0aG91dCBjYXJpbmcgd2hldGhlciBpdCBoYXMgYmVlbiBhbHJlYWR5IGFkZGVkIG9yIG5vdC4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBPYnNlcnZlciBUaGUgY29uc3RydWN0b3Igb2YgYW4gb2JzZXJ2ZXIgdG8gYWRkLgogICAgICogU2hvdWxkIGNyZWF0ZSBhbiBpbnN0YW5jZSBpbmhlcml0aW5nIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9vYnNlcnZlcn5PYnNlcnZlcn0uCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyfSBBZGRlZCBvYnNlcnZlciBpbnN0YW5jZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRPYnNlcnZlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkT2JzZXJ2ZXIoT2JzZXJ2ZXIpIHsKICAgICAgdmFyIG9ic2VydmVyID0gdGhpcy5fb2JzZXJ2ZXJzLmdldChPYnNlcnZlcik7CgogICAgICBpZiAob2JzZXJ2ZXIpIHsKICAgICAgICByZXR1cm4gb2JzZXJ2ZXI7CiAgICAgIH0KCiAgICAgIG9ic2VydmVyID0gbmV3IE9ic2VydmVyKHRoaXMpOwoKICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnNldChPYnNlcnZlciwgb2JzZXJ2ZXIpOwoKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZTsKICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yMiA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IyID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IyID0gdGhpcy5kb21Sb290c1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZSkgewogICAgICAgICAgdmFyIF9zdGVwMiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwMi52YWx1ZSwgMiksCiAgICAgICAgICAgICAgbmFtZSA9IF9zdGVwMiR2YWx1ZVswXSwKICAgICAgICAgICAgICBkb21FbGVtZW50ID0gX3N0ZXAyJHZhbHVlWzFdOwoKICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZG9tRWxlbWVudCwgbmFtZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgIF9pdGVyYXRvckVycm9yMiA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjIucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgb2JzZXJ2ZXIuZW5hYmxlKCk7CiAgICAgIHJldHVybiBvYnNlcnZlcjsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBvYnNlcnZlciBvZiB0aGUgZ2l2ZW4gdHlwZSBvciBgdW5kZWZpbmVkYCBpZiBzdWNoIG9ic2VydmVyIGhhcyBub3QgYmVlbiBhZGRlZCB5ZXQuCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gT2JzZXJ2ZXIgVGhlIGNvbnN0cnVjdG9yIG9mIGFuIG9ic2VydmVyIHRvIGdldC4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXJ8dW5kZWZpbmVkfSBPYnNlcnZlciBpbnN0YW5jZSBvciB1bmRlZmluZWQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0T2JzZXJ2ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9ic2VydmVyKE9ic2VydmVyKSB7CiAgICAgIHJldHVybiB0aGlzLl9vYnNlcnZlcnMuZ2V0KE9ic2VydmVyKTsKICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgYWxsIGFkZGVkIG9ic2VydmVycy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkaXNhYmxlT2JzZXJ2ZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlT2JzZXJ2ZXJzKCkgewogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSB0cnVlOwogICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IzID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjMgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjMgPSB0aGlzLl9vYnNlcnZlcnMudmFsdWVzKClbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDM7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMgPSAoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMyA9IHRydWUpIHsKICAgICAgICAgIHZhciBvYnNlcnZlciA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgIG9ic2VydmVyLmRpc2FibGUoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yMyA9IHRydWU7CiAgICAgICAgX2l0ZXJhdG9yRXJyb3IzID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zICYmIF9pdGVyYXRvcjMucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yMy5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yMykgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgYWxsIGFkZGVkIG9ic2VydmVycy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJlbmFibGVPYnNlcnZlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZU9ic2VydmVycygpIHsKICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gdHJ1ZTsKICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yNCA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3I0ID0gdW5kZWZpbmVkOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3I0ID0gdGhpcy5fb2JzZXJ2ZXJzLnZhbHVlcygpW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA0OyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ID0gKF9zdGVwNCA9IF9pdGVyYXRvcjQubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjQgPSB0cnVlKSB7CiAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICBvYnNlcnZlci5lbmFibGUoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yNCA9IHRydWU7CiAgICAgICAgX2l0ZXJhdG9yRXJyb3I0ID0gZXJyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb240ICYmIF9pdGVyYXRvcjQucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yNC5yZXR1cm4oKTsKICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yNCkgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNjcm9sbHMgdGhlIHBhZ2Ugdmlld3BvcnQgYW5kIHtAbGluayAjZG9tUm9vdHN9IHdpdGggdGhlaXIgYW5jZXN0b3JzIHRvIHJldmVhbCB0aGUKICAgICAqIGNhcmV0LCBpZiBub3QgYWxyZWFkeSB2aXNpYmxlIHRvIHRoZSB1c2VyLgogICAgICovCgogIH0sIHsKICAgIGtleTogInNjcm9sbFRvVGhlU2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzY3JvbGxUb1RoZVNlbGVjdGlvbigpIHsKICAgICAgdmFyIHJhbmdlID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpOwoKICAgICAgaWYgKHJhbmdlKSB7CiAgICAgICAgc2Nyb2xsVmlld3BvcnRUb1Nob3dUYXJnZXQoewogICAgICAgICAgdGFyZ2V0OiB0aGlzLmRvbUNvbnZlcnRlci52aWV3UmFuZ2VUb0RvbShyYW5nZSksCiAgICAgICAgICB2aWV3cG9ydE9mZnNldDogMjAKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJdCB3aWxsIGZvY3VzIERPTSBlbGVtZW50IHJlcHJlc2VudGluZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnQgRWRpdGFibGVFbGVtZW50fQogICAgICogdGhhdCBpcyBjdXJyZW50bHkgaGF2aW5nIHNlbGVjdGlvbiBpbnNpZGUuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzKCkgewogICAgICBpZiAoIXRoaXMuZG9jdW1lbnQuaXNGb2N1c2VkKSB7CiAgICAgICAgdmFyIGVkaXRhYmxlID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24uZWRpdGFibGVFbGVtZW50OwoKICAgICAgICBpZiAoZWRpdGFibGUpIHsKICAgICAgICAgIHRoaXMuZG9tQ29udmVydGVyLmZvY3VzKGVkaXRhYmxlKTsKICAgICAgICAgIHRoaXMuZm9yY2VSZW5kZXIoKTsKICAgICAgICB9IGVsc2Ugey8vIEJlZm9yZSBmb2N1c2luZyB2aWV3IGRvY3VtZW50LCBzZWxlY3Rpb24gc2hvdWxkIGJlIHBsYWNlZCBpbnNpZGUgb25lIG9mIHRoZSB2aWV3J3MgZWRpdGFibGVzLgogICAgICAgICAgLy8gTm9ybWFsbHkgaXRzIHNlbGVjdGlvbiB3aWxsIGJlIGNvbnZlcnRlZCBmcm9tIG1vZGVsIGRvY3VtZW50ICh3aGljaCBoYXZlIGRlZmF1bHQgc2VsZWN0aW9uKSwgYnV0CiAgICAgICAgICAvLyB3aGVuIHVzaW5nIHZpZXcgZG9jdW1lbnQgb24gaXRzIG93biwgd2UgbmVlZCB0byBtYW51YWxseSBwbGFjZSBzZWxlY3Rpb24gYmVmb3JlIGZvY3VzaW5nIGl0LgogICAgICAgICAgLy8KICAgICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdUaGVyZSBpcyBubyBzZWxlY3Rpb24gaW4gYW55IGVkaXRhYmxlIHRvIGZvY3VzLicgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVGhlIGBjaGFuZ2UoKWAgbWV0aG9kIGlzIHRoZSBwcmltYXJ5IHdheSBvZiBjaGFuZ2luZyB0aGUgdmlldy4gWW91IHNob3VsZCB1c2UgaXQgdG8gbW9kaWZ5IGFueSBub2RlIGluIHRoZSB2aWV3IHRyZWUuCiAgICAgKiBJdCBtYWtlcyBzdXJlIHRoYXQgYWZ0ZXIgYWxsIGNoYW5nZXMgYXJlIG1hZGUgdGhlIHZpZXcgaXMgcmVuZGVyZWQgdG8gdGhlIERPTSAoYXNzdW1pbmcgdGhhdCB0aGUgdmlldyB3aWxsIGJlIGNoYW5nZWQKICAgICAqIGluc2lkZSB0aGUgY2FsbGJhY2spLiBJdCBwcmV2ZW50cyBzaXR1YXRpb25zIHdoZW4gdGhlIERPTSBpcyB1cGRhdGVkIHdoZW4gdGhlIHZpZXcgc3RhdGUgaXMgbm90IHlldCBjb3JyZWN0LiBJdCBhbGxvd3MKICAgICAqIHRvIG5lc3QgY2FsbHMgb25lIGluc2lkZSBhbm90aGVyIGFuZCBzdGlsbCBwZXJmb3JtcyBhIHNpbmdsZSByZW5kZXJpbmcgYWZ0ZXIgYWxsIHRob3NlIGNoYW5nZXMgYXJlIG1hZGUuCiAgICAgKiBJdCBhbHNvIHJldHVybnMgdGhlIHJldHVybiB2YWx1ZSBvZiBpdHMgY2FsbGJhY2suCiAgICAgKgogICAgICoJCWNvbnN0IHRleHQgPSB2aWV3LmNoYW5nZSggd3JpdGVyID0+IHsKICAgICAqCQkJY29uc3QgbmV3VGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApOwogICAgICoJCQl3cml0ZXIuaW5zZXJ0KCBwb3NpdGlvbjEsIG5ld1RleHQgKTsKICAgICAqCiAgICAgKgkJCXZpZXcuY2hhbmdlKCB3cml0ZXIgPT4gewogICAgICoJCQkJd3JpdGVyLmluc2VydCggcG9zaXRpb24yLCB3cml0ZXIuY3JlYXRlVGV4dCggJ2JhcicgKSApOwogICAgICoJCQl9ICk7CiAgICAgKgogICAgICogCQkJd3JpdGVyLnJlbW92ZSggcmFuZ2UgKTsKICAgICAqCiAgICAgKiAJCQlyZXR1cm4gbmV3VGV4dDsKICAgICAqCQl9ICk7CiAgICAgKgogICAgICogV2hlbiB0aGUgb3V0ZXJtb3N0IGNoYW5nZSBibG9jayBpcyBkb25lIGFuZCByZW5kZXJpbmcgdG8gdGhlIERPTSBpcyBvdmVyIHRoZQogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZXZlbnQ6cmVuZGVyIGBWaWV3I3JlbmRlcmB9IGV2ZW50IGlzIGZpcmVkLgogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIHRocm93cyBhIGBhcHBseWluZy12aWV3LWNoYW5nZXMtb24tcmVuZGVyaW5nYCBlcnJvciB3aGVuCiAgICAgKiB0aGUgY2hhbmdlIGJsb2NrIGlzIHVzZWQgYWZ0ZXIgcmVuZGVyaW5nIHRvIHRoZSBET00gaGFzIHN0YXJ0ZWQuCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggbWF5IG1vZGlmeSB0aGUgdmlldy4KICAgICAqIEByZXR1cm5zIHsqfSBWYWx1ZSByZXR1cm5lZCBieSB0aGUgY2FsbGJhY2suCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFuZ2UoY2FsbGJhY2spIHsKICAgICAgaWYgKHRoaXMuaXNSZW5kZXJpbmdJblByb2dyZXNzIHx8IHRoaXMuX3Bvc3RGaXhlcnNJblByb2dyZXNzKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogVGhyb3duIHdoZW4gdGhlcmUgaXMgYW4gYXR0ZW1wdCB0byBtYWtlIGNoYW5nZXMgdG8gdGhlIHZpZXcgdHJlZSB3aGVuIGl0IGlzIGluIGluY29ycmVjdCBzdGF0ZS4gVGhpcyBtYXkKICAgICAgICAgKiBjYXVzZSBzb21lIHVuZXhwZWN0ZWQgYmVoYXZpb3VyIGFuZCBpbmNvbnNpc3RlbmN5IGJldHdlZW4gdGhlIERPTSBhbmQgdGhlIHZpZXcuCiAgICAgICAgICogVGhpcyBtYXkgYmUgY2F1c2VkIGJ5OgogICAgICAgICAqCiAgICAgICAgICogKiBjYWxsaW5nIHtAbGluayAjY2hhbmdlfSBvciB7QGxpbmsgI2ZvcmNlUmVuZGVyfSBkdXJpbmcgcmVuZGVyaW5nIHByb2Nlc3MsCiAgICAgICAgICogKiBjYWxsaW5nIHtAbGluayAjY2hhbmdlfSBvciB7QGxpbmsgI2ZvcmNlUmVuZGVyfSBpbnNpZGUgb2YKICAgICAgICAgKiAgIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjcmVnaXN0ZXJQb3N0Rml4ZXIgcG9zdC1maXhlciBmdW5jdGlvbn0uCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgY2Fubm90LWNoYW5nZS12aWV3LXRyZWUKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY2Fubm90LWNoYW5nZS12aWV3LXRyZWU6ICcgKyAnQXR0ZW1wdGluZyB0byBtYWtlIGNoYW5nZXMgdG8gdGhlIHZpZXcgd2hlbiBpdCBpcyBpbiBhbiBpbmNvcnJlY3Qgc3RhdGU6IHJlbmRlcmluZyBvciBwb3N0LWZpeGVycyBhcmUgaW4gcHJvZ3Jlc3MuICcgKyAnVGhpcyBtYXkgY2F1c2Ugc29tZSB1bmV4cGVjdGVkIGJlaGF2aW9yIGFuZCBpbmNvbnNpc3RlbmN5IGJldHdlZW4gdGhlIERPTSBhbmQgdGhlIHZpZXcuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgLy8gUmVjdXJzaXZlIGNhbGwgdG8gdmlldy5jaGFuZ2UoKSBtZXRob2QgLSBleGVjdXRlIGxpc3RlbmVyIGltbWVkaWF0ZWx5LgogICAgICAgIGlmICh0aGlzLl9vbmdvaW5nQ2hhbmdlKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodGhpcy5fd3JpdGVyKTsKICAgICAgICB9IC8vIFRoaXMgbG9jayB3aWxsIGFzc3VyZSB0aGF0IGFsbCByZWN1cnNpdmUgY2FsbHMgdG8gdmlldy5jaGFuZ2UoKSB3aWxsIGVuZCB1cCBpbiBzYW1lIGJsb2NrIC0gb25lICJyZW5kZXIiCiAgICAgICAgLy8gZXZlbnQgZm9yIGFsbCBuZXN0ZWQgY2FsbHMuCgoKICAgICAgICB0aGlzLl9vbmdvaW5nQ2hhbmdlID0gdHJ1ZTsKICAgICAgICB2YXIgY2FsbGJhY2tSZXN1bHQgPSBjYWxsYmFjayh0aGlzLl93cml0ZXIpOwogICAgICAgIHRoaXMuX29uZ29pbmdDaGFuZ2UgPSBmYWxzZTsgLy8gVGhpcyBsb2NrIGlzIHVzZWQgYnkgZWRpdGluZyBjb250cm9sbGVyIHRvIHJlbmRlciBjaGFuZ2VzIGZyb20gb3V0ZXIgbW9zdCBtb2RlbC5jaGFuZ2UoKSBvbmNlLiBBcyBwbHVnaW5zIG1pZ2h0IGNhbGwKICAgICAgICAvLyB2aWV3LmNoYW5nZSgpIGluc2lkZSBtb2RlbC5jaGFuZ2UoKSBibG9jayAtIHRoaXMgd2lsbCBlbnN1cmVzIHRoYXQgcG9zdGZpeGVycyBhbmQgcmVuZGVyaW5nIGFyZSBjYWxsZWQgb25jZSBhZnRlciBhbGwKICAgICAgICAvLyBjaGFuZ2VzLiBBbHNvLCB3ZSBkb24ndCBuZWVkIHRvIHJlbmRlciBhbnl0aGluZyBpZiB0aGVyZSdyZSBubyBjaGFuZ2VzIHNpbmNlIGxhc3QgcmVuZGVyaW5nLgoKICAgICAgICBpZiAoIXRoaXMuX3JlbmRlcmluZ0Rpc2FibGVkICYmIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcpIHsKICAgICAgICAgIHRoaXMuX3Bvc3RGaXhlcnNJblByb2dyZXNzID0gdHJ1ZTsKCiAgICAgICAgICB0aGlzLmRvY3VtZW50Ll9jYWxsUG9zdEZpeGVycyh0aGlzLl93cml0ZXIpOwoKICAgICAgICAgIHRoaXMuX3Bvc3RGaXhlcnNJblByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpcmUoJ3JlbmRlcicpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGxiYWNrUmVzdWx0OwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAvLyBAaWYgQ0tfREVCVUcgLy8gdGhyb3cgZXJyOwoKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIENLRWRpdG9yRXJyb3IucmV0aHJvd1VuZXhwZWN0ZWRFcnJvcihlcnIsIHRoaXMpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlcyByZW5kZXJpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCB2aWV3IGRvY3VtZW50fSB0byBET00uIElmIGFueSB2aWV3IGNoYW5nZXMgYXJlCiAgICAgKiBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MsIHJlbmRlcmluZyB3aWxsIHN0YXJ0IGFmdGVyIGFsbCB7QGxpbmsgI2NoYW5nZSBjaGFuZ2UgYmxvY2tzfSBhcmUgcHJvY2Vzc2VkLgogICAgICoKICAgICAqIE5vdGUgdGhhdCB0aGlzIG1ldGhvZCBpcyBkZWRpY2F0ZWQgZm9yIHNwZWNpYWwgY2FzZXMuIEFsbCB2aWV3IGNoYW5nZXMgc2hvdWxkIGJlIHdyYXBwZWQgaW4gdGhlIHtAbGluayAjY2hhbmdlfQogICAgICogYmxvY2sgYW5kIHRoZSB2aWV3IHdpbGwgYXV0b21hdGljYWxseSBjaGVjayB3aGV0aGVyIGl0IG5lZWRzIHRvIHJlbmRlciBET00gb3Igbm90LgogICAgICoKICAgICAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgYXBwbHlpbmctdmlldy1jaGFuZ2VzLW9uLXJlbmRlcmluZ2Agd2hlbgogICAgICogdHJ5aW5nIHRvIHJlLXJlbmRlciB3aGVuIHJlbmRlcmluZyB0byBET00gaGFzIGFscmVhZHkgc3RhcnRlZC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JjZVJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9yY2VSZW5kZXIoKSB7CiAgICAgIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcgPSB0cnVlOwogICAgICB0aGlzLmNoYW5nZShmdW5jdGlvbiAoKSB7fSk7CiAgICB9CiAgICAvKioKICAgICAqIERlc3Ryb3lzIHRoaXMgaW5zdGFuY2UuIE1ha2VzIHN1cmUgdGhhdCBhbGwgb2JzZXJ2ZXJzIGFyZSBkZXN0cm95ZWQgYW5kIGxpc3RlbmVycyByZW1vdmVkLgogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvcjUgPSBmYWxzZTsKICAgICAgdmFyIF9pdGVyYXRvckVycm9yNSA9IHVuZGVmaW5lZDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yNSA9IHRoaXMuX29ic2VydmVycy52YWx1ZXMoKVtTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwNTsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNSA9IChfc3RlcDUgPSBfaXRlcmF0b3I1Lm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb241ID0gdHJ1ZSkgewogICAgICAgICAgdmFyIG9ic2VydmVyID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgb2JzZXJ2ZXIuZGVzdHJveSgpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3I1ID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvcjUgPSBlcnI7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjUgJiYgX2l0ZXJhdG9yNS5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3I1LnJldHVybigpOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3I1KSB7CiAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yNTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZG9jdW1lbnQuZGVzdHJveSgpOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyBwb3NpdGlvbiBhdCB0aGUgZ2l2ZW4gbG9jYXRpb24uIFRoZSBsb2NhdGlvbiBjYW4gYmUgc3BlY2lmaWVkIGFzOgogICAgICoKICAgICAqICogYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSwKICAgICAqICogcGFyZW50IGVsZW1lbnQgYW5kIG9mZnNldCAob2Zmc2V0IGRlZmF1bHRzIHRvIGAwYCksCiAgICAgKiAqIHBhcmVudCBlbGVtZW50IGFuZCBgJ2VuZCdgIChzZXRzIHBvc2l0aW9uIGF0IHRoZSBlbmQgb2YgdGhhdCBlbGVtZW50KSwKICAgICAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgYCdiZWZvcmUnYCBvciBgJ2FmdGVyJ2AgKHNldHMgcG9zaXRpb24gYmVmb3JlIG9yIGFmdGVyIGdpdmVuIHZpZXcgaXRlbSkuCiAgICAgKgogICAgICogVGhpcyBtZXRob2QgaXMgYSBzaG9ydGN1dCB0byBvdGhlciBjb25zdHJ1Y3RvcnMgc3VjaCBhczoKICAgICAqCiAgICAgKiAqIHtAbGluayAjY3JlYXRlUG9zaXRpb25CZWZvcmV9LAogICAgICogKiB7QGxpbmsgI2NyZWF0ZVBvc2l0aW9uQWZ0ZXJ9LAogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbXxtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBpdGVtT3JQb3NpdGlvbgogICAgICogQHBhcmFtIHtOdW1iZXJ8J2VuZCd8J2JlZm9yZSd8J2FmdGVyJ30gW29mZnNldF0gT2Zmc2V0IG9yIG9uZSBvZiB0aGUgZmxhZ3MuIFVzZWQgb25seSB3aGVuCiAgICAgKiBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19LgogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZVBvc2l0aW9uQXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkgewogICAgICByZXR1cm4gUG9zaXRpb24uX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgbmV3IHBvc2l0aW9uIGFmdGVyIGdpdmVuIHZpZXcgaXRlbS4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW19IGl0ZW0gVmlldyBpdGVtIGFmdGVyIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgbG9jYXRlZC4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb259CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlUG9zaXRpb25BZnRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25BZnRlcihpdGVtKSB7CiAgICAgIHJldHVybiBQb3NpdGlvbi5fY3JlYXRlQWZ0ZXIoaXRlbSk7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZXMgYSBuZXcgcG9zaXRpb24gYmVmb3JlIGdpdmVuIHZpZXcgaXRlbS4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW19IGl0ZW0gVmlldyBpdGVtIGJlZm9yZSB3aGljaCB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGxvY2F0ZWQuCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufQogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZVBvc2l0aW9uQmVmb3JlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbkJlZm9yZShpdGVtKSB7CiAgICAgIHJldHVybiBQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKGl0ZW0pOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgcmFuZ2Ugc3Bhbm5pbmcgZnJvbSBgc3RhcnRgIHBvc2l0aW9uIHRvIGBlbmRgIHBvc2l0aW9uLgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGlzIGZhY3RvcnkgbWV0aG9kIGNyZWF0ZXMgaXQncyBvd24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0gaW5zdGFuY2VzIGJhc2luZyBvbiBwYXNzZWQgdmFsdWVzLgogICAgICoKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufSBzdGFydCBTdGFydCBwb3NpdGlvbi4KICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufSBbZW5kXSBFbmQgcG9zaXRpb24uIElmIG5vdCBzZXQsIHJhbmdlIHdpbGwgYmUgY29sbGFwc2VkIGF0IGBzdGFydGAgcG9zaXRpb24uCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfQogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZVJhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVSYW5nZShzdGFydCwgZW5kKSB7CiAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnQsIGVuZCk7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZXMgYSByYW5nZSB0aGF0IHN0YXJ0cyBiZWZvcmUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgZW5kcyBhZnRlciBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW19IGl0ZW0KICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlUmFuZ2VPbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUmFuZ2VPbihpdGVtKSB7CiAgICAgIHJldHVybiBSYW5nZS5fY3JlYXRlT24oaXRlbSk7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3QgY2hpbGQgb2YKICAgICAqIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgd2hpY2ggaXMgYSBwYXJlbnQgZm9yIHRoZSByYW5nZS4KICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlUmFuZ2VJbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlUmFuZ2VJbihlbGVtZW50KSB7CiAgICAgIHJldHVybiBSYW5nZS5fY3JlYXRlSW4oZWxlbWVudCk7CiAgICB9CiAgICAvKioKICAgICBDcmVhdGVzIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb259IGluc3RhbmNlLgogICAgICoKICAgICAqIAkJLy8gQ3JlYXRlcyBlbXB0eSBzZWxlY3Rpb24gd2l0aG91dCByYW5nZXMuCiAgICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gdmlldy5jcmVhdGVTZWxlY3Rpb24oKTsKICAgICAqCiAgICAgKgkJLy8gQ3JlYXRlcyBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHJhbmdlLgogICAgICoJCWNvbnN0IHJhbmdlID0gdmlldy5jcmVhdGVSYW5nZSggc3RhcnQsIGVuZCApOwogICAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHZpZXcuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSApOwogICAgICoKICAgICAqCQkvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcmFuZ2VzCiAgICAgKiAJCWNvbnN0IHJhbmdlcyA9IFsgdmlldy5jcmVhdGVSYW5nZSggc3RhcnQxLCBlbmQyICksIHZpZXcuY3JlYXRlUmFuZ2UoIHN0YXIyLCBlbmQyICkgXTsKICAgICAqCQljb25zdCBzZWxlY3Rpb24gPSB2aWV3LmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2VzICk7CiAgICAgKgogICAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGZyb20gdGhlIG90aGVyIHNlbGVjdGlvbi4KICAgICAqCQljb25zdCBvdGhlclNlbGVjdGlvbiA9IHZpZXcuY3JlYXRlU2VsZWN0aW9uKCk7CiAgICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gdmlldy5jcmVhdGVTZWxlY3Rpb24oIG90aGVyU2VsZWN0aW9uICk7CiAgICAgKgogICAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGZyb20gdGhlIGRvY3VtZW50IHNlbGVjdGlvbi4KICAgICAqCQljb25zdCBzZWxlY3Rpb24gPSB2aWV3LmNyZWF0ZVNlbGVjdGlvbiggZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb24gKTsKICAgICAqCiAgICAgKiAJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi4KICAgICAqCQljb25zdCBwb3NpdGlvbiA9IHZpZXcuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgcGF0aCApOwogICAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHZpZXcuY3JlYXRlU2VsZWN0aW9uKCBwb3NpdGlvbiApOwogICAgICoKICAgICAqCQkvLyBDcmVhdGVzIGNvbGxhcHNlZCBzZWxlY3Rpb24gYXQgdGhlIHBvc2l0aW9uIG9mIGdpdmVuIGl0ZW0gYW5kIG9mZnNldC4KICAgICAqCQljb25zdCBwYXJhZ3JhcGggPSB2aWV3LmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICdwYXJhZ3JhcGgnICk7CiAgICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gdmlldy5jcmVhdGVTZWxlY3Rpb24oIHBhcmFncmFwaCwgb2Zmc2V0ICk7CiAgICAgKgogICAgICoJCS8vIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUKICAgICAqCQkvLyBmaXJzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQgYW5kIGVuZHMgYWZ0ZXIgdGhlIGxhc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50LgogICAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHZpZXcuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsICdpbicgKTsKICAgICAqCiAgICAgKgkJLy8gQ3JlYXRlcyBhIHJhbmdlIG9uIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHMKICAgICAqCQkvLyBqdXN0IGFmdGVyIHRoZSBpdGVtLgogICAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHZpZXcuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsICdvbicgKTsKICAgICAqCiAgICAgKiBgU2VsZWN0aW9uYCdzIGZhY3RvcnkgbWV0aG9kIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBvcHRpb25zIChgYmFja3dhcmRgLCBgZmFrZWAgYW5kIGBsYWJlbGApIGFzIHRoZSBsYXN0IGFyZ3VtZW50LgogICAgICoKICAgICAqCQkvLyBDcmVhdGVzIGJhY2t3YXJkIHNlbGVjdGlvbi4KICAgICAqCQljb25zdCBzZWxlY3Rpb24gPSB2aWV3LmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2UsIHsgYmFja3dhcmQ6IHRydWUgfSApOwogICAgICoKICAgICAqIEZha2Ugc2VsZWN0aW9uIGRvZXMgbm90IHJlbmRlciBhcyBicm93c2VyIG5hdGl2ZSBzZWxlY3Rpb24gb3ZlciBzZWxlY3RlZCBlbGVtZW50cyBhbmQgaXMgaGlkZGVuIHRvIHRoZSB1c2VyLgogICAgICogVGhpcyB3YXksIG5vIG5hdGl2ZSBzZWxlY3Rpb24gVUkgYXJ0aWZhY3RzIGFyZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYW5kIHNlbGVjdGlvbiBvdmVyIGVsZW1lbnRzIGNhbiBiZQogICAgICogcmVwcmVzZW50ZWQgaW4gb3RoZXIgd2F5LCBmb3IgZXhhbXBsZSBieSBhcHBseWluZyBwcm9wZXIgQ1NTIGNsYXNzLgogICAgICoKICAgICAqIEFkZGl0aW9uYWxseSBmYWtlJ3Mgc2VsZWN0aW9uIGxhYmVsIGNhbiBiZSBwcm92aWRlZC4gSXQgd2lsbCBiZSB1c2VkIHRvIGRlc2NyaWJlIGZha2Ugc2VsZWN0aW9uIGluIERPTQogICAgICogKGFuZCBiZSAgcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuCiAgICAgKgogICAgICoJCS8vIENyZWF0ZXMgZmFrZSBzZWxlY3Rpb24gd2l0aCBsYWJlbC4KICAgICAqCQljb25zdCBzZWxlY3Rpb24gPSB2aWV3LmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2UsIHsgZmFrZTogdHJ1ZSwgbGFiZWw6ICdmb28nIH0gKTsKICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0YWJsZX0gW3NlbGVjdGFibGU9bnVsbF0KICAgICAqIEBwYXJhbSB7TnVtYmVyfCdiZWZvcmUnfCdlbmQnfCdhZnRlcid8J29uJ3wnaW4nfSBbcGxhY2VPck9mZnNldF0gT2Zmc2V0IG9yIHBsYWNlIHdoZW4gc2VsZWN0YWJsZSBpcyBhbiBgSXRlbWAuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmJhY2t3YXJkXSBTZXRzIHRoaXMgc2VsZWN0aW9uIGluc3RhbmNlIHRvIGJlIGJhY2t3YXJkLgogICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5mYWtlXSBTZXRzIHRoaXMgc2VsZWN0aW9uIGluc3RhbmNlIHRvIGJlIG1hcmtlZCBhcyBgZmFrZWAuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMubGFiZWxdIExhYmVsIGZvciB0aGUgZmFrZSBzZWxlY3Rpb24uCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb259CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlU2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTZWxlY3Rpb24oc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCwgb3B0aW9ucykgewogICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0LCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgb3IgZW5hYmxlcyByZW5kZXJpbmcuIElmIHRoZSBmbGFnIGlzIHNldCB0byBgdHJ1ZWAgdGhlbiB0aGUgcmVuZGVyaW5nIHdpbGwgYmUgZGlzYWJsZWQuCiAgICAgKiBJZiB0aGUgZmxhZyBpcyBzZXQgdG8gYGZhbHNlYCBhbmQgaWYgdGhlcmUgd2FzIHNvbWUgY2hhbmdlIGluIHRoZSBtZWFudGltZSwgdGhlbiB0aGUgcmVuZGVyaW5nIGFjdGlvbiB3aWxsIGJlIHBlcmZvcm1lZC4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGZsYWcgQSBmbGFnIGluZGljYXRlcyB3aGV0aGVyIHRoZSByZW5kZXJpbmcgc2hvdWxkIGJlIGRpc2FibGVkLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9kaXNhYmxlUmVuZGVyaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZGlzYWJsZVJlbmRlcmluZyhmbGFnKSB7CiAgICAgIHRoaXMuX3JlbmRlcmluZ0Rpc2FibGVkID0gZmxhZzsKCiAgICAgIGlmIChmbGFnID09IGZhbHNlKSB7CiAgICAgICAgLy8gUmVuZGVyIHdoZW4geW91IHN0b3AgYmxvY2tpbmcgcmVuZGVyaW5nLgogICAgICAgIHRoaXMuY2hhbmdlKGZ1bmN0aW9uICgpIHt9KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW5kZXJzIGFsbCBjaGFuZ2VzLiBJbiBvcmRlciB0byBhdm9pZCB0cmlnZ2VyaW5nIHRoZSBvYnNlcnZlcnMgKGUuZy4gbXV0YXRpb25zKSBhbGwgb2JzZXJ2ZXJzIGFyZSBkaXNhYmxlZAogICAgICogYmVmb3JlIHJlbmRlcmluZyBhbmQgcmUtZW5hYmxlZCBhZnRlciB0aGF0LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3JlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlcigpIHsKICAgICAgdGhpcy5pc1JlbmRlcmluZ0luUHJvZ3Jlc3MgPSB0cnVlOwogICAgICB0aGlzLmRpc2FibGVPYnNlcnZlcnMoKTsKCiAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbmRlcigpOwoKICAgICAgdGhpcy5lbmFibGVPYnNlcnZlcnMoKTsKICAgICAgdGhpcy5pc1JlbmRlcmluZ0luUHJvZ3Jlc3MgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogRmlyZWQgYWZ0ZXIgYSB0b3Btb3N0IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2NoYW5nZSBjaGFuZ2UgYmxvY2t9IGFuZCBhbGwKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjcmVnaXN0ZXJQb3N0Rml4ZXIgcG9zdC1maXhlcnN9IGFyZSBleGVjdXRlZC4KICAgICAqCiAgICAgKiBBY3R1YWwgcmVuZGVyaW5nIGlzIHBlcmZvcm1lZCBhcyBhIGZpcnN0IGxpc3RlbmVyIG9uICdub3JtYWwnIHByaW9yaXR5LgogICAgICoKICAgICAqCQl2aWV3Lm9uKCAncmVuZGVyJywgKCkgPT4gewogICAgICoJCQkvLyBSZW5kZXJpbmcgdG8gdGhlIERPTSBpcyBjb21wbGV0ZS4KICAgICAqCQl9ICk7CiAgICAgKgogICAgICogVGhpcyBldmVudCBpcyB1c2VmdWwgd2hlbiB5b3Ugd2FudCB0byB1cGRhdGUgaW50ZXJmYWNlIGVsZW1lbnRzIGFmdGVyIHRoZSByZW5kZXJpbmcsIGUuZy4gcG9zaXRpb24gb2YgdGhlCiAgICAgKiBiYWxsb29uIHBhbmVsLiBJZiB5b3Ugd2FudHMgdG8gY2hhbmdlIHZpZXcgc3RydWN0dXJlIHVzZQogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNyZWdpc3RlclBvc3RGaXhlciBwb3N0LWZpeGVyc30uCiAgICAgKgogICAgICogQGV2ZW50IG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZXZlbnQ6cmVuZGVyCiAgICAgKi8KCiAgfV0pOwoKICByZXR1cm4gVmlldzsKfSgpOwoKZXhwb3J0IHsgVmlldyBhcyBkZWZhdWx0IH07Cm1peChWaWV3LCBPYnNlcnZhYmxlTWl4aW4pOw=="},{"version":3,"sources":["C:/Users/pc/Desktop/Restoran/Restoran/Restoran.UI/client/node_modules/@ckeditor/ckeditor5-engine/src/view/view.js"],"names":["Document","DowncastWriter","Renderer","DomConverter","Position","Range","Selection","MutationObserver","KeyObserver","FakeSelectionObserver","SelectionObserver","FocusObserver","CompositionObserver","InputObserver","ObservableMixin","mix","scrollViewportToShowTarget","injectUiElementHandling","injectQuirksHandling","CKEditorError","env","View","stylesProcessor","document","domConverter","domRoots","Map","set","_renderer","selection","bind","to","_initialDomRootAttributes","WeakMap","_observers","_ongoingChange","_postFixersInProgress","_renderingDisabled","_hasChangedSinceTheLastRendering","_writer","addObserver","isAndroid","on","_render","fire","listenTo","domRoot","name","viewRoot","getRoot","_name","tagName","toLowerCase","initialDomRootAttributes","Array","from","attributes","value","addClass","split","setAttribute","updateContenteditableAttribute","isReadOnly","removeClass","bindElements","markToSync","domDocuments","add","ownerDocument","evt","node","change","values","observer","observe","get","forEach","removeAttribute","attribute","delete","unbindDomElement","Observer","domElement","enable","disable","range","getFirstRange","target","viewRangeToDom","viewportOffset","isFocused","editable","editableElement","focus","forceRender","callback","isRenderingInProgress","callbackResult","_callPostFixers","err","rethrowUnexpectedError","destroy","stopListening","itemOrPosition","offset","_createAt","item","_createAfter","_createBefore","start","end","_createOn","element","_createIn","selectable","placeOrOffset","options","flag","disableObservers","render","enableObservers"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/view/view\n */\n\nimport Document from './document';\nimport DowncastWriter from './downcastwriter';\nimport Renderer from './renderer';\nimport DomConverter from './domconverter';\nimport Position from './position';\nimport Range from './range';\nimport Selection from './selection';\n\nimport MutationObserver from './observer/mutationobserver';\nimport KeyObserver from './observer/keyobserver';\nimport FakeSelectionObserver from './observer/fakeselectionobserver';\nimport SelectionObserver from './observer/selectionobserver';\nimport FocusObserver from './observer/focusobserver';\nimport CompositionObserver from './observer/compositionobserver';\nimport InputObserver from './observer/inputobserver';\n\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport { scrollViewportToShowTarget } from '@ckeditor/ckeditor5-utils/src/dom/scroll';\nimport { injectUiElementHandling } from './uielement';\nimport { injectQuirksHandling } from './filler';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport env from '@ckeditor/ckeditor5-utils/src/env';\n\n/**\n * Editor's view controller class. Its main responsibility is DOM - View management for editing purposes, to provide\n * abstraction over the DOM structure and events and hide all browsers quirks.\n *\n * View controller renders view document to DOM whenever view structure changes. To determine when view can be rendered,\n * all changes need to be done using the {@link module:engine/view/view~View#change} method, using\n * {@link module:engine/view/downcastwriter~DowncastWriter}:\n *\n *\t\tview.change( writer => {\n *\t\t\twriter.insert( position, writer.createText( 'foo' ) );\n *\t\t} );\n *\n * View controller also register {@link module:engine/view/observer/observer~Observer observers} which observes changes\n * on DOM and fire events on the {@link module:engine/view/document~Document Document}.\n * Note that the following observers are added by the class constructor and are always available:\n *\n * * {@link module:engine/view/observer/mutationobserver~MutationObserver},\n * * {@link module:engine/view/observer/selectionobserver~SelectionObserver},\n * * {@link module:engine/view/observer/focusobserver~FocusObserver},\n * * {@link module:engine/view/observer/keyobserver~KeyObserver},\n * * {@link module:engine/view/observer/fakeselectionobserver~FakeSelectionObserver}.\n * * {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\n *\n * This class also {@link module:engine/view/view~View#attachDomRoot binds the DOM and the view elements}.\n *\n * If you do not need full a DOM - view management, and only want to transform a tree of view elements to a tree of DOM\n * elements you do not need this controller. You can use the {@link module:engine/view/domconverter~DomConverter DomConverter} instead.\n *\n * @mixes module:utils/observablemixin~ObservableMixin\n */\nexport default class View {\n\t/**\n\t * @param {module:engine/view/stylesmap~StylesProcessor} stylesProcessor The styles processor instance.\n\t */\n\tconstructor( stylesProcessor ) {\n\t\t/**\n\t\t * Instance of the {@link module:engine/view/document~Document} associated with this view controller.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/view/document~Document}\n\t\t */\n\t\tthis.document = new Document( stylesProcessor );\n\n\t\t/**\n\t\t * Instance of the {@link module:engine/view/domconverter~DomConverter domConverter} used by\n\t\t * {@link module:engine/view/view~View#_renderer renderer}\n\t\t * and {@link module:engine/view/observer/observer~Observer observers}.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/view/domconverter~DomConverter}\n\t\t */\n\t\tthis.domConverter = new DomConverter( this.document );\n\n\t\t/**\n\t\t * Roots of the DOM tree. Map on the `HTMLElement`s with roots names as keys.\n\t\t *\n\t\t * @readonly\n\t\t * @type {Map.<String, HTMLElement>}\n\t\t */\n\t\tthis.domRoots = new Map();\n\n\t\t/**\n\t\t * Used to prevent calling {@link #forceRender} and {@link #change} during rendering view to the DOM.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Boolean} #isRenderingInProgress\n\t\t */\n\t\tthis.set( 'isRenderingInProgress', false );\n\n\t\t/**\n\t\t * Instance of the {@link module:engine/view/renderer~Renderer renderer}.\n\t\t *\n\t\t * @protected\n\t\t * @type {module:engine/view/renderer~Renderer}\n\t\t */\n\t\tthis._renderer = new Renderer( this.domConverter, this.document.selection );\n\t\tthis._renderer.bind( 'isFocused' ).to( this.document );\n\n\t\t/**\n\t\t * A DOM root attributes cache. It saves the initial values of DOM root attributes before the DOM element\n\t\t * is {@link module:engine/view/view~View#attachDomRoot attached} to the view so later on, when\n\t\t * the view is destroyed ({@link module:engine/view/view~View#detachDomRoot}), they can be easily restored.\n\t\t * This way, the DOM element can go back to the (clean) state as if the editing view never used it.\n\t\t *\n\t\t * @private\n\t\t * @member {WeakMap.<HTMLElement,Object>}\n\t\t */\n\t\tthis._initialDomRootAttributes = new WeakMap();\n\n\t\t/**\n\t\t * Map of registered {@link module:engine/view/observer/observer~Observer observers}.\n\t\t *\n\t\t * @private\n\t\t * @type {Map.<Function, module:engine/view/observer/observer~Observer>}\n\t\t */\n\t\tthis._observers = new Map();\n\n\t\t/**\n\t\t * Is set to `true` when {@link #change view changes} are currently in progress.\n\t\t *\n\t\t * @private\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis._ongoingChange = false;\n\n\t\t/**\n\t\t * Used to prevent calling {@link #forceRender} and {@link #change} during rendering view to the DOM.\n\t\t *\n\t\t * @private\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis._postFixersInProgress = false;\n\n\t\t/**\n\t\t * Internal flag to temporary disable rendering. See the usage in the {@link #_disableRendering}.\n\t\t *\n\t\t * @private\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis._renderingDisabled = false;\n\n\t\t/**\n\t\t * Internal flag that disables rendering when there are no changes since the last rendering.\n\t\t * It stores information about changed selection and changed elements from attached document roots.\n\t\t *\n\t\t * @private\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis._hasChangedSinceTheLastRendering = false;\n\n\t\t/**\n\t\t * DowncastWriter instance used in {@link #change change method} callbacks.\n\t\t *\n\t\t * @private\n\t\t * @type {module:engine/view/downcastwriter~DowncastWriter}\n\t\t */\n\t\tthis._writer = new DowncastWriter( this.document );\n\n\t\t// Add default observers.\n\t\tthis.addObserver( MutationObserver );\n\t\tthis.addObserver( SelectionObserver );\n\t\tthis.addObserver( FocusObserver );\n\t\tthis.addObserver( KeyObserver );\n\t\tthis.addObserver( FakeSelectionObserver );\n\t\tthis.addObserver( CompositionObserver );\n\n\t\tif ( env.isAndroid ) {\n\t\t\tthis.addObserver( InputObserver );\n\t\t}\n\n\t\t// Inject quirks handlers.\n\t\tinjectQuirksHandling( this );\n\t\tinjectUiElementHandling( this );\n\n\t\t// Use 'normal' priority so that rendering is performed as first when using that priority.\n\t\tthis.on( 'render', () => {\n\t\t\tthis._render();\n\n\t\t\t// Informs that layout has changed after render.\n\t\t\tthis.document.fire( 'layoutChanged' );\n\n\t\t\t// Reset the `_hasChangedSinceTheLastRendering` flag after rendering.\n\t\t\tthis._hasChangedSinceTheLastRendering = false;\n\t\t} );\n\n\t\t// Listen to the document selection changes directly.\n\t\tthis.listenTo( this.document.selection, 'change', () => {\n\t\t\tthis._hasChangedSinceTheLastRendering = true;\n\t\t} );\n\t}\n\n\t/**\n\t * Attaches a DOM root element to the view element and enable all observers on that element.\n\t * Also {@link module:engine/view/renderer~Renderer#markToSync mark element} to be synchronized\n\t * with the view what means that all child nodes will be removed and replaced with content of the view root.\n\t *\n\t * This method also will change view element name as the same as tag name of given dom root.\n\t * Name is always transformed to lower case.\n\t *\n\t * **Note:** Use {@link #detachDomRoot `detachDomRoot()`} to revert this action.\n\t *\n\t * @param {Element} domRoot DOM root element.\n\t * @param {String} [name='main'] Name of the root.\n\t */\n\tattachDomRoot( domRoot, name = 'main' ) {\n\t\tconst viewRoot = this.document.getRoot( name );\n\n\t\t// Set view root name the same as DOM root tag name.\n\t\tviewRoot._name = domRoot.tagName.toLowerCase();\n\n\t\tconst initialDomRootAttributes = {};\n\n\t\t// 1. Copy and cache the attributes to remember the state of the element before attaching.\n\t\t//    The cached attributes will be restored in detachDomRoot() so the element goes to the\n\t\t//    clean state as if the editing view never used it.\n\t\t// 2. Apply the attributes using the view writer, so they all go under the control of the engine.\n\t\t//    The editing view takes over the attribute management completely because various\n\t\t//    features (e.g. addPlaceholder()) require dynamic changes of those attributes and they\n\t\t//    cannot be managed by the engine and the UI library at the same time.\n\t\tfor ( const { name, value } of Array.from( domRoot.attributes ) ) {\n\t\t\tinitialDomRootAttributes[ name ] = value;\n\n\t\t\t// Do not use writer.setAttribute() for the class attribute. The EditableUIView class\n\t\t\t// and its descendants could have already set some using the writer.addClass() on the view\n\t\t\t// document root. They haven't been rendered yet so they are not present in the DOM root.\n\t\t\t// Using writer.setAttribute( 'class', ... ) would override them completely.\n\t\t\tif ( name === 'class' ) {\n\t\t\t\tthis._writer.addClass( value.split( ' ' ), viewRoot );\n\t\t\t} else {\n\t\t\t\tthis._writer.setAttribute( name, value, viewRoot );\n\t\t\t}\n\t\t}\n\n\t\tthis._initialDomRootAttributes.set( domRoot, initialDomRootAttributes );\n\n\t\tconst updateContenteditableAttribute = () => {\n\t\t\tthis._writer.setAttribute( 'contenteditable', !viewRoot.isReadOnly, viewRoot );\n\n\t\t\tif ( viewRoot.isReadOnly ) {\n\t\t\t\tthis._writer.addClass( 'ck-read-only', viewRoot );\n\t\t\t} else {\n\t\t\t\tthis._writer.removeClass( 'ck-read-only', viewRoot );\n\t\t\t}\n\t\t};\n\n\t\t// Set initial value.\n\t\tupdateContenteditableAttribute();\n\n\t\tthis.domRoots.set( name, domRoot );\n\t\tthis.domConverter.bindElements( domRoot, viewRoot );\n\t\tthis._renderer.markToSync( 'children', viewRoot );\n\t\tthis._renderer.markToSync( 'attributes', viewRoot );\n\t\tthis._renderer.domDocuments.add( domRoot.ownerDocument );\n\n\t\tviewRoot.on( 'change:children', ( evt, node ) => this._renderer.markToSync( 'children', node ) );\n\t\tviewRoot.on( 'change:attributes', ( evt, node ) => this._renderer.markToSync( 'attributes', node ) );\n\t\tviewRoot.on( 'change:text', ( evt, node ) => this._renderer.markToSync( 'text', node ) );\n\t\tviewRoot.on( 'change:isReadOnly', () => this.change( updateContenteditableAttribute ) );\n\n\t\tviewRoot.on( 'change', () => {\n\t\t\tthis._hasChangedSinceTheLastRendering = true;\n\t\t} );\n\n\t\tfor ( const observer of this._observers.values() ) {\n\t\t\tobserver.observe( domRoot, name );\n\t\t}\n\t}\n\n\t/**\n\t * Detaches a DOM root element from the view element and restores its attributes to the state before\n\t * {@link #attachDomRoot `attachDomRoot()`}.\n\t *\n\t * @param {String} name Name of the root to detach.\n\t */\n\tdetachDomRoot( name ) {\n\t\tconst domRoot = this.domRoots.get( name );\n\n\t\t// Remove all root attributes so the DOM element is \"bare\".\n\t\tArray.from( domRoot.attributes ).forEach( ( { name } ) => domRoot.removeAttribute( name ) );\n\n\t\tconst initialDomRootAttributes = this._initialDomRootAttributes.get( domRoot );\n\n\t\t// Revert all view root attributes back to the state before attachDomRoot was called.\n\t\tfor ( const attribute in initialDomRootAttributes ) {\n\t\t\tdomRoot.setAttribute( attribute, initialDomRootAttributes[ attribute ] );\n\t\t}\n\n\t\tthis.domRoots.delete( name );\n\t\tthis.domConverter.unbindDomElement( domRoot );\n\t}\n\n\t/**\n\t * Gets DOM root element.\n\t *\n\t * @param {String} [name='main']  Name of the root.\n\t * @returns {Element} DOM root element instance.\n\t */\n\tgetDomRoot( name = 'main' ) {\n\t\treturn this.domRoots.get( name );\n\t}\n\n\t/**\n\t * Creates observer of the given type if not yet created, {@link module:engine/view/observer/observer~Observer#enable enables} it\n\t * and {@link module:engine/view/observer/observer~Observer#observe attaches} to all existing and future\n\t * {@link #domRoots DOM roots}.\n\t *\n\t * Note: Observers are recognized by their constructor (classes). A single observer will be instantiated and used only\n\t * when registered for the first time. This means that features and other components can register a single observer\n\t * multiple times without caring whether it has been already added or not.\n\t *\n\t * @param {Function} Observer The constructor of an observer to add.\n\t * Should create an instance inheriting from {@link module:engine/view/observer/observer~Observer}.\n\t * @returns {module:engine/view/observer/observer~Observer} Added observer instance.\n\t */\n\taddObserver( Observer ) {\n\t\tlet observer = this._observers.get( Observer );\n\n\t\tif ( observer ) {\n\t\t\treturn observer;\n\t\t}\n\n\t\tobserver = new Observer( this );\n\n\t\tthis._observers.set( Observer, observer );\n\n\t\tfor ( const [ name, domElement ] of this.domRoots ) {\n\t\t\tobserver.observe( domElement, name );\n\t\t}\n\n\t\tobserver.enable();\n\n\t\treturn observer;\n\t}\n\n\t/**\n\t * Returns observer of the given type or `undefined` if such observer has not been added yet.\n\t *\n\t * @param {Function} Observer The constructor of an observer to get.\n\t * @returns {module:engine/view/observer/observer~Observer|undefined} Observer instance or undefined.\n\t */\n\tgetObserver( Observer ) {\n\t\treturn this._observers.get( Observer );\n\t}\n\n\t/**\n\t * Disables all added observers.\n\t */\n\tdisableObservers() {\n\t\tfor ( const observer of this._observers.values() ) {\n\t\t\tobserver.disable();\n\t\t}\n\t}\n\n\t/**\n\t * Enables all added observers.\n\t */\n\tenableObservers() {\n\t\tfor ( const observer of this._observers.values() ) {\n\t\t\tobserver.enable();\n\t\t}\n\t}\n\n\t/**\n\t * Scrolls the page viewport and {@link #domRoots} with their ancestors to reveal the\n\t * caret, if not already visible to the user.\n\t */\n\tscrollToTheSelection() {\n\t\tconst range = this.document.selection.getFirstRange();\n\n\t\tif ( range ) {\n\t\t\tscrollViewportToShowTarget( {\n\t\t\t\ttarget: this.domConverter.viewRangeToDom( range ),\n\t\t\t\tviewportOffset: 20\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * It will focus DOM element representing {@link module:engine/view/editableelement~EditableElement EditableElement}\n\t * that is currently having selection inside.\n\t */\n\tfocus() {\n\t\tif ( !this.document.isFocused ) {\n\t\t\tconst editable = this.document.selection.editableElement;\n\n\t\t\tif ( editable ) {\n\t\t\t\tthis.domConverter.focus( editable );\n\t\t\t\tthis.forceRender();\n\t\t\t} else {\n\t\t\t\t// Before focusing view document, selection should be placed inside one of the view's editables.\n\t\t\t\t// Normally its selection will be converted from model document (which have default selection), but\n\t\t\t\t// when using view document on its own, we need to manually place selection before focusing it.\n\t\t\t\t//\n\t\t\t\t// @if CK_DEBUG // console.warn( 'There is no selection in any editable to focus.' );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * The `change()` method is the primary way of changing the view. You should use it to modify any node in the view tree.\n\t * It makes sure that after all changes are made the view is rendered to the DOM (assuming that the view will be changed\n\t * inside the callback). It prevents situations when the DOM is updated when the view state is not yet correct. It allows\n\t * to nest calls one inside another and still performs a single rendering after all those changes are made.\n\t * It also returns the return value of its callback.\n\t *\n\t *\t\tconst text = view.change( writer => {\n\t *\t\t\tconst newText = writer.createText( 'foo' );\n\t *\t\t\twriter.insert( position1, newText );\n\t *\n\t *\t\t\tview.change( writer => {\n\t *\t\t\t\twriter.insert( position2, writer.createText( 'bar' ) );\n\t *\t\t\t} );\n\t *\n\t * \t\t\twriter.remove( range );\n\t *\n\t * \t\t\treturn newText;\n\t *\t\t} );\n\t *\n\t * When the outermost change block is done and rendering to the DOM is over the\n\t * {@link module:engine/view/view~View#event:render `View#render`} event is fired.\n\t *\n\t * This method throws a `applying-view-changes-on-rendering` error when\n\t * the change block is used after rendering to the DOM has started.\n\t *\n\t * @param {Function} callback Callback function which may modify the view.\n\t * @returns {*} Value returned by the callback.\n\t */\n\tchange( callback ) {\n\t\tif ( this.isRenderingInProgress || this._postFixersInProgress ) {\n\t\t\t/**\n\t\t\t * Thrown when there is an attempt to make changes to the view tree when it is in incorrect state. This may\n\t\t\t * cause some unexpected behaviour and inconsistency between the DOM and the view.\n\t\t\t * This may be caused by:\n\t\t\t *\n\t\t\t * * calling {@link #change} or {@link #forceRender} during rendering process,\n\t\t\t * * calling {@link #change} or {@link #forceRender} inside of\n\t\t\t *   {@link module:engine/view/document~Document#registerPostFixer post-fixer function}.\n\t\t\t *\n\t\t\t * @error cannot-change-view-tree\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'cannot-change-view-tree: ' +\n\t\t\t\t'Attempting to make changes to the view when it is in an incorrect state: rendering or post-fixers are in progress. ' +\n\t\t\t\t'This may cause some unexpected behavior and inconsistency between the DOM and the view.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\ttry {\n\t\t\t// Recursive call to view.change() method - execute listener immediately.\n\t\t\tif ( this._ongoingChange ) {\n\t\t\t\treturn callback( this._writer );\n\t\t\t}\n\n\t\t\t// This lock will assure that all recursive calls to view.change() will end up in same block - one \"render\"\n\t\t\t// event for all nested calls.\n\t\t\tthis._ongoingChange = true;\n\t\t\tconst callbackResult = callback( this._writer );\n\t\t\tthis._ongoingChange = false;\n\n\t\t\t// This lock is used by editing controller to render changes from outer most model.change() once. As plugins might call\n\t\t\t// view.change() inside model.change() block - this will ensures that postfixers and rendering are called once after all\n\t\t\t// changes. Also, we don't need to render anything if there're no changes since last rendering.\n\t\t\tif ( !this._renderingDisabled && this._hasChangedSinceTheLastRendering ) {\n\t\t\t\tthis._postFixersInProgress = true;\n\t\t\t\tthis.document._callPostFixers( this._writer );\n\t\t\t\tthis._postFixersInProgress = false;\n\n\t\t\t\tthis.fire( 'render' );\n\t\t\t}\n\n\t\t\treturn callbackResult;\n\t\t} catch ( err ) {\n\t\t\t// @if CK_DEBUG // throw err;\n\t\t\t/* istanbul ignore next */\n\t\t\tCKEditorError.rethrowUnexpectedError( err, this );\n\t\t}\n\t}\n\n\t/**\n\t * Forces rendering {@link module:engine/view/document~Document view document} to DOM. If any view changes are\n\t * currently in progress, rendering will start after all {@link #change change blocks} are processed.\n\t *\n\t * Note that this method is dedicated for special cases. All view changes should be wrapped in the {@link #change}\n\t * block and the view will automatically check whether it needs to render DOM or not.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `applying-view-changes-on-rendering` when\n\t * trying to re-render when rendering to DOM has already started.\n\t */\n\tforceRender() {\n\t\tthis._hasChangedSinceTheLastRendering = true;\n\t\tthis.change( () => {} );\n\t}\n\n\t/**\n\t * Destroys this instance. Makes sure that all observers are destroyed and listeners removed.\n\t */\n\tdestroy() {\n\t\tfor ( const observer of this._observers.values() ) {\n\t\t\tobserver.destroy();\n\t\t}\n\n\t\tthis.document.destroy();\n\n\t\tthis.stopListening();\n\t}\n\n\t/**\n\t * Creates position at the given location. The location can be specified as:\n\t *\n\t * * a {@link module:engine/view/position~Position position},\n\t * * parent element and offset (offset defaults to `0`),\n\t * * parent element and `'end'` (sets position at the end of that element),\n\t * * {@link module:engine/view/item~Item view item} and `'before'` or `'after'` (sets position before or after given view item).\n\t *\n\t * This method is a shortcut to other constructors such as:\n\t *\n\t * * {@link #createPositionBefore},\n\t * * {@link #createPositionAfter},\n\t *\n\t * @param {module:engine/view/item~Item|module:engine/model/position~Position} itemOrPosition\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\n\t */\n\tcreatePositionAt( itemOrPosition, offset ) {\n\t\treturn Position._createAt( itemOrPosition, offset );\n\t}\n\n\t/**\n\t * Creates a new position after given view item.\n\t *\n\t * @param {module:engine/view/item~Item} item View item after which the position should be located.\n\t * @returns {module:engine/view/position~Position}\n\t */\n\tcreatePositionAfter( item ) {\n\t\treturn Position._createAfter( item );\n\t}\n\n\t/**\n\t * Creates a new position before given view item.\n\t *\n\t * @param {module:engine/view/item~Item} item View item before which the position should be located.\n\t * @returns {module:engine/view/position~Position}\n\t */\n\tcreatePositionBefore( item ) {\n\t\treturn Position._createBefore( item );\n\t}\n\n\t/**\n\t * Creates a range spanning from `start` position to `end` position.\n\t *\n\t * **Note:** This factory method creates it's own {@link module:engine/view/position~Position} instances basing on passed values.\n\t *\n\t * @param {module:engine/view/position~Position} start Start position.\n\t * @param {module:engine/view/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\n\t * @returns {module:engine/view/range~Range}\n\t */\n\tcreateRange( start, end ) {\n\t\treturn new Range( start, end );\n\t}\n\n\t/**\n\t * Creates a range that starts before given {@link module:engine/view/item~Item view item} and ends after it.\n\t *\n\t * @param {module:engine/view/item~Item} item\n\t * @returns {module:engine/view/range~Range}\n\t */\n\tcreateRangeOn( item ) {\n\t\treturn Range._createOn( item );\n\t}\n\n\t/**\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\n\t * that element and ends after the last child of that element.\n\t *\n\t * @param {module:engine/view/element~Element} element Element which is a parent for the range.\n\t * @returns {module:engine/view/range~Range}\n\t */\n\tcreateRangeIn( element ) {\n\t\treturn Range._createIn( element );\n\t}\n\n\t/**\n\t Creates new {@link module:engine/view/selection~Selection} instance.\n\t *\n\t * \t\t// Creates empty selection without ranges.\n\t *\t\tconst selection = view.createSelection();\n\t *\n\t *\t\t// Creates selection at the given range.\n\t *\t\tconst range = view.createRange( start, end );\n\t *\t\tconst selection = view.createSelection( range );\n\t *\n\t *\t\t// Creates selection at the given ranges\n\t * \t\tconst ranges = [ view.createRange( start1, end2 ), view.createRange( star2, end2 ) ];\n\t *\t\tconst selection = view.createSelection( ranges );\n\t *\n\t *\t\t// Creates selection from the other selection.\n\t *\t\tconst otherSelection = view.createSelection();\n\t *\t\tconst selection = view.createSelection( otherSelection );\n\t *\n\t *\t\t// Creates selection from the document selection.\n\t *\t\tconst selection = view.createSelection( editor.editing.view.document.selection );\n\t *\n\t * \t\t// Creates selection at the given position.\n\t *\t\tconst position = view.createPositionFromPath( root, path );\n\t *\t\tconst selection = view.createSelection( position );\n\t *\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\n\t *\t\tconst paragraph = view.createContainerElement( 'paragraph' );\n\t *\t\tconst selection = view.createSelection( paragraph, offset );\n\t *\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\n\t *\t\t// first child of that element and ends after the last child of that element.\n\t *\t\tconst selection = view.createSelection( paragraph, 'in' );\n\t *\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\n\t *\t\t// just after the item.\n\t *\t\tconst selection = view.createSelection( paragraph, 'on' );\n\t *\n\t * `Selection`'s factory method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\n\t *\n\t *\t\t// Creates backward selection.\n\t *\t\tconst selection = view.createSelection( range, { backward: true } );\n\t *\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\n\t * represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\n\t * (and be  properly handled by screen readers).\n\t *\n\t *\t\t// Creates fake selection with label.\n\t *\t\tconst selection = view.createSelection( range, { fake: true, label: 'foo' } );\n\t *\n\t * @param {module:engine/view/selection~Selectable} [selectable=null]\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\n\t * @param {Object} [options]\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\n\t * @param {String} [options.label] Label for the fake selection.\n\t * @returns {module:engine/view/selection~Selection}\n\t */\n\tcreateSelection( selectable, placeOrOffset, options ) {\n\t\treturn new Selection( selectable, placeOrOffset, options );\n\t}\n\n\t/**\n\t * Disables or enables rendering. If the flag is set to `true` then the rendering will be disabled.\n\t * If the flag is set to `false` and if there was some change in the meantime, then the rendering action will be performed.\n\t *\n\t * @protected\n\t * @param {Boolean} flag A flag indicates whether the rendering should be disabled.\n\t */\n\t_disableRendering( flag ) {\n\t\tthis._renderingDisabled = flag;\n\n\t\tif ( flag == false ) {\n\t\t\t// Render when you stop blocking rendering.\n\t\t\tthis.change( () => {} );\n\t\t}\n\t}\n\n\t/**\n\t * Renders all changes. In order to avoid triggering the observers (e.g. mutations) all observers are disabled\n\t * before rendering and re-enabled after that.\n\t *\n\t * @private\n\t */\n\t_render() {\n\t\tthis.isRenderingInProgress = true;\n\t\tthis.disableObservers();\n\t\tthis._renderer.render();\n\t\tthis.enableObservers();\n\t\tthis.isRenderingInProgress = false;\n\t}\n\n\t/**\n\t * Fired after a topmost {@link module:engine/view/view~View#change change block} and all\n\t * {@link module:engine/view/document~Document#registerPostFixer post-fixers} are executed.\n\t *\n\t * Actual rendering is performed as a first listener on 'normal' priority.\n\t *\n\t *\t\tview.on( 'render', () => {\n\t *\t\t\t// Rendering to the DOM is complete.\n\t *\t\t} );\n\t *\n\t * This event is useful when you want to update interface elements after the rendering, e.g. position of the\n\t * balloon panel. If you wants to change view structure use\n\t * {@link module:engine/view/document~Document#registerPostFixer post-fixers}.\n\t *\n\t * @event module:engine/view/view~View#event:render\n\t */\n}\n\nmix( View, ObservableMixin );\n"]}]}